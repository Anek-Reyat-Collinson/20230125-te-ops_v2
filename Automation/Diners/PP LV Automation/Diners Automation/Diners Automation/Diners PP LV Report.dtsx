<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="4/13/2023 3:16:09 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="TCG04246CDE"
  DTS:CreatorName="TCG\Harshad.Deshmukh"
  DTS:DTSID="{C79771D2-635B-42AF-815C-171B05FF7B2F}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="13.0.2165.0"
  DTS:LocaleID="1033"
  DTS:ObjectName="Diners PP LV Report"
  DTS:PackageType="5"
  DTS:VersionBuild="30"
  DTS:VersionGUID="{99F4F633-807A-4E30-99EF-AF53C2FAD3E3}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[Excel Connection Manager]"
      DTS:CreationName="EXCEL"
      DTS:DTSID="{875EED53-89E1-4184-B0D0-4743C4F4A2F1}"
      DTS:ObjectName="Excel Connection Manager">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Provider=Microsoft.ACE.OLEDB.12.0;Data Source=O:\8. Team\Harshad\Ops Automation\Dev\Diners\Diners PP - LV Report.xlsx;Extended Properties=&quot;EXCEL 12.0 XML;HDR=YES&quot;;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[OpsBilling]"
      DTS:CreationName="OLEDB"
      DTS:DelayValidation="True"
      DTS:DTSID="{C5DE9366-DD67-40CC-B134-950655E0938F}"
      DTS:ObjectName="OpsBilling">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:Retain="True"
          DTS:ConnectionString="Data Source=10.204.200.112;Initial Catalog=OpsBilling;Provider=SQLNCLI11.1;Integrated Security=SSPI;Auto Translate=False;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[PPASS]"
      DTS:CreationName="OLEDB"
      DTS:DelayValidation="True"
      DTS:DTSID="{969074CA-2F8D-44CD-A60D-D3DA277424DB}"
      DTS:ObjectName="PPASS">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:Retain="True"
          DTS:ConnectionString="Data Source=10.204.200.67;User ID=OPSBI_ETL;Initial Catalog=PPass;Provider=SQLNCLI11.1;Persist Security Info=True;Auto Translate=False;">
          <DTS:Password
            DTS:Name="Password"
            Sensitive="1"
            Encrypted="1">AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAobSyZUS7OEu+u3XoyiEzggAAAAAIAAAARABUAFMAAAADZgAAwAAAABAAAACWqVupw9htVtI0tT0A0QkNAAAAAASAAACgAAAAEAAAAAPUQhl11nsy/S49FUjqKIAgAAAAox+AjCGMQZO7FtDu0AuiO1bl6za0uHJR3GUi5a338V4UAAAAvq7twkjpxW7FB4hJc8MedCu4jJ8</DTS:Password>
        </DTS:ConnectionManager>
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:Variables>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{AA4EDF99-C6DC-4AC1-9E09-7D1B650FDB1E}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="&quot;TRUNCATE TABLE rprt.VisitBySourceDinersPPAutomation&quot;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="delQurey">
      <DTS:VariableValue
        DTS:DataType="8">TRUNCATE TABLE rprt.VisitBySourceDinersPPAutomation</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{49211D86-5C29-466F-9646-5CF88439453D}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="UPPER( @[$Project::strUseReportMonth])   == &quot;Y&quot; ?   (DT_DATE)(DT_DBDATE)DATEADD(&quot;D&quot;,-(DAY(DATEADD(&quot;M&quot;,1,@[$Project::dtReportMonth]))),DATEADD(&quot;M&quot;,1,@[$Project::dtReportMonth])): (DT_DATE)(DT_DBDATE)DATEADD(&quot;D&quot;,-(DAY(DATEADD(&quot;M&quot;,1,Dateadd(&quot;M&quot;,-1 ,getdate())))),DATEADD(&quot;M&quot;,1,Dateadd(&quot;M&quot;,-1 ,getdate())))"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="dtEndDate">
      <DTS:VariableValue
        DTS:DataType="7">4/30/2023</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{032BCA02-3ABC-4EE3-B147-15C13F67128A}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="UPPER( @[$Project::strUseReportMonth])   == &quot;Y&quot; ?   (DT_DATE)(DT_DBDATE)Dateadd(&quot;D&quot;,-1*Day( @[$Project::dtReportMonth] ) +1,    @[$Project::dtReportMonth]): (DT_DATE)(DT_DBDATE) Dateadd(&quot;D&quot;,-1*Day(Dateadd(&quot;M&quot;,-1 ,getdate())) +1  ,Dateadd(&quot;M&quot;,-1 ,getdate()))"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="dtReportMonth">
      <DTS:VariableValue
        DTS:DataType="7">4/1/2023</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{76B141CB-F691-4068-AE4D-58C5C28CE4B6}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="UPPER( @[$Project::strUseReportMonth])   == &quot;Y&quot; ?   (DT_DATE)(DT_DBDATE)Dateadd(&quot;D&quot;,-1*Day( @[$Project::dtReportMonth] ) +1,    @[$Project::dtReportMonth]): (DT_DATE)(DT_DBDATE) Dateadd(&quot;D&quot;,-1*Day(Dateadd(&quot;M&quot;,-1 ,getdate())) +1  ,Dateadd(&quot;M&quot;,-1 ,getdate()))"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="dtStartDate">
      <DTS:VariableValue
        DTS:DataType="7">4/1/2023</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{7A3E97E7-179C-4A03-94D7-B3124FC373C6}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="&quot;DECLARE @StartDate VARCHAR(10)=&quot;+ &quot;'&quot;+(DT_WSTR, 10) @[User::dtStartDate] +&quot;'&quot;+ &quot;&#xA;DECLARE @EndDate VARCHAR(10)=&quot;+ &quot;'&quot;+(DT_WSTR, 10) @[User::dtEndDate] +&quot;'&quot;+ &quot;&#xA;&#xA;DECLARE @var_startDate VARCHAR(10)&#xA;SET @var_startDate=CONVERT(CHAR(8),CONVERT(date,@StartDate,103),112)&#xA;DECLARE @var_endDate VARCHAR(10)&#xA;SET @var_endDate=CONVERT(CHAR(8),CONVERT(date,@EndDate,103),112)&#xA;&#xA;&#xA;IF OBJECT_ID('tempdb..##temptable') IS NOT NULL&#xA;&#x9;DROP TABLE ##temptable&#xA;&#xA;CREATE TABLE ##temptable (&#xA;&#x9;&#x9;Process_Month VARCHAR(10),&#xA;&#x9;&#x9;source_code &#x9;&#x9;varchar(20),&#xA;&#x9;&#x9;consumer_no &#x9;&#x9;INT NOT NULL,&#xA;&#x9;&#x9;external_identifier BIGINT NULL,&#xA;&#x9;&#x9;membership_no &#x9;&#x9;BIGINT NULL,&#xA;&#x9;&#x9;purchase_no &#x9;&#x9;INT NOT NULL,&#xA;&#x9;&#x9;track_seq &#x9;&#x9;&#x9;INT NOT NULL,&#xA;&#x9;&#x9;title &#x9;&#x9;&#x9;&#x9;varchar(20),&#xA;&#x9;&#x9;cardholdername&#x9;    varchar(max),&#xA;&#x9;&#x9;forename &#x9;&#x9;&#x9;varchar(50),&#xA;&#x9;&#x9;surname &#x9;&#x9;&#x9;varchar(50),&#xA;&#x9;&#x9;fullname &#x9;&#x9;&#x9;varchar(120),&#xA;&#x9;&#x9;source_desc &#x9;&#x9;varchar(255),&#xA;&#x9;&#x9;product_version &#x9;varchar(20),&#xA;&#x9;&#x9;paid_to_date &#x9;&#x9;date,&#xA;&#x9;&#x9;subs_issue_date &#x9;date,&#xA;&#x9;&#x9;subs_status &#x9;&#x9;varchar(5),&#xA;&#x9;&#x9;track_start &#x9;&#x9;date,&#xA;&#x9;&#x9;track_guests &#x9;&#x9;INT,&#xA;&#x9;&#x9;track_from &#x9;&#x9;&#x9;varchar(20),&#xA;&#x9;&#x9;track_value &#x9;&#x9;FLOAT,&#xA;&#x9;&#x9;creation_date &#x9;&#x9;date,&#xA;&#x9;&#x9;lounge_name&#x9;&#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;airport &#x9;&#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;trans_ccard_number &#x9;varchar(100),&#xA;&#x9;&#x9;external_ref &#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;track_batch &#x9;&#x9;INT,&#xA;&#x9;&#x9;old_system_ref &#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;campaign_code &#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;lounge_code&#x9;&#x9;&#x9;varchar(20),&#xA;&#x9;&#x9;city &#x9;&#x9;&#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;country &#x9;&#x9;&#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;vendor_tracking_code &#x9;varchar(100),&#xA;&#x9;&#x9;user_invitation_code &#x9;varchar(100),&#xA;&#x9;&#x9;remaining_mem_cli_count int,&#xA;&#x9;&#x9;remaining_mem_cli2_count int,&#xA;&#x9;&#x9;remaining_mem_pp_count &#x9;int,&#xA;&#x9;&#x9;remaining_gue_cli_count int,&#xA;&#x9;&#x9;remaining_gue_cli2_count int,&#xA;&#x9;&#x9;remaining_gue_pp_count &#x9;int,&#xA;&#x9;&#x9;remaining_mgu_cli_count int,&#xA;&#x9;&#x9;remaining_mgu_cli2_count int,&#xA;&#x9;&#x9;remaining_mgu_pp_count &#x9;int,&#xA;&#x9;&#x9;remaining_mgu_comp_count int,&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;experience_category &#x9;varchar(100),&#xA;&#x9;&#x9;experience_type &#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;airport_terminal_name  varchar(100),&#xA;&#x9;&#x9;airport_terminal_type  varchar(100),&#xA;&#x9;&#x9;visit_type_id SMALLINT,&#xA;&#x9;&#x9;visit_type&#x9;INT,&#xA;&#x9;&#x9;ccard_type VARCHAR(100),&#xA;&#x9;&#x9;effective_date DATETIME2,&#xA;&#x9;&#x9;report_month date&#xA;&#xA;);&#xA;&#xA;&#xA;INSERT INTO ##temptable(&#x9;&#xA;&#x9;Process_Month,&#xA;&#x9;source_code,&#xA;&#x9;consumer_no,&#xA;&#x9;external_identifier,&#xA;&#x9;membership_no,&#xA;&#x9;purchase_no,&#xA;&#x9;track_seq,&#xA;&#x9;title,&#xA;&#x9;cardholdername,&#xA;&#x9;forename,&#xA;&#x9;surname,&#xA;&#x9;fullname,&#xA;&#x9;source_desc,&#xA;&#x9;product_version,&#xA;&#x9;paid_to_date,&#xA;&#x9;subs_issue_date,&#xA;&#x9;subs_status,&#xA;&#x9;track_start,&#xA;&#x9;track_guests,&#xA;&#x9;track_from,&#xA;&#x9;track_value,&#xA;&#x9;creation_date,&#xA;&#x9;lounge_name,&#xA;&#x9;airport,&#xA;&#x9;trans_ccard_number,&#xA;&#x9;external_ref,&#xA;&#x9;track_batch,&#xA;&#x9;old_system_ref,&#xA;&#x9;campaign_code,&#xA;&#x9;lounge_code,&#xA;&#x9;city,&#xA;&#x9;country,&#xA;&#x9;vendor_tracking_code,&#xA;&#x9;user_invitation_code,&#xA;&#x9;remaining_mem_cli_count,&#xA;&#x9;remaining_mem_cli2_count,&#xA;&#x9;remaining_mem_pp_count,&#xA;&#x9;remaining_gue_cli_count,&#xA;&#x9;remaining_gue_cli2_count,&#xA;&#x9;remaining_gue_pp_count,&#xA;&#x9;remaining_mgu_cli_count,&#xA;&#x9;remaining_mgu_cli2_count,&#xA;&#x9;remaining_mgu_pp_count,&#xA;&#x9;remaining_mgu_comp_count,&#xA;&#x9;&#xA;&#x9;experience_category,&#xA;&#x9;experience_type,&#xA;&#x9;airport_terminal_name,&#xA;&#x9;airport_terminal_type,&#xA;&#x9;visit_type_id,&#xA;&#x9;ccard_type, &#xA;&#x9;effective_date,&#xA;&#x9;report_month&#xA;&#xA;&#x9; )&#xA;SELECT&#x9;&#xA;&#x9;&#x9;@var_startDate,&#xA;&#x9;&#x9;s.source_code,&#xA;&#x9;&#x9;c.consumer_no,&#xA;&#x9;&#x9;c.external_identifier,&#xA;&#x9;&#x9;c.membership_no,&#xA;&#x9;&#x9;p.purchase_no,&#xA;&#x9;&#x9;t.track_seq,&#xA;&#x9;&#x9;c.title,&#xA;&#x9;&#x9;p.ccardholders_name,&#xA;&#x9;&#x9;c.forename,&#xA;&#x9;&#x9;c.surname,&#xA;&#x9;&#x9;LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(c.forename + ' ' + c.surname,' ',' |'),'| ',''),'|',''))) AS fullname,&#xA;&#x9;&#x9;s.source_desc,&#xA;&#x9;&#x9;p.product_version,&#xA;&#x9;&#x9;p.paid_to_date,&#xA;&#x9;&#x9;p.subs_issue_date,&#xA;&#x9;&#x9;p.subs_status,&#xA;&#x9;&#x9;t.track_start,&#xA;&#x9;&#x9;t.track_guests,&#xA;&#x9;&#x9;t.track_from,&#xA;&#x9;&#x9;t.track_value,&#xA;&#x9;&#x9;t.creation_date,&#xA;&#x9;&#x9;l.lounge_name,&#xA;&#x9;&#x9;a.pp_short_name AS airport,&#xA;&#x9;&#x9;p.trans_ccard_number,&#xA;&#x9;&#x9;t.external_ref,&#xA;&#x9;&#x9;t.track_batch,&#xA;&#x9;&#x9;p.old_system_ref,&#xA;&#x9;&#x9;s.campaign_code,&#xA;&#x9;&#x9;l.lounge_code,&#xA;&#x9;&#x9;a.airport_city AS city,&#xA;&#x9;&#x9;cou.code_desc AS country,&#xA;&#x9;&#x9;siv.vendor_tracking_code,&#xA;&#x9;&#x9;siv.user_invitation_code,&#xA;&#x9;&#x9;0 AS remaining_mem_cli_count,&#xA;&#x9;&#x9;0 AS remaining_mem_cli2_count,&#xA; &#x9;&#x9;0 AS remaining_mem_pp_count,&#xA; &#x9;&#x9;0 AS remaining_gue_cli_count,&#xA; &#x9;&#x9;0 AS remaining_gue_cli2_count,&#xA; &#x9;&#x9;0 AS remaining_gue_pp_count,&#xA; &#x9;&#x9;0 AS remaining_mgu_cli_count,&#xA; &#x9;&#x9;0 AS remaining_mgu_cli2_count,&#xA; &#x9;&#x9;0 AS remaining_mgu_pp_count,&#xA; &#x9;&#x9;0 AS remaining_mgu_comp_count,&#xA; &#x9;&#x9;&#xA;&#x9;&#x9;'Lounge' as experience_category,&#xA;&#x9;&#x9;'Lounge' as experience_type,&#xA;&#x9;&#x9;ate.terminal_name as airport_terminal_name,&#xA;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;WHEN l.lounge_type = 'I' THEN 'I'&#xA;&#x9;&#x9;&#x9;WHEN l.lounge_type = 'D' THEN 'D'&#xA;&#x9;&#x9;&#x9;ELSE 'U'&#xA;&#x9;&#x9;  END&#x9;as airport_terminal_type,&#xA;&#x9;&#x9;t.visit_type_id,&#xA;&#x9;&#x9;p.ccard_type,&#xA;&#x9;&#x9;p.effective_date,&#xA;&#x9;&#x9;CAST(DATEADD(MONTH, DATEDIFF(MONTH, 0, t.[creation_date]), 0) AS DATE)      AS &#x9;report_month&#xA;&#xA;--INTO ##temptable&#xA;FROM&#xA;&#x9;&#x9;PPass.dbo.source_deal_config AS sdc WITH (NOLOCK)&#xA;&#x9;&#x9;INNER JOIN PPass.dbo.source AS s WITH (NOLOCK) ON sdc.source_code = s.source_code&#xA;&#x9;&#x9;INNER JOIN PPass.dbo.source_subscription AS ss WITH (NOLOCK) ON sdc.source_deal_config_id = ss.source_deal_config_id&#xA;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_subscription_link AS psl WITH (NOLOCK) ON ss.source_subscription_id = psl.source_subscription_id&#xA;&#x9;&#x9;INNER JOIN PPass.dbo.purchase AS p WITH (NOLOCK) ON psl.purchase_no = p.purchase_no&#xA;&#x9;&#x9;INNER JOIN PPass.dbo.consumer AS c WITH (NOLOCK) ON p.consumer_no = c.consumer_no&#xA;&#x9;&#x9;INNER JOIN PPass.dbo.tracking AS t WITH (NOLOCK) ON p.purchase_no = t.purchase_no&#xA;&#x9;&#x9;INNER JOIN PPass.dbo.lounge AS l WITH (NOLOCK) ON l.lounge_code = t.track_from&#xA;&#x9;&#x9;INNER JOIN PPass.dbo.airport AS a WITH (NOLOCK) ON a.iso_airport_code = l.airport&#xA;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.airport_terminal AS ate WITH (NOLOCK) ON l.airport_terminal_id = ate.airport_terminal_id&#xA;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.code AS COU  WITH (NOLOCK) ON COU.code = l.country_code AND COU.codetype = 'CTRY'&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_invitation_validation siv WITH (NOLOCK) ON siv.consumer_no = c.consumer_no&#xA;&#x9;WHERE&#xA;t.creation_date &gt;= @var_startDate AND t.creation_date &lt; DATEADD(d,1,@var_endDate)&#xA; AND t.track_status &lt;&gt; 'NA' &#xA;AND p.isDeleted = 0 &#xA;AND s.source_code in ( SELECT DISTINCT SourceCode FROM ##VisitBySourceSourceCodes)&#xA;--AND (p.consumer_no='1427229223' or c.membership_no='1427229223')&#xA;/* Load in the reedemed offers data */&#xA;&#xA;INSERT INTO ##temptable (&#x9;&#xA;&#x9;Process_Month,&#xA;&#x9;source_code,&#xA;&#x9;consumer_no,&#xA;&#x9;external_identifier,&#xA;&#x9;membership_no,&#xA;&#x9;purchase_no,&#xA;&#x9;track_seq,&#xA;&#x9;title,&#xA;&#x9;cardholdername,&#xA;&#x9;forename,&#xA;&#x9;surname,&#xA;&#x9;fullname,&#xA;&#x9;source_desc,&#xA;&#x9;product_version,&#xA;&#x9;paid_to_date,&#xA;&#x9;subs_issue_date,&#xA;&#x9;subs_status,&#xA;&#x9;track_start,&#xA;&#x9;track_guests,&#xA;&#x9;track_from,&#xA;&#x9;track_value,&#xA;&#x9;creation_date,&#xA;&#x9;lounge_name,&#xA;&#x9;airport,&#xA;&#x9;trans_ccard_number,&#xA;&#x9;external_ref,&#xA;&#x9;track_batch,&#xA;&#x9;old_system_ref,&#xA;&#x9;campaign_code,&#xA;&#x9;lounge_code,&#xA;&#x9;city,&#xA;&#x9;country,&#xA;&#x9;vendor_tracking_code,&#xA;&#x9;user_invitation_code,&#xA;&#x9;remaining_mem_cli_count,&#xA;&#x9;remaining_mem_cli2_count,&#xA;&#x9;remaining_mem_pp_count,&#xA;&#x9;remaining_gue_cli_count,&#xA;&#x9;remaining_gue_cli2_count,&#xA;&#x9;remaining_gue_pp_count,&#xA;&#x9;remaining_mgu_cli_count,&#xA;&#x9;remaining_mgu_cli2_count,&#xA;&#x9;remaining_mgu_pp_count,&#xA;&#x9;remaining_mgu_comp_count,&#xA;&#x9;experience_category,&#xA;&#x9;experience_type,&#xA;&#x9;airport_terminal_name,&#xA;&#x9;airport_terminal_type,&#xA;&#x9;visit_type_id,&#xA;&#x9;report_month&#xA;&#xA;&#x9; )&#xA;SELECT&#xA;&#x9;@var_startDate,&#xA;&#x9;s.source_code,&#xA;&#x9;c.consumer_no,&#xA;&#x9;c.external_identifier,&#xA;&#x9;c.membership_no,&#xA;&#x9;p.purchase_no,&#xA;&#x9;t.track_seq,&#xA;&#x9;c.title,&#xA;&#x9;p.ccardholders_name,&#xA;&#x9;c.forename,&#xA;&#x9;c.surname,&#xA;&#x9;LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(c.forename + ' ' + c.surname,' ',' |'),'| ',''),'|',''))) AS fullname,&#xA;&#x9;s.source_desc,&#xA;&#x9;p.product_version,&#xA;&#x9;p.paid_to_date,&#xA;&#x9;p.subs_issue_date,&#xA;&#x9;p.subs_status,&#xA;&#x9;t.track_start,&#xA;&#x9;t.track_guests,&#xA;&#x9;t.track_from,&#xA;&#x9;t.track_value,&#xA;&#x9;t.creation_date,&#xA;&#x9;ord.outlet_name as lounge_name,&#xA;&#x9;a.pp_short_name AS airport,&#xA;&#x9;p.trans_ccard_number,&#xA;&#x9;t.external_ref,&#xA;&#x9;t.track_batch,&#xA;&#x9;p.old_system_ref,&#xA;&#x9;s.campaign_code,&#xA;&#x9;t.track_from as lounge_code,&#xA;&#x9;a.airport_city AS city,&#xA;&#x9;cou.code_desc AS country,&#xA;&#x9;siv.vendor_tracking_code,&#xA;&#x9;siv.user_invitation_code,&#xA;&#x9;0 AS remaining_mem_cli_count , &#xA;&#x9;0 AS remaining_mem_cli2_count , &#xA;&#x9;0 AS remaining_mem_pp_count , &#xA;&#x9;0 AS remaining_gue_cli_count , &#xA;&#x9;0 AS remaining_gue_cli2_count , &#xA;&#x9;0 AS remaining_gue_pp_count , &#xA;&#x9;0 AS remaining_mgu_cli_count , &#xA;&#x9;0 AS remaining_mgu_cli2_count , &#xA;&#x9;0 AS remaining_mgu_pp_count , &#xA;&#x9;0 AS remaining_mgu_comp_count,&#xA;&#x9;&#xA;&#x9;ord.offer_category as experience_category,&#xA;&#x9;&#x9;ord.offer_type as experience_type,&#xA;&#x9;ISNULL(ate.terminal_name, 'Unknown' ) as airport_terminal_name,&#xA;&#x9;'U' as airport_terminal_type,&#xA;&#x9;t.visit_type_id,&#xA;&#x9;CAST(DATEADD(MONTH, DATEDIFF(MONTH, 0, t.[creation_date]), 0) AS DATE)      AS &#x9;report_month&#xA;FROM&#xA;&#x9;PPass.dbo.source_deal_config AS sdc WITH (NOLOCK)&#xA;&#x9;INNER JOIN PPass.dbo.source AS s WITH (NOLOCK) ON sdc.source_code = s.source_code&#xA;&#x9;INNER JOIN PPass.dbo.source_subscription AS ss WITH (NOLOCK) ON sdc.source_deal_config_id = ss.source_deal_config_id&#xA;&#x9;INNER JOIN PPass.dbo.purchase_subscription_link AS psl WITH (NOLOCK) ON ss.source_subscription_id = psl.source_subscription_id&#xA;&#x9;INNER JOIN PPass.dbo.purchase AS p WITH (NOLOCK) ON psl.purchase_no = p.purchase_no&#xA;&#x9;INNER JOIN PPass.dbo.consumer AS c WITH (NOLOCK) ON p.consumer_no = c.consumer_no&#xA;&#x9;INNER JOIN PPass.dbo.tracking AS t WITH (NOLOCK) ON p.purchase_no = t.purchase_no&#xA;&#x9;INNER JOIN PPass.dbo.offer_redemption_details AS ord WITH (NOLOCK) ON ord.consumer_no = c.consumer_no AND ord.track_seq = t.track_seq&#xA;&#x9;INNER JOIN PPass.dbo.airport AS a WITH (NOLOCK) ON a.iso_airport_code = ord.airport_iso_code&#xA;&#x9;LEFT JOIN PPass.dbo.outlet_airport_terminal AS oat WITH (NOLOCK) ON ord.outlet_id = oat.outlet_id&#xA;&#x9;LEFT JOIN PPass.dbo.airport_terminal AS ate WITH (NOLOCK) ON oat.airport_terminal_id = ate.airport_terminal_id&#xA;&#x9;LEFT OUTER JOIN PPass.dbo.code AS COU WITH (NOLOCK) ON cou.alpha_1 = a.iso_country_code&#xA;&#x9;&#x9;AND cou.codetype = 'CTRY2'&#xA;&#x9;&#x9;AND cou.alpha_5 &lt;&gt; ''&#xA;&#x9;LEFT OUTER JOIN PPass.dbo.source_invitation_validation siv WITH (NOLOCK) ON siv.consumer_no = c.consumer_no&#xA;&#x9;&#xA;WHERE&#xA;t.creation_date &gt;= @var_startDate AND t.creation_date &lt; DATEADD(d,1,@var_endDate)&#xA; AND t.track_status &lt;&gt; 'NA' &#xA;AND p.isDeleted = 0 &#xA;AND s.source_code in (SELECT DISTINCT SourceCode FROM ##VisitBySourceSourceCodes)&#xA;--AND (p.consumer_no='1427229223' or c.membership_no='1427229223')&#xA;/* update the temp table with an index */&#xA;--ALTER TABLE ##temptable &#xA;--ADD CONSTRAINT PK_##temptable &#xA;--PRIMARY KEY NONCLUSTERED (purchase_no, track_seq)&#xA;--&#x9;&#x9;&#x9;CREATE NONCLUSTERED INDEX ##temptable_idx1 ON ##temptable (source_code, consumer_no, fullname, track_start, lounge_name, external_ref) &#xA;--&#x9;&#x9;&#x9;WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 100) ON [PRIMARY]&#xA;&#xA;--Select * from ##temptable&#xA;&#xA;&#x9;&#x9;/*  MEM PPAYVISIT  */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;           &#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no;&#xA;&#xA;&#x9;/* MEM CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable ##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no;&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;/* MEM CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* GUE PPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* GUE CPAYLIST */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* GUE CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/*MGU PPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;/* MGU CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* MGU CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDMEM PPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDMEM CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;/* SHAREDMEM CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDGUE PPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDGUE CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDGUE CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;/* SHAREDMGU PPAYVISIT */&#xA;&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;/* SHAREDMGU CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;/*SHAREDMGU CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;/*OFFERMEM PPAYVISIT */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMEMCPAYLIST */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMEMCPAYLIST2 */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERGUEPPAYLIST */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERGUECPAYLIST */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERGUECPAYLIST2 */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMGUPPAYLIST */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMGUCPAYLIST */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMGUCPAYLIST2 */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;##temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;PPass.dbo.purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;;WITH derived_credit_data AS (&#xA;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;ISNULL(SUM(CASE WHEN vch.purchase_visit_allocation_his_id IS NULL THEN 1 ELSE 0 END),0) AS unused_visit,&#xA;&#x9;&#x9;&#x9;&#x9;ISNULL(SUM(CASE WHEN vch.purchase_visit_allocation_his_id IS NOT NULL THEN 1 ELSE 0 END),0) AS used_visit,&#xA;&#x9;&#x9;&#x9;&#x9;pval.purchase_no&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;PPass.dbo.visit_credit_his AS vch&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.visit_credit AS vc ON vch.visit_credit_id = vc.visit_credit_id&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.visit_credit_purchase_allocation AS vcpa ON vch.visit_credit_his_id = vcpa.visit_credit_his_id&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation AS pva ON vcpa.purchase_visit_allocation_id = pva.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_grp AS pvag ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN PPass.dbo.purchase_visit_allocation_link AS pval ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;vch.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;AND vch.expiry_date &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;AND vc.visit_credit_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;AND vc.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;GROUP BY pval.purchase_no&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;REMAINING_MGU_COMP_COUNT = derived_credit_data.unused_visit&#xA;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;##temptable&#xA;&#x9;&#x9;&#x9;INNER JOIN derived_credit_data ON ##temptable.purchase_no = derived_credit_data.purchase_no&#xA;&#xA;&#xA;&quot;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strQuery">
      <DTS:VariableValue
        DTS:DataType="8">DECLARE @StartDate VARCHAR(10)='01/04/2023'
DECLARE @EndDate VARCHAR(10)='30/04/2023'

DECLARE @var_startDate VARCHAR(10)
SET @var_startDate=CONVERT(CHAR(8),CONVERT(date,@StartDate,103),112)
DECLARE @var_endDate VARCHAR(10)
SET @var_endDate=CONVERT(CHAR(8),CONVERT(date,@EndDate,103),112)


IF OBJECT_ID('tempdb..##temptable') IS NOT NULL
	DROP TABLE ##temptable

CREATE TABLE ##temptable (
		Process_Month VARCHAR(10),
		source_code 		varchar(20),
		consumer_no 		INT NOT NULL,
		external_identifier BIGINT NULL,
		membership_no 		BIGINT NULL,
		purchase_no 		INT NOT NULL,
		track_seq 			INT NOT NULL,
		title 				varchar(20),
		cardholdername	    varchar(max),
		forename 			varchar(50),
		surname 			varchar(50),
		fullname 			varchar(120),
		source_desc 		varchar(255),
		product_version 	varchar(20),
		paid_to_date 		date,
		subs_issue_date 	date,
		subs_status 		varchar(5),
		track_start 		date,
		track_guests 		INT,
		track_from 			varchar(20),
		track_value 		FLOAT,
		creation_date 		date,
		lounge_name			varchar(100),
		airport 			varchar(100),
		trans_ccard_number 	varchar(100),
		external_ref 		varchar(100),
		track_batch 		INT,
		old_system_ref 		varchar(100),
		campaign_code 		varchar(100),
		lounge_code			varchar(20),
		city 				varchar(100),
		country 				varchar(100),
		vendor_tracking_code 	varchar(100),
		user_invitation_code 	varchar(100),
		remaining_mem_cli_count int,
		remaining_mem_cli2_count int,
		remaining_mem_pp_count 	int,
		remaining_gue_cli_count int,
		remaining_gue_cli2_count int,
		remaining_gue_pp_count 	int,
		remaining_mgu_cli_count int,
		remaining_mgu_cli2_count int,
		remaining_mgu_pp_count 	int,
		remaining_mgu_comp_count int,
		
		experience_category 	varchar(100),
		experience_type 		varchar(100),
		airport_terminal_name  varchar(100),
		airport_terminal_type  varchar(100),
		visit_type_id SMALLINT,
		visit_type	INT,
		ccard_type VARCHAR(100),
		effective_date DATETIME2,
		report_month date

);


INSERT INTO ##temptable(	
	Process_Month,
	source_code,
	consumer_no,
	external_identifier,
	membership_no,
	purchase_no,
	track_seq,
	title,
	cardholdername,
	forename,
	surname,
	fullname,
	source_desc,
	product_version,
	paid_to_date,
	subs_issue_date,
	subs_status,
	track_start,
	track_guests,
	track_from,
	track_value,
	creation_date,
	lounge_name,
	airport,
	trans_ccard_number,
	external_ref,
	track_batch,
	old_system_ref,
	campaign_code,
	lounge_code,
	city,
	country,
	vendor_tracking_code,
	user_invitation_code,
	remaining_mem_cli_count,
	remaining_mem_cli2_count,
	remaining_mem_pp_count,
	remaining_gue_cli_count,
	remaining_gue_cli2_count,
	remaining_gue_pp_count,
	remaining_mgu_cli_count,
	remaining_mgu_cli2_count,
	remaining_mgu_pp_count,
	remaining_mgu_comp_count,
	
	experience_category,
	experience_type,
	airport_terminal_name,
	airport_terminal_type,
	visit_type_id,
	ccard_type, 
	effective_date,
	report_month

	 )
SELECT	
		@var_startDate,
		s.source_code,
		c.consumer_no,
		c.external_identifier,
		c.membership_no,
		p.purchase_no,
		t.track_seq,
		c.title,
		p.ccardholders_name,
		c.forename,
		c.surname,
		LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(c.forename + ' ' + c.surname,' ',' |'),'| ',''),'|',''))) AS fullname,
		s.source_desc,
		p.product_version,
		p.paid_to_date,
		p.subs_issue_date,
		p.subs_status,
		t.track_start,
		t.track_guests,
		t.track_from,
		t.track_value,
		t.creation_date,
		l.lounge_name,
		a.pp_short_name AS airport,
		p.trans_ccard_number,
		t.external_ref,
		t.track_batch,
		p.old_system_ref,
		s.campaign_code,
		l.lounge_code,
		a.airport_city AS city,
		cou.code_desc AS country,
		siv.vendor_tracking_code,
		siv.user_invitation_code,
		0 AS remaining_mem_cli_count,
		0 AS remaining_mem_cli2_count,
 		0 AS remaining_mem_pp_count,
 		0 AS remaining_gue_cli_count,
 		0 AS remaining_gue_cli2_count,
 		0 AS remaining_gue_pp_count,
 		0 AS remaining_mgu_cli_count,
 		0 AS remaining_mgu_cli2_count,
 		0 AS remaining_mgu_pp_count,
 		0 AS remaining_mgu_comp_count,
 		
		'Lounge' as experience_category,
		'Lounge' as experience_type,
		ate.terminal_name as airport_terminal_name,
		CASE
			WHEN l.lounge_type = 'I' THEN 'I'
			WHEN l.lounge_type = 'D' THEN 'D'
			ELSE 'U'
		  END	as airport_terminal_type,
		t.visit_type_id,
		p.ccard_type,
		p.effective_date,
		CAST(DATEADD(MONTH, DATEDIFF(MONTH, 0, t.[creation_date]), 0) AS DATE)      AS 	report_month

--INTO ##temptable
FROM
		PPass.dbo.source_deal_config AS sdc WITH (NOLOCK)
		INNER JOIN PPass.dbo.source AS s WITH (NOLOCK) ON sdc.source_code = s.source_code
		INNER JOIN PPass.dbo.source_subscription AS ss WITH (NOLOCK) ON sdc.source_deal_config_id = ss.source_deal_config_id
		INNER JOIN PPass.dbo.purchase_subscription_link AS psl WITH (NOLOCK) ON ss.source_subscription_id = psl.source_subscription_id
		INNER JOIN PPass.dbo.purchase AS p WITH (NOLOCK) ON psl.purchase_no = p.purchase_no
		INNER JOIN PPass.dbo.consumer AS c WITH (NOLOCK) ON p.consumer_no = c.consumer_no
		INNER JOIN PPass.dbo.tracking AS t WITH (NOLOCK) ON p.purchase_no = t.purchase_no
		INNER JOIN PPass.dbo.lounge AS l WITH (NOLOCK) ON l.lounge_code = t.track_from
		INNER JOIN PPass.dbo.airport AS a WITH (NOLOCK) ON a.iso_airport_code = l.airport
		LEFT OUTER JOIN PPass.dbo.airport_terminal AS ate WITH (NOLOCK) ON l.airport_terminal_id = ate.airport_terminal_id
		LEFT OUTER JOIN PPass.dbo.code AS COU  WITH (NOLOCK) ON COU.code = l.country_code AND COU.codetype = 'CTRY'
		
		LEFT OUTER JOIN PPass.dbo.source_invitation_validation siv WITH (NOLOCK) ON siv.consumer_no = c.consumer_no
	WHERE
t.creation_date &gt;= @var_startDate AND t.creation_date &lt; DATEADD(d,1,@var_endDate)
 AND t.track_status &lt;&gt; 'NA' 
AND p.isDeleted = 0 
AND s.source_code in ( SELECT DISTINCT SourceCode FROM ##VisitBySourceSourceCodes)
--AND (p.consumer_no='1427229223' or c.membership_no='1427229223')
/* Load in the reedemed offers data */

INSERT INTO ##temptable (	
	Process_Month,
	source_code,
	consumer_no,
	external_identifier,
	membership_no,
	purchase_no,
	track_seq,
	title,
	cardholdername,
	forename,
	surname,
	fullname,
	source_desc,
	product_version,
	paid_to_date,
	subs_issue_date,
	subs_status,
	track_start,
	track_guests,
	track_from,
	track_value,
	creation_date,
	lounge_name,
	airport,
	trans_ccard_number,
	external_ref,
	track_batch,
	old_system_ref,
	campaign_code,
	lounge_code,
	city,
	country,
	vendor_tracking_code,
	user_invitation_code,
	remaining_mem_cli_count,
	remaining_mem_cli2_count,
	remaining_mem_pp_count,
	remaining_gue_cli_count,
	remaining_gue_cli2_count,
	remaining_gue_pp_count,
	remaining_mgu_cli_count,
	remaining_mgu_cli2_count,
	remaining_mgu_pp_count,
	remaining_mgu_comp_count,
	experience_category,
	experience_type,
	airport_terminal_name,
	airport_terminal_type,
	visit_type_id,
	report_month

	 )
SELECT
	@var_startDate,
	s.source_code,
	c.consumer_no,
	c.external_identifier,
	c.membership_no,
	p.purchase_no,
	t.track_seq,
	c.title,
	p.ccardholders_name,
	c.forename,
	c.surname,
	LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(c.forename + ' ' + c.surname,' ',' |'),'| ',''),'|',''))) AS fullname,
	s.source_desc,
	p.product_version,
	p.paid_to_date,
	p.subs_issue_date,
	p.subs_status,
	t.track_start,
	t.track_guests,
	t.track_from,
	t.track_value,
	t.creation_date,
	ord.outlet_name as lounge_name,
	a.pp_short_name AS airport,
	p.trans_ccard_number,
	t.external_ref,
	t.track_batch,
	p.old_system_ref,
	s.campaign_code,
	t.track_from as lounge_code,
	a.airport_city AS city,
	cou.code_desc AS country,
	siv.vendor_tracking_code,
	siv.user_invitation_code,
	0 AS remaining_mem_cli_count , 
	0 AS remaining_mem_cli2_count , 
	0 AS remaining_mem_pp_count , 
	0 AS remaining_gue_cli_count , 
	0 AS remaining_gue_cli2_count , 
	0 AS remaining_gue_pp_count , 
	0 AS remaining_mgu_cli_count , 
	0 AS remaining_mgu_cli2_count , 
	0 AS remaining_mgu_pp_count , 
	0 AS remaining_mgu_comp_count,
	
	ord.offer_category as experience_category,
		ord.offer_type as experience_type,
	ISNULL(ate.terminal_name, 'Unknown' ) as airport_terminal_name,
	'U' as airport_terminal_type,
	t.visit_type_id,
	CAST(DATEADD(MONTH, DATEDIFF(MONTH, 0, t.[creation_date]), 0) AS DATE)      AS 	report_month
FROM
	PPass.dbo.source_deal_config AS sdc WITH (NOLOCK)
	INNER JOIN PPass.dbo.source AS s WITH (NOLOCK) ON sdc.source_code = s.source_code
	INNER JOIN PPass.dbo.source_subscription AS ss WITH (NOLOCK) ON sdc.source_deal_config_id = ss.source_deal_config_id
	INNER JOIN PPass.dbo.purchase_subscription_link AS psl WITH (NOLOCK) ON ss.source_subscription_id = psl.source_subscription_id
	INNER JOIN PPass.dbo.purchase AS p WITH (NOLOCK) ON psl.purchase_no = p.purchase_no
	INNER JOIN PPass.dbo.consumer AS c WITH (NOLOCK) ON p.consumer_no = c.consumer_no
	INNER JOIN PPass.dbo.tracking AS t WITH (NOLOCK) ON p.purchase_no = t.purchase_no
	INNER JOIN PPass.dbo.offer_redemption_details AS ord WITH (NOLOCK) ON ord.consumer_no = c.consumer_no AND ord.track_seq = t.track_seq
	INNER JOIN PPass.dbo.airport AS a WITH (NOLOCK) ON a.iso_airport_code = ord.airport_iso_code
	LEFT JOIN PPass.dbo.outlet_airport_terminal AS oat WITH (NOLOCK) ON ord.outlet_id = oat.outlet_id
	LEFT JOIN PPass.dbo.airport_terminal AS ate WITH (NOLOCK) ON oat.airport_terminal_id = ate.airport_terminal_id
	LEFT OUTER JOIN PPass.dbo.code AS COU WITH (NOLOCK) ON cou.alpha_1 = a.iso_country_code
		AND cou.codetype = 'CTRY2'
		AND cou.alpha_5 &lt;&gt; ''
	LEFT OUTER JOIN PPass.dbo.source_invitation_validation siv WITH (NOLOCK) ON siv.consumer_no = c.consumer_no
	
WHERE
t.creation_date &gt;= @var_startDate AND t.creation_date &lt; DATEADD(d,1,@var_endDate)
 AND t.track_status &lt;&gt; 'NA' 
AND p.isDeleted = 0 
AND s.source_code in (SELECT DISTINCT SourceCode FROM ##VisitBySourceSourceCodes)
--AND (p.consumer_no='1427229223' or c.membership_no='1427229223')
/* update the temp table with an index */
--ALTER TABLE ##temptable 
--ADD CONSTRAINT PK_##temptable 
--PRIMARY KEY NONCLUSTERED (purchase_no, track_seq)
--			CREATE NONCLUSTERED INDEX ##temptable_idx1 ON ##temptable (source_code, consumer_no, fullname, track_start, lounge_name, external_ref) 
--			WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 100) ON [PRIMARY]

--Select * from ##temptable

		/*  MEM PPAYVISIT  */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 1
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
           
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 1
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_PP_count = calculated_visit_allocation.visit_number
				
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no;

	/* MEM CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 1
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 1
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable ##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no;

				/* MEM CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 1
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 1
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number
				
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* GUE PPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 2
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 2
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_PP_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* GUE CPAYLIST */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 2
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 2
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* GUE CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 2
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 2
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/*MGU PPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 3
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 3
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_PP_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
/* MGU CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 3
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 3
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* MGU CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 3
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 3
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDMEM PPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 8
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 8
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_PP_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDMEM CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 8
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 8
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
/* SHAREDMEM CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 8
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 8
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDGUE PPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 9
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 9
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_PP_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDGUE CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 9
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 9
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDGUE CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 9
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 9
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
/* SHAREDMGU PPAYVISIT */

		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 10
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 10
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_PP_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
				/* SHAREDMGU CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 10
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 10
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
				/*SHAREDMGU CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 10
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 10
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
/*OFFERMEM PPAYVISIT */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 6
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 6
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_PP_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMEMCPAYLIST */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 6
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 6
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMEMCPAYLIST2 */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 6
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 6
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERGUEPPAYLIST */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 5
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 5
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_PP_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERGUECPAYLIST */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 5
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 5
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERGUECPAYLIST2 */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 5
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 5
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMGUPPAYLIST */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 7
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 7
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_PP_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMGUCPAYLIST */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 7
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 7
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_CLI_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMGUCPAYLIST2 */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					PPass.dbo.purchase_visit_allocation_his AS pvah2
					INNER JOIN PPass.dbo.purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN PPass.dbo.source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								##temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 7
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					PPass.dbo.purchase pur
					INNER JOIN PPass.dbo.purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN PPass.dbo.purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN PPass.dbo.purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 7
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				##temptable
			SET
				remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				##temptable
				INNER JOIN calculated_visit_allocation ON ##temptable.purchase_no = calculated_visit_allocation.purchase_no
		;WITH derived_credit_data AS (
			SELECT
				ISNULL(SUM(CASE WHEN vch.purchase_visit_allocation_his_id IS NULL THEN 1 ELSE 0 END),0) AS unused_visit,
				ISNULL(SUM(CASE WHEN vch.purchase_visit_allocation_his_id IS NOT NULL THEN 1 ELSE 0 END),0) AS used_visit,
				pval.purchase_no
			FROM
				PPass.dbo.visit_credit_his AS vch
				INNER JOIN PPass.dbo.visit_credit AS vc ON vch.visit_credit_id = vc.visit_credit_id
				INNER JOIN PPass.dbo.visit_credit_purchase_allocation AS vcpa ON vch.visit_credit_his_id = vcpa.visit_credit_his_id
				INNER JOIN PPass.dbo.purchase_visit_allocation AS pva ON vcpa.purchase_visit_allocation_id = pva.purchase_visit_allocation_id
				INNER JOIN PPass.dbo.purchase_visit_allocation_grp AS pvag ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
				INNER JOIN PPass.dbo.purchase_visit_allocation_link AS pval ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
			WHERE
				vch.isdeleted = 0
				AND vch.expiry_date &gt;= getdate()
				AND vc.visit_credit_type_id = 1
				AND vc.visitor_type_id = 3
			GROUP BY pval.purchase_no
		)
		UPDATE
			##temptable
		SET
			REMAINING_MGU_COMP_COUNT = derived_credit_data.unused_visit
		FROM
			##temptable
			INNER JOIN derived_credit_data ON ##temptable.purchase_no = derived_credit_data.purchase_no


</DTS:VariableValue>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\DFT_GenerateExcelFile 1"
      DTS:CreationName="Microsoft.Pipeline"
      DTS:Description="Data Flow Task"
      DTS:Disabled="True"
      DTS:DTSID="{e9d32283-8795-41d2-9583-e2cb318f3e2b}"
      DTS:ExecutableType="Microsoft.Pipeline"
      DTS:LocaleID="-1"
      DTS:ObjectName="DFT_GenerateExcelFile 1"
      DTS:TaskContact="Performs high-performance data extraction, transformation and loading;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1">
      <DTS:Variables />
      <DTS:ObjectData>
        <pipeline
          version="1">
          <components>
            <component
              refId="Package\DFT_GenerateExcelFile 1\Data Conversion"
              componentClassID="Microsoft.DataConvert"
              contactInfo="Data Conversion;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;0"
              description="Data Conversion"
              name="Data Conversion"
              usesDispositions="true">
              <inputs>
                <input
                  refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input]"
                  name="Data Conversion Input">
                  <inputColumns>
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Source Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Source Code"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Source Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Member No]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Member No"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member No]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[CCard No]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="CCard No"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[CCard No]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Title]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Title"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Title]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[First Name]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="First Name"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[First Name]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Last Name]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Last Name"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Last Name]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Membership Plan]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Membership Plan"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Membership Plan]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Member Status]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Member Status"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member Status]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Paid To Date]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="Paid To Date"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Paid To Date]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Experience Transaction Date]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="Experience Transaction Date"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Date Processed]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="Date Processed"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Date Processed]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Batch No]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Batch No"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Batch No]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Reference]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Reference"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Reference]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Airport]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Airport"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Airport]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[City]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="City"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[City]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Country]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Country"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Country]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Complimentary Member/Guest]"
                      cachedDataType="i2"
                      cachedName="Complimentary Member/Guest"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Total Cardholder Amount Currency]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="3"
                      cachedName="Total Cardholder Amount Currency"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Total Cardholder Amount]"
                      cachedDataType="r4"
                      cachedName="Total Cardholder Amount"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Cost Centre]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Cost Centre"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cost Centre]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Campaign Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Campaign Code"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Campaign Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Vendor Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="Vendor Code"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Vendor Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[User Invitation Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="254"
                      cachedName="User Invitation Code"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[User Invitation Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Guest Visits]"
                      cachedDataType="i4"
                      cachedName="Guest Visits"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Guest Visits]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Lounge Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Lounge Code"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Lounge]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Lounge"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Inclusive PP Member Visit]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Member Visit"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Complimentary Member Visit]"
                      cachedDataType="i4"
                      cachedName="Complimentary Member Visit"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Cardholder Pays Member Visit]"
                      cachedDataType="i4"
                      cachedName="Cardholder Pays Member Visit"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Inclusive PP Guest Visit]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Guest Visit"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Complimentary Guest Visit]"
                      cachedDataType="i4"
                      cachedName="Complimentary Guest Visit"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Cardholder Pays Guest Visit]"
                      cachedDataType="i4"
                      cachedName="Cardholder Pays Guest Visit"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Lounge Visit Offer]"
                      cachedDataType="i4"
                      cachedName="Lounge Visit Offer"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Inclusive PP Member]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Member"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Inclusive PP Guest]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Guest"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Inclusive PP Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Member/Guest"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Cardholder Visit Currency Member]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="Cardholder Visit Currency Member"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Cardholder Visit Amount Member]"
                      cachedDataType="r8"
                      cachedName="Cardholder Visit Amount Member"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Cardholder Visit Currency Guest]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="Cardholder Visit Currency Guest"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Cardholder Visit Amount Guest]"
                      cachedDataType="r8"
                      cachedName="Cardholder Visit Amount Guest"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input].Columns[Cardholder Name]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="Cardholder Name"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Name]" />
                  </inputColumns>
                  <externalMetadataColumns />
                </input>
              </inputs>
              <outputs>
                <output
                  refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output]"
                  exclusionGroup="1"
                  name="Data Conversion Output"
                  synchronousInputId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Source Code]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Source Code]"
                      name="Copy of Source Code"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Source Code]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Member No]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Member No]"
                      name="Copy of Member No"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member No]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of CCard No]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of CCard No]"
                      name="Copy of CCard No"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[CCard No]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Title]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Title]"
                      name="Copy of Title"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Title]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of First Name]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of First Name]"
                      name="Copy of First Name"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[First Name]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Last Name]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Last Name]"
                      name="Copy of Last Name"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Last Name]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Membership Plan]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Membership Plan]"
                      name="Copy of Membership Plan"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Membership Plan]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Member Status]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Member Status]"
                      name="Copy of Member Status"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member Status]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Paid To Date]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Paid To Date]"
                      name="Copy of Paid To Date"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Paid To Date]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Experience Transaction Date]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Experience Transaction Date]"
                      name="Copy of Experience Transaction Date"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Date Processed]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Date Processed]"
                      name="Copy of Date Processed"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Date Processed]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Batch No]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Batch No]"
                      name="Copy of Batch No"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Batch No]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Reference]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Reference]"
                      name="Copy of Reference"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Reference]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Airport]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Airport]"
                      name="Copy of Airport"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Airport]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of City]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of City]"
                      name="Copy of City"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[City]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Country]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Country]"
                      name="Copy of Country"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Country]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Member/Guest]"
                      dataType="i2"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Member/Guest]"
                      name="Copy of Complimentary Member/Guest"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Total Cardholder Amount Currency]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="3"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Total Cardholder Amount Currency]"
                      name="Copy of Total Cardholder Amount Currency"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Total Cardholder Amount]"
                      dataType="r4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Total Cardholder Amount]"
                      name="Copy of Total Cardholder Amount"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cost Centre]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cost Centre]"
                      name="Copy of Cost Centre"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cost Centre]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Campaign Code]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Campaign Code]"
                      name="Copy of Campaign Code"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Campaign Code]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Vendor Code]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Vendor Code]"
                      name="Copy of Vendor Code"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Vendor Code]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of User Invitation Code]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of User Invitation Code]"
                      name="Copy of User Invitation Code"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[User Invitation Code]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Guest Visits]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Guest Visits]"
                      name="Copy of Guest Visits"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Guest Visits]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge Code]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge Code]"
                      name="Copy of Lounge Code"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Code]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge]"
                      name="Copy of Lounge"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member Visit]"
                      name="Copy of Inclusive PP Member Visit"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Member Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Member Visit]"
                      name="Copy of Complimentary Member Visit"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Pays Member Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Pays Member Visit]"
                      name="Copy of Cardholder Pays Member Visit"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Guest Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Guest Visit]"
                      name="Copy of Inclusive PP Guest Visit"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Guest Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Guest Visit]"
                      name="Copy of Complimentary Guest Visit"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Pays Guest Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Pays Guest Visit]"
                      name="Copy of Cardholder Pays Guest Visit"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge Visit Offer]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge Visit Offer]"
                      name="Copy of Lounge Visit Offer"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member]"
                      name="Copy of Inclusive PP Member"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Guest]"
                      name="Copy of Inclusive PP Guest"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member/Guest]"
                      name="Copy of Inclusive PP Member/Guest"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Currency Member]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Currency Member]"
                      name="Copy of Cardholder Visit Currency Member"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Amount Member]"
                      dataType="r8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Amount Member]"
                      name="Copy of Cardholder Visit Amount Member"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Currency Guest]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Currency Guest]"
                      name="Copy of Cardholder Visit Currency Guest"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Amount Guest]"
                      dataType="r8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Amount Guest]"
                      name="Copy of Cardholder Visit Amount Guest"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Name]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Name]"
                      name="Copy of Cardholder Name"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.Int32"
                          description="Specifies the input column used as the source of data for the conversion."
                          name="SourceInputColumnLineageID">#{Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Name]}</property>
                        <property
                          dataType="System.Boolean"
                          description="Indicates whether the column uses the faster, locale-neutral parsing routines."
                          name="FastParse">false</property>
                      </properties>
                    </outputColumn>
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
                <output
                  refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Error Output]"
                  exclusionGroup="1"
                  isErrorOut="true"
                  name="Data Conversion Error Output"
                  synchronousInputId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
            <component
              refId="Package\DFT_GenerateExcelFile 1\Excel Destination"
              componentClassID="Microsoft.ExcelDestination"
              contactInfo="Excel Destination;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;0"
              description="Excel Destination"
              name="Excel Destination"
              usesDispositions="true">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset">Sheet1$</property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor"></property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">0</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the values supplied for identity columns will be copied to the destination. If false, values for identity columns will be auto-generated at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepIdentity">false</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the columns containing null will have null inserted in the destination. If false, columns containing null will have their default values inserted at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepNulls">false</property>
                <property
                  dataType="System.String"
                  description="Specifies options to be used with fast load.  Applies only if fast load is turned on."
                  name="FastLoadOptions"></property>
                <property
                  dataType="System.Int32"
                  description="Specifies when commits are issued during data insertion.  A value of 0 specifies that one commit will be issued at the end of data insertion.  Applies only if fast load is turned on."
                  name="FastLoadMaxInsertCommitSize">2147483647</property>
              </properties>
              <connections>
                <connection
                  refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Connections[OleDbConnection]"
                  connectionManagerID="Package.ConnectionManagers[Excel Connection Manager]"
                  connectionManagerRefId="Package.ConnectionManagers[Excel Connection Manager]"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <inputs>
                <input
                  refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input]"
                  errorOrTruncationOperation="Insert"
                  errorRowDisposition="FailComponent"
                  hasSideEffects="true"
                  name="Excel Destination Input">
                  <inputColumns>
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Source Code]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Source Code"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Source Code]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Source Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Member No]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Member No"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Member No]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Member No]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of CCard No]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of CCard No"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[CCard No]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of CCard No]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Title]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Title"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Title]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Title]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of First Name]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of First Name"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[First Name]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of First Name]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Last Name]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Last Name"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Last Name]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Last Name]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Membership Plan]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Membership Plan"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Membership Plan]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Membership Plan]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Member Status]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Member Status"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Member Status]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Member Status]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Paid To Date]"
                      cachedDataType="wstr"
                      cachedLength="50"
                      cachedName="Copy of Paid To Date"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Paid To Date]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Paid To Date]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Experience Transaction Date]"
                      cachedDataType="wstr"
                      cachedLength="50"
                      cachedName="Copy of Experience Transaction Date"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Experience Transaction Date]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Experience Transaction Date]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Date Processed]"
                      cachedDataType="wstr"
                      cachedLength="50"
                      cachedName="Copy of Date Processed"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Date Processed]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Date Processed]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Batch No]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Batch No"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Batch No]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Batch No]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Reference]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Reference"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Reference]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Reference]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Airport]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Airport"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Airport]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Airport]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of City]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of City"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[City]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of City]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Country]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Country"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Country]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Country]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Complimentary Member/Guest]"
                      cachedDataType="i2"
                      cachedName="Copy of Complimentary Member/Guest"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Complimentary Member/Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Member/Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Total Cardholder Amount Currency]"
                      cachedDataType="wstr"
                      cachedLength="3"
                      cachedName="Copy of Total Cardholder Amount Currency"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Total Cardholder Amount Currency]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Total Cardholder Amount Currency]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Total Cardholder Amount]"
                      cachedDataType="r4"
                      cachedName="Copy of Total Cardholder Amount"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Total Cardholder Amount]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Total Cardholder Amount]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Cost Centre]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Cost Centre"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cost Centre]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cost Centre]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Campaign Code]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Campaign Code"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Campaign Code]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Campaign Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Vendor Code]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Vendor Code"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Vendor Code]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Vendor Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of User Invitation Code]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of User Invitation Code"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[User Invitation Code]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of User Invitation Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Guest Visits]"
                      cachedDataType="i4"
                      cachedName="Copy of Guest Visits"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Guest Visits]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Guest Visits]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Lounge Code]"
                      cachedDataType="wstr"
                      cachedLength="50"
                      cachedName="Copy of Lounge Code"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Lounge Code]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge Code]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Lounge]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Lounge"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Lounge]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Inclusive PP Member Visit]"
                      cachedDataType="i4"
                      cachedName="Copy of Inclusive PP Member Visit"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Member Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Complimentary Member Visit]"
                      cachedDataType="i4"
                      cachedName="Copy of Complimentary Member Visit"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Complimentary Member Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Cardholder Pays Member Visit]"
                      cachedDataType="i4"
                      cachedName="Copy of Cardholder Pays Member Visit"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Pays Member Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Pays Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Inclusive PP Guest Visit]"
                      cachedDataType="i4"
                      cachedName="Copy of Inclusive PP Guest Visit"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Guest Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Complimentary Guest Visit]"
                      cachedDataType="i4"
                      cachedName="Copy of Complimentary Guest Visit"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Complimentary Guest Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Complimentary Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Cardholder Pays Guest Visit]"
                      cachedDataType="i4"
                      cachedName="Copy of Cardholder Pays Guest Visit"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Pays Guest Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Pays Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Lounge Visit Offer]"
                      cachedDataType="i4"
                      cachedName="Copy of Lounge Visit Offer"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Lounge Visit Offer]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Lounge Visit Offer]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Inclusive PP Member]"
                      cachedDataType="i4"
                      cachedName="Copy of Inclusive PP Member"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Member]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Inclusive PP Guest]"
                      cachedDataType="i4"
                      cachedName="Copy of Inclusive PP Guest"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Inclusive PP Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Copy of Inclusive PP Member/Guest"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Member/Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Inclusive PP Member/Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Cardholder Visit Currency Member]"
                      cachedDataType="wstr"
                      cachedLength="50"
                      cachedName="Copy of Cardholder Visit Currency Member"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Visit Currency Member]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Currency Member]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Cardholder Visit Amount Member]"
                      cachedDataType="r8"
                      cachedName="Copy of Cardholder Visit Amount Member"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Visit Amount Member]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Amount Member]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Cardholder Visit Currency Guest]"
                      cachedDataType="wstr"
                      cachedLength="50"
                      cachedName="Copy of Cardholder Visit Currency Guest"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Visit Currency Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Currency Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Cardholder Visit Amount Guest]"
                      cachedDataType="r8"
                      cachedName="Copy of Cardholder Visit Amount Guest"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Visit Amount Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Visit Amount Guest]" />
                    <inputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].Columns[Copy of Cardholder Name]"
                      cachedDataType="wstr"
                      cachedLength="254"
                      cachedName="Copy of Cardholder Name"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Name]"
                      lineageId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output].Columns[Copy of Cardholder Name]" />
                  </inputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Source Code]"
                      dataType="wstr"
                      length="255"
                      name="Source Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Member No]"
                      dataType="wstr"
                      length="255"
                      name="Member No" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[CCard No]"
                      dataType="wstr"
                      length="255"
                      name="CCard No" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Title]"
                      dataType="wstr"
                      length="255"
                      name="Title" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[First Name]"
                      dataType="wstr"
                      length="255"
                      name="First Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Last Name]"
                      dataType="wstr"
                      length="255"
                      name="Last Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Membership Plan]"
                      dataType="wstr"
                      length="255"
                      name="Membership Plan" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Member Status]"
                      dataType="wstr"
                      length="255"
                      name="Member Status" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Paid To Date]"
                      dataType="wstr"
                      length="255"
                      name="Paid To Date" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Experience Transaction Date]"
                      dataType="wstr"
                      length="255"
                      name="Experience Transaction Date" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Date Processed]"
                      dataType="wstr"
                      length="255"
                      name="Date Processed" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Batch No]"
                      dataType="wstr"
                      length="255"
                      name="Batch No" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Reference]"
                      dataType="wstr"
                      length="255"
                      name="Reference" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Airport]"
                      dataType="wstr"
                      length="255"
                      name="Airport" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[City]"
                      dataType="wstr"
                      length="255"
                      name="City" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Country]"
                      dataType="wstr"
                      length="255"
                      name="Country" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Complimentary Member/Guest]"
                      dataType="wstr"
                      length="255"
                      name="Complimentary Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Total Cardholder Amount Currency]"
                      dataType="wstr"
                      length="255"
                      name="Total Cardholder Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Total Cardholder Amount]"
                      dataType="wstr"
                      length="255"
                      name="Total Cardholder Amount" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cost Centre]"
                      dataType="wstr"
                      length="255"
                      name="Cost Centre" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Campaign Code]"
                      dataType="wstr"
                      length="255"
                      name="Campaign Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Vendor Code]"
                      dataType="wstr"
                      length="255"
                      name="Vendor Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[User Invitation Code]"
                      dataType="wstr"
                      length="255"
                      name="User Invitation Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Guest Visits]"
                      dataType="wstr"
                      length="255"
                      name="Guest Visits" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Lounge Code]"
                      dataType="wstr"
                      length="255"
                      name="Lounge Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Lounge]"
                      dataType="wstr"
                      length="255"
                      name="Lounge" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Pays Member Visit]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Pays Member Visit]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Member Visit]"
                      dataType="wstr"
                      length="255"
                      name="Inclusive PP Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Complimentary Member Visit]"
                      dataType="wstr"
                      length="255"
                      name="Complimentary Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Pays Member Visit]"
                      dataType="wstr"
                      length="255"
                      name="Cardholder Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Pays Guest Visit]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Pays Guest Visit]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Guest Visit]"
                      dataType="wstr"
                      length="255"
                      name="Inclusive PP Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Complimentary Guest Visit]"
                      dataType="wstr"
                      length="255"
                      name="Complimentary Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Pays Guest Visit]"
                      dataType="wstr"
                      length="255"
                      name="Cardholder Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Lounge Visit Offer]"
                      dataType="wstr"
                      length="255"
                      name="Lounge Visit Offer" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Member]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Member]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Member]"
                      dataType="wstr"
                      length="255"
                      name="Inclusive PP Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Guest]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Guest]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Guest]"
                      dataType="wstr"
                      length="255"
                      name="Inclusive PP Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Member/Guest]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Member/Guest]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Inclusive PP Member/Guest]"
                      dataType="wstr"
                      length="255"
                      name="Inclusive PP Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Visit Currency Member]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Visit Amount Member]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Visit Amount Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Visit Currency Guest]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 1 Visit Amount Guest]"
                      dataType="wstr"
                      length="255"
                      name="Client 1 Visit Amount Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Total Client 1 Amount Currency]"
                      dataType="wstr"
                      length="255"
                      name="Total Client 1 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Total Client 1 Amount]"
                      dataType="wstr"
                      length="255"
                      name="Total Client 1 Amount" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Visit Currency Member]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Visit Amount Member]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Visit Amount Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Visit Currency Guest]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Client 2 Visit Amount Guest]"
                      dataType="wstr"
                      length="255"
                      name="Client 2 Visit Amount Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Total Client 2 Amount Currency]"
                      dataType="wstr"
                      length="255"
                      name="Total Client 2 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Total Client 2 Amount]"
                      dataType="wstr"
                      length="255"
                      name="Total Client 2 Amount" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Visit Currency Member]"
                      dataType="wstr"
                      length="255"
                      name="Cardholder Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Visit Amount Member]"
                      dataType="wstr"
                      length="255"
                      name="Cardholder Visit Amount Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Visit Currency Guest]"
                      dataType="wstr"
                      length="255"
                      name="Cardholder Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Visit Amount Guest]"
                      dataType="wstr"
                      length="255"
                      name="Cardholder Visit Amount Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input].ExternalColumns[Cardholder Name]"
                      dataType="wstr"
                      length="255"
                      name="Cardholder Name" />
                  </externalMetadataColumns>
                </input>
              </inputs>
              <outputs>
                <output
                  refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Outputs[Excel Destination Error Output]"
                  exclusionGroup="1"
                  isErrorOut="true"
                  name="Excel Destination Error Output"
                  synchronousInputId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Outputs[Excel Destination Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\Excel Destination.Outputs[Excel Destination Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\Excel Destination.Outputs[Excel Destination Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\Excel Destination.Outputs[Excel Destination Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
            <component
              refId="Package\DFT_GenerateExcelFile 1\OLE DB Source"
              componentClassID="Microsoft.OLEDBSource"
              contactInfo="OLE DB Source;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;7"
              description="OLE DB Source"
              name="OLE DB Source"
              usesDispositions="true"
              version="7">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset"></property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor">SELECT distinct 
		Report_Month
		,b.[Issuer Clean Name]
		,[Source Code]
	   ,b.[Bin/Prefix]
	   ,a.[Member No]
       ,a.[CCard No]
	   ,a.title AS [Title]
	   ,a.[Cardholder Name] as [Cardholder Name]
	   ,a.[First Name]
	   ,a.[Last Name]
	   ,a.[Membership Plan]
	   ,a.[Member Status]
	   ,CONVERT(VARCHAR(10),a.[Paid To Date],103) AS [Paid To Date]
	   ,CONVERT(VARCHAR(10),a.[Experience Transaction Date],103) AS [Experience Transaction Date]
	   ,CONVERT(VARCHAR(10),a.[Date Processed],103) AS [Date Processed]
	   ,a.[Guest Visits]
	   ,a.[Batch No]
	   ,a.[Reference]
	   ,a.[Lounge Code]
	   ,a.[Lounge]
	   ,a.airport AS [Airport]
	   ,a.city AS [City]
	   ,a.country AS [Country]
	   ,a.[Client 1 Pays Member Visit] as [Client Pays Member Visit]
	   ,a.[Inclusive PP Member Visit]
	   ,a.[Complimentary Member Visit]
	   ,a.[Cardholder Pays Member Visit]
	   ,a.[Client 1 Pays Guest Visit] as [Client Pays Guest Visit]
	   ,a.[Inclusive PP Guest Visit]
	   ,a.[Complimentary Guest Visit]
	   ,a.[Cardholder Pays Guest Visit]
	   ,a.[Lounge Visit Offer]
	   ,a.[Client 1 Member] as [Client Member]
	   ,a.[Inclusive PP Member]
	   ,a.[Client 1 Guest] as [Client Guest]
	   ,a.[Inclusive PP Guest]
	   ,a.[Client 1 Member/Guest] as [Client Member/Guest]
	   ,a.[Inclusive PP Member/Guest]
	   ,a.[Complimentary Member/Guest]
	   ,a.[Client 1 Visit Currency Member] as [Client Visit Currency Member]
	   ,a.[Client 1 Visit Amount Member] as [Client Visit Amount Member]
	   ,a.[Client 1 Visit Currency Guest] as [Client Visit Currency Guest]
	   ,a.[Client 1 Visit Amount Guest] as [Client Visit Amount Guest]
	   ,a.[Total Client 1 Amount Currency] as [Total Client Amount Currency]
	   ,a.[Total Client 1 Amount] as [Total Client Amount]
	   ,a.[Cardholder Visit Currency Member]
	   ,a.[Cardholder Visit Amount Member]
	   ,a.[Cardholder Visit Currency Guest]
	   ,a.[Cardholder Visit Amount Guest]
	   ,a.[Total Cardholder Amount Currency]
	   ,a.[Total Cardholder Amount]
	   ,a.[Cost Centre]
	   ,a.[Campaign Code]
	   ,a.[Vendor Code]
	   ,a.[User Invitation Code]
FROM OpsBilling.rprt.VisitBySourceDinersPPAutomation a
LEFT join cms.[dbo].[tbl_bi_deals] b on a.[Source Code]=b.[Client ID/SourceCode]
and 
(substring(a.[CCard No],0,11) =b.[Bin/Prefix] OR substring(a.[CCard No],0,10)=b.[Bin/Prefix] OR substring(a.[CCard No],0,9)=b.[Bin/Prefix] OR substring(a.[CCard No],0,8)=b.[Bin/Prefix] OR substring(a.[CCard No],0,7)=b.[Bin/Prefix])</property>
                <property
                  dataType="System.String"
                  description="The variable that contains the SQL command to be executed."
                  name="SqlCommandVariable"></property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">2</property>
                <property
                  dataType="System.String"
                  description="The mappings between the parameters in the SQL command and variables."
                  name="ParameterMapping">"Parameter0:Input",{ADBEFEF8-9A15-4D63-A505-77B83629EA59};</property>
              </properties>
              <connections>
                <connection
                  refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Connections[OleDbConnection]"
                  connectionManagerID="Package.ConnectionManagers[OpsBilling]"
                  connectionManagerRefId="Package.ConnectionManagers[OpsBilling]"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <outputs>
                <output
                  refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output]"
                  name="OLE DB Source Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Source Code]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Source Code]"
                      name="Source Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member No]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Member No]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member No]"
                      name="Member No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[CCard No]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[CCard No]"
                      name="CCard No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Title]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Title]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Title]"
                      name="Title"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[First Name]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[First Name]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[First Name]"
                      name="First Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Last Name]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Last Name]"
                      name="Last Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Membership Plan]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Membership Plan]"
                      name="Membership Plan"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Member Status]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member Status]"
                      name="Member Status"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Paid To Date]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Paid To Date]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Paid To Date]"
                      name="Paid To Date"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Experience Transaction Date]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]"
                      name="Experience Transaction Date"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Date Processed]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Date Processed]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Date Processed]"
                      name="Date Processed"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Batch No]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Batch No]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Batch No]"
                      name="Batch No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Reference]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Reference]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Reference]"
                      name="Reference"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Airport]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Airport]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Airport]"
                      name="Airport"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[City]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[City]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[City]"
                      name="City"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Country]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Country]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Country]"
                      name="Country"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]"
                      dataType="i2"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member/Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]"
                      name="Complimentary Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount Currency]"
                      length="3"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]"
                      name="Total Cardholder Amount Currency"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]"
                      dataType="r4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]"
                      name="Total Cardholder Amount"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cost Centre]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cost Centre]"
                      name="Cost Centre"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Campaign Code]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Campaign Code]"
                      name="Campaign Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Vendor Code]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Vendor Code]"
                      name="Vendor Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[User Invitation Code]"
                      length="254"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[User Invitation Code]"
                      name="User Invitation Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Report_Month]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Report_Month]"
                      length="10"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Report_Month]"
                      name="Report_Month"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Guest Visits]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Guest Visits]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Guest Visits]"
                      name="Guest Visits"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge Code]"
                      length="20"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Code]"
                      name="Lounge Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge]"
                      length="100"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge]"
                      name="Lounge"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]"
                      name="Inclusive PP Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]"
                      name="Complimentary Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Member Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]"
                      name="Cardholder Pays Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]"
                      name="Inclusive PP Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Guest Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]"
                      name="Complimentary Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Guest Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]"
                      name="Cardholder Pays Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge Visit Offer]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]"
                      name="Lounge Visit Offer"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]"
                      name="Inclusive PP Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]"
                      name="Inclusive PP Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member/Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]"
                      name="Inclusive PP Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Member]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]"
                      name="Cardholder Visit Currency Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]"
                      dataType="r8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Member]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]"
                      name="Cardholder Visit Amount Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Guest]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]"
                      name="Cardholder Visit Currency Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]"
                      dataType="r8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]"
                      name="Cardholder Visit Amount Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Name]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Name]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Name]"
                      name="Cardholder Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Issuer Clean Name]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Issuer Clean Name]"
                      length="255"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Issuer Clean Name]"
                      name="Issuer Clean Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Bin/Prefix]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Bin/Prefix]"
                      length="25"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Bin/Prefix]"
                      name="Bin/Prefix"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Pays Member Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Pays Member Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Pays Member Visit]"
                      name="Client Pays Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Pays Guest Visit]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Pays Guest Visit]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Pays Guest Visit]"
                      name="Client Pays Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Member]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Member]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Member]"
                      name="Client Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Guest]"
                      name="Client Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Member/Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Member/Guest]"
                      name="Client Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Visit Currency Member]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Visit Currency Member]"
                      name="Client Visit Currency Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Visit Amount Member]"
                      dataType="r8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Visit Amount Member]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Visit Amount Member]"
                      name="Client Visit Amount Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Visit Currency Guest]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Visit Currency Guest]"
                      name="Client Visit Currency Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Visit Amount Guest]"
                      dataType="r8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Visit Amount Guest]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Visit Amount Guest]"
                      name="Client Visit Amount Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client Amount Currency]"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client Amount Currency]"
                      name="Total Client Amount Currency"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client Amount]"
                      dataType="r8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client Amount]"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client Amount]"
                      name="Total Client Amount"
                      truncationRowDisposition="FailComponent" />
                  </outputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Source Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Member No]"
                      dataType="i8"
                      name="Member No" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="CCard No" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Title]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Title" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[First Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="First Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Last Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Membership Plan" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      length="5"
                      name="Member Status" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Paid To Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Paid To Date" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Experience Transaction Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Experience Transaction Date" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Date Processed]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Date Processed" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Batch No]"
                      dataType="i4"
                      name="Batch No" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Reference]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Reference" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Airport]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Airport" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[City]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="City" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Country]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Country" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member/Guest]"
                      dataType="i4"
                      name="Complimentary Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Total Cardholder Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount]"
                      dataType="r8"
                      name="Total Cardholder Amount" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      name="Cost Centre" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      name="Campaign Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      name="Vendor Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      name="User Invitation Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Report_Month]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Report_Month" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Guest Visits]"
                      dataType="i4"
                      name="Guest Visits" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Lounge Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Lounge" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member Visit]"
                      dataType="i4"
                      name="Inclusive PP Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member Visit]"
                      dataType="i4"
                      name="Complimentary Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Member Visit]"
                      dataType="i4"
                      name="Cardholder Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest Visit]"
                      dataType="i4"
                      name="Inclusive PP Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Guest Visit]"
                      dataType="i4"
                      name="Complimentary Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Guest Visit]"
                      dataType="i4"
                      name="Cardholder Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge Visit Offer]"
                      dataType="i4"
                      name="Lounge Visit Offer" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member]"
                      dataType="i4"
                      name="Inclusive PP Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest]"
                      dataType="i4"
                      name="Inclusive PP Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      name="Inclusive PP Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Cardholder Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Member]"
                      dataType="r8"
                      name="Cardholder Visit Amount Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Cardholder Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Guest]"
                      dataType="r8"
                      name="Cardholder Visit Amount Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Name]"
                      codePage="1252"
                      dataType="text"
                      name="Cardholder Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Issuer Clean Name]"
                      dataType="wstr"
                      length="255"
                      name="Issuer Clean Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Bin/Prefix]"
                      dataType="wstr"
                      length="25"
                      name="Bin/Prefix" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Pays Member Visit]"
                      dataType="i4"
                      name="Client Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Pays Guest Visit]"
                      dataType="i4"
                      name="Client Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Member]"
                      dataType="i4"
                      name="Client Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Guest]"
                      dataType="i4"
                      name="Client Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Member/Guest]"
                      dataType="i4"
                      name="Client Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Client Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Visit Amount Member]"
                      dataType="r8"
                      name="Client Visit Amount Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Client Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Visit Amount Guest]"
                      dataType="r8"
                      name="Client Visit Amount Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Total Client Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client Amount]"
                      dataType="r8"
                      name="Total Client Amount" />
                  </externalMetadataColumns>
                </output>
                <output
                  refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output]"
                  isErrorOut="true"
                  name="OLE DB Source Error Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Report_Month]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Report_Month]"
                      name="Report_Month" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Issuer Clean Name]"
                      dataType="wstr"
                      length="255"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Issuer Clean Name]"
                      name="Issuer Clean Name" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Source Code]"
                      name="Source Code" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Bin/Prefix]"
                      dataType="wstr"
                      length="25"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Bin/Prefix]"
                      name="Bin/Prefix" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Member No]"
                      dataType="i8"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Member No]"
                      name="Member No" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[CCard No]"
                      name="CCard No" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Title]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Title]"
                      name="Title" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Name]"
                      codePage="1252"
                      dataType="text"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Name]"
                      name="Cardholder Name" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[First Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[First Name]"
                      name="First Name" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Last Name]"
                      name="Last Name" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Membership Plan]"
                      name="Membership Plan" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      length="5"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Member Status]"
                      name="Member Status" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Paid To Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Paid To Date]"
                      name="Paid To Date" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Experience Transaction Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Experience Transaction Date]"
                      name="Experience Transaction Date" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Date Processed]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Date Processed]"
                      name="Date Processed" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Guest Visits]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Guest Visits]"
                      name="Guest Visits" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Batch No]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Batch No]"
                      name="Batch No" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Reference]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Reference]"
                      name="Reference" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge Code]"
                      name="Lounge Code" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge]"
                      name="Lounge" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Airport]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Airport]"
                      name="Airport" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[City]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[City]"
                      name="City" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Country]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Country]"
                      name="Country" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Pays Member Visit]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Pays Member Visit]"
                      name="Client Pays Member Visit" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member Visit]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member Visit]"
                      name="Inclusive PP Member Visit" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Member Visit]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Member Visit]"
                      name="Complimentary Member Visit" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Member Visit]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Member Visit]"
                      name="Cardholder Pays Member Visit" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Pays Guest Visit]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Pays Guest Visit]"
                      name="Client Pays Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest Visit]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest Visit]"
                      name="Inclusive PP Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Guest Visit]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Guest Visit]"
                      name="Complimentary Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Guest Visit]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Guest Visit]"
                      name="Cardholder Pays Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge Visit Offer]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge Visit Offer]"
                      name="Lounge Visit Offer" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Member]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Member]"
                      name="Client Member" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member]"
                      name="Inclusive PP Member" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Guest]"
                      name="Client Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest]"
                      name="Inclusive PP Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Member/Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Member/Guest]"
                      name="Client Member/Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member/Guest]"
                      name="Inclusive PP Member/Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Member/Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Member/Guest]"
                      name="Complimentary Member/Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Visit Currency Member]"
                      name="Client Visit Currency Member" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Visit Amount Member]"
                      dataType="r8"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Visit Amount Member]"
                      name="Client Visit Amount Member" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Visit Currency Guest]"
                      name="Client Visit Currency Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Visit Amount Guest]"
                      dataType="r8"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Visit Amount Guest]"
                      name="Client Visit Amount Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client Amount Currency]"
                      name="Total Client Amount Currency" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client Amount]"
                      dataType="r8"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client Amount]"
                      name="Total Client Amount" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Member]"
                      name="Cardholder Visit Currency Member" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Member]"
                      dataType="r8"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Member]"
                      name="Cardholder Visit Amount Member" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Guest]"
                      name="Cardholder Visit Currency Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Guest]"
                      dataType="r8"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Guest]"
                      name="Cardholder Visit Amount Guest" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount Currency]"
                      name="Total Cardholder Amount Currency" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount]"
                      dataType="r8"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount]"
                      name="Total Cardholder Amount" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cost Centre]"
                      name="Cost Centre" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Campaign Code]"
                      name="Campaign Code" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Vendor Code]"
                      name="Vendor Code" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[User Invitation Code]"
                      name="User Invitation Code" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
          </components>
          <paths>
            <path
              refId="Package\DFT_GenerateExcelFile 1.Paths[Data Conversion Output]"
              endId="Package\DFT_GenerateExcelFile 1\Excel Destination.Inputs[Excel Destination Input]"
              name="Data Conversion Output"
              startId="Package\DFT_GenerateExcelFile 1\Data Conversion.Outputs[Data Conversion Output]" />
            <path
              refId="Package\DFT_GenerateExcelFile 1.Paths[OLE DB Source Output]"
              endId="Package\DFT_GenerateExcelFile 1\Data Conversion.Inputs[Data Conversion Input]"
              name="OLE DB Source Output"
              startId="Package\DFT_GenerateExcelFile 1\OLE DB Source.Outputs[OLE DB Source Output]" />
          </paths>
        </pipeline>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\DFT_LoadData 1"
      DTS:CreationName="Microsoft.Pipeline"
      DTS:DelayValidation="True"
      DTS:Description="Data Flow Task"
      DTS:DTSID="{e3cf6cf7-9b27-4eda-b2de-4edf005dc6bf}"
      DTS:ExecutableType="Microsoft.Pipeline"
      DTS:LocaleID="-1"
      DTS:ObjectName="DFT_LoadData 1"
      DTS:TaskContact="Performs high-performance data extraction, transformation and loading;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1">
      <DTS:Variables />
      <DTS:ObjectData>
        <pipeline
          version="1">
          <components>
            <component
              refId="Package\DFT_LoadData 1\OLE DB Destination"
              componentClassID="Microsoft.OLEDBDestination"
              contactInfo="OLE DB Destination;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;4"
              description="OLE DB Destination"
              name="OLE DB Destination"
              usesDispositions="true"
              version="4">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset">[rprt].[VisitBySourceDinersPPAutomation]</property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor"></property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">3</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the values supplied for identity columns will be copied to the destination. If false, values for identity columns will be auto-generated at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepIdentity">false</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the columns containing null will have null inserted in the destination. If false, columns containing null will have their default values inserted at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepNulls">false</property>
                <property
                  dataType="System.String"
                  description="Specifies options to be used with fast load.  Applies only if fast load is turned on."
                  name="FastLoadOptions">TABLOCK,CHECK_CONSTRAINTS</property>
                <property
                  dataType="System.Int32"
                  description="Specifies when commits are issued during data insertion.  A value of 0 specifies that one commit will be issued at the end of data insertion.  Applies only if fast load is turned on."
                  name="FastLoadMaxInsertCommitSize">2147483647</property>
              </properties>
              <connections>
                <connection
                  refId="Package\DFT_LoadData 1\OLE DB Destination.Connections[OleDbConnection]"
                  connectionManagerID="Package.ConnectionManagers[OpsBilling]"
                  connectionManagerRefId="Package.ConnectionManagers[OpsBilling]"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <inputs>
                <input
                  refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input]"
                  errorOrTruncationOperation="Insert"
                  errorRowDisposition="FailComponent"
                  hasSideEffects="true"
                  name="OLE DB Destination Input">
                  <inputColumns>
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Source Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Source Code"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Source Code]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Source Code]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Member No]"
                      cachedDataType="i8"
                      cachedName="Member No"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member No]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member No]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Title]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Title"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Title]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Title]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[First Name]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="First Name"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[First Name]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[First Name]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Last Name]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="Last Name"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Last Name]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Last Name]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Membership Plan]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Membership Plan"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Membership Plan]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Membership Plan]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Member Status]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="5"
                      cachedName="Member Status"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member Status]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member Status]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Paid To Date]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="10"
                      cachedName="Paid To Date"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Paid To Date]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Paid To Date]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Experience Transaction Date]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="10"
                      cachedName="Experience Transaction Date"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Experience Transaction Date]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Date Processed]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="10"
                      cachedName="Date Processed"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Date Processed]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Date Processed]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Batch No]"
                      cachedDataType="i4"
                      cachedName="Batch No"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Batch No]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Batch No]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Reference]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Reference"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Reference]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Reference]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Airport]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Airport"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Airport]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Airport]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[City]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="City"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[City]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[City]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Country]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Country"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Country]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Country]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Complimentary Member/Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member/Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Cardholder Amount Currency]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Total Cardholder Amount Currency"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount Currency]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Cardholder Amount]"
                      cachedDataType="numeric"
                      cachedName="Total Cardholder Amount"
                      cachedPrecision="19"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cost Centre]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Cost Centre"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cost Centre]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cost Centre]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Campaign Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Campaign Code"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Campaign Code]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Campaign Code]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Vendor Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Vendor Code"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Vendor Code]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Vendor Code]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[User Invitation Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="User Invitation Code"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[User Invitation Code]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[User Invitation Code]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Guest Visits]"
                      cachedDataType="i4"
                      cachedName="Guest Visits"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Guest Visits]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Guest Visits]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Lounge Code"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Code]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Code]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Lounge"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Inclusive PP Member Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Complimentary Member Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Pays Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Cardholder Pays Member Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Guest Visit]"
                      cachedDataType="ui1"
                      cachedName="Inclusive PP Guest Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Guest Visit]"
                      cachedDataType="ui1"
                      cachedName="Complimentary Guest Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Pays Guest Visit]"
                      cachedDataType="ui1"
                      cachedName="Cardholder Pays Guest Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge Visit Offer]"
                      cachedDataType="ui1"
                      cachedName="Lounge Visit Offer"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Visit Offer]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Member"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Guest]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Member/Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member/Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Currency Member]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Cardholder Visit Currency Member"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Amount Member]"
                      cachedDataType="numeric"
                      cachedName="Cardholder Visit Amount Member"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Currency Guest]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Cardholder Visit Currency Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Amount Guest]"
                      cachedDataType="numeric"
                      cachedName="Cardholder Visit Amount Guest"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Pays Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Client 1 Pays Member Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Pays Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Client 2 Pays Member Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Pays Guest Visit]"
                      cachedDataType="ui1"
                      cachedName="Client 1 Pays Guest Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Pays Guest Visit]"
                      cachedDataType="ui1"
                      cachedName="Client 2 Pays Guest Visit"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Visit]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Member]"
                      cachedDataType="i4"
                      cachedName="Client 1 Member"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Member]"
                      cachedDataType="i4"
                      cachedName="Client 2 Member"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Guest]"
                      cachedDataType="i4"
                      cachedName="Client 1 Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Guest]"
                      cachedDataType="i4"
                      cachedName="Client 2 Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Client 1 Member/Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member/Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Client 2 Member/Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member/Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Currency Member]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Client 1 Visit Currency Member"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Amount Member]"
                      cachedDataType="numeric"
                      cachedName="Client 1 Visit Amount Member"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Currency Guest]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Client 1 Visit Currency Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Amount Guest]"
                      cachedDataType="numeric"
                      cachedName="Client 1 Visit Amount Guest"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 1 Amount Currency]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Total Client 1 Amount Currency"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount Currency]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 1 Amount]"
                      cachedDataType="numeric"
                      cachedName="Total Client 1 Amount"
                      cachedPrecision="19"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Currency Member]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Client 2 Visit Currency Member"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Amount Member]"
                      cachedDataType="numeric"
                      cachedName="Client 2 Visit Amount Member"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Currency Guest]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Client 2 Visit Currency Guest"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Amount Guest]"
                      cachedDataType="numeric"
                      cachedName="Client 2 Visit Amount Guest"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 2 Amount Currency]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Total Client 2 Amount Currency"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount Currency]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 2 Amount]"
                      cachedDataType="numeric"
                      cachedName="Total Client 2 Amount"
                      cachedPrecision="19"
                      cachedScale="2"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[CCard No]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="CCard No"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[CCard No]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[CCard No]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Report_Month]"
                      cachedDataType="dbDate"
                      cachedName="Report_Month"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Report_Month]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Report_Month]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[consumer_no]"
                      cachedDataType="i4"
                      cachedName="consumer_no"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[consumer_no]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[consumer_no]" />
                    <inputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[cardholdername]"
                      cachedCodepage="1252"
                      cachedDataType="text"
                      cachedName="cardholdername"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Name]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[cardholdername]" />
                  </inputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Report_Month]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Report_Month" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Source Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member No]"
                      dataType="i8"
                      name="Member No" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="CCard No" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Title]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Title" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[First Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="First Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Last Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Membership Plan" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      length="5"
                      name="Member Status" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Paid To Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Paid To Date" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Experience Transaction Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Experience Transaction Date" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Date Processed]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Date Processed" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Guest Visits]"
                      dataType="i4"
                      name="Guest Visits" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Batch No]"
                      dataType="i4"
                      name="Batch No" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Reference]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Reference" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Lounge Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Lounge" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Airport]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Airport" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[City]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="City" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Country]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Country" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Member Visit]"
                      dataType="i4"
                      name="Client 1 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Member Visit]"
                      dataType="i4"
                      name="Client 2 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member Visit]"
                      dataType="i4"
                      name="Inclusive PP Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member Visit]"
                      dataType="i4"
                      name="Complimentary Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Member Visit]"
                      dataType="i4"
                      name="Cardholder Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Guest Visit]"
                      dataType="i4"
                      name="Client 1 Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Guest Visit]"
                      dataType="i4"
                      name="Client 2 Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest Visit]"
                      dataType="i4"
                      name="Inclusive PP Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Guest Visit]"
                      dataType="i4"
                      name="Complimentary Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Guest Visit]"
                      dataType="i4"
                      name="Cardholder Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Visit Offer]"
                      dataType="i4"
                      name="Lounge Visit Offer" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member]"
                      dataType="i4"
                      name="Client 1 Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member]"
                      dataType="i4"
                      name="Client 2 Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member]"
                      dataType="i4"
                      name="Inclusive PP Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Guest]"
                      dataType="i4"
                      name="Client 1 Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Guest]"
                      dataType="i4"
                      name="Client 2 Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest]"
                      dataType="i4"
                      name="Inclusive PP Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member/Guest]"
                      dataType="i4"
                      name="Client 1 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member/Guest]"
                      dataType="i4"
                      name="Client 2 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      name="Inclusive PP Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member/Guest]"
                      dataType="i4"
                      name="Complimentary Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Client 1 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Member]"
                      dataType="r8"
                      name="Client 1 Visit Amount Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Client 1 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Guest]"
                      dataType="r8"
                      name="Client 1 Visit Amount Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Total Client 1 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount]"
                      dataType="r8"
                      name="Total Client 1 Amount" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Client 2 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Member]"
                      dataType="r8"
                      name="Client 2 Visit Amount Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Client 2 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Guest]"
                      dataType="r8"
                      name="Client 2 Visit Amount Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Total Client 2 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount]"
                      dataType="r8"
                      name="Total Client 2 Amount" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Cardholder Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Member]"
                      dataType="r8"
                      name="Cardholder Visit Amount Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Cardholder Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Guest]"
                      dataType="r8"
                      name="Cardholder Visit Amount Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Total Cardholder Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount]"
                      dataType="r8"
                      name="Total Cardholder Amount" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      name="Cost Centre" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      name="Campaign Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      name="Vendor Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      length="300"
                      name="User Invitation Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[consumer_no]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="consumer_no" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Name]"
                      codePage="1252"
                      dataType="text"
                      name="Cardholder Name" />
                  </externalMetadataColumns>
                </input>
              </inputs>
              <outputs>
                <output
                  refId="Package\DFT_LoadData 1\OLE DB Destination.Outputs[OLE DB Destination Error Output]"
                  exclusionGroup="1"
                  isErrorOut="true"
                  name="OLE DB Destination Error Output"
                  synchronousInputId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
            <component
              refId="Package\DFT_LoadData 1\OLE DB Source"
              componentClassID="Microsoft.OLEDBSource"
              contactInfo="OLE DB Source;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;7"
              description="OLE DB Source"
              name="OLE DB Source"
              usesDispositions="true"
              version="7">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset"></property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor">SELECT DISTINCT
Report_Month,       
source_code AS [Source Code]
	   ,membership_no as [Member No]
                     ,trans_ccard_number AS [CCard No]
	   ,title AS [Title]
                     ,cardholdername
	   ,forename AS [First Name]
	   ,surname AS [Last Name]
	   ,product_version AS [Membership Plan]
	   ,subs_status AS [Member Status]
	   ,CONVERT(VARCHAR(10),paid_to_date,103) AS [Paid To Date]
	   ,CONVERT(VARCHAR(10),track_start,103) AS [Experience Transaction Date]
	   ,CONVERT(VARCHAR(10),creation_date,103) AS [Date Processed]
	   ,track_guests AS [Guest Visits]
	   ,track_batch AS [Batch No]
	   ,external_ref AS [Reference]
	   ,lounge_code AS [Lounge Code]
	   ,lounge_name AS [Lounge]
	   ,airport AS [Airport]
	   ,city AS [City]
	   ,country AS [Country]
	   ,count_mem_cli AS [Client 1 Pays Member Visit]
	   ,pvsd.count_mem_cli2 AS [Client 2 Pays Member Visit]
	   ,count_mem_pp AS [Inclusive PP Member Visit]
	   ,count_mem_comp AS [Complimentary Member Visit]
	   ,count_mem_mem AS [Cardholder Pays Member Visit]

	   ,count_gue_cli AS [Client 1 Pays Guest Visit]
	   ,pvsd.count_gue_cli2 AS [Client 2 Pays Guest Visit]
	   ,count_gue_pp AS [Inclusive PP Guest Visit]
	   ,count_gue_comp AS [Complimentary Guest Visit]
	   ,count_gue_mem AS [Cardholder Pays Guest Visit]
	   ,count_gue_lou AS [Lounge Visit Offer]
	   ,remaining_mem_cli_count AS [Client 1 Member]
	   ,temp.remaining_mem_cli2_count AS [Client 2 Member]
	   ,remaining_mem_pp_count AS [Inclusive PP Member]
	   ,temp.remaining_gue_cli_count AS [Client 1 Guest]
	   ,remaining_gue_cli2_count AS [Client 2 Guest]
	   ,remaining_gue_pp_count AS [Inclusive PP Guest]
	   ,remaining_mgu_cli_count AS [Client 1 Member/Guest]
	   ,temp.remaining_mgu_cli2_count AS [Client 2 Member/Guest]

	   ,remaining_mgu_pp_count AS [Inclusive PP Member/Guest]
	   ,remaining_mgu_comp_count AS [Complimentary Member/Guest]

	   ,fee_mem_cli_curr AS [Client 1 Visit Currency Member]
	   ,fee_mem_cli AS [Client 1 Visit Amount Member]
	   ,fee_gue_cli_curr AS [Client 1 Visit Currency Guest]
	   ,fee_gue_cli AS [Client 1 Visit Amount Guest]
	   ,COALESCE(fee_mem_cli_curr,fee_gue_cli_curr) AS [Total Client 1 Amount Currency]
	   ,CAST(fee_mem_cli AS NUMERIC(18,2))+ CAST(fee_gue_cli AS NUMERIC(18,2)) AS [Total Client 1 Amount]

	   ,pvsd.fee_mem_cli2_curr AS [Client 2 Visit Currency Member]
	   ,pvsd.fee_mem_cli2 AS [Client 2 Visit Amount Member]
	   ,pvsd.fee_gue_cli2_curr AS [Client 2 Visit Currency Guest]
	   ,pvsd.fee_gue_cli2 AS [Client 2 Visit Amount Guest]
	   ,COALESCE(pvsd.fee_mem_cli2_curr,pvsd.fee_gue_cli2_curr) AS [Total Client 2 Amount Currency]
	   ,CAST(pvsd.fee_mem_cli2 AS NUMERIC(18,2))+ CAST(pvsd.fee_gue_cli2 AS NUMERIC(18,2)) AS [Total Client 2 Amount]
	   
	   ,fee_mem_mem_curr	 AS [Cardholder Visit Currency Member]
	   ,fee_mem_mem	 AS [Cardholder Visit Amount Member]
	   ,fee_gue_mem_curr AS [Cardholder Visit Currency Guest]
	   ,fee_gue_mem AS [Cardholder Visit Amount Guest]
	   
                      ,CASE WHEN fee_mem_mem_curr='' THEN fee_gue_mem_curr 
                                  WHEN fee_gue_mem_curr='' THEN fee_mem_mem_curr
                                  ELSE fee_mem_mem_curr 
                       END AS [Total Cardholder Amount Currency]
	   ,CAST(fee_mem_mem AS NUMERIC(18,2))+CAST(fee_gue_mem AS NUMERIC(18,2)) AS [Total Cardholder Amount]
	   
	   ,old_system_ref AS [Cost Centre]
	   ,campaign_code AS [Campaign Code]
	   ,vendor_tracking_code AS [Vendor Code]
	   ,user_invitation_code AS [User Invitation Code]
	   ,temp.consumer_no
 FROM
	##temptable AS temp
	INNER JOIN PPass.dbo.purchase_visit_summary_data AS pvsd WITH (NOLOCK) ON temp.purchase_no = pvsd.purchase_no AND temp.track_seq = pvsd.track_seq</property>
                <property
                  dataType="System.String"
                  description="The variable that contains the SQL command to be executed."
                  name="SqlCommandVariable">User::strQuery</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">2</property>
                <property
                  dataType="System.String"
                  description="The mappings between the parameters in the SQL command and variables."
                  name="ParameterMapping"></property>
              </properties>
              <connections>
                <connection
                  refId="Package\DFT_LoadData 1\OLE DB Source.Connections[OleDbConnection]"
                  connectionManagerID="Package.ConnectionManagers[PPASS]"
                  connectionManagerRefId="Package.ConnectionManagers[PPASS]"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <outputs>
                <output
                  refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output]"
                  name="OLE DB Source Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Source Code]"
                      length="20"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Source Code]"
                      name="Source Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member No]"
                      dataType="i8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Member No]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member No]"
                      name="Member No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Title]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Title]"
                      length="20"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Title]"
                      name="Title"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[First Name]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[First Name]"
                      length="50"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[First Name]"
                      name="First Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Last Name]"
                      length="50"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Last Name]"
                      name="Last Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Membership Plan]"
                      length="20"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Membership Plan]"
                      name="Membership Plan"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Member Status]"
                      length="5"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Member Status]"
                      name="Member Status"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Paid To Date]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Paid To Date]"
                      length="10"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Paid To Date]"
                      name="Paid To Date"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Experience Transaction Date]"
                      length="10"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]"
                      name="Experience Transaction Date"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Date Processed]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Date Processed]"
                      length="10"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Date Processed]"
                      name="Date Processed"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Batch No]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Batch No]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Batch No]"
                      name="Batch No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Reference]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Reference]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Reference]"
                      name="Reference"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Airport]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Airport]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Airport]"
                      name="Airport"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[City]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[City]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[City]"
                      name="City"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Country]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Country]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Country]"
                      name="Country"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member/Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]"
                      name="Complimentary Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount Currency]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]"
                      name="Total Cardholder Amount Currency"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]"
                      name="Total Cardholder Amount"
                      precision="19"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cost Centre]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cost Centre]"
                      name="Cost Centre"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Campaign Code]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Campaign Code]"
                      name="Campaign Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Vendor Code]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Vendor Code]"
                      name="Vendor Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[User Invitation Code]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[User Invitation Code]"
                      name="User Invitation Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Guest Visits]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Guest Visits]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Guest Visits]"
                      name="Guest Visits"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge Code]"
                      length="20"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Code]"
                      name="Lounge Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge]"
                      name="Lounge"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]"
                      name="Inclusive PP Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]"
                      name="Complimentary Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]"
                      name="Cardholder Pays Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]"
                      name="Inclusive PP Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]"
                      name="Complimentary Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]"
                      name="Cardholder Pays Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge Visit Offer]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]"
                      name="Lounge Visit Offer"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]"
                      name="Inclusive PP Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]"
                      name="Inclusive PP Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member/Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]"
                      name="Inclusive PP Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Member]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]"
                      name="Cardholder Visit Currency Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]"
                      name="Cardholder Visit Amount Member"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Guest]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]"
                      name="Cardholder Visit Currency Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]"
                      name="Cardholder Visit Amount Guest"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]"
                      name="Client 1 Pays Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Member Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]"
                      name="Client 2 Pays Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Visit]"
                      name="Client 1 Pays Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Guest Visit]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Visit]"
                      name="Client 2 Pays Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Member]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Member]"
                      name="Client 1 Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Member]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Member]"
                      name="Client 2 Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Guest]"
                      name="Client 1 Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Guest]"
                      name="Client 2 Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member/Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]"
                      name="Client 1 Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member/Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]"
                      name="Client 2 Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Member]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]"
                      name="Client 1 Visit Currency Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]"
                      name="Client 1 Visit Amount Member"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Guest]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]"
                      name="Client 1 Visit Currency Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]"
                      name="Client 1 Visit Amount Guest"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount Currency]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]"
                      name="Total Client 1 Amount Currency"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]"
                      name="Total Client 1 Amount"
                      precision="19"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Member]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]"
                      name="Client 2 Visit Currency Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Member]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]"
                      name="Client 2 Visit Amount Member"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Guest]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]"
                      name="Client 2 Visit Currency Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Guest]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]"
                      name="Client 2 Visit Amount Guest"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount Currency]"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]"
                      name="Total Client 2 Amount Currency"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]"
                      name="Total Client 2 Amount"
                      precision="19"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[CCard No]"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[CCard No]"
                      name="CCard No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Report_Month]"
                      dataType="dbDate"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Report_Month]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Report_Month]"
                      name="Report_Month"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[consumer_no]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[consumer_no]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[consumer_no]"
                      name="consumer_no"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[cardholdername]"
                      codePage="1252"
                      dataType="text"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[cardholdername]"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[cardholdername]"
                      name="cardholdername"
                      truncationRowDisposition="FailComponent" />
                  </outputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Source Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Member No]"
                      dataType="i8"
                      name="Member No" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Title]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Title" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[First Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="First Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Last Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Membership Plan" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      length="5"
                      name="Member Status" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Paid To Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Paid To Date" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Experience Transaction Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Experience Transaction Date" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Date Processed]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      name="Date Processed" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Batch No]"
                      dataType="i4"
                      name="Batch No" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Reference]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Reference" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Airport]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Airport" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[City]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="City" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Country]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Country" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member/Guest]"
                      dataType="i4"
                      name="Complimentary Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Total Cardholder Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount]"
                      dataType="numeric"
                      name="Total Cardholder Amount"
                      precision="19"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Cost Centre" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Campaign Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Vendor Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="User Invitation Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Guest Visits]"
                      dataType="i4"
                      name="Guest Visits" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Lounge Code" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Lounge" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member Visit]"
                      dataType="ui1"
                      name="Inclusive PP Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member Visit]"
                      dataType="ui1"
                      name="Complimentary Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Member Visit]"
                      dataType="ui1"
                      name="Cardholder Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest Visit]"
                      dataType="ui1"
                      name="Inclusive PP Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Guest Visit]"
                      dataType="ui1"
                      name="Complimentary Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Guest Visit]"
                      dataType="ui1"
                      name="Cardholder Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Lounge Visit Offer]"
                      dataType="ui1"
                      name="Lounge Visit Offer" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member]"
                      dataType="i4"
                      name="Inclusive PP Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest]"
                      dataType="i4"
                      name="Inclusive PP Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      name="Inclusive PP Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Cardholder Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Member]"
                      dataType="numeric"
                      name="Cardholder Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Cardholder Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Guest]"
                      dataType="numeric"
                      name="Cardholder Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Member Visit]"
                      dataType="ui1"
                      name="Client 1 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Member Visit]"
                      dataType="ui1"
                      name="Client 2 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Guest Visit]"
                      dataType="ui1"
                      name="Client 1 Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Guest Visit]"
                      dataType="ui1"
                      name="Client 2 Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member]"
                      dataType="i4"
                      name="Client 1 Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member]"
                      dataType="i4"
                      name="Client 2 Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Guest]"
                      dataType="i4"
                      name="Client 1 Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Guest]"
                      dataType="i4"
                      name="Client 2 Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member/Guest]"
                      dataType="i4"
                      name="Client 1 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member/Guest]"
                      dataType="i4"
                      name="Client 2 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Client 1 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Member]"
                      dataType="numeric"
                      name="Client 1 Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Client 1 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Guest]"
                      dataType="numeric"
                      name="Client 1 Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Total Client 1 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount]"
                      dataType="numeric"
                      name="Total Client 1 Amount"
                      precision="19"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Client 2 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Member]"
                      dataType="numeric"
                      name="Client 2 Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Client 2 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Guest]"
                      dataType="numeric"
                      name="Client 2 Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Total Client 2 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount]"
                      dataType="numeric"
                      name="Total Client 2 Amount"
                      precision="19"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="CCard No" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Report_Month]"
                      dataType="dbDate"
                      name="Report_Month" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[consumer_no]"
                      dataType="i4"
                      name="consumer_no" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[cardholdername]"
                      codePage="1252"
                      dataType="text"
                      name="cardholdername" />
                  </externalMetadataColumns>
                </output>
                <output
                  refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output]"
                  isErrorOut="true"
                  name="OLE DB Source Error Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Report_Month]"
                      dataType="dbDate"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Report_Month]"
                      name="Report_Month" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Source Code]"
                      name="Source Code" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Member No]"
                      dataType="i8"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Member No]"
                      name="Member No" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[CCard No]"
                      name="CCard No" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Title]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Title]"
                      name="Title" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[cardholdername]"
                      codePage="1252"
                      dataType="text"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[cardholdername]"
                      name="cardholdername" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[First Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[First Name]"
                      name="First Name" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Last Name]"
                      name="Last Name" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Membership Plan]"
                      name="Membership Plan" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      length="5"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Member Status]"
                      name="Member Status" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Paid To Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Paid To Date]"
                      name="Paid To Date" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Experience Transaction Date]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Experience Transaction Date]"
                      name="Experience Transaction Date" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Date Processed]"
                      codePage="1252"
                      dataType="str"
                      length="10"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Date Processed]"
                      name="Date Processed" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Guest Visits]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Guest Visits]"
                      name="Guest Visits" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Batch No]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Batch No]"
                      name="Batch No" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Reference]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Reference]"
                      name="Reference" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge Code]"
                      name="Lounge Code" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge]"
                      name="Lounge" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Airport]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Airport]"
                      name="Airport" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[City]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[City]"
                      name="City" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Country]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Country]"
                      name="Country" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Member Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Member Visit]"
                      name="Client 1 Pays Member Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Member Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Member Visit]"
                      name="Client 2 Pays Member Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member Visit]"
                      name="Inclusive PP Member Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Member Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Member Visit]"
                      name="Complimentary Member Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Member Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Member Visit]"
                      name="Cardholder Pays Member Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Guest Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Guest Visit]"
                      name="Client 1 Pays Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Guest Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Guest Visit]"
                      name="Client 2 Pays Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest Visit]"
                      name="Inclusive PP Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Guest Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Guest Visit]"
                      name="Complimentary Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Guest Visit]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Guest Visit]"
                      name="Cardholder Pays Guest Visit" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge Visit Offer]"
                      dataType="ui1"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Lounge Visit Offer]"
                      name="Lounge Visit Offer" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Member]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Member]"
                      name="Client 1 Member" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Member]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Member]"
                      name="Client 2 Member" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member]"
                      name="Inclusive PP Member" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Guest]"
                      name="Client 1 Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Guest]"
                      name="Client 2 Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest]"
                      name="Inclusive PP Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Member/Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Member/Guest]"
                      name="Client 1 Member/Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Member/Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Member/Guest]"
                      name="Client 2 Member/Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member/Guest]"
                      name="Inclusive PP Member/Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Member/Guest]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Complimentary Member/Guest]"
                      name="Complimentary Member/Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Member]"
                      name="Client 1 Visit Currency Member" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Member]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Member]"
                      name="Client 1 Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Guest]"
                      name="Client 1 Visit Currency Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Guest]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Guest]"
                      name="Client 1 Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount Currency]"
                      name="Total Client 1 Amount Currency" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount]"
                      name="Total Client 1 Amount"
                      precision="19"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Member]"
                      name="Client 2 Visit Currency Member" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Member]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Member]"
                      name="Client 2 Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Guest]"
                      name="Client 2 Visit Currency Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Guest]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Guest]"
                      name="Client 2 Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount Currency]"
                      name="Total Client 2 Amount Currency" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount]"
                      name="Total Client 2 Amount"
                      precision="19"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Member]"
                      name="Cardholder Visit Currency Member" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Member]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Member]"
                      name="Cardholder Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Guest]"
                      name="Cardholder Visit Currency Guest" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Guest]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Guest]"
                      name="Cardholder Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount Currency]"
                      name="Total Cardholder Amount Currency" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount]"
                      dataType="numeric"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount]"
                      name="Total Cardholder Amount"
                      precision="19"
                      scale="2" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Cost Centre]"
                      name="Cost Centre" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Campaign Code]"
                      name="Campaign Code" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Vendor Code]"
                      name="Vendor Code" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[User Invitation Code]"
                      name="User Invitation Code" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[consumer_no]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[consumer_no]"
                      name="consumer_no" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
          </components>
          <paths>
            <path
              refId="Package\DFT_LoadData 1.Paths[OLE DB Source Output]"
              endId="Package\DFT_LoadData 1\OLE DB Destination.Inputs[OLE DB Destination Input]"
              name="OLE DB Source Output"
              startId="Package\DFT_LoadData 1\OLE DB Source.Outputs[OLE DB Source Output]" />
          </paths>
        </pipeline>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\DFT_LoadSourceCodesPPass"
      DTS:CreationName="Microsoft.Pipeline"
      DTS:DelayValidation="True"
      DTS:Description="Data Flow Task"
      DTS:DTSID="{332892f0-be5a-466f-a456-4c86b2245f1c}"
      DTS:ExecutableType="Microsoft.Pipeline"
      DTS:LocaleID="-1"
      DTS:ObjectName="DFT_LoadSourceCodesPPass"
      DTS:TaskContact="Performs high-performance data extraction, transformation and loading;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1">
      <DTS:Variables />
      <DTS:ObjectData>
        <pipeline
          version="1">
          <components>
            <component
              refId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination"
              componentClassID="Microsoft.OLEDBDestination"
              contactInfo="OLE DB Destination;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;4"
              description="OLE DB Destination"
              name="OLE DB Destination"
              usesDispositions="true"
              version="4">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset"></property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor">Select * from ##VisitBySourceSourceCodes</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">2</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the values supplied for identity columns will be copied to the destination. If false, values for identity columns will be auto-generated at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepIdentity">false</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the columns containing null will have null inserted in the destination. If false, columns containing null will have their default values inserted at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepNulls">false</property>
                <property
                  dataType="System.String"
                  description="Specifies options to be used with fast load.  Applies only if fast load is turned on."
                  name="FastLoadOptions">TABLOCK,CHECK_CONSTRAINTS</property>
                <property
                  dataType="System.Int32"
                  description="Specifies when commits are issued during data insertion.  A value of 0 specifies that one commit will be issued at the end of data insertion.  Applies only if fast load is turned on."
                  name="FastLoadMaxInsertCommitSize">2147483647</property>
              </properties>
              <connections>
                <connection
                  refId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Connections[OleDbConnection]"
                  connectionManagerID="Package.ConnectionManagers[PPASS]"
                  connectionManagerRefId="Package.ConnectionManagers[PPASS]"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <inputs>
                <input
                  refId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Inputs[OLE DB Destination Input]"
                  errorOrTruncationOperation="Insert"
                  errorRowDisposition="FailComponent"
                  hasSideEffects="true"
                  name="OLE DB Destination Input">
                  <inputColumns>
                    <inputColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client ID/SourceCode]"
                      cachedDataType="wstr"
                      cachedLength="255"
                      cachedName="Client ID/SourceCode"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[SourceCode]"
                      lineageId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client ID/SourceCode]" />
                  </inputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[SourceCode]"
                      dataType="wstr"
                      length="255"
                      name="SourceCode" />
                  </externalMetadataColumns>
                </input>
              </inputs>
              <outputs>
                <output
                  refId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Outputs[OLE DB Destination Error Output]"
                  exclusionGroup="1"
                  isErrorOut="true"
                  name="OLE DB Destination Error Output"
                  synchronousInputId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Inputs[OLE DB Destination Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
            <component
              refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source"
              componentClassID="Microsoft.OLEDBSource"
              contactInfo="OLE DB Source;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;7"
              description="OLE DB Source"
              name="OLE DB Source"
              usesDispositions="true"
              version="7">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset"></property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor">select distinct [Client ID/SourceCode] from cms.dbo.tbl_bi_deals 
where [Client Name]='Diners' and Network='Diners' and Program='Priority Pass' and [Program Type]='Wholesale Digital' 
and [AOPC Enabled]='Yes' and Status='Active'</property>
                <property
                  dataType="System.String"
                  description="The variable that contains the SQL command to be executed."
                  name="SqlCommandVariable"></property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">2</property>
                <property
                  dataType="System.String"
                  description="The mappings between the parameters in the SQL command and variables."
                  name="ParameterMapping"></property>
              </properties>
              <connections>
                <connection
                  refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Connections[OleDbConnection]"
                  connectionManagerID="Package.ConnectionManagers[OpsBilling]"
                  connectionManagerRefId="Package.ConnectionManagers[OpsBilling]"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <outputs>
                <output
                  refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Output]"
                  name="OLE DB Source Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client ID/SourceCode]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client ID/SourceCode]"
                      length="255"
                      lineageId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client ID/SourceCode]"
                      name="Client ID/SourceCode"
                      truncationRowDisposition="FailComponent" />
                  </outputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client ID/SourceCode]"
                      dataType="wstr"
                      length="255"
                      name="Client ID/SourceCode" />
                  </externalMetadataColumns>
                </output>
                <output
                  refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Error Output]"
                  isErrorOut="true"
                  name="OLE DB Source Error Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client ID/SourceCode]"
                      dataType="wstr"
                      length="255"
                      lineageId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client ID/SourceCode]"
                      name="Client ID/SourceCode" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
          </components>
          <paths>
            <path
              refId="Package\DFT_LoadSourceCodesPPass.Paths[OLE DB Source Output]"
              endId="Package\DFT_LoadSourceCodesPPass\OLE DB Destination.Inputs[OLE DB Destination Input]"
              name="OLE DB Source Output"
              startId="Package\DFT_LoadSourceCodesPPass\OLE DB Source.Outputs[OLE DB Source Output]" />
          </paths>
        </pipeline>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\DFT_LoadSourceCodesPPass 1"
      DTS:CreationName="Microsoft.Pipeline"
      DTS:DelayValidation="True"
      DTS:Description="Data Flow Task"
      DTS:DTSID="{cacf0849-39ee-495d-8c0b-a3e4e08e14d1}"
      DTS:ExecutableType="Microsoft.Pipeline"
      DTS:LocaleID="-1"
      DTS:ObjectName="DFT_LoadSourceCodesPPass 1"
      DTS:TaskContact="Performs high-performance data extraction, transformation and loading;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1">
      <DTS:Variables />
      <DTS:ObjectData>
        <pipeline
          version="1">
          <components>
            <component
              refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination"
              componentClassID="Microsoft.OLEDBDestination"
              contactInfo="OLE DB Destination;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;4"
              description="OLE DB Destination"
              name="OLE DB Destination"
              usesDispositions="true"
              version="4">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset">[dbo].[##VisitBySourceSourceCodes]</property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor">Select * from ##VisitBySourceSourceCodes</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">2</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the values supplied for identity columns will be copied to the destination. If false, values for identity columns will be auto-generated at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepIdentity">false</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the columns containing null will have null inserted in the destination. If false, columns containing null will have their default values inserted at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepNulls">false</property>
                <property
                  dataType="System.String"
                  description="Specifies options to be used with fast load.  Applies only if fast load is turned on."
                  name="FastLoadOptions">TABLOCK,CHECK_CONSTRAINTS</property>
                <property
                  dataType="System.Int32"
                  description="Specifies when commits are issued during data insertion.  A value of 0 specifies that one commit will be issued at the end of data insertion.  Applies only if fast load is turned on."
                  name="FastLoadMaxInsertCommitSize">2147483647</property>
              </properties>
              <connections>
                <connection
                  refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Connections[OleDbConnection]"
                  connectionManagerID="Package.ConnectionManagers[OpsBilling]"
                  connectionManagerRefId="Package.ConnectionManagers[OpsBilling]"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <inputs>
                <input
                  refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input]"
                  errorOrTruncationOperation="Insert"
                  errorRowDisposition="FailComponent"
                  hasSideEffects="true"
                  name="OLE DB Destination Input">
                  <inputColumns>
                    <inputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client ID/SourceCode]"
                      cachedDataType="wstr"
                      cachedLength="255"
                      cachedName="Client ID/SourceCode"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client ID/SourceCode]"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client ID/SourceCode]" />
                    <inputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client Name]"
                      cachedDataType="wstr"
                      cachedLength="255"
                      cachedName="Client Name"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client Name]"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Name]" />
                    <inputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Program]"
                      cachedDataType="wstr"
                      cachedLength="45"
                      cachedName="Program"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Program]"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Program]" />
                    <inputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Issuer Clean Name]"
                      cachedDataType="wstr"
                      cachedLength="255"
                      cachedName="Issuer Clean Name"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Issuer Clean Name]"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Issuer Clean Name]" />
                    <inputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Program Type]"
                      cachedDataType="wstr"
                      cachedLength="45"
                      cachedName="Program Type"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Program Type]"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Program Type]" />
                  </inputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client Name]"
                      dataType="wstr"
                      length="255"
                      name="Client Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client ID/SourceCode]"
                      dataType="wstr"
                      length="255"
                      name="Client ID/SourceCode" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Program]"
                      dataType="wstr"
                      length="45"
                      name="Program" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Issuer Clean Name]"
                      dataType="wstr"
                      length="255"
                      name="Issuer Clean Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Program Type]"
                      dataType="wstr"
                      length="45"
                      name="Program Type" />
                  </externalMetadataColumns>
                </input>
              </inputs>
              <outputs>
                <output
                  refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Outputs[OLE DB Destination Error Output]"
                  exclusionGroup="1"
                  isErrorOut="true"
                  name="OLE DB Destination Error Output"
                  synchronousInputId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
            <component
              refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source"
              componentClassID="Microsoft.OLEDBSource"
              contactInfo="OLE DB Source;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;7"
              description="OLE DB Source"
              name="OLE DB Source"
              usesDispositions="true"
              version="7">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset"></property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor">select distinct [Client Name], [Client ID/SourceCode],Program,[Issuer Clean Name],[Program Type] from cms.dbo.tbl_bi_deals 
where [Client Name]='Diners' and Network='Diners' and Program='Priority Pass' and [Program Type]='Wholesale Digital' 
and [AOPC Enabled]='Yes' and Status='Active'</property>
                <property
                  dataType="System.String"
                  description="The variable that contains the SQL command to be executed."
                  name="SqlCommandVariable"></property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">2</property>
                <property
                  dataType="System.String"
                  description="The mappings between the parameters in the SQL command and variables."
                  name="ParameterMapping"></property>
              </properties>
              <connections>
                <connection
                  refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Connections[OleDbConnection]"
                  connectionManagerID="Package.ConnectionManagers[OpsBilling]"
                  connectionManagerRefId="Package.ConnectionManagers[OpsBilling]"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <outputs>
                <output
                  refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output]"
                  name="OLE DB Source Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client ID/SourceCode]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client ID/SourceCode]"
                      length="255"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client ID/SourceCode]"
                      name="Client ID/SourceCode"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Name]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Name]"
                      length="255"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Client Name]"
                      name="Client Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Program]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Program]"
                      length="45"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Program]"
                      name="Program"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Issuer Clean Name]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Issuer Clean Name]"
                      length="255"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Issuer Clean Name]"
                      name="Issuer Clean Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Program Type]"
                      dataType="wstr"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Program Type]"
                      length="45"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].Columns[Program Type]"
                      name="Program Type"
                      truncationRowDisposition="FailComponent" />
                  </outputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client ID/SourceCode]"
                      dataType="wstr"
                      length="255"
                      name="Client ID/SourceCode" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Client Name]"
                      dataType="wstr"
                      length="255"
                      name="Client Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Program]"
                      dataType="wstr"
                      length="45"
                      name="Program" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Issuer Clean Name]"
                      dataType="wstr"
                      length="255"
                      name="Issuer Clean Name" />
                    <externalMetadataColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output].ExternalColumns[Program Type]"
                      dataType="wstr"
                      length="45"
                      name="Program Type" />
                  </externalMetadataColumns>
                </output>
                <output
                  refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output]"
                  isErrorOut="true"
                  name="OLE DB Source Error Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Name]"
                      dataType="wstr"
                      length="255"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client Name]"
                      name="Client Name" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client ID/SourceCode]"
                      dataType="wstr"
                      length="255"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Client ID/SourceCode]"
                      name="Client ID/SourceCode" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Program]"
                      dataType="wstr"
                      length="45"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Program]"
                      name="Program" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Issuer Clean Name]"
                      dataType="wstr"
                      length="255"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Issuer Clean Name]"
                      name="Issuer Clean Name" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Program Type]"
                      dataType="wstr"
                      length="45"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[Program Type]"
                      name="Program Type" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
          </components>
          <paths>
            <path
              refId="Package\DFT_LoadSourceCodesPPass 1.Paths[OLE DB Source Output]"
              endId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination.Inputs[OLE DB Destination Input]"
              name="OLE DB Source Output"
              startId="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source.Outputs[OLE DB Source Output]" />
          </paths>
        </pipeline>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\EST_CreateTableinTempdbPPass"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:DelayValidation="True"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{eac28792-6a94-4628-8ff5-db4b1a589496}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="EST_CreateTableinTempdbPPass"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{969074CA-2F8D-44CD-A60D-D3DA277424DB}"
          SQLTask:SqlStatementSource="IF OBJECT_ID(N'tempdb..##VisitBySourceSourceCodes') IS NOT NULL&#xA;BEGIN&#xA;DROP TABLE ##VisitBySourceSourceCodes&#xA;END&#xA;GO&#xA;CREATE TABLE ##VisitBySourceSourceCodes(SourceCode NVARCHAR(255))" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\EST_CreateTableinTempdbPPass 1"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:DelayValidation="True"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{dfbdaa60-bc4d-484d-8a61-1c85bbc7fba8}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="EST_CreateTableinTempdbPPass 1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{C5DE9366-DD67-40CC-B134-950655E0938F}"
          SQLTask:SqlStatementSource="IF OBJECT_ID(N'tempdb..##VisitBySourceSourceCodes') IS NOT NULL&#xA;BEGIN&#xA;DROP TABLE ##VisitBySourceSourceCodes&#xA;END&#xA;GO&#xA;CREATE TABLE ##VisitBySourceSourceCodes([Client Name] NVARCHAR(255),[Client ID/SourceCode] NVARCHAR(255),Program NVARCHAR(45),[Issuer Clean Name] NVARCHAR(255)&#xA;,[Program Type] NVARCHAR(45))" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\EST_DeleteVisitData"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{e9bb03ac-2279-4415-82e5-9574dbeb07ca}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="EST_DeleteVisitData"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{C5DE9366-DD67-40CC-B134-950655E0938F}"
          SQLTask:BypassPrepare="False"
          SQLTask:SqlStatementSource="TRUNCATE TABLE rprt.VisitBySourceDinersPPAutomation" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\SQL Get the data from Ppass"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:DelayValidation="True"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{9017592e-8cf4-42b4-a985-60da78ab2cb8}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="SQL Get the data from Ppass"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{969074CA-2F8D-44CD-A60D-D3DA277424DB}"
          SQLTask:SqlStmtSourceType="Variable"
          SQLTask:SqlStatementSource="User::strQuery" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint]"
      DTS:CreationName=""
      DTS:DTSID="{69c7c896-9db0-4c94-83db-a3780e3c436a}"
      DTS:From="Package\DFT_LoadSourceCodesPPass 1"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint"
      DTS:To="Package\EST_DeleteVisitData" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 1]"
      DTS:CreationName=""
      DTS:DTSID="{51315cc2-9d0d-417b-bb0f-cc36b496f1b9}"
      DTS:From="Package\SQL Get the data from Ppass"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 1"
      DTS:To="Package\DFT_LoadData 1" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 2]"
      DTS:CreationName=""
      DTS:DTSID="{fd75d3d6-1834-449a-a35d-ff495151b4a6}"
      DTS:From="Package\EST_DeleteVisitData"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 2"
      DTS:To="Package\EST_CreateTableinTempdbPPass" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 3]"
      DTS:CreationName=""
      DTS:DTSID="{0f817f73-3e89-4ff3-82e2-ac484663fa53}"
      DTS:From="Package\EST_CreateTableinTempdbPPass 1"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 3"
      DTS:To="Package\DFT_LoadSourceCodesPPass 1" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 3 1]"
      DTS:CreationName=""
      DTS:DTSID="{7d824553-5957-4066-b1de-49cccd8110d5}"
      DTS:From="Package\EST_CreateTableinTempdbPPass"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 3 1"
      DTS:To="Package\DFT_LoadSourceCodesPPass" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 4]"
      DTS:CreationName=""
      DTS:DTSID="{7569de89-10f5-45ce-807d-e6f914481dfc}"
      DTS:From="Package\DFT_LoadSourceCodesPPass"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 4"
      DTS:To="Package\SQL Get the data from Ppass" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 5]"
      DTS:CreationName=""
      DTS:DTSID="{6BFD8915-1C54-4CF5-B268-5509D3DFAB01}"
      DTS:From="Package\DFT_LoadData 1"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 5"
      DTS:To="Package\DFT_GenerateExcelFile 1" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="16" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="196,42"
          Id="Package\DFT_GenerateExcelFile 1"
          TopLeft="68,584" />
        <NodeLayout
          Size="158,42"
          Id="Package\DFT_LoadData 1"
          TopLeft="88,510" />
        <NodeLayout
          Size="214,42"
          Id="Package\DFT_LoadSourceCodesPPass"
          TopLeft="60,360" />
        <NodeLayout
          Size="214,42"
          Id="Package\DFT_LoadSourceCodesPPass 1"
          TopLeft="63,130" />
        <NodeLayout
          Size="206,42"
          Id="Package\EST_CreateTableinTempdbPPass"
          TopLeft="68,278" />
        <NodeLayout
          Size="242,42"
          Id="Package\EST_CreateTableinTempdbPPass 1"
          TopLeft="50,57" />
        <NodeLayout
          Size="175,42"
          Id="Package\EST_DeleteVisitData"
          TopLeft="84,202" />
        <NodeLayout
          Size="215,42"
          Id="Package\SQL Get the data from Ppass"
          TopLeft="64,436" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint]"
          TopLeft="170.75,172">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,30"
              Start="0,0"
              End="0,22.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,22.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 1]"
          TopLeft="169.25,478">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,32"
              Start="0,0"
              End="0,24.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,24.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 2]"
          TopLeft="171.25,244">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,34"
              Start="0,0"
              End="0,26.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,26.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 3]"
          TopLeft="170.5,99">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,31"
              Start="0,0"
              End="0,23.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,23.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 3 1]"
          TopLeft="169,320">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,40"
              Start="0,0"
              End="0,32.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,32.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 4]"
          TopLeft="169.25,402">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,34"
              Start="0,0"
              End="0,26.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,26.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 5]"
          TopLeft="166.5,552">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,32"
              Start="0,0"
              End="0,24.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,24.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
  <TaskHost
    design-time-name="Package\DFT_GenerateExcelFile 1">
    <LayoutInfo>
      <GraphLayout
        Capacity="8" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="159,42"
          Id="Package\DFT_GenerateExcelFile 1\Excel Destination"
          TopLeft="335,240" />
        <NodeLayout
          Size="156,42"
          Id="Package\DFT_GenerateExcelFile 1\Data Conversion"
          TopLeft="332,151" />
        <NodeLayout
          Size="150,42"
          Id="Package\DFT_GenerateExcelFile 1\OLE DB Source"
          TopLeft="335,55" />
        <EdgeLayout
          Id="Package\DFT_GenerateExcelFile 1.Paths[OLE DB Source Output]"
          TopLeft="410,97">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,54"
              Start="0,0"
              End="0,46.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,46.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\DFT_GenerateExcelFile 1.Paths[Data Conversion Output]"
          TopLeft="412.25,193">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,47"
              Start="0,0"
              End="0,39.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,39.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </TaskHost>
  <PipelineComponentMetadata
    design-time-name="Package\DFT_GenerateExcelFile 1\Excel Destination">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
      <Property>
        <Name>TableInfoObjectType</Name>
        <Value
          type="q2:string">Table</Value>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <PipelineComponentMetadata
    design-time-name="Package\DFT_GenerateExcelFile 1\OLE DB Source">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <TaskHost
    design-time-name="Package\DFT_LoadData 1">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="171,42"
          Id="Package\DFT_LoadData 1\OLE DB Destination"
          TopLeft="342,151" />
        <NodeLayout
          Size="150,42"
          Id="Package\DFT_LoadData 1\OLE DB Source"
          TopLeft="350,56" />
        <EdgeLayout
          Id="Package\DFT_LoadData 1.Paths[OLE DB Source Output]"
          TopLeft="426.25,98">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,53"
              Start="0,0"
              End="0,45.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,45.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </TaskHost>
  <PipelineComponentMetadata
    design-time-name="Package\DFT_LoadData 1\OLE DB Destination">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
      <Property>
        <Name>TableInfoObjectType</Name>
        <Value
          type="q2:string">Table</Value>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <PipelineComponentMetadata
    design-time-name="Package\DFT_LoadData 1\OLE DB Source">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <TaskHost
    design-time-name="Package\DFT_LoadSourceCodesPPass">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgm="clr-namespace:Microsoft.SqlServer.Graph.Model;assembly=Microsoft.SqlServer.Graph">
        <NodeLayout
          Size="171,42"
          Id="Package\DFT_LoadSourceCodesPPass\OLE DB Destination"
          TopLeft="288,159" />
        <NodeLayout
          Size="150,42"
          Id="Package\DFT_LoadSourceCodesPPass\OLE DB Source"
          TopLeft="289,70" />
        <EdgeLayout
          Id="Package\DFT_LoadSourceCodesPPass.Paths[OLE DB Source Output]"
          TopLeft="364,112">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="9.5,47"
              Start="0,0"
              End="9.5,39.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,19.5" />
                  <mssgle:CubicBezierSegment
                    Point1="0,19.5"
                    Point2="0,23.5"
                    Point3="4,23.5" />
                  <mssgle:LineSegment
                    End="5.5,23.5" />
                  <mssgle:CubicBezierSegment
                    Point1="5.5,23.5"
                    Point2="9.5,23.5"
                    Point3="9.5,27.5" />
                  <mssgle:LineSegment
                    End="9.5,39.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0,0,0,0"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </TaskHost>
  <PipelineComponentMetadata
    design-time-name="Package\DFT_LoadSourceCodesPPass\OLE DB Destination">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <PipelineComponentMetadata
    design-time-name="Package\DFT_LoadSourceCodesPPass\OLE DB Source">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <TaskHost
    design-time-name="Package\DFT_LoadSourceCodesPPass 1">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="171,42"
          Id="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination"
          TopLeft="288,159" />
        <NodeLayout
          Size="150,42"
          Id="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source"
          TopLeft="288,70" />
        <EdgeLayout
          Id="Package\DFT_LoadSourceCodesPPass 1.Paths[OLE DB Source Output]"
          TopLeft="363,112">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="10.5,47"
              Start="0,0"
              End="10.5,39.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,19.5" />
                  <mssgle:CubicBezierSegment
                    Point1="0,19.5"
                    Point2="0,23.5"
                    Point3="4,23.5" />
                  <mssgle:LineSegment
                    End="6.5,23.5" />
                  <mssgle:CubicBezierSegment
                    Point1="6.5,23.5"
                    Point2="10.5,23.5"
                    Point3="10.5,27.5" />
                  <mssgle:LineSegment
                    End="10.5,39.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </TaskHost>
  <PipelineComponentMetadata
    design-time-name="Package\DFT_LoadSourceCodesPPass 1\OLE DB Destination">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <PipelineComponentMetadata
    design-time-name="Package\DFT_LoadSourceCodesPPass 1\OLE DB Source">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>