<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="9/4/2017 12:09:08 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="TCG02603"
  DTS:CreatorName="TCG\vijay.pattar"
  DTS:DelayValidation="True"
  DTS:DTSID="{FBDBE732-C8F0-454F-A2EC-0A5DD8A5E658}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:ISOLevel="4096"
  DTS:LastModifiedProductVersion="15.0.2000.170"
  DTS:LocaleID="2057"
  DTS:ObjectName="Visa VCES src2dst_Visits"
  DTS:PackageType="5"
  DTS:VersionBuild="327"
  DTS:VersionGUID="{C8464CC3-16F3-40D6-A7FC-2D4D081FD522}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[global_ods]"
      DTS:CreationName="OLEDB"
      DTS:DTSID="{B9272401-4009-4276-B1A7-9C56A89EA4DA}"
      DTS:ObjectName="global_ods">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectRetryCount="1"
          DTS:ConnectRetryInterval="5"
          DTS:ConnectionString="Data Source=DI-REPORTING;Initial Catalog=global_ods;Provider=SQLNCLI11.1;Integrated Security=SSPI;Auto Translate=False;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:PackageParameters>
    <DTS:PackageParameter
      DTS:CreationName=""
      DTS:DataType="3"
      DTS:DTSID="{828C6A96-FC5C-41EE-A42E-4231FEF7DB97}"
      DTS:ObjectName="int_DataloadWorkFlowID">
      <DTS:Property
        DTS:DataType="3"
        DTS:Name="ParameterValue">0</DTS:Property>
    </DTS:PackageParameter>
    <DTS:PackageParameter
      DTS:CreationName=""
      DTS:DataType="8"
      DTS:DTSID="{B209BE30-BEEB-4096-8425-770C3EC41FD7}"
      DTS:ObjectName="strSourcodes">
      <DTS:Property
        DTS:DataType="8"
        DTS:Name="ParameterValue">'LKVSSPCEGRLS18','LKVSARBPLTSAU21'</DTS:Property>
    </DTS:PackageParameter>
  </DTS:PackageParameters>
  <DTS:Variables>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{58F4EF83-5D01-4471-9162-3B64E2C0A5CD}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="UPPER( @[$Project::strUseReportMonth])   == &quot;Y&quot; ?   (DT_DATE)(DT_DBDATE)DATEADD(&quot;D&quot;,-(DAY(DATEADD(&quot;M&quot;,1,@[$Project::dtReportMonth]))),DATEADD(&quot;M&quot;,1,@[$Project::dtReportMonth])): (DT_DATE)(DT_DBDATE)DATEADD(&quot;D&quot;,-(DAY(DATEADD(&quot;M&quot;,1,Dateadd(&quot;M&quot;,-1 ,getdate())))),DATEADD(&quot;M&quot;,1,Dateadd(&quot;M&quot;,-1 ,getdate())))"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="dtEndDate">
      <DTS:VariableValue
        DTS:DataType="7">7/31/2022</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{27B73296-C58A-49D6-87CB-6FA571FA0E9D}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="UPPER( @[$Project::strUseReportMonth])   == &quot;Y&quot; ?   (DT_DATE)(DT_DBDATE)Dateadd(&quot;D&quot;,-1*Day( @[$Project::dtReportMonth] ) +1,    @[$Project::dtReportMonth]): (DT_DATE)(DT_DBDATE) Dateadd(&quot;D&quot;,-1*Day(Dateadd(&quot;M&quot;,-1 ,getdate())) +1  ,Dateadd(&quot;M&quot;,-1 ,getdate()))"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="dtReportMonth">
      <DTS:VariableValue
        DTS:DataType="7">7/1/2022</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{470EFB73-D826-4438-912E-4014F8C4ECFF}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="UPPER( @[$Project::strUseReportMonth])   == &quot;Y&quot; ?   (DT_DATE)(DT_DBDATE)Dateadd(&quot;D&quot;,-1*Day( @[$Project::dtReportMonth] ) +1,    @[$Project::dtReportMonth]): (DT_DATE)(DT_DBDATE) Dateadd(&quot;D&quot;,-1*Day(Dateadd(&quot;M&quot;,-1 ,getdate())) +1  ,Dateadd(&quot;M&quot;,-1 ,getdate()))"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="dtStartDate">
      <DTS:VariableValue
        DTS:DataType="7">7/1/2022</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{51397312-736B-424C-99E9-824844320B52}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="@[$Package::int_DataloadWorkFlowID]"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="intApplicationDataloadWorkflowID">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{E898C6D9-E8B1-461B-996A-3FB2D54A23E3}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="intDataLoadID">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{01E1B83B-5FE6-45AC-BAA6-C141C67539CB}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="intDebug">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{231B98D9-AF74-452E-A786-ABF2187F5A88}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="intRecInsertedCount">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{AF746A7A-78A2-4919-B4D7-C50A9E4A340C}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="intRecUpdatedCount">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{DCA743A2-BA86-4D1F-B45E-E159F0E2E5B2}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="intRecWithIssueCount">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{DB44ECBC-C047-4DD3-8A86-5B58CC06F2A5}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="intSourceRecCount">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{1C63DF89-5278-4988-8AC5-7B7EEDFD0F88}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="int_DataloadWorkFlowID">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{0380BF4D-8F4F-4BE0-8392-F97401637E63}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="returnvalue">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{313900DE-DE1D-4D29-A330-8441C5B96872}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="return_value">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{B39402C7-87B7-4482-A204-4DBE0D412D66}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="rsWorkflowStep_Configuration">
      <DTS:VariableValue
        DTS:DataSubType="ManagedSerializable"
        DTS:DataType="13">
        <SOAP-ENV:Envelope xmlns:clr="http://schemas.microsoft.com/soap/encoding/clr/1.0" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
          <SOAP-ENV:Body>
            <xsd:anyType
              id="ref-1"></xsd:anyType>
          </SOAP-ENV:Body>
        </SOAP-ENV:Envelope>
      </DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{61F76F44-73D9-403E-BFCB-5CC9B5F4163E}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strArchiveFileNameFormat">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{B79B7121-FBBA-409F-B3C2-F9E1BFF36943}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="@[System::PackageName] + &quot; Fails to execute.&#xA;&#xA;Please, check Package and run again &#xA;&#xA;From  BI_DEV_TEAM&quot;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strBody">
      <DTS:VariableValue
        DTS:DataType="8">Visa VCES src2dst_Visits Fails to execute.

Please, check Package and run again 

From  BI_DEV_TEAM</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{3BFF7264-8182-4A6F-B8D1-22677496DEE4}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strClientName">
      <DTS:VariableValue
        DTS:DataType="8">Profitability Automation - PPDB To BI02</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{28795253-2C25-440F-9588-B1C5DED7DA3A}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strConnection">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{0C04D444-9F43-4D9B-8E19-483942B676C2}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strCorruptFolder">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{B51ED772-E930-48C7-BF83-F5537EA20AF1}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strDestinationFolder">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{D41C21A9-8A56-4548-BA67-814E51F5784A}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strFileName_Format_Export">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{58B6AA46-FF73-4980-8CE5-45B89AB6557F}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strFileName_Format_Import">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{664411CC-FCBE-4994-BF94-C01A5F172D2A}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="@[$Project::FromEmail]  &#xA;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strFromEmail">
      <DTS:VariableValue
        DTS:DataType="8">Harshad.Deshmukh@collinsongroup.com</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{CBDE7EA1-C252-41CF-BEEC-EB59D2BB7CFC}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strProcessUnknownFile">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{DCBD4ABC-06EF-41BB-B929-CCD141F7F1F1}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="&quot;IF OBJECT_ID('tempdb..#temptable') IS NOT NULL&#xA;&#x9;DROP TABLE #temptable&#xA;&#xA;CREATE TABLE #temptable (&#xA;&#x9;&#x9;source_code &#x9;&#x9;varchar(20),&#xA;&#x9;&#x9;consumer_no &#x9;&#x9;INT NOT NULL,&#xA;&#x9;&#x9;external_identifier BIGINT NULL,&#xA;&#x9;&#x9;membership_no &#x9;&#x9;BIGINT NULL,&#xA;&#x9;&#x9;purchase_no &#x9;&#x9;INT NOT NULL,&#xA;&#x9;&#x9;track_seq &#x9;&#x9;&#x9;INT NOT NULL,&#xA;&#x9;&#x9;title &#x9;&#x9;&#x9;&#x9;varchar(20),&#xA;&#x9;&#x9;forename &#x9;&#x9;&#x9;varchar(50),&#xA;&#x9;&#x9;surname &#x9;&#x9;&#x9;varchar(50),&#xA;&#x9;&#x9;fullname &#x9;&#x9;&#x9;varchar(120),&#xA;&#x9;&#x9;source_desc &#x9;&#x9;varchar(255),&#xA;&#x9;&#x9;product_version &#x9;varchar(20),&#xA;&#x9;&#x9;paid_to_date &#x9;&#x9;date,&#xA;&#x9;&#x9;subs_issue_date &#x9;date,&#xA;&#x9;&#x9;subs_status &#x9;&#x9;varchar(5),&#xA;&#x9;&#x9;track_start &#x9;&#x9;date,&#xA;&#x9;&#x9;track_guests &#x9;&#x9;INT,&#xA;&#x9;&#x9;track_from &#x9;&#x9;&#x9;varchar(20),&#xA;&#x9;&#x9;track_value &#x9;&#x9;FLOAT,&#xA;&#x9;&#x9;creation_date &#x9;&#x9;date,&#xA;&#x9;&#x9;lounge_name&#x9;&#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;airport &#x9;&#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;trans_ccard_number &#x9;varchar(100),&#xA;&#x9;&#x9;trans_ccard_expiry date,&#xA;&#x9;&#x9;external_ref &#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;track_batch &#x9;&#x9;INT,&#xA;&#x9;&#x9;old_system_ref &#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;campaign_code &#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;lounge_code&#x9;&#x9;&#x9;varchar(20),&#xA;&#x9;&#x9;city &#x9;&#x9;&#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;country &#x9;&#x9;&#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;vendor_tracking_code &#x9;varchar(100),&#xA;&#x9;&#x9;user_invitation_code &#x9;varchar(100),&#xA;&#x9;&#x9;remaining_mem_cli_count int,&#xA;&#x9;&#x9;remaining_mem_cli2_count int,&#xA;&#x9;&#x9;remaining_mem_pp_count &#x9;int,&#xA;&#x9;&#x9;remaining_gue_cli_count int,&#xA;&#x9;&#x9;remaining_gue_cli2_count int,&#xA;&#x9;&#x9;remaining_gue_pp_count &#x9;int,&#xA;&#x9;&#x9;remaining_mgu_cli_count int,&#xA;&#x9;&#x9;remaining_mgu_cli2_count int,&#xA;&#x9;&#x9;remaining_mgu_pp_count &#x9;int,&#xA;&#x9;&#x9;remaining_mgu_comp_count int,&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;experience_category &#x9;varchar(100),&#xA;&#x9;&#x9;experience_type &#x9;&#x9;varchar(100),&#xA;&#x9;&#x9;airport_terminal_name  varchar(100),&#xA;&#x9;&#x9;airport_terminal_type  varchar(100),&#xA;&#x9;&#x9;visit_type_id SMALLINT,&#xA;&#x9;&#x9;visit_type&#x9;INT,&#xA;&#x9;&#x9;ccard_type VARCHAR(100),&#xA;&#x9;&#x9;effective_date DATETIME2,&#xA;&#x9;&#x9;report_month date&#xA;&#xA;);&#xA;&#xA;&#xA;INSERT INTO #temptable(&#x9;&#xA;&#x9;source_code,&#xA;&#x9;consumer_no,&#xA;&#x9;external_identifier,&#xA;&#x9;membership_no,&#xA;&#x9;purchase_no,&#xA;&#x9;track_seq,&#xA;&#x9;title,&#xA;&#x9;forename,&#xA;&#x9;surname,&#xA;&#x9;fullname,&#xA;&#x9;source_desc,&#xA;&#x9;product_version,&#xA;&#x9;paid_to_date,&#xA;&#x9;subs_issue_date,&#xA;&#x9;subs_status,&#xA;&#x9;track_start,&#xA;&#x9;track_guests,&#xA;&#x9;track_from,&#xA;&#x9;track_value,&#xA;&#x9;creation_date,&#xA;&#x9;lounge_name,&#xA;&#x9;airport,&#xA;&#x9;trans_ccard_number,&#xA;    trans_ccard_expiry,&#xA;&#x9;external_ref,&#xA;&#x9;track_batch,&#xA;&#x9;old_system_ref,&#xA;&#x9;campaign_code,&#xA;&#x9;lounge_code,&#xA;&#x9;city,&#xA;&#x9;country,&#xA;&#x9;vendor_tracking_code,&#xA;&#x9;user_invitation_code,&#xA;&#x9;remaining_mem_cli_count,&#xA;&#x9;remaining_mem_cli2_count,&#xA;&#x9;remaining_mem_pp_count,&#xA;&#x9;remaining_gue_cli_count,&#xA;&#x9;remaining_gue_cli2_count,&#xA;&#x9;remaining_gue_pp_count,&#xA;&#x9;remaining_mgu_cli_count,&#xA;&#x9;remaining_mgu_cli2_count,&#xA;&#x9;remaining_mgu_pp_count,&#xA;&#x9;remaining_mgu_comp_count,&#xA;&#x9;&#xA;&#x9;experience_category,&#xA;&#x9;experience_type,&#xA;&#x9;airport_terminal_name,&#xA;&#x9;airport_terminal_type,&#xA;&#x9;visit_type_id,&#xA;&#x9;ccard_type, &#xA;&#x9;effective_date,&#xA;&#x9;report_month&#xA;&#xA;&#x9; )&#xA;SELECT&#x9;s.source_code,&#xA;&#x9;&#x9;c.consumer_no,&#xA;&#x9;&#x9;c.external_identifier,&#xA;&#x9;&#x9;c.membership_no,&#xA;&#x9;&#x9;p.purchase_no,&#xA;&#x9;&#x9;t.track_seq,&#xA;&#x9;&#x9;c.title,&#xA;&#x9;&#x9;c.forename,&#xA;&#x9;&#x9;c.surname,&#xA;&#x9;&#x9;LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(c.forename + ' ' + c.surname,' ',' |'),'| ',''),'|',''))) AS fullname,&#xA;&#x9;&#x9;s.source_desc,&#xA;&#x9;&#x9;p.product_version,&#xA;&#x9;&#x9;p.paid_to_date,&#xA;&#x9;&#x9;p.subs_issue_date,&#xA;&#x9;&#x9;p.subs_status,&#xA;&#x9;&#x9;t.track_start,&#xA;&#x9;&#x9;t.track_guests,&#xA;&#x9;&#x9;t.track_from,&#xA;&#x9;&#x9;t.track_value,&#xA;&#x9;&#x9;t.creation_date,&#xA;&#x9;&#x9;l.lounge_name,&#xA;&#x9;&#x9;a.pp_short_name AS airport,&#xA;&#x9;&#x9;p.trans_ccard_number,&#xA;&#x9;&#x9;p.trans_ccard_expiry,&#xA;&#x9;&#x9;t.external_ref,&#xA;&#x9;&#x9;t.track_batch,&#xA;&#x9;&#x9;p.old_system_ref,&#xA;&#x9;&#x9;s.campaign_code,&#xA;&#x9;&#x9;l.lounge_code,&#xA;&#x9;&#x9;a.airport_city AS city,&#xA;&#x9;&#x9;cou.code_desc AS country,&#xA;&#x9;&#x9;siv.vendor_tracking_code,&#xA;&#x9;&#x9;siv.user_invitation_code,&#xA;&#x9;&#x9;0 AS remaining_mem_cli_count,&#xA;&#x9;&#x9;0 AS remaining_mem_cli2_count,&#xA; &#x9;&#x9;0 AS remaining_mem_pp_count,&#xA; &#x9;&#x9;0 AS remaining_gue_cli_count,&#xA; &#x9;&#x9;0 AS remaining_gue_cli2_count,&#xA; &#x9;&#x9;0 AS remaining_gue_pp_count,&#xA; &#x9;&#x9;0 AS remaining_mgu_cli_count,&#xA; &#x9;&#x9;0 AS remaining_mgu_cli2_count,&#xA; &#x9;&#x9;0 AS remaining_mgu_pp_count,&#xA; &#x9;&#x9;0 AS remaining_mgu_comp_count,&#xA; &#x9;&#x9;&#xA;&#x9;&#x9;'Lounge' as experience_category,&#xA;&#x9;&#x9;'Lounge' as experience_type,&#xA;&#x9;&#x9;ate.terminal_name as airport_terminal_name,&#xA;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;WHEN l.lounge_type = 'I' THEN 'I'&#xA;&#x9;&#x9;&#x9;WHEN l.lounge_type = 'D' THEN 'D'&#xA;&#x9;&#x9;&#x9;ELSE 'U'&#xA;&#x9;&#x9;  END&#x9;as airport_terminal_type,&#xA;&#x9;&#x9;t.visit_type_id,&#xA;&#x9;&#x9;p.ccard_type,&#xA;&#x9;&#x9;p.effective_date,&#xA;&#x9;&#x9;CAST(DATEADD(MONTH, DATEDIFF(MONTH, 0, t.[creation_date]), 0) AS DATE)      AS &#x9;report_month&#xA;&#xA;--INTO #temptable&#xA;FROM&#xA;&#x9;&#x9;source_deal_config AS sdc WITH (NOLOCK)&#xA;&#x9;&#x9;INNER JOIN source AS s WITH (NOLOCK) ON sdc.source_code = s.source_code&#xA;&#x9;&#x9;INNER JOIN source_subscription AS ss WITH (NOLOCK) ON sdc.source_deal_config_id = ss.source_deal_config_id&#xA;&#x9;&#x9;INNER JOIN purchase_subscription_link AS psl WITH (NOLOCK) ON ss.source_subscription_id = psl.source_subscription_id&#xA;&#x9;&#x9;INNER JOIN purchase AS p WITH (NOLOCK) ON psl.purchase_no = p.purchase_no&#xA;&#x9;&#x9;INNER JOIN consumer AS c WITH (NOLOCK) ON p.consumer_no = c.consumer_no&#xA;&#x9;&#x9;INNER JOIN tracking AS t WITH (NOLOCK) ON p.purchase_no = t.purchase_no&#xA;&#x9;&#x9;INNER JOIN lounge AS l WITH (NOLOCK) ON l.lounge_code = t.track_from&#xA;&#x9;&#x9;INNER JOIN airport AS a WITH (NOLOCK) ON a.iso_airport_code = l.airport&#xA;&#x9;&#x9;LEFT OUTER JOIN airport_terminal AS ate WITH (NOLOCK) ON l.airport_terminal_id = ate.airport_terminal_id&#xA;&#x9;&#x9;LEFT OUTER JOIN code AS COU  WITH (NOLOCK) ON COU.code = l.country_code AND COU.codetype = 'CTRY'&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;LEFT OUTER JOIN source_invitation_validation siv WITH (NOLOCK) ON siv.consumer_no = c.consumer_no&#xA;&#x9;WHERE&#xA;t.creation_date &gt;= &quot;+&quot;'&quot;+(DT_WSTR, 4) year( @[User::dtStartDate]) +  right(&quot;00&quot; + (DT_WSTR, 2) month( @[User::dtStartDate] ),2)  + &#xA;&#x9;right(&quot;00&quot; + (DT_WSTR, 2) day( @[User::dtStartDate] ),2) +&quot;'&quot;+ &quot; AND t.creation_date &lt; DATEADD(d,1,'&quot; &#xA;+ (DT_WSTR, 4) year( @[User::dtEndDate]) +  right(&quot;00&quot; + (DT_WSTR, 2) month( @[User::dtEndDate] ),2)&#xA;+ right(&quot;00&quot; + (DT_WSTR, 2) day( @[User::dtEndDate] ),2)+&quot;'&quot;+&quot;)&quot;+&quot;&#xA; AND t.track_status &lt;&gt; 'NA' &#xA;AND p.isDeleted = 0 AND s.source_code in (&quot; +  @[$Package::strSourcodes]    + &quot;)&quot;&#xA;&#xA;+ &quot;&#xA;/* Load in the reedemed offers data */&#xA;&#xA;INSERT INTO #temptable (&#x9;&#xA;&#x9;source_code,&#xA;&#x9;consumer_no,&#xA;&#x9;external_identifier,&#xA;&#x9;membership_no,&#xA;&#x9;purchase_no,&#xA;&#x9;track_seq,&#xA;&#x9;title,&#xA;&#x9;forename,&#xA;&#x9;surname,&#xA;&#x9;fullname,&#xA;&#x9;source_desc,&#xA;&#x9;product_version,&#xA;&#x9;paid_to_date,&#xA;&#x9;subs_issue_date,&#xA;&#x9;subs_status,&#xA;&#x9;track_start,&#xA;&#x9;track_guests,&#xA;&#x9;track_from,&#xA;&#x9;track_value,&#xA;&#x9;creation_date,&#xA;&#x9;lounge_name,&#xA;&#x9;airport,&#xA;&#x9;trans_ccard_number,&#xA;&#x9;trans_ccard_expiry,&#xA;&#x9;external_ref,&#xA;&#x9;track_batch,&#xA;&#x9;old_system_ref,&#xA;&#x9;campaign_code,&#xA;&#x9;lounge_code,&#xA;&#x9;city,&#xA;&#x9;country,&#xA;&#x9;vendor_tracking_code,&#xA;&#x9;user_invitation_code,&#xA;&#x9;remaining_mem_cli_count,&#xA;&#x9;remaining_mem_cli2_count,&#xA;&#x9;remaining_mem_pp_count,&#xA;&#x9;remaining_gue_cli_count,&#xA;&#x9;remaining_gue_cli2_count,&#xA;&#x9;remaining_gue_pp_count,&#xA;&#x9;remaining_mgu_cli_count,&#xA;&#x9;remaining_mgu_cli2_count,&#xA;&#x9;remaining_mgu_pp_count,&#xA;&#x9;remaining_mgu_comp_count,&#xA;&#x9;experience_category,&#xA;&#x9;experience_type,&#xA;&#x9;airport_terminal_name,&#xA;&#x9;airport_terminal_type,&#xA;&#x9;visit_type_id,&#xA;&#x9;report_month&#xA;&#xA;&#x9; )&#xA;SELECT&#xA;&#x9;s.source_code,&#xA;&#x9;c.consumer_no,&#xA;&#x9;c.external_identifier,&#xA;&#x9;c.membership_no,&#xA;&#x9;p.purchase_no,&#xA;&#x9;t.track_seq,&#xA;&#x9;c.title,&#xA;&#x9;c.forename,&#xA;&#x9;c.surname,&#xA;&#x9;LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(c.forename + ' ' + c.surname,' ',' |'),'| ',''),'|',''))) AS fullname,&#xA;&#x9;s.source_desc,&#xA;&#x9;p.product_version,&#xA;&#x9;p.paid_to_date,&#xA;&#x9;p.subs_issue_date,&#xA;&#x9;p.subs_status,&#xA;&#x9;t.track_start,&#xA;&#x9;t.track_guests,&#xA;&#x9;t.track_from,&#xA;&#x9;t.track_value,&#xA;&#x9;t.creation_date,&#xA;&#x9;ord.outlet_name as lounge_name,&#xA;&#x9;a.pp_short_name AS airport,&#xA;&#x9;p.trans_ccard_number,&#xA;&#x9;p.trans_ccard_expiry,&#xA;&#x9;t.external_ref,&#xA;&#x9;t.track_batch,&#xA;&#x9;p.old_system_ref,&#xA;&#x9;s.campaign_code,&#xA;&#x9;t.track_from as lounge_code,&#xA;&#x9;a.airport_city AS city,&#xA;&#x9;cou.code_desc AS country,&#xA;&#x9;siv.vendor_tracking_code,&#xA;&#x9;siv.user_invitation_code,&#xA;&#x9;0 AS remaining_mem_cli_count , &#xA;&#x9;0 AS remaining_mem_cli2_count , &#xA;&#x9;0 AS remaining_mem_pp_count , &#xA;&#x9;0 AS remaining_gue_cli_count , &#xA;&#x9;0 AS remaining_gue_cli2_count , &#xA;&#x9;0 AS remaining_gue_pp_count , &#xA;&#x9;0 AS remaining_mgu_cli_count , &#xA;&#x9;0 AS remaining_mgu_cli2_count , &#xA;&#x9;0 AS remaining_mgu_pp_count , &#xA;&#x9;0 AS remaining_mgu_comp_count,&#xA;&#x9;&#xA;&#x9;ord.offer_category as experience_category,&#xA;&#x9;&#x9;ord.offer_type as experience_type,&#xA;&#x9;ISNULL(ate.terminal_name, 'Unknown' ) as airport_terminal_name,&#xA;&#x9;'U' as airport_terminal_type,&#xA;&#x9;t.visit_type_id,&#xA;&#x9;CAST(DATEADD(MONTH, DATEDIFF(MONTH, 0, t.[creation_date]), 0) AS DATE)      AS &#x9;report_month&#xA;FROM&#xA;&#x9;source_deal_config AS sdc WITH (NOLOCK)&#xA;&#x9;INNER JOIN source AS s WITH (NOLOCK) ON sdc.source_code = s.source_code&#xA;&#x9;INNER JOIN source_subscription AS ss WITH (NOLOCK) ON sdc.source_deal_config_id = ss.source_deal_config_id&#xA;&#x9;INNER JOIN purchase_subscription_link AS psl WITH (NOLOCK) ON ss.source_subscription_id = psl.source_subscription_id&#xA;&#x9;INNER JOIN purchase AS p WITH (NOLOCK) ON psl.purchase_no = p.purchase_no&#xA;&#x9;INNER JOIN consumer AS c WITH (NOLOCK) ON p.consumer_no = c.consumer_no&#xA;&#x9;INNER JOIN tracking AS t WITH (NOLOCK) ON p.purchase_no = t.purchase_no&#xA;&#x9;INNER JOIN offer_redemption_details AS ord WITH (NOLOCK) ON ord.consumer_no = c.consumer_no AND ord.track_seq = t.track_seq&#xA;&#x9;INNER JOIN airport AS a WITH (NOLOCK) ON a.iso_airport_code = ord.airport_iso_code&#xA;&#x9;LEFT JOIN outlet_airport_terminal AS oat WITH (NOLOCK) ON ord.outlet_id = oat.outlet_id&#xA;&#x9;LEFT JOIN airport_terminal AS ate WITH (NOLOCK) ON oat.airport_terminal_id = ate.airport_terminal_id&#xA;&#x9;LEFT OUTER JOIN code AS COU WITH (NOLOCK) ON cou.alpha_1 = a.iso_country_code&#xA;&#x9;&#x9;AND cou.codetype = 'CTRY2'&#xA;&#x9;&#x9;AND cou.alpha_5 &lt;&gt; ''&#xA;&#x9;LEFT OUTER JOIN source_invitation_validation siv WITH (NOLOCK) ON siv.consumer_no = c.consumer_no&#xA;&#x9;&#xA;WHERE&#xA;t.creation_date &gt;= &quot;+&quot;'&quot;+(DT_WSTR, 4) year( @[User::dtStartDate]) +  right(&quot;00&quot; + (DT_WSTR, 2) month( @[User::dtStartDate] ),2)  + &#xA;&#x9;right(&quot;00&quot; + (DT_WSTR, 2) day( @[User::dtStartDate] ),2) +&quot;'&quot;+ &quot; AND t.creation_date &lt; DATEADD(d,1,'&quot; &#xA;+ (DT_WSTR, 4) year( @[User::dtEndDate]) +  right(&quot;00&quot; + (DT_WSTR, 2) month( @[User::dtEndDate] ),2)&#xA;+ right(&quot;00&quot; + (DT_WSTR, 2) day( @[User::dtEndDate] ),2)+&quot;'&quot;+&quot;)&quot;+&quot;&#xA; AND t.track_status &lt;&gt; 'NA' &#xA;AND p.isDeleted = 0 AND s.source_code in (&quot; +  @[$Package::strSourcodes]    + &quot;)&quot;&#xA;+ &quot;&#xA;/* update the temp table with an index */&#xA;ALTER TABLE #temptable &#xA;ADD CONSTRAINT PK_#temptable2 &#xA;PRIMARY KEY NONCLUSTERED (purchase_no, track_seq)&#xA;&#x9;&#x9;&#x9;CREATE NONCLUSTERED INDEX #temptable_idx1 ON #temptable (source_code, consumer_no, fullname, track_start, lounge_name, external_ref) &#xA;&#x9;&#x9;&#x9;WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 100) ON [PRIMARY]&#xA;&#xA;&#xA;&#xA;&#x9;&#x9;/*  MEM PPAYVISIT  */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;           &#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no;&#xA;&#xA;&#x9;/* MEM CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable #temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no;&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;/* MEM CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* GUE PPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* GUE CPAYLIST */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* GUE CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/*MGU PPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;/* MGU CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* MGU CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDMEM PPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDMEM CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;/* SHAREDMEM CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 8&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDGUE PPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDGUE CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#xA;/* SHAREDGUE CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 9&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;/* SHAREDMGU PPAYVISIT */&#xA;&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;/* SHAREDMGU CPAYVISIT */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;/*SHAREDMGU CPAYVISIT2 */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 10&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;/*OFFERMEM PPAYVISIT */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMEMCPAYLIST */&#xA;&#x9;&#x9;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMEMCPAYLIST2 */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 6&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERGUEPPAYLIST */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERGUECPAYLIST */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERGUECPAYLIST2 */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMGUPPAYLIST */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 21&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_PP_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMGUCPAYLIST */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 22&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;/* OFFERMGUCPAYLIST2 */&#xA;;WITH used_visit_allocations AS (&#xA;            &#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;COUNT(1) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase_visit_allocation_his AS pvah2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EXISTS (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;#temptable temp2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp2.purchase_no = pval2.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pvah2.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva2.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND salg.guest_source_visit_allocation_id is NULL&#xA;&#x9;&#x9;&#x9;&#x9;GROUP BY&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pvah2.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;derived_visit_allocation AS (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_from,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_count_to,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pva.visit_validity_type_id,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN pva.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(pva.visit_count_to - pva.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE (pva.visit_count_to - pva.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS allocated_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;purchase pur&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.charge_owner_id = 25&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visitor_type_id = 7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.visit_allocation_type_id NOT IN (3,4)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND pur.isDeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id&#xA;               &#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;pva.valid_from &lt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND pva.valid_to &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR pva.visit_validity_type_id = 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;calculated_visit_allocation AS&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_to = 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN 9999&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN derived_visit_allocation.visit_count_from = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END AS visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.used_visit_count AS used_visit_number,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;derived_visit_allocation.purchase_no&#xA;&#x9;&#x9;&#x9;&#x9;FROM derived_visit_allocation&#xA;&#x9;&#x9;&#x9;)&#xA;&#xA;&#x9;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;&#x9;remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no&#xA;&#x9;&#x9;;WITH derived_credit_data AS (&#xA;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;ISNULL(SUM(CASE WHEN vch.purchase_visit_allocation_his_id IS NULL THEN 1 ELSE 0 END),0) AS unused_visit,&#xA;&#x9;&#x9;&#x9;&#x9;ISNULL(SUM(CASE WHEN vch.purchase_visit_allocation_his_id IS NOT NULL THEN 1 ELSE 0 END),0) AS used_visit,&#xA;&#x9;&#x9;&#x9;&#x9;pval.purchase_no&#xA;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;visit_credit_his AS vch&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN visit_credit AS vc ON vch.visit_credit_id = vc.visit_credit_id&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN visit_credit_purchase_allocation AS vcpa ON vch.visit_credit_his_id = vcpa.visit_credit_his_id&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation AS pva ON vcpa.purchase_visit_allocation_id = pva.purchase_visit_allocation_id&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_grp AS pvag ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;&#x9;INNER JOIN purchase_visit_allocation_link AS pval ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id&#xA;&#x9;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;&#x9;vch.isdeleted = 0&#xA;&#x9;&#x9;&#x9;&#x9;AND vch.expiry_date &gt;= getdate()&#xA;&#x9;&#x9;&#x9;&#x9;AND vc.visit_credit_type_id = 1&#xA;&#x9;&#x9;&#x9;&#x9;AND vc.visitor_type_id = 3&#xA;&#x9;&#x9;&#x9;GROUP BY pval.purchase_no&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;UPDATE&#xA;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;SET&#xA;&#x9;&#x9;&#x9;REMAINING_MGU_COMP_COUNT = derived_credit_data.unused_visit&#xA;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;#temptable&#xA;&#x9;&#x9;&#x9;INNER JOIN derived_credit_data ON #temptable.purchase_no = derived_credit_data.purchase_no&#xA;&#x9;&#x9;&#xA;IF OBJECT_ID('tempdb..#temptblvces_vists') IS NOT NULL&#xA;&#x9;DROP TABLE #temptblvces_vists&#xA;&#xA;&#xA;/* Get the data to return */&#xA;&#xA;&#x9;SELECT DISTINCT&#xA;       source_code,&#xA;       consumer_no,&#xA;       external_identifier,&#xA;       membership_no,&#xA;       temp.purchase_no,&#xA;       temp.track_seq,&#xA;       title,&#xA;       forename,&#xA;       surname,&#xA;       fullname,&#xA;       source_desc,&#xA;       product_version,&#xA;       paid_to_date,&#xA;       subs_issue_date,&#xA;       subs_status,&#xA;       track_start,&#xA;       track_guests,&#xA;       track_from,&#xA;       track_value,&#xA;       creation_date,&#xA;       lounge_name,&#xA;       airport,&#xA;       trans_ccard_number,&#xA;&#x9;   trans_ccard_expiry,&#xA;       external_ref,&#xA;       track_batch,&#xA;       old_system_ref,&#xA;       campaign_code,&#xA;       lounge_code,&#xA;       city,&#xA;       country,&#xA;       vendor_tracking_code,&#xA;       user_invitation_code,&#xA;       remaining_mem_cli_count,&#xA;       remaining_mem_cli2_count,&#xA;       remaining_mem_pp_count,&#xA;       remaining_gue_cli_count,&#xA;       remaining_gue_cli2_count,&#xA;       remaining_gue_pp_count,&#xA;       remaining_mgu_cli_count,&#xA;       remaining_mgu_cli2_count,&#xA;       remaining_mgu_pp_count,&#xA;       remaining_mgu_comp_count,&#xA;       experience_category,&#xA;       experience_type,&#xA;       airport_terminal_name,&#xA;       airport_terminal_type,&#xA;       visit_type_id,&#xA;       visit_type,&#xA;       ccard_type,&#xA;       effective_date,&#xA;       [populated],&#xA;       [count_mem_cli],&#xA;       [count_mem_pp],&#xA;       [count_mem_comp],&#xA;       [count_mem_mem],&#xA;       [count_mem_lou],&#xA;       [count_gue_cli],&#xA;       [count_gue_pp],&#xA;       [count_gue_comp],&#xA;       [count_gue_mem],&#xA;       [count_gue_lou],&#xA;       [fee_mem_cli_curr],&#xA;       [fee_mem_cli],&#xA;       [fee_mem_pp_curr],&#xA;       [fee_mem_pp],&#xA;       [fee_mem_mem_curr],&#xA;       [fee_mem_mem],&#xA;       [fee_gue_cli_curr],&#xA;       [fee_gue_cli],&#xA;       [fee_gue_pp_curr],&#xA;       [fee_gue_pp],&#xA;       [fee_gue_mem_curr],&#xA;       [fee_gue_mem],&#xA;       [count_mem_cli2],&#xA;       [count_gue_cli2],&#xA;       [fee_mem_cli2_curr],&#xA;       [fee_mem_cli2],&#xA;       [fee_gue_cli2_curr],&#xA;       [fee_gue_cli2],&#xA;&#x9;   report_month&#xA;&#x9;   INTO #temptblvces_vists&#xA; FROM&#xA;&#x9;#temptable AS temp&#xA;&#x9;INNER JOIN purchase_visit_summary_data AS pvsd WITH (NOLOCK) ON temp.purchase_no = pvsd.purchase_no AND temp.track_seq = pvsd.track_seq&#xA;ORDER BY&#xA;&#x9;temp.source_code,&#xA;&#x9;temp.consumer_no,&#xA;&#x9;temp.fullname,&#xA;&#x9;temp.track_seq,&#xA;&#x9;temp.track_start,&#xA;&#x9;temp.lounge_name,&#xA;&#x9;temp.external_ref &#xA;&#x9;ASC&#xA;&#x9;&quot;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strQuery">
      <DTS:VariableValue
        DTS:DataType="8">IF OBJECT_ID('tempdb..#temptable') IS NOT NULL
	DROP TABLE #temptable

CREATE TABLE #temptable (
		source_code 		varchar(20),
		consumer_no 		INT NOT NULL,
		external_identifier BIGINT NULL,
		membership_no 		BIGINT NULL,
		purchase_no 		INT NOT NULL,
		track_seq 			INT NOT NULL,
		title 				varchar(20),
		forename 			varchar(50),
		surname 			varchar(50),
		fullname 			varchar(120),
		source_desc 		varchar(255),
		product_version 	varchar(20),
		paid_to_date 		date,
		subs_issue_date 	date,
		subs_status 		varchar(5),
		track_start 		date,
		track_guests 		INT,
		track_from 			varchar(20),
		track_value 		FLOAT,
		creation_date 		date,
		lounge_name			varchar(100),
		airport 			varchar(100),
		trans_ccard_number 	varchar(100),
		trans_ccard_expiry date,
		external_ref 		varchar(100),
		track_batch 		INT,
		old_system_ref 		varchar(100),
		campaign_code 		varchar(100),
		lounge_code			varchar(20),
		city 				varchar(100),
		country 				varchar(100),
		vendor_tracking_code 	varchar(100),
		user_invitation_code 	varchar(100),
		remaining_mem_cli_count int,
		remaining_mem_cli2_count int,
		remaining_mem_pp_count 	int,
		remaining_gue_cli_count int,
		remaining_gue_cli2_count int,
		remaining_gue_pp_count 	int,
		remaining_mgu_cli_count int,
		remaining_mgu_cli2_count int,
		remaining_mgu_pp_count 	int,
		remaining_mgu_comp_count int,
		
		experience_category 	varchar(100),
		experience_type 		varchar(100),
		airport_terminal_name  varchar(100),
		airport_terminal_type  varchar(100),
		visit_type_id SMALLINT,
		visit_type	INT,
		ccard_type VARCHAR(100),
		effective_date DATETIME2,
		report_month date

);


INSERT INTO #temptable(	
	source_code,
	consumer_no,
	external_identifier,
	membership_no,
	purchase_no,
	track_seq,
	title,
	forename,
	surname,
	fullname,
	source_desc,
	product_version,
	paid_to_date,
	subs_issue_date,
	subs_status,
	track_start,
	track_guests,
	track_from,
	track_value,
	creation_date,
	lounge_name,
	airport,
	trans_ccard_number,
    trans_ccard_expiry,
	external_ref,
	track_batch,
	old_system_ref,
	campaign_code,
	lounge_code,
	city,
	country,
	vendor_tracking_code,
	user_invitation_code,
	remaining_mem_cli_count,
	remaining_mem_cli2_count,
	remaining_mem_pp_count,
	remaining_gue_cli_count,
	remaining_gue_cli2_count,
	remaining_gue_pp_count,
	remaining_mgu_cli_count,
	remaining_mgu_cli2_count,
	remaining_mgu_pp_count,
	remaining_mgu_comp_count,
	
	experience_category,
	experience_type,
	airport_terminal_name,
	airport_terminal_type,
	visit_type_id,
	ccard_type, 
	effective_date,
	report_month

	 )
SELECT	s.source_code,
		c.consumer_no,
		c.external_identifier,
		c.membership_no,
		p.purchase_no,
		t.track_seq,
		c.title,
		c.forename,
		c.surname,
		LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(c.forename + ' ' + c.surname,' ',' |'),'| ',''),'|',''))) AS fullname,
		s.source_desc,
		p.product_version,
		p.paid_to_date,
		p.subs_issue_date,
		p.subs_status,
		t.track_start,
		t.track_guests,
		t.track_from,
		t.track_value,
		t.creation_date,
		l.lounge_name,
		a.pp_short_name AS airport,
		p.trans_ccard_number,
		p.trans_ccard_expiry,
		t.external_ref,
		t.track_batch,
		p.old_system_ref,
		s.campaign_code,
		l.lounge_code,
		a.airport_city AS city,
		cou.code_desc AS country,
		siv.vendor_tracking_code,
		siv.user_invitation_code,
		0 AS remaining_mem_cli_count,
		0 AS remaining_mem_cli2_count,
 		0 AS remaining_mem_pp_count,
 		0 AS remaining_gue_cli_count,
 		0 AS remaining_gue_cli2_count,
 		0 AS remaining_gue_pp_count,
 		0 AS remaining_mgu_cli_count,
 		0 AS remaining_mgu_cli2_count,
 		0 AS remaining_mgu_pp_count,
 		0 AS remaining_mgu_comp_count,
 		
		'Lounge' as experience_category,
		'Lounge' as experience_type,
		ate.terminal_name as airport_terminal_name,
		CASE
			WHEN l.lounge_type = 'I' THEN 'I'
			WHEN l.lounge_type = 'D' THEN 'D'
			ELSE 'U'
		  END	as airport_terminal_type,
		t.visit_type_id,
		p.ccard_type,
		p.effective_date,
		CAST(DATEADD(MONTH, DATEDIFF(MONTH, 0, t.[creation_date]), 0) AS DATE)      AS 	report_month

--INTO #temptable
FROM
		source_deal_config AS sdc WITH (NOLOCK)
		INNER JOIN source AS s WITH (NOLOCK) ON sdc.source_code = s.source_code
		INNER JOIN source_subscription AS ss WITH (NOLOCK) ON sdc.source_deal_config_id = ss.source_deal_config_id
		INNER JOIN purchase_subscription_link AS psl WITH (NOLOCK) ON ss.source_subscription_id = psl.source_subscription_id
		INNER JOIN purchase AS p WITH (NOLOCK) ON psl.purchase_no = p.purchase_no
		INNER JOIN consumer AS c WITH (NOLOCK) ON p.consumer_no = c.consumer_no
		INNER JOIN tracking AS t WITH (NOLOCK) ON p.purchase_no = t.purchase_no
		INNER JOIN lounge AS l WITH (NOLOCK) ON l.lounge_code = t.track_from
		INNER JOIN airport AS a WITH (NOLOCK) ON a.iso_airport_code = l.airport
		LEFT OUTER JOIN airport_terminal AS ate WITH (NOLOCK) ON l.airport_terminal_id = ate.airport_terminal_id
		LEFT OUTER JOIN code AS COU  WITH (NOLOCK) ON COU.code = l.country_code AND COU.codetype = 'CTRY'
		
		LEFT OUTER JOIN source_invitation_validation siv WITH (NOLOCK) ON siv.consumer_no = c.consumer_no
	WHERE
t.creation_date &gt;= '20220701' AND t.creation_date &lt; DATEADD(d,1,'20220731')
 AND t.track_status &lt;&gt; 'NA' 
AND p.isDeleted = 0 AND s.source_code in ('LKVSSPCEGRLS18','LKVSARBPLTSAU21')
/* Load in the reedemed offers data */

INSERT INTO #temptable (	
	source_code,
	consumer_no,
	external_identifier,
	membership_no,
	purchase_no,
	track_seq,
	title,
	forename,
	surname,
	fullname,
	source_desc,
	product_version,
	paid_to_date,
	subs_issue_date,
	subs_status,
	track_start,
	track_guests,
	track_from,
	track_value,
	creation_date,
	lounge_name,
	airport,
	trans_ccard_number,
	trans_ccard_expiry,
	external_ref,
	track_batch,
	old_system_ref,
	campaign_code,
	lounge_code,
	city,
	country,
	vendor_tracking_code,
	user_invitation_code,
	remaining_mem_cli_count,
	remaining_mem_cli2_count,
	remaining_mem_pp_count,
	remaining_gue_cli_count,
	remaining_gue_cli2_count,
	remaining_gue_pp_count,
	remaining_mgu_cli_count,
	remaining_mgu_cli2_count,
	remaining_mgu_pp_count,
	remaining_mgu_comp_count,
	experience_category,
	experience_type,
	airport_terminal_name,
	airport_terminal_type,
	visit_type_id,
	report_month

	 )
SELECT
	s.source_code,
	c.consumer_no,
	c.external_identifier,
	c.membership_no,
	p.purchase_no,
	t.track_seq,
	c.title,
	c.forename,
	c.surname,
	LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(c.forename + ' ' + c.surname,' ',' |'),'| ',''),'|',''))) AS fullname,
	s.source_desc,
	p.product_version,
	p.paid_to_date,
	p.subs_issue_date,
	p.subs_status,
	t.track_start,
	t.track_guests,
	t.track_from,
	t.track_value,
	t.creation_date,
	ord.outlet_name as lounge_name,
	a.pp_short_name AS airport,
	p.trans_ccard_number,
	p.trans_ccard_expiry,
	t.external_ref,
	t.track_batch,
	p.old_system_ref,
	s.campaign_code,
	t.track_from as lounge_code,
	a.airport_city AS city,
	cou.code_desc AS country,
	siv.vendor_tracking_code,
	siv.user_invitation_code,
	0 AS remaining_mem_cli_count , 
	0 AS remaining_mem_cli2_count , 
	0 AS remaining_mem_pp_count , 
	0 AS remaining_gue_cli_count , 
	0 AS remaining_gue_cli2_count , 
	0 AS remaining_gue_pp_count , 
	0 AS remaining_mgu_cli_count , 
	0 AS remaining_mgu_cli2_count , 
	0 AS remaining_mgu_pp_count , 
	0 AS remaining_mgu_comp_count,
	
	ord.offer_category as experience_category,
		ord.offer_type as experience_type,
	ISNULL(ate.terminal_name, 'Unknown' ) as airport_terminal_name,
	'U' as airport_terminal_type,
	t.visit_type_id,
	CAST(DATEADD(MONTH, DATEDIFF(MONTH, 0, t.[creation_date]), 0) AS DATE)      AS 	report_month
FROM
	source_deal_config AS sdc WITH (NOLOCK)
	INNER JOIN source AS s WITH (NOLOCK) ON sdc.source_code = s.source_code
	INNER JOIN source_subscription AS ss WITH (NOLOCK) ON sdc.source_deal_config_id = ss.source_deal_config_id
	INNER JOIN purchase_subscription_link AS psl WITH (NOLOCK) ON ss.source_subscription_id = psl.source_subscription_id
	INNER JOIN purchase AS p WITH (NOLOCK) ON psl.purchase_no = p.purchase_no
	INNER JOIN consumer AS c WITH (NOLOCK) ON p.consumer_no = c.consumer_no
	INNER JOIN tracking AS t WITH (NOLOCK) ON p.purchase_no = t.purchase_no
	INNER JOIN offer_redemption_details AS ord WITH (NOLOCK) ON ord.consumer_no = c.consumer_no AND ord.track_seq = t.track_seq
	INNER JOIN airport AS a WITH (NOLOCK) ON a.iso_airport_code = ord.airport_iso_code
	LEFT JOIN outlet_airport_terminal AS oat WITH (NOLOCK) ON ord.outlet_id = oat.outlet_id
	LEFT JOIN airport_terminal AS ate WITH (NOLOCK) ON oat.airport_terminal_id = ate.airport_terminal_id
	LEFT OUTER JOIN code AS COU WITH (NOLOCK) ON cou.alpha_1 = a.iso_country_code
		AND cou.codetype = 'CTRY2'
		AND cou.alpha_5 &lt;&gt; ''
	LEFT OUTER JOIN source_invitation_validation siv WITH (NOLOCK) ON siv.consumer_no = c.consumer_no
	
WHERE
t.creation_date &gt;= '20220701' AND t.creation_date &lt; DATEADD(d,1,'20220731')
 AND t.track_status &lt;&gt; 'NA' 
AND p.isDeleted = 0 AND s.source_code in ('LKVSSPCEGRLS18','LKVSARBPLTSAU21')
/* update the temp table with an index */
ALTER TABLE #temptable 
ADD CONSTRAINT PK_#temptable2 
PRIMARY KEY NONCLUSTERED (purchase_no, track_seq)
			CREATE NONCLUSTERED INDEX #temptable_idx1 ON #temptable (source_code, consumer_no, fullname, track_start, lounge_name, external_ref) 
			WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 100) ON [PRIMARY]



		/*  MEM PPAYVISIT  */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 1
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
           
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 1
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_PP_count = calculated_visit_allocation.visit_number
				
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no;

	/* MEM CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 1
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 1
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable #temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no;

				/* MEM CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 1
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 1
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number
				
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* GUE PPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 2
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 2
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_PP_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* GUE CPAYLIST */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 2
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 2
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* GUE CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 2
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 2
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/*MGU PPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 3
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 3
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_PP_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
/* MGU CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 3
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 3
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* MGU CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 3
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 3
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDMEM PPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 8
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 8
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_PP_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDMEM CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 8
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 8
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
/* SHAREDMEM CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 8
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 8
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDGUE PPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 9
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 9
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_PP_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDGUE CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 9
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 9
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no

/* SHAREDGUE CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 9
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 9
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
/* SHAREDMGU PPAYVISIT */

		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 10
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 10
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_PP_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
				/* SHAREDMGU CPAYVISIT */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 10
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 10
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
				/*SHAREDMGU CPAYVISIT2 */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 10
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 10
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
/*OFFERMEM PPAYVISIT */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 6
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 6
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_PP_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMEMCPAYLIST */
		;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 6
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 6
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMEMCPAYLIST2 */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 6
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 6
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MEM_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERGUEPPAYLIST */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 5
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 5
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_PP_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERGUECPAYLIST */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 5
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 5
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERGUECPAYLIST2 */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 5
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 5
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_GUE_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMGUPPAYLIST */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 7
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 21
					AND pva.visitor_type_id = 7
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_PP_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMGUCPAYLIST */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 7
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 22
					AND pva.visitor_type_id = 7
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_CLI_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		/* OFFERMGUCPAYLIST2 */
;WITH used_visit_allocations AS (
            	SELECT
					COUNT(1) AS used_visit_count,
					pvah2.purchase_visit_allocation_id
				FROM
					purchase_visit_allocation_his AS pvah2
					INNER JOIN purchase_visit_allocation pva2 ON pvah2.purchase_visit_allocation_id = pva2.purchase_visit_allocation_id
					INNER JOIN purchase_visit_allocation_link pval2 ON pva2.purchase_visit_allocation_grp_id = pval2.purchase_visit_allocation_grp_id
					LEFT OUTER JOIN source_visit_allocation_mem_gue_link salg ON pva2.source_visit_allocation_id = salg.guest_source_visit_allocation_id
				WHERE
						EXISTS (
							SELECT
								1
							FROM
								#temptable temp2
							WHERE
								temp2.purchase_no = pval2.purchase_no
						)
					AND pvah2.isdeleted = 0
					AND pva2.visitor_type_id = 7
					AND salg.guest_source_visit_allocation_id is NULL
				GROUP BY
					pvah2.purchase_visit_allocation_id
			),
			derived_visit_allocation AS (
				SELECT
					pva.visit_count_from,
					pva.visit_count_to,
					pva.visit_validity_type_id,
					CASE
						WHEN pva.visit_count_to = 9999
							THEN 9999
						WHEN pva.visit_count_from = 0
							THEN	(pva.visit_count_to - pva.visit_count_from)
						ELSE (pva.visit_count_to - pva.visit_count_from) + 1
					END AS allocated_visit_count,
					ISNULL(used_visit_allocations.used_visit_count, 0) AS used_visit_count,
					pur.purchase_no
				FROM
					purchase pur
					INNER JOIN purchase_visit_allocation_link pval ON pval.purchase_no = pur.purchase_no
					INNER JOIN purchase_visit_allocation_grp pvag ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
					INNER JOIN purchase_visit_allocation pva ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
					AND pva.charge_owner_id = 25
					AND pva.visitor_type_id = 7
					AND pva.visit_allocation_type_id NOT IN (3,4)
					AND pur.isDeleted = 0
					LEFT JOIN used_visit_allocations ON pva.purchase_visit_allocation_id = used_visit_allocations.purchase_visit_allocation_id
               	WHERE
						(
							(	pva.valid_from &lt;= getdate()
								AND pva.valid_to &gt;= getdate()
							)
							OR pva.visit_validity_type_id = 2
						)
			),
			calculated_visit_allocation AS
			(
				SELECT
					CASE WHEN derived_visit_allocation.visit_count_to = 9999 THEN
						9999
					ELSE
						CASE WHEN derived_visit_allocation.visit_validity_type_id = 2 THEN
							CASE
								WHEN derived_visit_allocation.visit_count_to = 9999
									THEN 9999
								WHEN derived_visit_allocation.visit_count_from = 0
									THEN	(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from)
								ELSE
									(derived_visit_allocation.visit_count_to - derived_visit_allocation.visit_count_from) + 1
							END
						ELSE
							(derived_visit_allocation.allocated_visit_count - derived_visit_allocation.used_visit_count)
						END
					END AS visit_number,
					derived_visit_allocation.used_visit_count AS used_visit_number,
					derived_visit_allocation.purchase_no
				FROM derived_visit_allocation
			)

			UPDATE
				#temptable
			SET
				remaining_MGU_CLI2_count = calculated_visit_allocation.visit_number
			FROM
				#temptable
				INNER JOIN calculated_visit_allocation ON #temptable.purchase_no = calculated_visit_allocation.purchase_no
		;WITH derived_credit_data AS (
			SELECT
				ISNULL(SUM(CASE WHEN vch.purchase_visit_allocation_his_id IS NULL THEN 1 ELSE 0 END),0) AS unused_visit,
				ISNULL(SUM(CASE WHEN vch.purchase_visit_allocation_his_id IS NOT NULL THEN 1 ELSE 0 END),0) AS used_visit,
				pval.purchase_no
			FROM
				visit_credit_his AS vch
				INNER JOIN visit_credit AS vc ON vch.visit_credit_id = vc.visit_credit_id
				INNER JOIN visit_credit_purchase_allocation AS vcpa ON vch.visit_credit_his_id = vcpa.visit_credit_his_id
				INNER JOIN purchase_visit_allocation AS pva ON vcpa.purchase_visit_allocation_id = pva.purchase_visit_allocation_id
				INNER JOIN purchase_visit_allocation_grp AS pvag ON pva.purchase_visit_allocation_grp_id = pvag.purchase_visit_allocation_grp_id
				INNER JOIN purchase_visit_allocation_link AS pval ON pvag.purchase_visit_allocation_grp_id = pval.purchase_visit_allocation_grp_id
			WHERE
				vch.isdeleted = 0
				AND vch.expiry_date &gt;= getdate()
				AND vc.visit_credit_type_id = 1
				AND vc.visitor_type_id = 3
			GROUP BY pval.purchase_no
		)
		UPDATE
			#temptable
		SET
			REMAINING_MGU_COMP_COUNT = derived_credit_data.unused_visit
		FROM
			#temptable
			INNER JOIN derived_credit_data ON #temptable.purchase_no = derived_credit_data.purchase_no
		
IF OBJECT_ID('tempdb..#temptblvces_vists') IS NOT NULL
	DROP TABLE #temptblvces_vists


/* Get the data to return */

	SELECT DISTINCT
       source_code,
       consumer_no,
       external_identifier,
       membership_no,
       temp.purchase_no,
       temp.track_seq,
       title,
       forename,
       surname,
       fullname,
       source_desc,
       product_version,
       paid_to_date,
       subs_issue_date,
       subs_status,
       track_start,
       track_guests,
       track_from,
       track_value,
       creation_date,
       lounge_name,
       airport,
       trans_ccard_number,
	   trans_ccard_expiry,
       external_ref,
       track_batch,
       old_system_ref,
       campaign_code,
       lounge_code,
       city,
       country,
       vendor_tracking_code,
       user_invitation_code,
       remaining_mem_cli_count,
       remaining_mem_cli2_count,
       remaining_mem_pp_count,
       remaining_gue_cli_count,
       remaining_gue_cli2_count,
       remaining_gue_pp_count,
       remaining_mgu_cli_count,
       remaining_mgu_cli2_count,
       remaining_mgu_pp_count,
       remaining_mgu_comp_count,
       experience_category,
       experience_type,
       airport_terminal_name,
       airport_terminal_type,
       visit_type_id,
       visit_type,
       ccard_type,
       effective_date,
       [populated],
       [count_mem_cli],
       [count_mem_pp],
       [count_mem_comp],
       [count_mem_mem],
       [count_mem_lou],
       [count_gue_cli],
       [count_gue_pp],
       [count_gue_comp],
       [count_gue_mem],
       [count_gue_lou],
       [fee_mem_cli_curr],
       [fee_mem_cli],
       [fee_mem_pp_curr],
       [fee_mem_pp],
       [fee_mem_mem_curr],
       [fee_mem_mem],
       [fee_gue_cli_curr],
       [fee_gue_cli],
       [fee_gue_pp_curr],
       [fee_gue_pp],
       [fee_gue_mem_curr],
       [fee_gue_mem],
       [count_mem_cli2],
       [count_gue_cli2],
       [fee_mem_cli2_curr],
       [fee_mem_cli2],
       [fee_gue_cli2_curr],
       [fee_gue_cli2],
	   report_month
	   INTO #temptblvces_vists
 FROM
	#temptable AS temp
	INNER JOIN purchase_visit_summary_data AS pvsd WITH (NOLOCK) ON temp.purchase_no = pvsd.purchase_no AND temp.track_seq = pvsd.track_seq
ORDER BY
	temp.source_code,
	temp.consumer_no,
	temp.fullname,
	temp.track_seq,
	temp.track_start,
	temp.lounge_name,
	temp.external_ref 
	ASC
	</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{A1D2DF00-294B-4B7F-B918-3A4383C37F6C}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="&quot;delete from [staging].[tbl_ppbo_visits] where [source code] in (&quot; + @[$Package::strSourcodes] + &quot;) and report_month = &quot;+&quot;'&quot;+(DT_WSTR, 4) year( @[User::dtReportMonth]) +  right(&quot;00&quot; + (DT_WSTR, 2) month( @[User::dtReportMonth] ),2)  + &#xA;&#x9;right(&quot;00&quot; + (DT_WSTR, 2) day( @[User::dtReportMonth] ),2) +&quot;'&quot;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strQuery_del">
      <DTS:VariableValue
        DTS:DataType="8">delete from [staging].[tbl_ppbo_visits] where [source code] in ('LKVSSPCEGRLS18','LKVSARBPLTSAU21') and report_month = '20220701'</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{71FDF112-A549-4E03-940A-2E88EE1EA305}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="REPLACE((DT_WSTR, 10)(DT_DBDATE)@[User::dtReportMonth],&quot;-&quot;,&quot;&quot;)"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strReportMonthKey">
      <DTS:VariableValue
        DTS:DataType="8">20220701</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{D268376E-3713-4FD0-90C3-24E4A9479063}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strSourceFolder">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{E2B5D372-0303-4D32-9E77-6E0F77484A70}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strStoredProcedureName">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{8070AC4A-31B6-4E8C-A388-C43F9300BC82}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="@[System::PackageName] + &quot; Fails to execute.Please check Package and run again&quot;"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strSubject">
      <DTS:VariableValue
        DTS:DataType="8">Visa VCES src2dst_Visits Fails to execute.Please check Package and run again</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{622B8C51-5748-46A7-9654-7EC9274ADD5F}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="@[$Project::ToEmail]"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strToEmail">
      <DTS:VariableValue
        DTS:DataType="8">Harshad.Deshmukh@collinsongroup.com</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{16F05222-2F1D-4054-83CE-888C358FDEAF}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="strUnknownFolder">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Flag Data Load Complete"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{62E3E70E-F9D4-4033-8552-328F531CD6D7}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Flag Data Load Complete"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="1">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{F9F29697-3D73-49BD-B676-2F37DE7B05DC}"
          SQLTask:SqlStatementSource="EXECUTE [audit_log].[usp_updDataloadWorkflowStepStatus] ?, ?, ?, ?, 'Complete'" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="1"
            SQLTask:DtsVariableName="User::intRecInsertedCount"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="2"
            SQLTask:DtsVariableName="User::intRecUpdatedCount"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="3"
            SQLTask:DtsVariableName="User::intRecWithIssueCount"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="$Package::int_DataloadWorkFlowID"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Flag Data Load Failed"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{AC0AE703-0B41-469B-8978-2B6BA20D40E9}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Flag Data Load Failed"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{F9F29697-3D73-49BD-B676-2F37DE7B05DC}"
          SQLTask:SqlStatementSource="EXECUTE [audit_log].[usp_updDataloadWorkflowStepStatus] ?, Null, Null, Null, 'Failed'" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="$Package::int_DataloadWorkFlowID"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Flag Dataload as Start"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{6A3E18C4-09BE-4C99-A733-A83B76E719B1}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Flag Dataload as Start"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{F9F29697-3D73-49BD-B676-2F37DE7B05DC}"
          SQLTask:SqlStatementSource="EXECUTE [audit_log].[usp_updDataloadWorkflowStepStatus] ?, ?, ?, ?, 'Start'" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::int_DataloadWorkFlowID"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="1"
            SQLTask:DtsVariableName="User::intRecInsertedCount"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="2"
            SQLTask:DtsVariableName="User::intRecUpdatedCount"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="3"
            SQLTask:DtsVariableName="User::intRecWithIssueCount"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Get the Configuration"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:DelayValidation="True"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{355D8E54-AE36-4F8D-BDC2-EAE02B2FDACA}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Get the Configuration"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{F9F29697-3D73-49BD-B676-2F37DE7B05DC}"
          SQLTask:SqlStatementSource="EXECUTE [audit_log].[usp_getDataloadWorkflowStepConfiguration] ?"
          SQLTask:ResultType="ResultSetType_Rowset" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="0"
            SQLTask:DtsVariableName="User::rsWorkflowStep_Configuration" />
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="$Package::int_DataloadWorkFlowID"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="3"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Load StagingPPassVisits"
      DTS:CreationName="Microsoft.Pipeline"
      DTS:DelayValidation="True"
      DTS:Description="Data Flow Task"
      DTS:Disabled="True"
      DTS:DTSID="{F253212C-5F41-49C6-A133-904D94DC1335}"
      DTS:ExecutableType="Microsoft.Pipeline"
      DTS:LocaleID="-1"
      DTS:ObjectName="Load StagingPPassVisits"
      DTS:TaskContact="Performs high-performance data extraction, transformation and loading;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1">
      <DTS:Variables />
      <DTS:ObjectData>
        <pipeline
          version="1">
          <components>
            <component
              refId="Package\Load StagingPPassVisits\Derived Column"
              componentClassID="Microsoft.DerivedColumn"
              contactInfo="Derived Column;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;0"
              description="Creates new column values by applying expressions to transformation input columns. Create new columns or overwrite existing ones. For example, concatenate the values from the 'first name' and 'last name' column to make a 'full name' column."
              name="Derived Column"
              usesDispositions="true">
              <inputs>
                <input
                  refId="Package\Load StagingPPassVisits\Derived Column.Inputs[Derived Column Input]"
                  description="Input to the Derived Column Transformation"
                  name="Derived Column Input">
                  <externalMetadataColumns />
                </input>
              </inputs>
              <outputs>
                <output
                  refId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output]"
                  description="Default Output of the Derived Column Transformation"
                  exclusionGroup="1"
                  name="Derived Column Output"
                  synchronousInputId="Package\Load StagingPPassVisits\Derived Column.Inputs[Derived Column Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedDate]"
                      dataType="date"
                      errorOrTruncationOperation="Computation"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedDate]"
                      name="d_CreatedDate"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.String"
                          description="Derived Column Expression"
                          name="Expression">@[System::ContainerStartTime]</property>
                        <property
                          containsID="true"
                          dataType="System.String"
                          description="Derived Column Friendly Expression"
                          expressionType="Notify"
                          name="FriendlyExpression">@[System::ContainerStartTime]</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedBy]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Computation"
                      errorRowDisposition="FailComponent"
                      length="50"
                      lineageId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedBy]"
                      name="d_CreatedBy"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.String"
                          description="Derived Column Expression"
                          name="Expression">(DT_STR,50,1252)@[System::UserName]</property>
                        <property
                          containsID="true"
                          dataType="System.String"
                          description="Derived Column Friendly Expression"
                          expressionType="Notify"
                          name="FriendlyExpression">(DT_STR,50,1252)@[System::UserName]</property>
                      </properties>
                    </outputColumn>
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[DataLoadWorkFlowID]"
                      dataType="i4"
                      errorOrTruncationOperation="Computation"
                      errorRowDisposition="FailComponent"
                      lineageId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[DataLoadWorkFlowID]"
                      name="DataLoadWorkFlowID"
                      truncationRowDisposition="FailComponent">
                      <properties>
                        <property
                          containsID="true"
                          dataType="System.String"
                          description="Derived Column Expression"
                          name="Expression">@[$Package::int_DataloadWorkFlowID]</property>
                        <property
                          containsID="true"
                          dataType="System.String"
                          description="Derived Column Friendly Expression"
                          expressionType="Notify"
                          name="FriendlyExpression">@[$Package::int_DataloadWorkFlowID]</property>
                      </properties>
                    </outputColumn>
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
                <output
                  refId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output]"
                  description="Error Output of the Derived Column Transformation"
                  exclusionGroup="1"
                  isErrorOut="true"
                  name="Derived Column Error Output"
                  synchronousInputId="Package\Load StagingPPassVisits\Derived Column.Inputs[Derived Column Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
            <component
              refId="Package\Load StagingPPassVisits\OLE DB Destination"
              componentClassID="Microsoft.OLEDBDestination"
              contactInfo="OLE DB Destination;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;4"
              description="OLE DB Destination"
              name="OLE DB Destination"
              usesDispositions="true"
              version="4">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset">[source].[tblvces_visits_1]</property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor, Microsoft.DataTransformationServices.Controls, Version=15.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91"></property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">3</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the values supplied for identity columns will be copied to the destination. If false, values for identity columns will be auto-generated at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepIdentity">false</property>
                <property
                  dataType="System.Boolean"
                  description="Indicates whether the columns containing null will have null inserted in the destination. If false, columns containing null will have their default values inserted at the destination. Applies only if fast load is turned on."
                  name="FastLoadKeepNulls">false</property>
                <property
                  dataType="System.String"
                  description="Specifies options to be used with fast load.  Applies only if fast load is turned on."
                  name="FastLoadOptions">TABLOCK,CHECK_CONSTRAINTS</property>
                <property
                  dataType="System.Int32"
                  description="Specifies when commits are issued during data insertion.  A value of 0 specifies that one commit will be issued at the end of data insertion.  Applies only if fast load is turned on."
                  name="FastLoadMaxInsertCommitSize">2147483647</property>
              </properties>
              <connections>
                <connection
                  refId="Package\Load StagingPPassVisits\OLE DB Destination.Connections[OleDbConnection]"
                  connectionManagerID="{110815AA-F3E7-43C3-AC2E-A9880201B737}:invalid"
                  connectionManagerRefId="{110815AA-F3E7-43C3-AC2E-A9880201B737}:invalid"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <inputs>
                <input
                  refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input]"
                  errorOrTruncationOperation="Insert"
                  errorRowDisposition="FailComponent"
                  hasSideEffects="true"
                  name="OLE DB Destination Input">
                  <inputColumns>
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[consumer_no]"
                      cachedDataType="i4"
                      cachedName="consumer_no"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[consumer_no]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[consumer_no]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[track_seq]"
                      cachedDataType="i4"
                      cachedName="track_seq"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[track_seq]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[track_seq]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[report_month]"
                      cachedDataType="dbDate"
                      cachedName="report_month"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[report_month]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[report_month]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[DataLoadWorkFlowID]"
                      cachedDataType="i4"
                      cachedName="DataLoadWorkFlowID"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[dataloadworkflowid]"
                      lineageId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[DataLoadWorkFlowID]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[d_CreatedDate]"
                      cachedDataType="date"
                      cachedName="d_CreatedDate"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[creation_date]"
                      lineageId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedDate]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Source Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Source Code"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Source Code]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Source Code]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Member No]"
                      cachedDataType="i8"
                      cachedName="Member No"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member No]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member No]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[CCard No]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="CCard No"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[CCard No]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard No]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Title]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Title"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Title]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Title]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[First Name]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="First Name"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[First Name]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[First Name]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Last Name]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="Last Name"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Last Name]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Last Name]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Membership Plan]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Membership Plan"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Membership Plan]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Membership Plan]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Member Status]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="5"
                      cachedName="Member Status"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member Status]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member Status]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Paid To Date]"
                      cachedDataType="dbDate"
                      cachedName="Paid To Date"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Paid To Date]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Paid To Date]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Experience Transaction Date]"
                      cachedDataType="dbDate"
                      cachedName="Experience Transaction Date"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Experience Transaction Date]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Date Processed]"
                      cachedDataType="dbDate"
                      cachedName="Date Processed"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Date Processed]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Date Processed]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Guests Visits]"
                      cachedDataType="i4"
                      cachedName="Guests Visits"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Guests Visits]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Guests Visits]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Batch No]"
                      cachedDataType="i4"
                      cachedName="Batch No"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Batch No]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Batch No]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Reference]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Reference"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Reference]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Reference]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge Codde]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="20"
                      cachedName="Lounge Codde"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Codde]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Codde]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Lounge"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Airport]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Airport"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Airport]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Airport]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[City]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="City"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[City]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[City]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Country]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Country"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Country]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Country]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Pays Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Client 1 Pays Member Visit"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Pays Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Client 2 Pays Member Visit"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Inclusive PP Member Visit"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Complimentary Member Visit"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Pays Member Visit]"
                      cachedDataType="ui1"
                      cachedName="Cardholder Pays Member Visit"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Pays Guest Activity]"
                      cachedDataType="ui1"
                      cachedName="Client 1 Pays Guest Activity"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Guest Activity]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Activity]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Pays Guest Activity]"
                      cachedDataType="ui1"
                      cachedName="Client 2 Pays Guest Activity"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Guest Activity]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Activity]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Guest Visit]"
                      cachedDataType="ui1"
                      cachedName="Inclusive PP Guest Visit"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Guest Visit]"
                      cachedDataType="ui1"
                      cachedName="Complimentary Guest Visit"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Guest Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Pays Guest Visit]"
                      cachedDataType="ui1"
                      cachedName="Cardholder Pays Guest Visit"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Guest Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge Visit Offer]"
                      cachedDataType="ui1"
                      cachedName="Lounge Visit Offer"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Visit Offer]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Member]"
                      cachedDataType="i4"
                      cachedName="Client 1 Member"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Member]"
                      cachedDataType="i4"
                      cachedName="Client 2 Member"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member]"
                      cachedDataType="ui1"
                      cachedName="Inclusive PP Member"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Guest]"
                      cachedDataType="i4"
                      cachedName="Client 1 Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Guest]"
                      cachedDataType="i4"
                      cachedName="Client 2 Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Guest]"
                      cachedDataType="ui1"
                      cachedName="Inclusive PP Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Client 1 Member/Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member/Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Client 2 Member/Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member/Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Inclusive PP Member/Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member/Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Member/Guest]"
                      cachedDataType="i4"
                      cachedName="Complimentary Member/Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member/Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Currency Member]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Client 1 Visit Currency Member"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Amount Member]"
                      cachedDataType="numeric"
                      cachedName="Client 1 Visit Amount Member"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Currency Guest]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Client 1 Visit Currency Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Amount Guest]"
                      cachedDataType="numeric"
                      cachedName="Client 1 Visit Amount Guest"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 1 Amount Currency]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Total Client 1 Amount Currency"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount Currency]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 1 Amount]"
                      cachedDataType="numeric"
                      cachedName="Total Client 1 Amount"
                      cachedPrecision="11"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Currency Member]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Client 2 Visit Currency Member"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Amount Member]"
                      cachedDataType="numeric"
                      cachedName="Client 2 Visit Amount Member"
                      cachedPrecision="11"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Currency Guest]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Client 2 Visit Currency Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Amount Guest]"
                      cachedDataType="numeric"
                      cachedName="Client 2 Visit Amount Guest"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 2 Amount Currency]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Total Client 2 Amount Currency"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount Currency]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 2 Amount]"
                      cachedDataType="numeric"
                      cachedName="Total Client 2 Amount"
                      cachedPrecision="11"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Currency Member]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Cardholder Visit Currency Member"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Amount Member]"
                      cachedDataType="numeric"
                      cachedName="Cardholder Visit Amount Member"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Currency Guest]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Cardholder Visit Currency Guest"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Amount Guest]"
                      cachedDataType="numeric"
                      cachedName="Cardholder Visit Amount Guest"
                      cachedPrecision="10"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Cardholder Amount Currency]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="2"
                      cachedName="Total Cardholder Amount Currency"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount Currency]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Cardholder Amount]"
                      cachedDataType="numeric"
                      cachedName="Total Cardholder Amount"
                      cachedPrecision="11"
                      cachedScale="2"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cost Centre]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Cost Centre"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cost Centre]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cost Centre]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Campaign Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Campaign Code"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Campaign Code]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Campaign Code]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Vendor Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="Vendor Code"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Vendor Code]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Vendor Code]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[User Invitation Code]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="User Invitation Code"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[User Invitation Code]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[User Invitation Code]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[lounge type]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="100"
                      cachedName="lounge type"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[lounge type]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[lounge type]" />
                    <inputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[d_CreatedBy]"
                      cachedCodepage="1252"
                      cachedDataType="str"
                      cachedLength="50"
                      cachedName="d_CreatedBy"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[created_by]"
                      lineageId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedBy]" />
                  </inputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[creation_date]"
                      dataType="dbTimeStamp"
                      name="creation_date" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[track_seq]"
                      dataType="i4"
                      name="track_seq" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[consumer_no]"
                      dataType="i4"
                      name="consumer_no" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[report_month]"
                      dataType="dbDate"
                      name="report_month" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[dataloadworkflowid]"
                      dataType="i4"
                      name="dataloadworkflowid" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Source Code" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member No]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Member No" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="CCard No" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Title]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Title" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[First Name]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="First Name" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Last Name" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Membership Plan" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Member Status" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Paid To Date]"
                      dataType="dbDate"
                      name="Paid To Date" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Experience Transaction Date]"
                      dataType="dbDate"
                      name="Experience Transaction Date" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Date Processed]"
                      dataType="dbDate"
                      name="Date Processed" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Guests Visits]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Guests Visits" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Batch No]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Batch No" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Reference]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Reference" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Codde]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Lounge Codde" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Lounge" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Airport]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Airport" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[City]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="City" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Country]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Country" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Member Visit]"
                      dataType="i2"
                      name="Client 1 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Member Visit]"
                      dataType="i2"
                      name="Client 2 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member Visit]"
                      dataType="i2"
                      name="Inclusive PP Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member Visit]"
                      dataType="i2"
                      name="Complimentary Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Member Visit]"
                      dataType="i2"
                      name="Cardholder Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Guest Activity]"
                      dataType="i2"
                      name="Client 1 Pays Guest Activity" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Guest Activity]"
                      dataType="i2"
                      name="Client 2 Pays Guest Activity" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest Visit]"
                      dataType="i2"
                      name="Inclusive PP Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Guest Visit]"
                      dataType="i2"
                      name="Complimentary Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Guest Visit]"
                      dataType="i2"
                      name="Cardholder Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Visit Offer]"
                      dataType="i4"
                      name="Lounge Visit Offer" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member]"
                      dataType="i4"
                      name="Client 1 Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member]"
                      dataType="i2"
                      name="Client 2 Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member]"
                      dataType="i2"
                      name="Inclusive PP Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Guest]"
                      dataType="i2"
                      name="Client 1 Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Guest]"
                      dataType="i2"
                      name="Client 2 Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest]"
                      dataType="i2"
                      name="Inclusive PP Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member/Guest]"
                      dataType="i2"
                      name="Client 1 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member/Guest]"
                      dataType="i2"
                      name="Client 2 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member/Guest]"
                      dataType="i2"
                      name="Inclusive PP Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member/Guest]"
                      dataType="i2"
                      name="Complimentary Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Client 1 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Member]"
                      dataType="numeric"
                      name="Client 1 Visit Amount Member"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Client 1 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Guest]"
                      dataType="numeric"
                      name="Client 1 Visit Amount Guest"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Total Client 1 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount]"
                      dataType="numeric"
                      name="Total Client 1 Amount"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Client 2 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Member]"
                      dataType="numeric"
                      name="Client 2 Visit Amount Member"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Client 2 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Guest]"
                      dataType="numeric"
                      name="Client 2 Visit Amount Guest"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Total Client 2 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount]"
                      dataType="numeric"
                      name="Total Client 2 Amount"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Cardholder Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Member]"
                      dataType="numeric"
                      name="Cardholder Visit Amount Member"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Cardholder Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Guest]"
                      dataType="numeric"
                      name="Cardholder Visit Amount Guest"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="3"
                      name="Total Cardholder Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount]"
                      dataType="numeric"
                      name="Total Cardholder Amount"
                      precision="18"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Cost Centre" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Campaign Code" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="Vendor Code" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      length="254"
                      name="User Invitation Code" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[lounge type]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="lounge type" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[created_by]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="created_by" />
                  </externalMetadataColumns>
                </input>
              </inputs>
              <outputs>
                <output
                  refId="Package\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output]"
                  exclusionGroup="1"
                  isErrorOut="true"
                  name="OLE DB Destination Error Output"
                  synchronousInputId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input]">
                  <outputColumns>
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
            <component
              refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits"
              componentClassID="Microsoft.OLEDBSource"
              contactInfo="OLE DB Source;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;7"
              description="OLE DB Source"
              name="OLE_SRC Ppass Visits"
              usesDispositions="true"
              version="7">
              <properties>
                <property
                  dataType="System.Int32"
                  description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                  name="CommandTimeout">0</property>
                <property
                  dataType="System.String"
                  description="Specifies the name of the database object used to open a rowset."
                  name="OpenRowset"></property>
                <property
                  dataType="System.String"
                  description="Specifies the variable that contains the name of the database object used to open a rowset."
                  name="OpenRowsetVariable"></property>
                <property
                  dataType="System.String"
                  description="The SQL command to be executed."
                  name="SqlCommand"
                  UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor, Microsoft.DataTransformationServices.Controls, Version=15.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91">SELECT [source_code]			AS [Source Code]
      --,[consumer_no]			AS [Member No]
      ,[external_identifier]	AS [Member No]
      ,[trans_ccard_number]		AS [CCard No]
	  ,[title]					AS [Title]
      ,[forename]				AS [First Name]
      ,[surname]				AS [Last Name]
	  ,[product_version]		AS [Membership Plan]
	  ,[subs_status]			AS [Member Status]
	  ,[paid_to_date]			AS [Paid To Date]
	  ,[track_start]			AS [Experience Transaction Date]
      ,[creation_date]			AS [Date Processed]
	  ,[track_guests]			AS [Guests Visits]
      ,[track_batch]			AS [Batch No]
      ,[external_ref]			AS [Reference]
      ,[track_from]				AS [Lounge Codde]	  
      ,[lounge_name]			AS [Lounge]
      ,[airport]				AS [Airport]
      ,[city]					AS [City]
      ,[country]				AS [Country]
	  ,[count_mem_cli]			AS [Client 1 Pays Member Visit]
      ,[count_mem_cli2]			AS [Client 2 Pays Member Visit]
      ,[count_mem_pp]			AS [Inclusive PP Member Visit]
      ,[count_mem_comp]			AS [Complimentary Member Visit]
	  
	  ,[count_mem_mem]			AS [Cardholder Pays Member Visit]
      ,[count_gue_cli]			AS [Client 1 Pays Guest Activity]
      ,[count_gue_cli2]			AS [Client 2 Pays Guest Activity]
      ,[count_gue_pp]			AS [Inclusive PP Guest Visit]
      ,[count_gue_comp]			AS [Complimentary Guest Visit]

      ,[count_gue_mem]			AS [Cardholder Pays Guest Visit]
      ,[count_gue_lou]			AS [Lounge Visit Offer]

      ,remaining_mem_cli_count	AS [Client 1 Member]
      ,remaining_mem_cli2_count	AS [Client 2 Member]
      ,[count_mem_pp]			AS [Inclusive PP Member]

      ,remaining_gue_cli_count	AS [Client 1 Guest]
      ,remaining_gue_cli2_count AS [Client 2 Guest]

      ,[count_gue_pp]			AS [Inclusive PP Guest]
      ,remaining_mgu_cli_count	AS [Client 1 Member/Guest]
      ,remaining_mgu_cli2_count	AS [Client 2 Member/Guest]
      ,remaining_mgu_pp_count	AS [Inclusive PP Member/Guest]
      ,remaining_mgu_comp_count	AS [Complimentary Member/Guest]
      ,[fee_mem_cli_curr]		AS [Client 1 Visit Currency Member]
      ,[fee_mem_cli]			AS [Client 1 Visit Amount Member]
      ,[fee_gue_cli_curr]		AS [Client 1 Visit Currency Guest]
      ,[fee_gue_cli]			AS [Client 1 Visit Amount Guest]

      , CASE
        WHEN LEN([fee_mem_cli_curr]) &gt; 0
            THEN [fee_mem_cli_curr]
        WHEN LEN([fee_gue_cli_curr]) &gt; 0
            THEN [fee_gue_cli_curr]
        ELSE
            ' '
		END 					AS [Total Client 1 Amount Currency]
      , CASE
        WHEN (fee_mem_cli_curr = fee_gue_cli_curr)
             AND LEN(fee_mem_cli_curr) &gt; 0
            THEN fee_mem_cli + fee_gue_cli
        WHEN LEN(fee_mem_cli_curr) &gt; 0
            THEN fee_mem_cli
        WHEN LEN(fee_gue_cli_curr) &gt; 0
            THEN fee_gue_cli
        ELSE
            0.00
		END  						AS [Total Client 1 Amount]
/*
	  , CASE
			WHEN LEN([fee_mem_cli2_curr]) &gt; 0
				THEN [fee_mem_cli2_curr]
			WHEN LEN([fee_gue_cli2_curr]) &gt; 0
				THEN [fee_gue_cli2_curr]
			ELSE
				' '
		END  					AS [Client 2 Visit Currency Member]

	  , CASE
			WHEN (fee_mem_cli2_curr = fee_gue_cli2_curr)
				 AND LEN(fee_mem_cli2_curr) &gt; 0
				THEN fee_mem_cli2 + fee_gue_cli2
			WHEN LEN(fee_mem_cli2_curr) &gt; 0
				THEN fee_mem_cli2
			WHEN LEN(fee_gue_cli2_curr) &gt; 0
				THEN fee_gue_cli2
			ELSE
				0.00
		END						AS [Client 2 Visit Amount Member]

      ,[fee_mem_cli2_curr]						AS [Client 2 Visit Currency Guest]
      ,[fee_mem_cli2]							AS [Client 2 Visit Amount Guest]
*/
	  ,[fee_mem_cli2_curr]						AS [Client 2 Visit Currency Member]
	  ,[fee_mem_cli2]							AS [Client 2 Visit Amount Member]
      ,[fee_gue_cli2_curr]						AS [Client 2 Visit Currency Guest]
      ,[fee_gue_cli2]							AS [Client 2 Visit Amount Guest]
	  , CASE
			WHEN LEN([fee_mem_cli2_curr]) &gt; 0
				THEN [fee_mem_cli2_curr]
			WHEN LEN([fee_gue_cli2_curr]) &gt; 0
				THEN [fee_gue_cli2_curr]
			ELSE
				' '
		END   										AS [Total Client 2 Amount Currency]
	  , CASE
			WHEN (fee_mem_cli2_curr = fee_gue_cli2_curr)
				 AND LEN(fee_mem_cli2_curr) &gt; 0
				THEN fee_mem_cli2 + fee_gue_cli2
			WHEN LEN(fee_mem_cli2_curr) &gt; 0
				THEN fee_mem_cli2
			WHEN LEN(fee_gue_cli2_curr) &gt; 0
				THEN fee_gue_cli2
			ELSE
				0.00
		END 										AS [Total Client 2 Amount]
      ,fee_mem_mem_curr						AS [Cardholder Visit Currency Member]
      ,fee_mem_mem						AS [Cardholder Visit Amount Member]
      ,fee_gue_mem_curr						AS [Cardholder Visit Currency Guest]
      ,fee_gue_mem						AS [Cardholder Visit Amount Guest]
	  , CASE
			WHEN LEN(fee_mem_mem_curr) &gt; 0
				THEN fee_mem_mem_curr
			WHEN LEN(fee_gue_mem_curr) &gt; 0
				THEN fee_gue_mem_curr
			ELSE
				' '
		END 							AS [Total Cardholder Amount Currency]
	  , CASE
			WHEN (fee_mem_mem_curr = fee_gue_mem_curr)
				 AND LEN(fee_mem_mem_curr) &gt; 0
				THEN fee_mem_mem + fee_gue_mem
			WHEN LEN(fee_mem_mem_curr) &gt; 0
				THEN fee_mem_mem
			WHEN LEN(fee_gue_mem_curr) &gt; 0
				THEN fee_gue_mem
			ELSE
				0.00
		END 								AS [Total Cardholder Amount]
      ,old_system_ref						AS [Cost Centre]
      ,campaign_code						AS [Campaign Code]
      ,vendor_tracking_code						AS [Vendor Code]
      ,user_invitation_code						AS [User Invitation Code]
      --,NULL						AS [creation_date]
      --,NULL						AS [created_by]
      ,	[track_seq]					AS [track_seq]
      ,[consumer_no]						AS [consumer_no]
      ,report_month						AS [report_month]
	  ,airport_terminal_type		AS [lounge type]


  FROM ##temptblvces_vists</property>
                <property
                  dataType="System.String"
                  description="The variable that contains the SQL command to be executed."
                  name="SqlCommandVariable">User::strQuery_visits</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the column code page to use when code page information is unavailable from the data source."
                  name="DefaultCodePage">1252</property>
                <property
                  dataType="System.Boolean"
                  description="Forces the use of the DefaultCodePage property value when describing character data."
                  name="AlwaysUseDefaultCodePage">false</property>
                <property
                  dataType="System.Int32"
                  description="Specifies the mode used to access the database."
                  name="AccessMode"
                  typeConverter="AccessMode">2</property>
                <property
                  dataType="System.String"
                  description="The mappings between the parameters in the SQL command and variables."
                  name="ParameterMapping"></property>
              </properties>
              <connections>
                <connection
                  refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Connections[OleDbConnection]"
                  connectionManagerID="{DB6D6206-F4FE-4DC4-9C90-9E2C55A34AB1}:invalid"
                  connectionManagerRefId="{DB6D6206-F4FE-4DC4-9C90-9E2C55A34AB1}:invalid"
                  description="The OLE DB runtime connection used to access the database."
                  name="OleDbConnection" />
              </connections>
              <outputs>
                <output
                  refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output]"
                  name="OLE DB Source Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[consumer_no]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[consumer_no]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[consumer_no]"
                      name="consumer_no"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[track_seq]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[track_seq]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[track_seq]"
                      name="track_seq"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Source Code]"
                      length="20"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Source Code]"
                      name="Source Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member No]"
                      dataType="i8"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Member No]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member No]"
                      name="Member No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[CCard No]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard No]"
                      name="CCard No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Title]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Title]"
                      length="20"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Title]"
                      name="Title"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[First Name]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[First Name]"
                      length="50"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[First Name]"
                      name="First Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Last Name]"
                      length="50"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Last Name]"
                      name="Last Name"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Membership Plan]"
                      length="20"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Membership Plan]"
                      name="Membership Plan"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Member Status]"
                      length="5"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member Status]"
                      name="Member Status"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Paid To Date]"
                      dataType="dbDate"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Paid To Date]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Paid To Date]"
                      name="Paid To Date"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]"
                      dataType="dbDate"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Experience Transaction Date]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]"
                      name="Experience Transaction Date"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Date Processed]"
                      dataType="dbDate"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Date Processed]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Date Processed]"
                      name="Date Processed"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Guests Visits]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Guests Visits]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Guests Visits]"
                      name="Guests Visits"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Batch No]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Batch No]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Batch No]"
                      name="Batch No"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Reference]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Reference]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Reference]"
                      name="Reference"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Codde]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge Codde]"
                      length="20"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Codde]"
                      name="Lounge Codde"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge]"
                      name="Lounge"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Airport]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Airport]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Airport]"
                      name="Airport"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[City]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[City]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[City]"
                      name="City"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Country]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Country]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Country]"
                      name="Country"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]"
                      name="Client 1 Pays Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]"
                      name="Client 2 Pays Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]"
                      name="Inclusive PP Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]"
                      name="Complimentary Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Member Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]"
                      name="Cardholder Pays Member Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Activity]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Guest Activity]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Activity]"
                      name="Client 1 Pays Guest Activity"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Activity]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Guest Activity]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Activity]"
                      name="Client 2 Pays Guest Activity"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]"
                      name="Inclusive PP Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Guest Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]"
                      name="Complimentary Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Guest Visit]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]"
                      name="Cardholder Pays Guest Visit"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge Visit Offer]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]"
                      name="Lounge Visit Offer"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member]"
                      name="Client 1 Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member]"
                      name="Client 2 Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]"
                      name="Inclusive PP Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Guest]"
                      name="Client 1 Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Guest]"
                      name="Client 2 Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]"
                      dataType="ui1"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]"
                      name="Inclusive PP Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member/Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]"
                      name="Client 1 Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member/Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]"
                      name="Client 2 Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member/Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]"
                      name="Inclusive PP Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]"
                      dataType="i4"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member/Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]"
                      name="Complimentary Member/Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Member]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]"
                      name="Client 1 Visit Currency Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]"
                      name="Client 1 Visit Amount Member"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Guest]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]"
                      name="Client 1 Visit Currency Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]"
                      name="Client 1 Visit Amount Guest"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount Currency]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]"
                      name="Total Client 1 Amount Currency"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]"
                      name="Total Client 1 Amount"
                      precision="11"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Member]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]"
                      name="Client 2 Visit Currency Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]"
                      name="Client 2 Visit Amount Member"
                      precision="11"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Guest]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]"
                      name="Client 2 Visit Currency Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]"
                      name="Client 2 Visit Amount Guest"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount Currency]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]"
                      name="Total Client 2 Amount Currency"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]"
                      name="Total Client 2 Amount"
                      precision="11"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Member]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]"
                      name="Cardholder Visit Currency Member"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Member]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]"
                      name="Cardholder Visit Amount Member"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Guest]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]"
                      name="Cardholder Visit Currency Guest"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Guest]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]"
                      name="Cardholder Visit Amount Guest"
                      precision="10"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount Currency]"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]"
                      name="Total Cardholder Amount Currency"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]"
                      dataType="numeric"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]"
                      name="Total Cardholder Amount"
                      precision="11"
                      scale="2"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cost Centre]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cost Centre]"
                      name="Cost Centre"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Campaign Code]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Campaign Code]"
                      name="Campaign Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Vendor Code]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Vendor Code]"
                      name="Vendor Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[User Invitation Code]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[User Invitation Code]"
                      name="User Invitation Code"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[report_month]"
                      dataType="dbDate"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[report_month]"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[report_month]"
                      name="report_month"
                      truncationRowDisposition="FailComponent" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[lounge type]"
                      codePage="1252"
                      dataType="str"
                      errorOrTruncationOperation="Conversion"
                      errorRowDisposition="FailComponent"
                      externalMetadataColumnId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[lounge type]"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[lounge type]"
                      name="lounge type"
                      truncationRowDisposition="FailComponent" />
                  </outputColumns>
                  <externalMetadataColumns
                    isUsed="True">
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[consumer_no]"
                      dataType="i4"
                      name="consumer_no" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[track_seq]"
                      dataType="i4"
                      name="track_seq" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Source Code" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Member No]"
                      dataType="i8"
                      name="Member No" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="CCard No" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Title]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Title" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[First Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="First Name" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      name="Last Name" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Membership Plan" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      length="5"
                      name="Member Status" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Paid To Date]"
                      dataType="dbDate"
                      name="Paid To Date" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Experience Transaction Date]"
                      dataType="dbDate"
                      name="Experience Transaction Date" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Date Processed]"
                      dataType="dbDate"
                      name="Date Processed" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Guests Visits]"
                      dataType="i4"
                      name="Guests Visits" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Batch No]"
                      dataType="i4"
                      name="Batch No" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Reference]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Reference" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge Codde]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      name="Lounge Codde" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Lounge" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Airport]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Airport" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[City]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="City" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Country]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Country" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Member Visit]"
                      dataType="ui1"
                      name="Client 1 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Member Visit]"
                      dataType="ui1"
                      name="Client 2 Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member Visit]"
                      dataType="ui1"
                      name="Inclusive PP Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member Visit]"
                      dataType="ui1"
                      name="Complimentary Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Member Visit]"
                      dataType="ui1"
                      name="Cardholder Pays Member Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Guest Activity]"
                      dataType="ui1"
                      name="Client 1 Pays Guest Activity" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Guest Activity]"
                      dataType="ui1"
                      name="Client 2 Pays Guest Activity" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest Visit]"
                      dataType="ui1"
                      name="Inclusive PP Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Guest Visit]"
                      dataType="ui1"
                      name="Complimentary Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Guest Visit]"
                      dataType="ui1"
                      name="Cardholder Pays Guest Visit" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge Visit Offer]"
                      dataType="ui1"
                      name="Lounge Visit Offer" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member]"
                      dataType="i4"
                      name="Client 1 Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member]"
                      dataType="i4"
                      name="Client 2 Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member]"
                      dataType="ui1"
                      name="Inclusive PP Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Guest]"
                      dataType="i4"
                      name="Client 1 Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Guest]"
                      dataType="i4"
                      name="Client 2 Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest]"
                      dataType="ui1"
                      name="Inclusive PP Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member/Guest]"
                      dataType="i4"
                      name="Client 1 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member/Guest]"
                      dataType="i4"
                      name="Client 2 Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      name="Inclusive PP Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member/Guest]"
                      dataType="i4"
                      name="Complimentary Member/Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Client 1 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Member]"
                      dataType="numeric"
                      name="Client 1 Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Client 1 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Guest]"
                      dataType="numeric"
                      name="Client 1 Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Total Client 1 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount]"
                      dataType="numeric"
                      name="Total Client 1 Amount"
                      precision="11"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Client 2 Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Member]"
                      dataType="numeric"
                      name="Client 2 Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Client 2 Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Guest]"
                      dataType="numeric"
                      name="Client 2 Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Total Client 2 Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount]"
                      dataType="numeric"
                      name="Total Client 2 Amount"
                      precision="11"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Cardholder Visit Currency Member" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Member]"
                      dataType="numeric"
                      name="Cardholder Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Cardholder Visit Currency Guest" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Guest]"
                      dataType="numeric"
                      name="Cardholder Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      name="Total Cardholder Amount Currency" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount]"
                      dataType="numeric"
                      name="Total Cardholder Amount"
                      precision="11"
                      scale="2" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Cost Centre" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Campaign Code" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="Vendor Code" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="User Invitation Code" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[report_month]"
                      dataType="dbDate"
                      name="report_month" />
                    <externalMetadataColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[lounge type]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      name="lounge type" />
                  </externalMetadataColumns>
                </output>
                <output
                  refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output]"
                  isErrorOut="true"
                  name="OLE DB Source Error Output">
                  <outputColumns>
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Source Code]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Source Code]"
                      name="Source Code" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Member No]"
                      dataType="i8"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Member No]"
                      name="Member No" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[CCard No]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[CCard No]"
                      name="CCard No" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Title]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Title]"
                      name="Title" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[First Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[First Name]"
                      name="First Name" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Last Name]"
                      codePage="1252"
                      dataType="str"
                      length="50"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Last Name]"
                      name="Last Name" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Membership Plan]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Membership Plan]"
                      name="Membership Plan" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Member Status]"
                      codePage="1252"
                      dataType="str"
                      length="5"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Member Status]"
                      name="Member Status" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Paid To Date]"
                      dataType="dbDate"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Paid To Date]"
                      name="Paid To Date" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Experience Transaction Date]"
                      dataType="dbDate"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Experience Transaction Date]"
                      name="Experience Transaction Date" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Date Processed]"
                      dataType="dbDate"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Date Processed]"
                      name="Date Processed" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Guests Visits]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Guests Visits]"
                      name="Guests Visits" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Batch No]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Batch No]"
                      name="Batch No" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Reference]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Reference]"
                      name="Reference" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge Codde]"
                      codePage="1252"
                      dataType="str"
                      length="20"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge Codde]"
                      name="Lounge Codde" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge]"
                      name="Lounge" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Airport]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Airport]"
                      name="Airport" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[City]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[City]"
                      name="City" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Country]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Country]"
                      name="Country" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Member Visit]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Member Visit]"
                      name="Client 1 Pays Member Visit" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Member Visit]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Member Visit]"
                      name="Client 2 Pays Member Visit" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member Visit]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member Visit]"
                      name="Inclusive PP Member Visit" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Member Visit]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Member Visit]"
                      name="Complimentary Member Visit" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Member Visit]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Member Visit]"
                      name="Cardholder Pays Member Visit" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Guest Activity]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Guest Activity]"
                      name="Client 1 Pays Guest Activity" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Guest Activity]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Guest Activity]"
                      name="Client 2 Pays Guest Activity" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest Visit]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest Visit]"
                      name="Inclusive PP Guest Visit" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Guest Visit]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Guest Visit]"
                      name="Complimentary Guest Visit" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Guest Visit]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Guest Visit]"
                      name="Cardholder Pays Guest Visit" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge Visit Offer]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge Visit Offer]"
                      name="Lounge Visit Offer" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Member]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Member]"
                      name="Client 1 Member" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Member]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Member]"
                      name="Client 2 Member" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member]"
                      name="Inclusive PP Member" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Guest]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Guest]"
                      name="Client 1 Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Guest]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Guest]"
                      name="Client 2 Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest]"
                      dataType="ui1"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest]"
                      name="Inclusive PP Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Member/Guest]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Member/Guest]"
                      name="Client 1 Member/Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Member/Guest]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Member/Guest]"
                      name="Client 2 Member/Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member/Guest]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member/Guest]"
                      name="Inclusive PP Member/Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Member/Guest]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Member/Guest]"
                      name="Complimentary Member/Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Member]"
                      name="Client 1 Visit Currency Member" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Member]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Member]"
                      name="Client 1 Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Guest]"
                      name="Client 1 Visit Currency Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Guest]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Guest]"
                      name="Client 1 Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount Currency]"
                      name="Total Client 1 Amount Currency" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount]"
                      name="Total Client 1 Amount"
                      precision="11"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Member]"
                      name="Client 2 Visit Currency Member" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Member]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Member]"
                      name="Client 2 Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Guest]"
                      name="Client 2 Visit Currency Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Guest]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Guest]"
                      name="Client 2 Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount Currency]"
                      name="Total Client 2 Amount Currency" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount]"
                      name="Total Client 2 Amount"
                      precision="11"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Member]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Member]"
                      name="Cardholder Visit Currency Member" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Member]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Member]"
                      name="Cardholder Visit Amount Member"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Guest]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Guest]"
                      name="Cardholder Visit Currency Guest" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Guest]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Guest]"
                      name="Cardholder Visit Amount Guest"
                      precision="10"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount Currency]"
                      codePage="1252"
                      dataType="str"
                      length="2"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount Currency]"
                      name="Total Cardholder Amount Currency" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount]"
                      dataType="numeric"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount]"
                      name="Total Cardholder Amount"
                      precision="11"
                      scale="2" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cost Centre]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cost Centre]"
                      name="Cost Centre" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Campaign Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Campaign Code]"
                      name="Campaign Code" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Vendor Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Vendor Code]"
                      name="Vendor Code" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[User Invitation Code]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[User Invitation Code]"
                      name="User Invitation Code" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[consumer_no]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[consumer_no]"
                      name="consumer_no" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                      name="ErrorCode"
                      specialFlags="1" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[report_month]"
                      dataType="dbDate"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[report_month]"
                      name="report_month" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[lounge type]"
                      codePage="1252"
                      dataType="str"
                      length="100"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[lounge type]"
                      name="lounge type" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[track_seq]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[track_seq]"
                      name="track_seq" />
                    <outputColumn
                      refId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      dataType="i4"
                      lineageId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                      name="ErrorColumn"
                      specialFlags="2" />
                  </outputColumns>
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
            <component
              refId="Package\Load StagingPPassVisits\Row Count"
              componentClassID="Microsoft.RowCount"
              contactInfo="Row Count;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;0"
              description="Counts rows as they pass through a data flow. For example, use the number of rows processed to determine whether or not to perform cleanup operations, or update text in an e-mail message to communicate processing status."
              name="Row Count">
              <properties>
                <property
                  dataType="System.String"
                  description="Specifies the variable to hold the row count."
                  name="VariableName">User::intRecInsertedCount</property>
              </properties>
              <inputs>
                <input
                  refId="Package\Load StagingPPassVisits\Row Count.Inputs[Row Count Input 1]"
                  hasSideEffects="true"
                  name="Row Count Input 1">
                  <externalMetadataColumns />
                </input>
              </inputs>
              <outputs>
                <output
                  refId="Package\Load StagingPPassVisits\Row Count.Outputs[Row Count Output 1]"
                  name="Row Count Output 1"
                  synchronousInputId="Package\Load StagingPPassVisits\Row Count.Inputs[Row Count Input 1]">
                  <externalMetadataColumns />
                </output>
              </outputs>
            </component>
          </components>
          <paths>
            <path
              refId="Package\Load StagingPPassVisits.Paths[Derived Column Output]"
              endId="Package\Load StagingPPassVisits\Row Count.Inputs[Row Count Input 1]"
              name="Derived Column Output"
              startId="Package\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output]" />
            <path
              refId="Package\Load StagingPPassVisits.Paths[OLE DB Source Output]"
              endId="Package\Load StagingPPassVisits\Derived Column.Inputs[Derived Column Input]"
              name="OLE DB Source Output"
              startId="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output]" />
            <path
              refId="Package\Load StagingPPassVisits.Paths[Row Count Output 1]"
              endId="Package\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input]"
              name="Row Count Output 1"
              startId="Package\Load StagingPPassVisits\Row Count.Outputs[Row Count Output 1]" />
          </paths>
        </pipeline>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Sequence Container"
      DTS:CreationName="STOCK:SEQUENCE"
      DTS:Description="Sequence Container"
      DTS:DTSID="{D2F8AD20-CC85-4BE3-9FE2-06CF4B9C638F}"
      DTS:ExecutableType="STOCK:SEQUENCE"
      DTS:LocaleID="-1"
      DTS:ObjectName="Sequence Container">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:Executables>
        <DTS:Executable
          DTS:refId="Package\Sequence Container\create visits"
          DTS:CreationName="Microsoft.ExecuteSQLTask"
          DTS:Description="Execute SQL Task"
          DTS:DTSID="{70E10F9D-80D4-490C-9E02-1B314DA36B1C}"
          DTS:ExecutableType="Microsoft.ExecuteSQLTask"
          DTS:LocaleID="-1"
          DTS:ObjectName="create visits"
          DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2017 RC1; © 2017 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
          DTS:ThreadHint="0">
          <DTS:Variables />
          <DTS:ObjectData>
            <SQLTask:SqlTaskData
              SQLTask:Connection="{DB6D6206-F4FE-4DC4-9C90-9E2C55A34AB1}"
              SQLTask:SqlStmtSourceType="Variable"
              SQLTask:SqlStatementSource="User::strQuery" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
          </DTS:ObjectData>
        </DTS:Executable>
        <DTS:Executable
          DTS:refId="Package\Sequence Container\delete from dst"
          DTS:CreationName="Microsoft.ExecuteSQLTask"
          DTS:Description="Execute SQL Task"
          DTS:DTSID="{335E6FEC-6A0C-42C6-9173-54E32956AD4E}"
          DTS:ExecutableType="Microsoft.ExecuteSQLTask"
          DTS:LocaleID="-1"
          DTS:ObjectName="delete from dst"
          DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2017 RC1; © 2017 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
          DTS:ThreadHint="0">
          <DTS:Variables />
          <DTS:ObjectData>
            <SQLTask:SqlTaskData
              SQLTask:Connection="{110815AA-F3E7-43C3-AC2E-A9880201B737}"
              SQLTask:SqlStmtSourceType="Variable"
              SQLTask:SqlStatementSource="User::strQuery_del" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
          </DTS:ObjectData>
        </DTS:Executable>
        <DTS:Executable
          DTS:refId="Package\Sequence Container\Get Current Reporting Month"
          DTS:CreationName="Microsoft.ExecuteSQLTask"
          DTS:Description="Execute SQL Task"
          DTS:Disabled="True"
          DTS:DTSID="{53B6DF91-C98E-4DB4-91CB-402EB2CFE1AF}"
          DTS:ExecutableType="Microsoft.ExecuteSQLTask"
          DTS:LocaleID="-1"
          DTS:ObjectName="Get Current Reporting Month"
          DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
          DTS:ThreadHint="0">
          <DTS:Variables />
          <DTS:ObjectData>
            <SQLTask:SqlTaskData
              SQLTask:Connection="{B0859886-4D06-4A17-9F8A-F4400B63B3DB}"
              SQLTask:SqlStatementSource="Execute [dbo].[usp_ReportMonth_Sel_ByClient]  ?, ? , ? output  , ? output  , ? output" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="2"
                SQLTask:DtsVariableName="User::dtStartDate"
                SQLTask:ParameterDirection="Output"
                SQLTask:DataType="135"
                SQLTask:ParameterSize="-1" />
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="3"
                SQLTask:DtsVariableName="User::dtEndDate"
                SQLTask:ParameterDirection="Output"
                SQLTask:DataType="135"
                SQLTask:ParameterSize="-1" />
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="4"
                SQLTask:DtsVariableName="User::dtReportMonth"
                SQLTask:ParameterDirection="Output"
                SQLTask:DataType="135"
                SQLTask:ParameterSize="-1" />
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="0"
                SQLTask:DtsVariableName="User::strClientName"
                SQLTask:ParameterDirection="Input"
                SQLTask:DataType="129"
                SQLTask:ParameterSize="-1" />
              <SQLTask:ParameterBinding
                SQLTask:ParameterName="1"
                SQLTask:DtsVariableName="$Package::int_DataloadWorkFlowID"
                SQLTask:ParameterDirection="Input"
                SQLTask:DataType="3"
                SQLTask:ParameterSize="-1" />
            </SQLTask:SqlTaskData>
          </DTS:ObjectData>
        </DTS:Executable>
        <DTS:Executable
          DTS:refId="Package\Sequence Container\Load StagingPPassVisits"
          DTS:CreationName="Microsoft.Pipeline"
          DTS:DelayValidation="True"
          DTS:Description="Data Flow Task"
          DTS:DTSID="{849C0DE9-714F-42ED-B5CD-5B8F6F846F26}"
          DTS:ExecutableType="Microsoft.Pipeline"
          DTS:LocaleID="-1"
          DTS:ObjectName="Load StagingPPassVisits"
          DTS:TaskContact="Performs high-performance data extraction, transformation and loading;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1">
          <DTS:Variables />
          <DTS:ObjectData>
            <pipeline
              version="1">
              <components>
                <component
                  refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column"
                  componentClassID="Microsoft.DerivedColumn"
                  contactInfo="Derived Column;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;0"
                  description="Creates new column values by applying expressions to transformation input columns. Create new columns or overwrite existing ones. For example, concatenate the values from the 'first name' and 'last name' column to make a 'full name' column."
                  name="Derived Column"
                  usesDispositions="true">
                  <inputs>
                    <input
                      refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Inputs[Derived Column Input]"
                      description="Input to the Derived Column Transformation"
                      name="Derived Column Input">
                      <externalMetadataColumns />
                    </input>
                  </inputs>
                  <outputs>
                    <output
                      refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output]"
                      description="Default Output of the Derived Column Transformation"
                      exclusionGroup="1"
                      name="Derived Column Output"
                      synchronousInputId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Inputs[Derived Column Input]">
                      <outputColumns>
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedDate]"
                          dataType="date"
                          errorOrTruncationOperation="Computation"
                          errorRowDisposition="FailComponent"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedDate]"
                          name="d_CreatedDate"
                          truncationRowDisposition="FailComponent">
                          <properties>
                            <property
                              containsID="true"
                              dataType="System.String"
                              description="Derived Column Expression"
                              name="Expression">@[System::ContainerStartTime]</property>
                            <property
                              containsID="true"
                              dataType="System.String"
                              description="Derived Column Friendly Expression"
                              expressionType="Notify"
                              name="FriendlyExpression">@[System::ContainerStartTime]</property>
                          </properties>
                        </outputColumn>
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedBy]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Computation"
                          errorRowDisposition="FailComponent"
                          length="50"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[d_CreatedBy]"
                          name="d_CreatedBy"
                          truncationRowDisposition="FailComponent">
                          <properties>
                            <property
                              containsID="true"
                              dataType="System.String"
                              description="Derived Column Expression"
                              name="Expression">(DT_STR,50,1252)@[System::UserName]</property>
                            <property
                              containsID="true"
                              dataType="System.String"
                              description="Derived Column Friendly Expression"
                              expressionType="Notify"
                              name="FriendlyExpression">(DT_STR,50,1252)@[System::UserName]</property>
                          </properties>
                        </outputColumn>
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[DataLoadWorkFlowID]"
                          dataType="i4"
                          errorOrTruncationOperation="Computation"
                          errorRowDisposition="FailComponent"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[DataLoadWorkFlowID]"
                          name="DataLoadWorkFlowID"
                          truncationRowDisposition="FailComponent">
                          <properties>
                            <property
                              containsID="true"
                              dataType="System.String"
                              description="Derived Column Expression"
                              name="Expression">@[$Package::int_DataloadWorkFlowID]</property>
                            <property
                              containsID="true"
                              dataType="System.String"
                              description="Derived Column Friendly Expression"
                              expressionType="Notify"
                              name="FriendlyExpression">@[$Package::int_DataloadWorkFlowID]</property>
                          </properties>
                        </outputColumn>
                      </outputColumns>
                      <externalMetadataColumns />
                    </output>
                    <output
                      refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output]"
                      description="Error Output of the Derived Column Transformation"
                      exclusionGroup="1"
                      isErrorOut="true"
                      name="Derived Column Error Output"
                      synchronousInputId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Inputs[Derived Column Input]">
                      <outputColumns>
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output].Columns[ErrorCode]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output].Columns[ErrorCode]"
                          name="ErrorCode"
                          specialFlags="1" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output].Columns[ErrorColumn]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Error Output].Columns[ErrorColumn]"
                          name="ErrorColumn"
                          specialFlags="2" />
                      </outputColumns>
                      <externalMetadataColumns />
                    </output>
                  </outputs>
                </component>
                <component
                  refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination"
                  componentClassID="Microsoft.OLEDBDestination"
                  contactInfo="OLE DB Destination;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;4"
                  description="OLE DB Destination"
                  name="OLE DB Destination"
                  usesDispositions="true"
                  version="4">
                  <properties>
                    <property
                      dataType="System.Int32"
                      description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                      name="CommandTimeout">0</property>
                    <property
                      dataType="System.String"
                      description="Specifies the name of the database object used to open a rowset."
                      name="OpenRowset">[staging].[tbl_ppbo_visits]</property>
                    <property
                      dataType="System.String"
                      description="Specifies the variable that contains the name of the database object used to open a rowset."
                      name="OpenRowsetVariable"></property>
                    <property
                      dataType="System.String"
                      description="The SQL command to be executed."
                      name="SqlCommand"
                      UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor, Microsoft.DataTransformationServices.Controls, Version=15.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91"></property>
                    <property
                      dataType="System.Int32"
                      description="Specifies the column code page to use when code page information is unavailable from the data source."
                      name="DefaultCodePage">1252</property>
                    <property
                      dataType="System.Boolean"
                      description="Forces the use of the DefaultCodePage property value when describing character data."
                      name="AlwaysUseDefaultCodePage">false</property>
                    <property
                      dataType="System.Int32"
                      description="Specifies the mode used to access the database."
                      name="AccessMode"
                      typeConverter="AccessMode">3</property>
                    <property
                      dataType="System.Boolean"
                      description="Indicates whether the values supplied for identity columns will be copied to the destination. If false, values for identity columns will be auto-generated at the destination. Applies only if fast load is turned on."
                      name="FastLoadKeepIdentity">false</property>
                    <property
                      dataType="System.Boolean"
                      description="Indicates whether the columns containing null will have null inserted in the destination. If false, columns containing null will have their default values inserted at the destination. Applies only if fast load is turned on."
                      name="FastLoadKeepNulls">false</property>
                    <property
                      dataType="System.String"
                      description="Specifies options to be used with fast load.  Applies only if fast load is turned on."
                      name="FastLoadOptions">TABLOCK,CHECK_CONSTRAINTS</property>
                    <property
                      dataType="System.Int32"
                      description="Specifies when commits are issued during data insertion.  A value of 0 specifies that one commit will be issued at the end of data insertion.  Applies only if fast load is turned on."
                      name="FastLoadMaxInsertCommitSize">2147483647</property>
                  </properties>
                  <connections>
                    <connection
                      refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Connections[OleDbConnection]"
                      connectionManagerID="{110815AA-F3E7-43C3-AC2E-A9880201B737}:invalid"
                      connectionManagerRefId="{110815AA-F3E7-43C3-AC2E-A9880201B737}:invalid"
                      description="The OLE DB runtime connection used to access the database."
                      name="OleDbConnection" />
                  </connections>
                  <inputs>
                    <input
                      refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input]"
                      errorOrTruncationOperation="Insert"
                      errorRowDisposition="FailComponent"
                      hasSideEffects="true"
                      name="OLE DB Destination Input">
                      <inputColumns>
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[consumer_no]"
                          cachedDataType="i4"
                          cachedName="consumer_no"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[consumer_no]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[consumer_no]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[track_seq]"
                          cachedDataType="i4"
                          cachedName="track_seq"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[track_seq]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[track_seq]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Source Code]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="20"
                          cachedName="Source Code"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Source Code]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Source Code]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Member No]"
                          cachedDataType="i8"
                          cachedName="Member No"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member No]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member No]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[CCard No]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="CCard No"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[CCard No]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard No]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Title]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="20"
                          cachedName="Title"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Title]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Title]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[First Name]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="50"
                          cachedName="First Name"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[First Name]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[First Name]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Last Name]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="50"
                          cachedName="Last Name"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Last Name]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Last Name]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Membership Plan]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="20"
                          cachedName="Membership Plan"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Membership Plan]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Membership Plan]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Member Status]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="5"
                          cachedName="Member Status"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member Status]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member Status]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Paid To Date]"
                          cachedDataType="dbDate"
                          cachedName="Paid To Date"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Paid To Date]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Paid To Date]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Experience Transaction Date]"
                          cachedDataType="dbDate"
                          cachedName="Experience Transaction Date"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Experience Transaction Date]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Date Processed]"
                          cachedDataType="dbDate"
                          cachedName="Date Processed"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Date Processed]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Date Processed]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Guests Visits]"
                          cachedDataType="i4"
                          cachedName="Guests Visits"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Guests Visits]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Guests Visits]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Batch No]"
                          cachedDataType="i4"
                          cachedName="Batch No"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Batch No]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Batch No]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Reference]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="Reference"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Reference]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Reference]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge Codde]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="20"
                          cachedName="Lounge Codde"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Codde]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Codde]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="Lounge"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Airport]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="Airport"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Airport]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Airport]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[City]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="City"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[City]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[City]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Country]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="Country"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Country]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Country]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Pays Member Visit]"
                          cachedDataType="ui1"
                          cachedName="Client 1 Pays Member Visit"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Pays Member Visit]"
                          cachedDataType="ui1"
                          cachedName="Client 2 Pays Member Visit"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member Visit]"
                          cachedDataType="ui1"
                          cachedName="Inclusive PP Member Visit"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Member Visit]"
                          cachedDataType="ui1"
                          cachedName="Complimentary Member Visit"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Pays Member Visit]"
                          cachedDataType="ui1"
                          cachedName="Cardholder Pays Member Visit"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Pays Guest Activity]"
                          cachedDataType="ui1"
                          cachedName="Client 1 Pays Guest Activity"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Guest Activity]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Activity]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Pays Guest Activity]"
                          cachedDataType="ui1"
                          cachedName="Client 2 Pays Guest Activity"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Guest Activity]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Activity]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Guest Visit]"
                          cachedDataType="ui1"
                          cachedName="Inclusive PP Guest Visit"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Guest Visit]"
                          cachedDataType="ui1"
                          cachedName="Complimentary Guest Visit"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Guest Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Pays Guest Visit]"
                          cachedDataType="ui1"
                          cachedName="Cardholder Pays Guest Visit"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Guest Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Lounge Visit Offer]"
                          cachedDataType="ui1"
                          cachedName="Lounge Visit Offer"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Visit Offer]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Member]"
                          cachedDataType="i4"
                          cachedName="Client 1 Member"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Member]"
                          cachedDataType="i4"
                          cachedName="Client 2 Member"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member]"
                          cachedDataType="ui1"
                          cachedName="Inclusive PP Member"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Guest]"
                          cachedDataType="i4"
                          cachedName="Client 1 Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Guest]"
                          cachedDataType="i4"
                          cachedName="Client 2 Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Guest]"
                          cachedDataType="ui1"
                          cachedName="Inclusive PP Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Member/Guest]"
                          cachedDataType="i4"
                          cachedName="Client 1 Member/Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member/Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Member/Guest]"
                          cachedDataType="i4"
                          cachedName="Client 2 Member/Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member/Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Inclusive PP Member/Guest]"
                          cachedDataType="i4"
                          cachedName="Inclusive PP Member/Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member/Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Complimentary Member/Guest]"
                          cachedDataType="i4"
                          cachedName="Complimentary Member/Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member/Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Currency Member]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Client 1 Visit Currency Member"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Amount Member]"
                          cachedDataType="numeric"
                          cachedName="Client 1 Visit Amount Member"
                          cachedPrecision="10"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Currency Guest]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Client 1 Visit Currency Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 1 Visit Amount Guest]"
                          cachedDataType="numeric"
                          cachedName="Client 1 Visit Amount Guest"
                          cachedPrecision="10"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 1 Amount Currency]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Total Client 1 Amount Currency"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount Currency]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 1 Amount]"
                          cachedDataType="numeric"
                          cachedName="Total Client 1 Amount"
                          cachedPrecision="11"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Currency Member]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Client 2 Visit Currency Member"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Amount Member]"
                          cachedDataType="numeric"
                          cachedName="Client 2 Visit Amount Member"
                          cachedPrecision="11"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Currency Guest]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Client 2 Visit Currency Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Client 2 Visit Amount Guest]"
                          cachedDataType="numeric"
                          cachedName="Client 2 Visit Amount Guest"
                          cachedPrecision="10"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 2 Amount Currency]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Total Client 2 Amount Currency"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount Currency]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Client 2 Amount]"
                          cachedDataType="numeric"
                          cachedName="Total Client 2 Amount"
                          cachedPrecision="11"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Currency Member]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Cardholder Visit Currency Member"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Amount Member]"
                          cachedDataType="numeric"
                          cachedName="Cardholder Visit Amount Member"
                          cachedPrecision="10"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Currency Guest]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Cardholder Visit Currency Guest"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cardholder Visit Amount Guest]"
                          cachedDataType="numeric"
                          cachedName="Cardholder Visit Amount Guest"
                          cachedPrecision="10"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Cardholder Amount Currency]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="2"
                          cachedName="Total Cardholder Amount Currency"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount Currency]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Total Cardholder Amount]"
                          cachedDataType="numeric"
                          cachedName="Total Cardholder Amount"
                          cachedPrecision="11"
                          cachedScale="2"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Cost Centre]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="Cost Centre"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cost Centre]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cost Centre]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Campaign Code]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="Campaign Code"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Campaign Code]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Campaign Code]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[Vendor Code]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="Vendor Code"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Vendor Code]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Vendor Code]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[User Invitation Code]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="User Invitation Code"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[User Invitation Code]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[User Invitation Code]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[report_month]"
                          cachedDataType="dbDate"
                          cachedName="report_month"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[report_month]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[report_month]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[lounge type]"
                          cachedCodepage="1252"
                          cachedDataType="str"
                          cachedLength="100"
                          cachedName="lounge type"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[lounge type]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[lounge type]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[DataLoadWorkFlowID]"
                          cachedDataType="i4"
                          cachedName="DataLoadWorkFlowID"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[dataloadworkflowid]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output].Columns[DataLoadWorkFlowID]" />
                        <inputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].Columns[CCard Expiry Date]"
                          cachedDataType="dbDate"
                          cachedName="CCard Expiry Date"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[CCard No Expiry Date]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard Expiry Date]" />
                      </inputColumns>
                      <externalMetadataColumns
                        isUsed="True">
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Source Code]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Source Code" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member No]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Member No" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[CCard No]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="CCard No" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Title]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Title" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[First Name]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="First Name" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Last Name]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Last Name" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Membership Plan]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Membership Plan" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Member Status]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Member Status" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Paid To Date]"
                          dataType="dbDate"
                          name="Paid To Date" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Experience Transaction Date]"
                          dataType="dbDate"
                          name="Experience Transaction Date" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Date Processed]"
                          dataType="dbDate"
                          name="Date Processed" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Guests Visits]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Guests Visits" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Batch No]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Batch No" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Reference]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Reference" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Codde]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Lounge Codde" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Lounge" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Airport]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Airport" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[City]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="City" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Country]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Country" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Member Visit]"
                          dataType="i2"
                          name="Client 1 Pays Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Member Visit]"
                          dataType="i2"
                          name="Client 2 Pays Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member Visit]"
                          dataType="i2"
                          name="Inclusive PP Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member Visit]"
                          dataType="i2"
                          name="Complimentary Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Member Visit]"
                          dataType="i2"
                          name="Cardholder Pays Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Pays Guest Activity]"
                          dataType="i2"
                          name="Client 1 Pays Guest Activity" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Pays Guest Activity]"
                          dataType="i2"
                          name="Client 2 Pays Guest Activity" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest Visit]"
                          dataType="i2"
                          name="Inclusive PP Guest Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Guest Visit]"
                          dataType="i2"
                          name="Complimentary Guest Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Pays Guest Visit]"
                          dataType="i2"
                          name="Cardholder Pays Guest Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Lounge Visit Offer]"
                          dataType="i4"
                          name="Lounge Visit Offer" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member]"
                          dataType="i4"
                          name="Client 1 Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member]"
                          dataType="i2"
                          name="Client 2 Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member]"
                          dataType="i2"
                          name="Inclusive PP Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Guest]"
                          dataType="i2"
                          name="Client 1 Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Guest]"
                          dataType="i2"
                          name="Client 2 Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Guest]"
                          dataType="i2"
                          name="Inclusive PP Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Member/Guest]"
                          dataType="i2"
                          name="Client 1 Member/Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Member/Guest]"
                          dataType="i2"
                          name="Client 2 Member/Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Inclusive PP Member/Guest]"
                          dataType="i2"
                          name="Inclusive PP Member/Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Complimentary Member/Guest]"
                          dataType="i2"
                          name="Complimentary Member/Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Client 1 Visit Currency Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Member]"
                          dataType="numeric"
                          name="Client 1 Visit Amount Member"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Client 1 Visit Currency Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 1 Visit Amount Guest]"
                          dataType="numeric"
                          name="Client 1 Visit Amount Guest"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Total Client 1 Amount Currency" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 1 Amount]"
                          dataType="numeric"
                          name="Total Client 1 Amount"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Client 2 Visit Currency Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Member]"
                          dataType="numeric"
                          name="Client 2 Visit Amount Member"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Client 2 Visit Currency Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Client 2 Visit Amount Guest]"
                          dataType="numeric"
                          name="Client 2 Visit Amount Guest"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Total Client 2 Amount Currency" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Client 2 Amount]"
                          dataType="numeric"
                          name="Total Client 2 Amount"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Cardholder Visit Currency Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Member]"
                          dataType="numeric"
                          name="Cardholder Visit Amount Member"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Cardholder Visit Currency Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cardholder Visit Amount Guest]"
                          dataType="numeric"
                          name="Cardholder Visit Amount Guest"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="3"
                          name="Total Cardholder Amount Currency" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Total Cardholder Amount]"
                          dataType="numeric"
                          name="Total Cardholder Amount"
                          precision="18"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Cost Centre]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Cost Centre" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Campaign Code]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Campaign Code" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[Vendor Code]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="Vendor Code" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[User Invitation Code]"
                          codePage="1252"
                          dataType="str"
                          length="254"
                          name="User Invitation Code" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[lounge type]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="lounge type" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[creation_date]"
                          dataType="dbTimeStamp"
                          name="creation_date" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[created_by]"
                          codePage="1252"
                          dataType="str"
                          length="50"
                          name="created_by" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[track_seq]"
                          dataType="i4"
                          name="track_seq" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[consumer_no]"
                          dataType="i4"
                          name="consumer_no" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[report_month]"
                          dataType="dbDate"
                          name="report_month" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[dataloadworkflowid]"
                          dataType="i4"
                          name="dataloadworkflowid" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input].ExternalColumns[CCard No Expiry Date]"
                          dataType="dbDate"
                          name="CCard No Expiry Date" />
                      </externalMetadataColumns>
                    </input>
                  </inputs>
                  <outputs>
                    <output
                      refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output]"
                      exclusionGroup="1"
                      isErrorOut="true"
                      name="OLE DB Destination Error Output"
                      synchronousInputId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input]">
                      <outputColumns>
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorCode]"
                          name="ErrorCode"
                          specialFlags="1" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Outputs[OLE DB Destination Error Output].Columns[ErrorColumn]"
                          name="ErrorColumn"
                          specialFlags="2" />
                      </outputColumns>
                      <externalMetadataColumns />
                    </output>
                  </outputs>
                </component>
                <component
                  refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits"
                  componentClassID="Microsoft.OLEDBSource"
                  contactInfo="OLE DB Source;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;7"
                  description="OLE DB Source"
                  name="OLE_SRC Ppass Visits"
                  usesDispositions="true"
                  version="7">
                  <properties>
                    <property
                      dataType="System.Int32"
                      description="The number of seconds before a command times out.  A value of 0 indicates an infinite time-out."
                      name="CommandTimeout">0</property>
                    <property
                      dataType="System.String"
                      description="Specifies the name of the database object used to open a rowset."
                      name="OpenRowset"></property>
                    <property
                      dataType="System.String"
                      description="Specifies the variable that contains the name of the database object used to open a rowset."
                      name="OpenRowsetVariable"></property>
                    <property
                      dataType="System.String"
                      description="The SQL command to be executed."
                      name="SqlCommand"
                      UITypeEditor="Microsoft.DataTransformationServices.Controls.ModalMultilineStringEditor, Microsoft.DataTransformationServices.Controls, Version=15.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91">SELECT [source_code]			AS [Source Code]
      --,[consumer_no]			AS [Member No]
      ,[external_identifier]	AS [Member No]
      ,[trans_ccard_number]		AS [CCard No]
,[trans_ccard_expiry]		AS [CCard Expiry Date]
	  ,[title]					AS [Title]
      ,[forename]				AS [First Name]
      ,[surname]				AS [Last Name]
	  ,[product_version]		AS [Membership Plan]
	  ,[subs_status]			AS [Member Status]
	  ,[paid_to_date]			AS [Paid To Date]
	  ,[track_start]			AS [Experience Transaction Date]
      ,[creation_date]			AS [Date Processed]
	  ,[track_guests]			AS [Guests Visits]
      ,[track_batch]			AS [Batch No]
      ,[external_ref]			AS [Reference]
      ,[track_from]				AS [Lounge Codde]	  
      ,[lounge_name]			AS [Lounge]
      ,[airport]				AS [Airport]
      ,[city]					AS [City]
      ,[country]				AS [Country]
	  ,[count_mem_cli]			AS [Client 1 Pays Member Visit]
      ,[count_mem_cli2]			AS [Client 2 Pays Member Visit]
      ,[count_mem_pp]			AS [Inclusive PP Member Visit]
      ,[count_mem_comp]			AS [Complimentary Member Visit]
	  
	  ,[count_mem_mem]			AS [Cardholder Pays Member Visit]
      ,[count_gue_cli]			AS [Client 1 Pays Guest Activity]
      ,[count_gue_cli2]			AS [Client 2 Pays Guest Activity]
      ,[count_gue_pp]			AS [Inclusive PP Guest Visit]
      ,[count_gue_comp]			AS [Complimentary Guest Visit]

      ,[count_gue_mem]			AS [Cardholder Pays Guest Visit]
      ,[count_gue_lou]			AS [Lounge Visit Offer]

      ,remaining_mem_cli_count	AS [Client 1 Member]
      ,remaining_mem_cli2_count	AS [Client 2 Member]
      ,[count_mem_pp]			AS [Inclusive PP Member]

      ,remaining_gue_cli_count	AS [Client 1 Guest]
      ,remaining_gue_cli2_count AS [Client 2 Guest]

      ,[count_gue_pp]			AS [Inclusive PP Guest]
      ,remaining_mgu_cli_count	AS [Client 1 Member/Guest]
      ,remaining_mgu_cli2_count	AS [Client 2 Member/Guest]
      ,remaining_mgu_pp_count	AS [Inclusive PP Member/Guest]
      ,remaining_mgu_comp_count	AS [Complimentary Member/Guest]
      ,[fee_mem_cli_curr]		AS [Client 1 Visit Currency Member]
      ,[fee_mem_cli]			AS [Client 1 Visit Amount Member]
      ,[fee_gue_cli_curr]		AS [Client 1 Visit Currency Guest]
      ,[fee_gue_cli]			AS [Client 1 Visit Amount Guest]

      , CASE
        WHEN LEN([fee_mem_cli_curr]) &gt; 0
            THEN [fee_mem_cli_curr]
        WHEN LEN([fee_gue_cli_curr]) &gt; 0
            THEN [fee_gue_cli_curr]
        ELSE
            ' '
		END 					AS [Total Client 1 Amount Currency]
      , CASE
        WHEN (fee_mem_cli_curr = fee_gue_cli_curr)
             AND LEN(fee_mem_cli_curr) &gt; 0
            THEN fee_mem_cli + fee_gue_cli
        WHEN LEN(fee_mem_cli_curr) &gt; 0
            THEN fee_mem_cli
        WHEN LEN(fee_gue_cli_curr) &gt; 0
            THEN fee_gue_cli
        ELSE
            0.00
		END  						AS [Total Client 1 Amount]
/*
	  , CASE
			WHEN LEN([fee_mem_cli2_curr]) &gt; 0
				THEN [fee_mem_cli2_curr]
			WHEN LEN([fee_gue_cli2_curr]) &gt; 0
				THEN [fee_gue_cli2_curr]
			ELSE
				' '
		END  					AS [Client 2 Visit Currency Member]

	  , CASE
			WHEN (fee_mem_cli2_curr = fee_gue_cli2_curr)
				 AND LEN(fee_mem_cli2_curr) &gt; 0
				THEN fee_mem_cli2 + fee_gue_cli2
			WHEN LEN(fee_mem_cli2_curr) &gt; 0
				THEN fee_mem_cli2
			WHEN LEN(fee_gue_cli2_curr) &gt; 0
				THEN fee_gue_cli2
			ELSE
				0.00
		END						AS [Client 2 Visit Amount Member]

      ,[fee_mem_cli2_curr]						AS [Client 2 Visit Currency Guest]
      ,[fee_mem_cli2]							AS [Client 2 Visit Amount Guest]
*/
	  ,[fee_mem_cli2_curr]						AS [Client 2 Visit Currency Member]
	  ,[fee_mem_cli2]							AS [Client 2 Visit Amount Member]
      ,[fee_gue_cli2_curr]						AS [Client 2 Visit Currency Guest]
      ,[fee_gue_cli2]							AS [Client 2 Visit Amount Guest]
	  , CASE
			WHEN LEN([fee_mem_cli2_curr]) &gt; 0
				THEN [fee_mem_cli2_curr]
			WHEN LEN([fee_gue_cli2_curr]) &gt; 0
				THEN [fee_gue_cli2_curr]
			ELSE
				' '
		END   										AS [Total Client 2 Amount Currency]
	  , CASE
			WHEN (fee_mem_cli2_curr = fee_gue_cli2_curr)
				 AND LEN(fee_mem_cli2_curr) &gt; 0
				THEN fee_mem_cli2 + fee_gue_cli2
			WHEN LEN(fee_mem_cli2_curr) &gt; 0
				THEN fee_mem_cli2
			WHEN LEN(fee_gue_cli2_curr) &gt; 0
				THEN fee_gue_cli2
			ELSE
				0.00
		END 										AS [Total Client 2 Amount]
      ,fee_mem_mem_curr						AS [Cardholder Visit Currency Member]
      ,fee_mem_mem						AS [Cardholder Visit Amount Member]
      ,fee_gue_mem_curr						AS [Cardholder Visit Currency Guest]
      ,fee_gue_mem						AS [Cardholder Visit Amount Guest]
	  , CASE
			WHEN LEN(fee_mem_mem_curr) &gt; 0
				THEN fee_mem_mem_curr
			WHEN LEN(fee_gue_mem_curr) &gt; 0
				THEN fee_gue_mem_curr
			ELSE
				' '
		END 							AS [Total Cardholder Amount Currency]
	  , CASE
			WHEN (fee_mem_mem_curr = fee_gue_mem_curr)
				 AND LEN(fee_mem_mem_curr) &gt; 0
				THEN fee_mem_mem + fee_gue_mem
			WHEN LEN(fee_mem_mem_curr) &gt; 0
				THEN fee_mem_mem
			WHEN LEN(fee_gue_mem_curr) &gt; 0
				THEN fee_gue_mem
			ELSE
				0.00
		END 								AS [Total Cardholder Amount]
      ,old_system_ref						AS [Cost Centre]
      ,campaign_code						AS [Campaign Code]
      ,vendor_tracking_code						AS [Vendor Code]
      ,user_invitation_code						AS [User Invitation Code]
      --,NULL						AS [creation_date]
      --,NULL						AS [created_by]
      ,	[track_seq]					AS [track_seq]
      ,[consumer_no]						AS [consumer_no]
      ,report_month						AS [report_month]
	  ,airport_terminal_type		AS [lounge type]


  FROM #temptblvces_vists</property>
                    <property
                      dataType="System.String"
                      description="The variable that contains the SQL command to be executed."
                      name="SqlCommandVariable">User::strQuery_visits</property>
                    <property
                      dataType="System.Int32"
                      description="Specifies the column code page to use when code page information is unavailable from the data source."
                      name="DefaultCodePage">1252</property>
                    <property
                      dataType="System.Boolean"
                      description="Forces the use of the DefaultCodePage property value when describing character data."
                      name="AlwaysUseDefaultCodePage">false</property>
                    <property
                      dataType="System.Int32"
                      description="Specifies the mode used to access the database."
                      name="AccessMode"
                      typeConverter="AccessMode">2</property>
                    <property
                      dataType="System.String"
                      description="The mappings between the parameters in the SQL command and variables."
                      name="ParameterMapping"></property>
                  </properties>
                  <connections>
                    <connection
                      refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Connections[OleDbConnection]"
                      connectionManagerID="{DB6D6206-F4FE-4DC4-9C90-9E2C55A34AB1}:invalid"
                      connectionManagerRefId="{DB6D6206-F4FE-4DC4-9C90-9E2C55A34AB1}:invalid"
                      description="The OLE DB runtime connection used to access the database."
                      name="OleDbConnection" />
                  </connections>
                  <outputs>
                    <output
                      refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output]"
                      name="OLE DB Source Output">
                      <outputColumns>
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[consumer_no]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[consumer_no]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[consumer_no]"
                          name="consumer_no"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[track_seq]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[track_seq]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[track_seq]"
                          name="track_seq"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Source Code]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Source Code]"
                          length="20"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Source Code]"
                          name="Source Code"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member No]"
                          dataType="i8"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Member No]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member No]"
                          name="Member No"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard No]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[CCard No]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard No]"
                          name="CCard No"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Title]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Title]"
                          length="20"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Title]"
                          name="Title"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[First Name]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[First Name]"
                          length="50"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[First Name]"
                          name="First Name"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Last Name]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Last Name]"
                          length="50"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Last Name]"
                          name="Last Name"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Membership Plan]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Membership Plan]"
                          length="20"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Membership Plan]"
                          name="Membership Plan"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member Status]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Member Status]"
                          length="5"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Member Status]"
                          name="Member Status"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Paid To Date]"
                          dataType="dbDate"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Paid To Date]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Paid To Date]"
                          name="Paid To Date"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]"
                          dataType="dbDate"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Experience Transaction Date]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Experience Transaction Date]"
                          name="Experience Transaction Date"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Date Processed]"
                          dataType="dbDate"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Date Processed]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Date Processed]"
                          name="Date Processed"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Guests Visits]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Guests Visits]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Guests Visits]"
                          name="Guests Visits"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Batch No]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Batch No]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Batch No]"
                          name="Batch No"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Reference]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Reference]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Reference]"
                          name="Reference"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Codde]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge Codde]"
                          length="20"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Codde]"
                          name="Lounge Codde"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge]"
                          name="Lounge"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Airport]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Airport]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Airport]"
                          name="Airport"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[City]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[City]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[City]"
                          name="City"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Country]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Country]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Country]"
                          name="Country"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Member Visit]"
                          name="Client 1 Pays Member Visit"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Member Visit]"
                          name="Client 2 Pays Member Visit"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member Visit]"
                          name="Inclusive PP Member Visit"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member Visit]"
                          name="Complimentary Member Visit"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Member Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Member Visit]"
                          name="Cardholder Pays Member Visit"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Activity]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Guest Activity]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Pays Guest Activity]"
                          name="Client 1 Pays Guest Activity"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Activity]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Guest Activity]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Pays Guest Activity]"
                          name="Client 2 Pays Guest Activity"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest Visit]"
                          name="Inclusive PP Guest Visit"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Guest Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Guest Visit]"
                          name="Complimentary Guest Visit"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Guest Visit]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Pays Guest Visit]"
                          name="Cardholder Pays Guest Visit"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge Visit Offer]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Lounge Visit Offer]"
                          name="Lounge Visit Offer"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member]"
                          name="Client 1 Member"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member]"
                          name="Client 2 Member"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member]"
                          name="Inclusive PP Member"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Guest]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Guest]"
                          name="Client 1 Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Guest]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Guest]"
                          name="Client 2 Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]"
                          dataType="ui1"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Guest]"
                          name="Inclusive PP Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member/Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Member/Guest]"
                          name="Client 1 Member/Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member/Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Member/Guest]"
                          name="Client 2 Member/Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member/Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Inclusive PP Member/Guest]"
                          name="Inclusive PP Member/Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]"
                          dataType="i4"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member/Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Complimentary Member/Guest]"
                          name="Complimentary Member/Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Member]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Member]"
                          name="Client 1 Visit Currency Member"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Member]"
                          name="Client 1 Visit Amount Member"
                          precision="10"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Guest]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Currency Guest]"
                          name="Client 1 Visit Currency Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 1 Visit Amount Guest]"
                          name="Client 1 Visit Amount Guest"
                          precision="10"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount Currency]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount Currency]"
                          name="Total Client 1 Amount Currency"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 1 Amount]"
                          name="Total Client 1 Amount"
                          precision="11"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Member]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Member]"
                          name="Client 2 Visit Currency Member"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Member]"
                          name="Client 2 Visit Amount Member"
                          precision="11"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Guest]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Currency Guest]"
                          name="Client 2 Visit Currency Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Client 2 Visit Amount Guest]"
                          name="Client 2 Visit Amount Guest"
                          precision="10"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount Currency]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount Currency]"
                          name="Total Client 2 Amount Currency"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Client 2 Amount]"
                          name="Total Client 2 Amount"
                          precision="11"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Member]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Member]"
                          name="Cardholder Visit Currency Member"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Member]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Member]"
                          name="Cardholder Visit Amount Member"
                          precision="10"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Guest]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Currency Guest]"
                          name="Cardholder Visit Currency Guest"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Guest]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cardholder Visit Amount Guest]"
                          name="Cardholder Visit Amount Guest"
                          precision="10"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount Currency]"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount Currency]"
                          name="Total Cardholder Amount Currency"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]"
                          dataType="numeric"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Total Cardholder Amount]"
                          name="Total Cardholder Amount"
                          precision="11"
                          scale="2"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cost Centre]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cost Centre]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Cost Centre]"
                          name="Cost Centre"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Campaign Code]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Campaign Code]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Campaign Code]"
                          name="Campaign Code"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Vendor Code]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Vendor Code]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[Vendor Code]"
                          name="Vendor Code"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[User Invitation Code]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[User Invitation Code]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[User Invitation Code]"
                          name="User Invitation Code"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[report_month]"
                          dataType="dbDate"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[report_month]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[report_month]"
                          name="report_month"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[lounge type]"
                          codePage="1252"
                          dataType="str"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[lounge type]"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[lounge type]"
                          name="lounge type"
                          truncationRowDisposition="FailComponent" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard Expiry Date]"
                          dataType="dbDate"
                          errorOrTruncationOperation="Conversion"
                          errorRowDisposition="FailComponent"
                          externalMetadataColumnId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[CCard Expiry Date]"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].Columns[CCard Expiry Date]"
                          name="CCard Expiry Date"
                          truncationRowDisposition="FailComponent" />
                      </outputColumns>
                      <externalMetadataColumns
                        isUsed="True">
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[consumer_no]"
                          dataType="i4"
                          name="consumer_no" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[track_seq]"
                          dataType="i4"
                          name="track_seq" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Source Code]"
                          codePage="1252"
                          dataType="str"
                          length="20"
                          name="Source Code" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Member No]"
                          dataType="i8"
                          name="Member No" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[CCard No]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="CCard No" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Title]"
                          codePage="1252"
                          dataType="str"
                          length="20"
                          name="Title" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[First Name]"
                          codePage="1252"
                          dataType="str"
                          length="50"
                          name="First Name" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Last Name]"
                          codePage="1252"
                          dataType="str"
                          length="50"
                          name="Last Name" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Membership Plan]"
                          codePage="1252"
                          dataType="str"
                          length="20"
                          name="Membership Plan" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Member Status]"
                          codePage="1252"
                          dataType="str"
                          length="5"
                          name="Member Status" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Paid To Date]"
                          dataType="dbDate"
                          name="Paid To Date" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Experience Transaction Date]"
                          dataType="dbDate"
                          name="Experience Transaction Date" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Date Processed]"
                          dataType="dbDate"
                          name="Date Processed" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Guests Visits]"
                          dataType="i4"
                          name="Guests Visits" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Batch No]"
                          dataType="i4"
                          name="Batch No" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Reference]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="Reference" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge Codde]"
                          codePage="1252"
                          dataType="str"
                          length="20"
                          name="Lounge Codde" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="Lounge" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Airport]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="Airport" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[City]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="City" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Country]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="Country" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Member Visit]"
                          dataType="ui1"
                          name="Client 1 Pays Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Member Visit]"
                          dataType="ui1"
                          name="Client 2 Pays Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member Visit]"
                          dataType="ui1"
                          name="Inclusive PP Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member Visit]"
                          dataType="ui1"
                          name="Complimentary Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Member Visit]"
                          dataType="ui1"
                          name="Cardholder Pays Member Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Pays Guest Activity]"
                          dataType="ui1"
                          name="Client 1 Pays Guest Activity" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Pays Guest Activity]"
                          dataType="ui1"
                          name="Client 2 Pays Guest Activity" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest Visit]"
                          dataType="ui1"
                          name="Inclusive PP Guest Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Guest Visit]"
                          dataType="ui1"
                          name="Complimentary Guest Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Pays Guest Visit]"
                          dataType="ui1"
                          name="Cardholder Pays Guest Visit" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Lounge Visit Offer]"
                          dataType="ui1"
                          name="Lounge Visit Offer" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member]"
                          dataType="i4"
                          name="Client 1 Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member]"
                          dataType="i4"
                          name="Client 2 Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member]"
                          dataType="ui1"
                          name="Inclusive PP Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Guest]"
                          dataType="i4"
                          name="Client 1 Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Guest]"
                          dataType="i4"
                          name="Client 2 Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Guest]"
                          dataType="ui1"
                          name="Inclusive PP Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Member/Guest]"
                          dataType="i4"
                          name="Client 1 Member/Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Member/Guest]"
                          dataType="i4"
                          name="Client 2 Member/Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Inclusive PP Member/Guest]"
                          dataType="i4"
                          name="Inclusive PP Member/Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Complimentary Member/Guest]"
                          dataType="i4"
                          name="Complimentary Member/Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Client 1 Visit Currency Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Member]"
                          dataType="numeric"
                          name="Client 1 Visit Amount Member"
                          precision="10"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Client 1 Visit Currency Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 1 Visit Amount Guest]"
                          dataType="numeric"
                          name="Client 1 Visit Amount Guest"
                          precision="10"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Total Client 1 Amount Currency" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 1 Amount]"
                          dataType="numeric"
                          name="Total Client 1 Amount"
                          precision="11"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Client 2 Visit Currency Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Member]"
                          dataType="numeric"
                          name="Client 2 Visit Amount Member"
                          precision="10"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Client 2 Visit Currency Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Client 2 Visit Amount Guest]"
                          dataType="numeric"
                          name="Client 2 Visit Amount Guest"
                          precision="10"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Total Client 2 Amount Currency" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Client 2 Amount]"
                          dataType="numeric"
                          name="Total Client 2 Amount"
                          precision="11"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Cardholder Visit Currency Member" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Member]"
                          dataType="numeric"
                          name="Cardholder Visit Amount Member"
                          precision="10"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Cardholder Visit Currency Guest" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cardholder Visit Amount Guest]"
                          dataType="numeric"
                          name="Cardholder Visit Amount Guest"
                          precision="10"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          name="Total Cardholder Amount Currency" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Total Cardholder Amount]"
                          dataType="numeric"
                          name="Total Cardholder Amount"
                          precision="11"
                          scale="2" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Cost Centre]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="Cost Centre" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Campaign Code]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="Campaign Code" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[Vendor Code]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="Vendor Code" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[User Invitation Code]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="User Invitation Code" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[report_month]"
                          dataType="dbDate"
                          name="report_month" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[lounge type]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          name="lounge type" />
                        <externalMetadataColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output].ExternalColumns[CCard Expiry Date]"
                          dataType="dbDate"
                          name="CCard Expiry Date" />
                      </externalMetadataColumns>
                    </output>
                    <output
                      refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output]"
                      isErrorOut="true"
                      name="OLE DB Source Error Output">
                      <outputColumns>
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Source Code]"
                          codePage="1252"
                          dataType="str"
                          length="20"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Source Code]"
                          name="Source Code" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Member No]"
                          dataType="i8"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Member No]"
                          name="Member No" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[CCard No]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[CCard No]"
                          name="CCard No" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[CCard Expiry Date]"
                          dataType="dbDate"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[CCard Expiry Date]"
                          name="CCard Expiry Date" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Title]"
                          codePage="1252"
                          dataType="str"
                          length="20"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Title]"
                          name="Title" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[First Name]"
                          codePage="1252"
                          dataType="str"
                          length="50"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[First Name]"
                          name="First Name" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Last Name]"
                          codePage="1252"
                          dataType="str"
                          length="50"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Last Name]"
                          name="Last Name" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Membership Plan]"
                          codePage="1252"
                          dataType="str"
                          length="20"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Membership Plan]"
                          name="Membership Plan" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Member Status]"
                          codePage="1252"
                          dataType="str"
                          length="5"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Member Status]"
                          name="Member Status" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Paid To Date]"
                          dataType="dbDate"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Paid To Date]"
                          name="Paid To Date" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Experience Transaction Date]"
                          dataType="dbDate"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Experience Transaction Date]"
                          name="Experience Transaction Date" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Date Processed]"
                          dataType="dbDate"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Date Processed]"
                          name="Date Processed" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Guests Visits]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Guests Visits]"
                          name="Guests Visits" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Batch No]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Batch No]"
                          name="Batch No" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Reference]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Reference]"
                          name="Reference" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge Codde]"
                          codePage="1252"
                          dataType="str"
                          length="20"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge Codde]"
                          name="Lounge Codde" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge]"
                          name="Lounge" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Airport]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Airport]"
                          name="Airport" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[City]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[City]"
                          name="City" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Country]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Country]"
                          name="Country" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Member Visit]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Member Visit]"
                          name="Client 1 Pays Member Visit" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Member Visit]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Member Visit]"
                          name="Client 2 Pays Member Visit" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member Visit]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member Visit]"
                          name="Inclusive PP Member Visit" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Member Visit]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Member Visit]"
                          name="Complimentary Member Visit" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Member Visit]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Member Visit]"
                          name="Cardholder Pays Member Visit" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Guest Activity]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Pays Guest Activity]"
                          name="Client 1 Pays Guest Activity" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Guest Activity]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Pays Guest Activity]"
                          name="Client 2 Pays Guest Activity" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest Visit]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest Visit]"
                          name="Inclusive PP Guest Visit" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Guest Visit]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Guest Visit]"
                          name="Complimentary Guest Visit" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Guest Visit]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Pays Guest Visit]"
                          name="Cardholder Pays Guest Visit" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge Visit Offer]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Lounge Visit Offer]"
                          name="Lounge Visit Offer" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Member]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Member]"
                          name="Client 1 Member" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Member]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Member]"
                          name="Client 2 Member" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member]"
                          name="Inclusive PP Member" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Guest]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Guest]"
                          name="Client 1 Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Guest]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Guest]"
                          name="Client 2 Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest]"
                          dataType="ui1"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Guest]"
                          name="Inclusive PP Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Member/Guest]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Member/Guest]"
                          name="Client 1 Member/Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Member/Guest]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Member/Guest]"
                          name="Client 2 Member/Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member/Guest]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Inclusive PP Member/Guest]"
                          name="Inclusive PP Member/Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Member/Guest]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Complimentary Member/Guest]"
                          name="Complimentary Member/Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Member]"
                          name="Client 1 Visit Currency Member" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Member]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Member]"
                          name="Client 1 Visit Amount Member"
                          precision="10"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Currency Guest]"
                          name="Client 1 Visit Currency Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Guest]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 1 Visit Amount Guest]"
                          name="Client 1 Visit Amount Guest"
                          precision="10"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount Currency]"
                          name="Total Client 1 Amount Currency" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 1 Amount]"
                          name="Total Client 1 Amount"
                          precision="11"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Member]"
                          name="Client 2 Visit Currency Member" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Member]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Member]"
                          name="Client 2 Visit Amount Member"
                          precision="10"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Currency Guest]"
                          name="Client 2 Visit Currency Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Guest]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Client 2 Visit Amount Guest]"
                          name="Client 2 Visit Amount Guest"
                          precision="10"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount Currency]"
                          name="Total Client 2 Amount Currency" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Client 2 Amount]"
                          name="Total Client 2 Amount"
                          precision="11"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Member]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Member]"
                          name="Cardholder Visit Currency Member" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Member]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Member]"
                          name="Cardholder Visit Amount Member"
                          precision="10"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Guest]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Currency Guest]"
                          name="Cardholder Visit Currency Guest" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Guest]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cardholder Visit Amount Guest]"
                          name="Cardholder Visit Amount Guest"
                          precision="10"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount Currency]"
                          codePage="1252"
                          dataType="str"
                          length="2"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount Currency]"
                          name="Total Cardholder Amount Currency" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount]"
                          dataType="numeric"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Total Cardholder Amount]"
                          name="Total Cardholder Amount"
                          precision="11"
                          scale="2" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cost Centre]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Cost Centre]"
                          name="Cost Centre" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Campaign Code]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Campaign Code]"
                          name="Campaign Code" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Vendor Code]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[Vendor Code]"
                          name="Vendor Code" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[User Invitation Code]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[User Invitation Code]"
                          name="User Invitation Code" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[consumer_no]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[consumer_no]"
                          name="consumer_no" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[ErrorCode]"
                          name="ErrorCode"
                          specialFlags="1" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[report_month]"
                          dataType="dbDate"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[report_month]"
                          name="report_month" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[lounge type]"
                          codePage="1252"
                          dataType="str"
                          length="100"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[lounge type]"
                          name="lounge type" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[track_seq]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[track_seq]"
                          name="track_seq" />
                        <outputColumn
                          refId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                          dataType="i4"
                          lineageId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Error Output].Columns[ErrorColumn]"
                          name="ErrorColumn"
                          specialFlags="2" />
                      </outputColumns>
                      <externalMetadataColumns />
                    </output>
                  </outputs>
                </component>
                <component
                  refId="Package\Sequence Container\Load StagingPPassVisits\Row Count"
                  componentClassID="Microsoft.RowCount"
                  contactInfo="Row Count;Microsoft Corporation; Microsoft SQL Server; (C) Microsoft Corporation; All Rights Reserved; http://www.microsoft.com/sql/support;0"
                  description="Counts rows as they pass through a data flow. For example, use the number of rows processed to determine whether or not to perform cleanup operations, or update text in an e-mail message to communicate processing status."
                  name="Row Count">
                  <properties>
                    <property
                      dataType="System.String"
                      description="Specifies the variable to hold the row count."
                      name="VariableName">User::intRecInsertedCount</property>
                  </properties>
                  <inputs>
                    <input
                      refId="Package\Sequence Container\Load StagingPPassVisits\Row Count.Inputs[Row Count Input 1]"
                      hasSideEffects="true"
                      name="Row Count Input 1">
                      <externalMetadataColumns />
                    </input>
                  </inputs>
                  <outputs>
                    <output
                      refId="Package\Sequence Container\Load StagingPPassVisits\Row Count.Outputs[Row Count Output 1]"
                      name="Row Count Output 1"
                      synchronousInputId="Package\Sequence Container\Load StagingPPassVisits\Row Count.Inputs[Row Count Input 1]">
                      <externalMetadataColumns />
                    </output>
                  </outputs>
                </component>
              </components>
              <paths>
                <path
                  refId="Package\Sequence Container\Load StagingPPassVisits.Paths[Derived Column Output]"
                  endId="Package\Sequence Container\Load StagingPPassVisits\Row Count.Inputs[Row Count Input 1]"
                  name="Derived Column Output"
                  startId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Outputs[Derived Column Output]" />
                <path
                  refId="Package\Sequence Container\Load StagingPPassVisits.Paths[OLE DB Source Output]"
                  endId="Package\Sequence Container\Load StagingPPassVisits\Derived Column.Inputs[Derived Column Input]"
                  name="OLE DB Source Output"
                  startId="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits.Outputs[OLE DB Source Output]" />
                <path
                  refId="Package\Sequence Container\Load StagingPPassVisits.Paths[Row Count Output 1]"
                  endId="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination.Inputs[OLE DB Destination Input]"
                  name="Row Count Output 1"
                  startId="Package\Sequence Container\Load StagingPPassVisits\Row Count.Outputs[Row Count Output 1]" />
              </paths>
            </pipeline>
          </DTS:ObjectData>
        </DTS:Executable>
      </DTS:Executables>
      <DTS:PrecedenceConstraints>
        <DTS:PrecedenceConstraint
          DTS:refId="Package\Sequence Container.PrecedenceConstraints[Constraint]"
          DTS:CreationName=""
          DTS:DTSID="{2F6CF2BC-6644-4343-8D31-55DB0DB1E9BD}"
          DTS:From="Package\Sequence Container\Get Current Reporting Month"
          DTS:LogicalAnd="True"
          DTS:ObjectName="Constraint"
          DTS:To="Package\Sequence Container\create visits" />
        <DTS:PrecedenceConstraint
          DTS:refId="Package\Sequence Container.PrecedenceConstraints[Constraint 1]"
          DTS:CreationName=""
          DTS:DTSID="{EBF545DC-0636-4CD5-9FB4-6BA2F66E5BC4}"
          DTS:From="Package\Sequence Container\create visits"
          DTS:LogicalAnd="True"
          DTS:ObjectName="Constraint 1"
          DTS:To="Package\Sequence Container\delete from dst" />
        <DTS:PrecedenceConstraint
          DTS:refId="Package\Sequence Container.PrecedenceConstraints[Constraint 2]"
          DTS:CreationName=""
          DTS:DTSID="{59A11C7D-A173-4A4F-8992-FC1BEAADFC0F}"
          DTS:From="Package\Sequence Container\delete from dst"
          DTS:LogicalAnd="True"
          DTS:ObjectName="Constraint 2"
          DTS:To="Package\Sequence Container\Load StagingPPassVisits" />
      </DTS:PrecedenceConstraints>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Set up configuration variables"
      DTS:CreationName="Microsoft.ScriptTask"
      DTS:Description="Script Task"
      DTS:Disabled="True"
      DTS:DTSID="{DB44BFF5-6317-4115-83C2-140FED4B4615}"
      DTS:ExecutableType="Microsoft.ScriptTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Set up configuration variables"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <ScriptProject
          Name="ST_347ee0a4ef48426ab95e2a1949f79eb2"
          VSTAMajorVersion="14"
          VSTAMinorVersion="0"
          Language="VisualBasic" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint]"
      DTS:CreationName=""
      DTS:DTSID="{D828E65B-0223-4CE2-B5D2-364DB225D45C}"
      DTS:From="Package\Sequence Container"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint"
      DTS:To="Package\Flag Data Load Complete" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 1]"
      DTS:CreationName=""
      DTS:DTSID="{EAD36BB6-BAB4-45B8-AB11-2C649F76B652}"
      DTS:From="Package\Sequence Container"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 1"
      DTS:To="Package\Flag Data Load Failed"
      DTS:Value="1" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 2]"
      DTS:CreationName=""
      DTS:DTSID="{7D40D8F5-FD5C-4E77-931D-9BF705B42785}"
      DTS:From="Package\Set up configuration variables"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 2"
      DTS:To="Package\Sequence Container" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 3]"
      DTS:CreationName=""
      DTS:DTSID="{98602356-2616-42D4-B620-3D55C0326097}"
      DTS:From="Package\Flag Dataload as Start"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 3"
      DTS:To="Package\Get the Configuration" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 4]"
      DTS:CreationName=""
      DTS:DTSID="{9810D72F-DD81-46F5-8232-5D5058B4CAF1}"
      DTS:From="Package\Get the Configuration"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 4"
      DTS:To="Package\Set up configuration variables" />
  </DTS:PrecedenceConstraints>
  <DTS:EventHandlers>
    <DTS:EventHandler
      DTS:refId="Package.EventHandlers[OnError]"
      DTS:CreationName="OnError"
      DTS:DTSID="{246B5566-A514-443D-927E-7ED2E6DF7292}"
      DTS:EventID="0"
      DTS:EventName="OnError"
      DTS:LocaleID="-1">
      <DTS:Variables>
        <DTS:Variable
          DTS:CreationName=""
          DTS:Description="The propagate property of the event"
          DTS:DTSID="{78896D6A-724F-4207-AA28-F1C68D2B0D02}"
          DTS:IncludeInDebugDump="6789"
          DTS:Namespace="System"
          DTS:ObjectName="Propagate">
          <DTS:VariableValue
            DTS:DataType="11">-1</DTS:VariableValue>
        </DTS:Variable>
      </DTS:Variables>
      <DTS:Executables />
    </DTS:EventHandler>
  </DTS:EventHandlers>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="32" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgm="clr-namespace:Microsoft.SqlServer.Graph.Model;assembly=Microsoft.SqlServer.Graph">
        <NodeLayout
          Size="198,45"
          Id="Package\Flag Data Load Complete"
          TopLeft="124.071428104323,600.582351396817" />
        <NodeLayout
          Size="198,45"
          Id="Package\Flag Data Load Failed"
          TopLeft="374.071430216032,601.12352767865" />
        <NodeLayout
          Size="220,42"
          Id="Package\Flag Dataload as Start"
          TopLeft="259.271428172442,7.33529414338633" />
        <NodeLayout
          Size="220,42"
          Id="Package\Get the Configuration"
          TopLeft="259.271428172442,53.9352941433863" />
        <NodeLayout
          Size="192,42"
          Id="Package\Load StagingPPassVisits"
          TopLeft="124.071428104323,705.92352767865" />
        <NodeLayout
          Size="192,42"
          Id="Package\Sequence Container\create visits"
          TopLeft="31.4285714188401,71.558822259606" />
        <NodeLayout
          Size="192,42"
          Id="Package\Sequence Container\delete from dst"
          TopLeft="31.4285714188401,118.558822259606" />
        <NodeLayout
          Size="192,42"
          Id="Package\Sequence Container\Get Current Reporting Month"
          TopLeft="31.4285714188401,24.558822259606" />
        <NodeLayout
          Size="191,42"
          Id="Package\Sequence Container\Load StagingPPassVisits"
          TopLeft="31.4285714188401,165.558822259606" />
        <EdgeLayout
          Id="Package\Sequence Container.PrecedenceConstraints[Constraint]"
          TopLeft="31.4285714188401,45.558822259606">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,41.3333333333333"
              Start="0,0"
              End="-7.5,41.3333333333333">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="-18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="-18.5,0"
                    Point2="-22.5,0"
                    Point3="-22.5,4" />
                  <mssgle:LineSegment
                    End="-22.5,37.3333333333333" />
                  <mssgle:CubicBezierSegment
                    Point1="-22.5,37.3333333333333"
                    Point2="-22.5,41.3333333333333"
                    Point3="-18.5,41.3333333333333" />
                  <mssgle:LineSegment
                    End="-7.5,41.3333333333333" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container.PrecedenceConstraints[Constraint 1]"
          TopLeft="31.4285714188401,98.2254889262727">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,35.6666666666667"
              Start="0,0"
              End="-7.5,35.6666666666667">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="-18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="-18.5,0"
                    Point2="-22.5,0"
                    Point3="-22.5,4" />
                  <mssgle:LineSegment
                    End="-22.5,31.6666666666667" />
                  <mssgle:CubicBezierSegment
                    Point1="-22.5,31.6666666666667"
                    Point2="-22.5,35.6666666666667"
                    Point3="-18.5,35.6666666666667" />
                  <mssgle:LineSegment
                    End="-7.5,35.6666666666667" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container.PrecedenceConstraints[Constraint 2]"
          TopLeft="223.42857141884,139.558822259606">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="-1,47"
              Start="0,0"
              End="6.5,47">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="18.5,0"
                    Point2="22.5,0"
                    Point3="22.5,4" />
                  <mssgle:LineSegment
                    End="22.5,43" />
                  <mssgle:CubicBezierSegment
                    Point1="22.5,43"
                    Point2="22.5,47"
                    Point3="18.5,47" />
                  <mssgle:LineSegment
                    End="6.5,47" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <ContainerLayout
          HeaderHeight="43"
          IsExpanded="True"
          PanelSize="261,263"
          Size="261,306"
          Id="Package\Sequence Container"
          TopLeft="230.028570124568,174.63725422416" />
        <NodeLayout
          Size="220,42"
          Id="Package\Set up configuration variables"
          TopLeft="259.271428172442,100.535294143386" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint]"
          TopLeft="318.361903457901,435.63725422416">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="-95.2904753535783,164.945097172657"
              Start="0,0"
              End="-95.2904753535783,157.445097172657">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,62.581036939458" />
                  <mssgle:CubicBezierSegment
                    Point1="0,62.581036939458"
                    Point2="0,66.581036939458"
                    Point3="-4,66.581036939458" />
                  <mssgle:LineSegment
                    End="-91.2904753535783,66.581036939458" />
                  <mssgle:CubicBezierSegment
                    Point1="-91.2904753535783,66.581036939458"
                    Point2="-95.2904753535783,66.581036939458"
                    Point3="-95.2904753535783,70.581036939458" />
                  <mssgle:LineSegment
                    End="-95.2904753535783,157.445097172657" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 1]"
          TopLeft="402.695236791235,435.63725422416">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="70.3761934247974,165.48627345449"
              Start="0,0"
              End="70.3761934247974,157.98627345449">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,62.7994858574866" />
                  <mssgle:CubicBezierSegment
                    Point1="0,62.7994858574866"
                    Point2="0,66.7994858574866"
                    Point3="4,66.7994858574866" />
                  <mssgle:LineSegment
                    End="66.3761934247974,66.7994858574866" />
                  <mssgle:CubicBezierSegment
                    Point1="66.3761934247974,66.7994858574866"
                    Point2="70.3761934247974,66.7994858574866"
                    Point3="70.3761934247974,70.7994858574866" />
                  <mssgle:LineSegment
                    End="70.3761934247974,157.98627345449" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="19.9467490561487,71.7994858574866,30.4826953125,9.7490234375"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 2]"
          TopLeft="369.271428172442,142.535294143386">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="-8.74285804787399,32.1019600807736"
              Start="0,0"
              End="-8.74285804787399,24.6019600807736">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,12.0509800403868" />
                  <mssgle:CubicBezierSegment
                    Point1="0,12.0509800403868"
                    Point2="0,16.0509800403868"
                    Point3="-4,16.0509800403868" />
                  <mssgle:LineSegment
                    End="-4.74285804787399,16.0509800403868" />
                  <mssgle:CubicBezierSegment
                    Point1="-4.74285804787399,16.0509800403868"
                    Point2="-8.74285804787399,16.0509800403868"
                    Point3="-8.74285804787399,20.0509800403868" />
                  <mssgle:LineSegment
                    End="-8.74285804787399,24.6019600807736" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 3]"
          TopLeft="259.271428172442,28.1352941433863">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,41"
              Start="0,0"
              End="-7.5,41">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="-18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="-18.5,0"
                    Point2="-22.5,0"
                    Point3="-22.5,4" />
                  <mssgle:LineSegment
                    End="-22.5,37" />
                  <mssgle:CubicBezierSegment
                    Point1="-22.5,37"
                    Point2="-22.5,41"
                    Point3="-18.5,41" />
                  <mssgle:LineSegment
                    End="-7.5,41" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 4]"
          TopLeft="259.271428172442,80.3352941433863">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,41"
              Start="0,0"
              End="-7.5,41">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="-18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="-18.5,0"
                    Point2="-22.5,0"
                    Point3="-22.5,4" />
                  <mssgle:LineSegment
                    End="-22.5,37" />
                  <mssgle:CubicBezierSegment
                    Point1="-22.5,37"
                    Point2="-22.5,41"
                    Point3="-18.5,41" />
                  <mssgle:LineSegment
                    End="-7.5,41" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
  <DtsEventHandler
    design-time-name="Package.EventHandlers[OnError]">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="150.4,41.6"
          Id="{22E601B2-DE8F-4F06-A5D6-5783ECD2950C}"
          TopLeft="313.6,160.8" />
      </GraphLayout>
    </LayoutInfo>
  </DtsEventHandler>
  <TaskHost
    design-time-name="Package\Load StagingPPassVisits">
    <LayoutInfo>
      <GraphLayout
        Capacity="8" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgm="clr-namespace:Microsoft.SqlServer.Graph.Model;assembly=Microsoft.SqlServer.Graph">
        <NodeLayout
          Size="220,42"
          Id="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits"
          TopLeft="265.714290239373,60.4705884326288" />
        <NodeLayout
          Size="171,42"
          Id="Package\Load StagingPPassVisits\OLE DB Destination"
          TopLeft="291.57142858116,227" />
        <NodeLayout
          Size="220,42"
          Id="Package\Load StagingPPassVisits\Derived Column"
          TopLeft="265.714290239373,108.082353147091" />
        <NodeLayout
          Size="220,42"
          Id="Package\Load StagingPPassVisits\Row Count"
          TopLeft="265.714290239373,155.082353147091" />
        <EdgeLayout
          Id="Package\Load StagingPPassVisits.Paths[Row Count Output 1]"
          TopLeft="376.442859410266,196.682353147091">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,30.317646852909"
              Start="0,0"
              End="0,22.817646852909">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,22.817646852909" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0,0,0,0"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Load StagingPPassVisits.Paths[OLE DB Source Output]"
          TopLeft="265.714290239373,81.2705884326288">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,42.0117647144622"
              Start="0,0"
              End="-7.5,42.0117647144622">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="-18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="-18.5,0"
                    Point2="-22.5,0"
                    Point3="-22.5,4" />
                  <mssgle:LineSegment
                    End="-22.5,38.0117647144622" />
                  <mssgle:CubicBezierSegment
                    Point1="-22.5,38.0117647144622"
                    Point2="-22.5,42.0117647144622"
                    Point3="-18.5,42.0117647144622" />
                  <mssgle:LineSegment
                    End="-7.5,42.0117647144622" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0,0,0,0"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Load StagingPPassVisits.Paths[Derived Column Output]"
          TopLeft="265.714290239373,134.749019813758">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,35.6666666666667"
              Start="0,0"
              End="-7.5,35.6666666666667">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="-18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="-18.5,0"
                    Point2="-22.5,0"
                    Point3="-22.5,4" />
                  <mssgle:LineSegment
                    End="-22.5,31.6666666666667" />
                  <mssgle:CubicBezierSegment
                    Point1="-22.5,31.6666666666667"
                    Point2="-22.5,35.6666666666667"
                    Point3="-18.5,35.6666666666667" />
                  <mssgle:LineSegment
                    End="-7.5,35.6666666666667" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0,0,0,0"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </TaskHost>
  <PipelineComponentMetadata
    design-time-name="Package\Load StagingPPassVisits\OLE_SRC Ppass Visits">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <PipelineComponentMetadata
    design-time-name="Package\Load StagingPPassVisits\OLE DB Destination">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
      <Property>
        <Name>TableInfoObjectType</Name>
        <Value
          type="q2:string">Table</Value>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <TaskHost
    design-time-name="Package\Sequence Container\Load StagingPPassVisits">
    <LayoutInfo>
      <GraphLayout
        Capacity="8" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgm="clr-namespace:Microsoft.SqlServer.Graph.Model;assembly=Microsoft.SqlServer.Graph">
        <NodeLayout
          Size="220,42"
          Id="Package\Sequence Container\Load StagingPPassVisits\Row Count"
          TopLeft="265.714290239373,155.082353147091" />
        <NodeLayout
          Size="220,42"
          Id="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits"
          TopLeft="265.714290239373,60.4705884326288" />
        <NodeLayout
          Size="171,42"
          Id="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination"
          TopLeft="279,221" />
        <NodeLayout
          Size="220,42"
          Id="Package\Sequence Container\Load StagingPPassVisits\Derived Column"
          TopLeft="265.714290239373,108.082353147091" />
        <EdgeLayout
          Id="Package\Sequence Container\Load StagingPPassVisits.Paths[Row Count Output 1]"
          TopLeft="375.714290239373,197.082353147091">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="-11.214290239373,23.917646852909"
              Start="0,0"
              End="-11.214290239373,16.417646852909">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,7.9588234264545" />
                  <mssgle:CubicBezierSegment
                    Point1="0,7.9588234264545"
                    Point2="0,11.9588234264545"
                    Point3="-4,11.9588234264545" />
                  <mssgle:LineSegment
                    End="-7.21429023937299,11.9588234264545" />
                  <mssgle:CubicBezierSegment
                    Point1="-7.21429023937299,11.9588234264545"
                    Point2="-11.214290239373,11.9588234264545"
                    Point3="-11.214290239373,15.9588234264545" />
                  <mssgle:LineSegment
                    End="-11.214290239373,16.417646852909" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0,0,0,0"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container\Load StagingPPassVisits.Paths[OLE DB Source Output]"
          TopLeft="265.714290239373,81.2705884326288">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,42.0117647144622"
              Start="0,0"
              End="-7.5,42.0117647144622">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="-18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="-18.5,0"
                    Point2="-22.5,0"
                    Point3="-22.5,4" />
                  <mssgle:LineSegment
                    End="-22.5,38.0117647144622" />
                  <mssgle:CubicBezierSegment
                    Point1="-22.5,38.0117647144622"
                    Point2="-22.5,42.0117647144622"
                    Point3="-18.5,42.0117647144622" />
                  <mssgle:LineSegment
                    End="-7.5,42.0117647144622" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0,0,0,0"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container\Load StagingPPassVisits.Paths[Derived Column Output]"
          TopLeft="265.714290239373,134.749019813758">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,35.6666666666667"
              Start="0,0"
              End="-7.5,35.6666666666667">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="-18.5,0" />
                  <mssgle:CubicBezierSegment
                    Point1="-18.5,0"
                    Point2="-22.5,0"
                    Point3="-22.5,4" />
                  <mssgle:LineSegment
                    End="-22.5,31.6666666666667" />
                  <mssgle:CubicBezierSegment
                    Point1="-22.5,31.6666666666667"
                    Point2="-22.5,35.6666666666667"
                    Point3="-18.5,35.6666666666667" />
                  <mssgle:LineSegment
                    End="-7.5,35.6666666666667" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0,0,0,0"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </TaskHost>
  <PipelineComponentMetadata
    design-time-name="Package\Sequence Container\Load StagingPPassVisits\OLE_SRC Ppass Visits">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
      <Property>
        <Name>TableInfoObjectType</Name>
        <Value
          type="q2:string">Table</Value>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
  <PipelineComponentMetadata
    design-time-name="Package\Sequence Container\Load StagingPPassVisits\OLE DB Destination">
    <Properties>
      <Property>
        <Name>DataSourceViewID</Name>
      </Property>
      <Property>
        <Name>TableInfoObjectType</Name>
        <Value
          type="q2:string">Table</Value>
      </Property>
    </Properties>
  </PipelineComponentMetadata>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>