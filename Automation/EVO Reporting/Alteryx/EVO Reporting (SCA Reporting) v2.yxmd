<?xml version="1.0"?>
<AlteryxDocument yxmdVer="2022.1">
  <Nodes>
    <Node ToolID="57">
      <GuiSettings Plugin="AlteryxGuiToolkit.ToolContainer.ToolContainer">
        <Position x="80" y="839" width="2078" height="531" />
      </GuiSettings>
      <Properties>
        <Configuration>
          <Caption>Tableau Push</Caption>
          <Style TextColor="#314c4a" FillColor="#ecf2f2" BorderColor="#314c4a" Transparency="25" Margin="25" />
          <Disabled value="False" />
          <Folded value="False" />
        </Configuration>
        <Annotation DisplayMode="0">
          <Name />
          <DefaultAnnotationText />
          <Left value="False" />
        </Annotation>
      </Properties>
      <ChildNodes>
        <Node ToolID="39">
          <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileInput.DbFileInput">
            <Position x="105" y="910" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Passwords />
              <CachedCosmeticName>VisionBI Live</CachedCosmeticName>
              <File FileFormat="23" RecordLimit="">aka:5f15b4b10b05360e6c4ed360|||select * FROM cms.source.tblCmsDeals WHERE deal_status='Active'</File>
              <FormatSpecificOptions>
                <SingleRowFetch>False</SingleRowFetch>
                <ReadCentroids>False</ReadCentroids>
                <TableStyle>Quoted</TableStyle>
                <CacheData>False</CacheData>
                <SessionReadOnly>True</SessionReadOnly>
                <ReadUncommitted>False</ReadUncommitted>
                <NoProgress>True</NoProgress>
                <PostSQL />
                <PreSQLOnConfig>True</PreSQLOnConfig>
                <PreSQL />
              </FormatSpecificOptions>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>aka:VisionBI Live
Query=select * FROM cms.source.tbl...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
            <Dependencies>
              <Implicit />
            </Dependencies>
            <MetaInfo connection="Output">
              <RecordInfo>
                <Field name="client_name" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="source_code" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="prefix" size="25" source="File: VisionBI Live" type="V_WString" />
                <Field name="ica" size="12" source="File: VisionBI Live" type="V_WString" />
                <Field name="reporting_ica" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="bin" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="group_code" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="issuer_name" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="clean_issuer_name" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="country_of_issue_iso" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="country_of_issue" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="cg_region_of_issue" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="client_region_of_issue" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="client_sub_region_of_issue" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="lounge_programme" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="model" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="deal_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="deal_status" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="deal_start_date" source="File: VisionBI Live" type="DateTime" />
                <Field name="deal_cancellation_date" source="File: VisionBI Live" type="DateTime" />
                <Field name="client_service_centre" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="contract_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="card_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="membership_fee_currency" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="membership_fee" scale="2" size="13" source="File: VisionBI Live" type="FixedDecimal" />
                <Field name="selected_non_selected" source="File: VisionBI Live" type="Int16" />
                <Field name="po_charge_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="billing_inclusion_lounge_visits" source="File: VisionBI Live" type="Int16" />
                <Field name="billing_inclusion_memberships" source="File: VisionBI Live" type="Int16" />
                <Field name="decline" source="File: VisionBI Live" type="Int16" />
                <Field name="bid" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="lounge_set_selected" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="lv_report_credit_card_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="consolidated_report" source="File: VisionBI Live" type="Int16" />
                <Field name="currency" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="created_dt" source="File: VisionBI Live" type="DateTime" />
              </RecordInfo>
            </MetaInfo>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileInput" />
        </Node>
        <Node ToolID="40">
          <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileInput.DbFileInput">
            <Position x="109" y="1035" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Passwords />
              <CachedCosmeticName>CDE OPS (PPASS)</CachedCosmeticName>
              <File FileFormat="23" RecordLimit="">aka:630f3be88a20878940976291|||/*
Formatting terminated on error: Unclosed case statement.
*/

SELECT T1.id,
       T1.transaction_type,
       T1.transaction_initiated_by,
       CASE
           WHEN T1.description = 'LK MIT payment' THEN
               'LK Visit MIT'
           WHEN T1.description = 'LK Visit' THEN
               'LK Visit CIT'
           WHEN T1.description = 'LKVisit' THEN
               'LK Visit CIT'
           ELSE
               T1.description
       END AS description,
       T1.currency,
       T1.amount,
       T1.transaction_state,
       T1.transaction_created_date,
       T1.consumer_id,
       T1.response_payload_error_code,
       T1.response_payload_error_code_description,
       T1.Ppass_source_code,
       T1.transaction_Source_code,
       T1.[denied_delivery/delivery_date_utc],
       T1.[Consumer Name],
       T1.[Consumer number],
       T1.[Payments Order number],
       T1.error_code,
       T1.IsDelivery,
       T1.Product,
       T1.[Visit ID],
       T1.[Device ID],
       T1.Date,
       T1.Time,
       T1.lounge_code,
       T1.country_code,
       T1.[Source C],
       T1.[Order Ref],
       T1.[Consumer No],
       T1.scaEnabled,
       T1.paymentCardVerificationDuringConsumption,
       T1.PilotWave,
       T1.LoadedDate,
       T1.[Finance status],
       T1._userJourneyCode,
       CASE
           WHEN ISNULL(T1.description, '') LIKE '%sub%'
                AND ISNULL(T1.[Consumer No], '') = '' THEN
               ''
           WHEN T1.Event = 'Visit'
                AND DATEDIFF(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &lt;= 2
                AND ISNULL(T1.NextErrorCode1, '') NOT IN ( 796, 764 ) THEN
               'Not Last Transaction'
           WHEN T1.Event = 'Visit'
                AND DATEDIFF(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &lt;= 2
                AND ISNULL(T1.NextErrorCode1, '') NOT IN ( 796, 764 ) THEN
               'Last Transaction'
           WHEN T1.Event = 'Visit'
                AND DATEDIFF(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &lt;= 2
                AND ISNULL(T1.NextErrorCode1, '') NOT IN ( 796, 764 ) THEN
               'Last Transaction'
           WHEN T1.Event = 'Visit'
                AND DATEDIFF(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &lt;= 2
                AND ISNULL(T1.NextErrorCode1, '') IN ( 796, 764 )
                AND T1.row1# IN ( 1, 2 ) THEN
               'Last Transaction'
           WHEN T1.Event = 'Visit'
                AND ((ISNULL(T1.[Lounge Code], '') != ISNULL(T1.NextLoungeCode, '')))
                AND DATEDIFF(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) IS NULL THEN
               'Last Transaction'
           WHEN T1.Event = 'Visit'
                AND ((ISNULL(T1.[Lounge Code], '') != ISNULL(T1.NextLoungeCode, '')))
                AND DATEDIFF(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &gt; 2 THEN
               'Last Transaction'
           WHEN ISNULL(T1.description, '') LIKE '%sub%'
                AND ISNULL(T1.[Consumer No], '') &lt;&gt; ''
                AND T1.row1# &gt; 1
                AND ISNULL(T1.error_code, '') IN ( 796, 764 ) THEN
               ''
           WHEN ISNULL(T1.description, '') LIKE '%sub%'
                AND ISNULL(T1.[Consumer No], '') &lt;&gt; ''
                AND T1.row1# &gt; 1
                AND ISNULL(T1.error_code, '') NOT IN ( 796, 764 ) THEN
               'Not Last Transaction'
           WHEN ISNULL(T1.description, '') LIKE '%sub%'
                AND ISNULL(T1.[Consumer No], '') &lt;&gt; ''
                AND T1.row1# = 1
                AND ISNULL(T1.error_code, '') IN ( 796, 764 ) THEN
               ''
           WHEN ISNULL(T1.description, '') LIKE '%sub%'
                AND ISNULL(T1.[Consumer No], '') &lt;&gt; ''
                AND T1.row1# = 1
                AND ISNULL(T1.error_code, '') NOT IN ( 796, 764 ) THEN
               'Last Transaction'
           WHEN T1.row1# &gt; 1
                AND ISNULL(T1.error_code, '') IN ( 796, 764 ) THEN
               ''
           WHEN T1.row1# &gt; 1
                AND ISNULL(T1.error_code, '') NOT IN ( 796, 764 ) THEN
               'Not Last Transaction'
           WHEN T1.row1# = 1
                AND ISNULL(T1.error_code, '') IN ( 796, 764 ) THEN
               ''
           WHEN T1.row1# = 1
                AND ISNULL(T1.error_code, '') NOT IN ( 796, 764 ) THEN
               'Last Transaction'
       END AS [Last Transaction],
       CASE
           WHEN ISNULL(T1.error_code, '') = '710' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '711' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '712' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '726' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '727' THEN
               'VALID DECLINE - Contact Issuer'
           WHEN ISNULL(T1.error_code, '') = '729' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '731' THEN
               'SYSTEM ERROR - Already Voided'
           WHEN ISNULL(T1.error_code, '') = '733' THEN
               'SYSTEM ERROR - Please Try Again'
           WHEN ISNULL(T1.error_code, '') = '734' THEN
               'SYSTEM ERROR - Please Try Again'
           WHEN ISNULL(T1.error_code, '') = '740' THEN
               'VALID DECLINE - Contact Issuer'
           WHEN ISNULL(T1.error_code, '') = '741' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '743' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '744' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '751' THEN
               'VALID DECLINE - Contact Issuer'
           WHEN ISNULL(T1.error_code, '') = '753' THEN
               'VALID DECLINE - Payment Card Expired'
           WHEN ISNULL(T1.error_code, '') = '757' THEN
               'VALID DECLINE - Contact Issuer'
           WHEN ISNULL(T1.error_code, '') = '760' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '761' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '763' THEN
               'SYSTEM ERROR - TBC'
           WHEN ISNULL(T1.error_code, '') = '764' THEN
               'SYSTEM ERROR - TBC'
           WHEN ISNULL(T1.error_code, '') = '780' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '782' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '781' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '783' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '784' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '790' THEN
               'SYSTEM ERROR - Please Try Again'
           WHEN ISNULL(T1.error_code, '') = '791' THEN
               'SYSTEM ERROR - Please Try Again'
           WHEN ISNULL(T1.error_code, '') = '792' THEN
               'SYSTEM ERROR - Please Try Again'
           WHEN ISNULL(T1.error_code, '') = '793' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '796' THEN
               'SYSTEM ERROR - Emergency Manual Process'
           WHEN ISNULL(T1.error_code, '') = '942' THEN
               'ABANDONED: Authorise Visit Screen'
           WHEN ISNULL(T1.error_code, '') = '943' THEN
               'ABANDONED: 3DS Regulations'
           WHEN ISNULL(T1.error_code, '') = '944' THEN
               'ABANDONED: 3DS Member Consent'
           WHEN ISNULL(T1.error_code, '') = '945' THEN
               'ABANDONED: 3DS Payment Screen'
           WHEN ISNULL(T1.error_code, '') = '946' THEN
               'ABANDONED: 3DS Billing Address'
           WHEN ISNULL(T1.error_code, '') = '947' THEN
               'ABANDONED: 3DS Challenge'
           WHEN ISNULL(T1.error_code, '') LIKE '9%' THEN
               'ABANDONED: Screen TBC'
		   ----Requested as a part of OPSBI-220
           --WHEN T1.Event = 'Update Card'
           --     AND ISNULL(T1.transaction_state, '') = 'CREATED'
           --     AND ISNULL(T1.transaction_initiated_by, '') = 'CIT' THEN
           --    'Abandoned'
           --WHEN T1.Event = 'Update Card'
           --     AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
           --     AND ISNULL(T1.transaction_initiated_by, '') = 'CIT' THEN
           --    'Success with SCA PreAuth'
           --WHEN T1.Event = 'Update Card' THEN
           --    'Not Determined'
		   ----Requested as a part of OPSBI-220
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%'
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success No Payment'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = '942'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '942' THEN
               'Abandoned Before Transaction'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND T1.Event = 'Visit' THEN
               'Investigate - No Delivery'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Invalid Visit'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '942'
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%' THEN
               'Abandoned Pre Payment'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%' THEN
               'Investigate - No Delivery'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%' THEN
               'Success No Payment'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%' THEN
               'Invalid Visit'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '942'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Abandoned Before Transaction'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND T1.Event = 'Visit' THEN
               'Investigate - No Delivery'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') &lt;&gt; ''
                AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Invalid Visit'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND T1.Event = 'Visit' THEN
               'Abandoned Before Transaction'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '942'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used'
           WHEN ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Abandoned During payment'
           WHEN ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND T1.Event = 'Visit' THEN
               'Investigate - No Delivery'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used'
           WHEN ISNULL(T1.transaction_state, '') = 'CREATED' THEN
               'Abandoned'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used'
           WHEN ISNULL(T1.transaction_state, '') = 'REFUNDED' THEN
               'Refunded'
           WHEN ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'SENT_FOR_AUTHORISATION'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Abandoned During Payment'
           WHEN ISNULL(T1.transaction_state, '') = 'SENT_FOR_VERIFICATION'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y' THEN
               'Abandoned Pre Payment'
           WHEN ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND T1.Event = 'Visit' THEN
               'Abandoned Pre Payment'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Authentication requested'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Authentication Requested'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Authorization System or issuer system inoperative'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Authorization System or issuer system inoperative'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CARD BLOCKED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - CARD BLOCKED'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CONTACT CARD ISSUER'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - CONTACT CARD ISSUER'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CREDITCARD ISSUER TEMPORARILY NOT REACHABLE'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - CREDITCARD ISSUER TEMPORARILY NOT REACHABLE'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Do not honour'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Do not honour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Expired card'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Expired card'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'FRAUD SUSPICION'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - FRAUD SUSPICION'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID ACCOUNT'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID ACCOUNT'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID SECURITY CODE'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decine - INVALID SECURITY CODE'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID TRANSACTION'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID TRANSACTION'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Issuer unavailable or switch inoperative (STIP not applicable or available for this transaction)'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Issuer Unavailable or Inoperative'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'LIMIT EXCEEDED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - LIMIT EXCEEDED'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Capture card'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Capture card'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CARD EXPIRED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - CARD EXPIRED'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'DECLINED, EXPIRED CARD'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - DECLINED, EXPIRED CARD'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'ILLEGAL TRANSACTION'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - ILLEGAL TRANSACTION'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID ACCEPTOR'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID ACCEPTOR'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID CARD ISSUER'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID CARD ISSUER'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Invalid PIN'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Invalid PIN'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'REJECTED BY CARD ISSUER'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - REJECTED BY CARD ISSUER'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Refer to card issuer'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Refer to card issuer'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'REFUSED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - REFUSED'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'RESTRICTED CARD'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - RESTRICTED CARD'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'STOLEN CARD, PICK UP'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - STOLEN CARD, PICK UP'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Try another card'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Try another card'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'UNKNOWN CARD'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline  - UNKNOWN CARD'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.IsDelivery, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.IsDelivery, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success COF used PreAuth'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.IsDelivery, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success with SCA'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.IsDelivery, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success with SCA PreAuth'
       END AS Outcome,
       CASE
           WHEN ISNULL(T1.error_code, '') = '710' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '711' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '712' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '726' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '727' THEN
               'VALID DECLINE - Contact Issuer'
           WHEN ISNULL(T1.error_code, '') = '729' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '731' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '733' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '734' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '740' THEN
               'VALID DECLINE - Contact Issuer'
           WHEN ISNULL(T1.error_code, '') = '741' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '743' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '744' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '751' THEN
               'VALID DECLINE - Contact Issuer'
           WHEN ISNULL(T1.error_code, '') = '753' THEN
               'VALID DECLINE - Payment Card Expired'
           WHEN ISNULL(T1.error_code, '') = '757' THEN
               'VALID DECLINE - Contact Issuer'
           WHEN ISNULL(T1.error_code, '') = '760' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '761' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '763' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '764' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '780' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '782' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '781' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '783' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '784' THEN
               'VALID DECLINE - Not eligible for inventory item.'
           WHEN ISNULL(T1.error_code, '') = '790' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '791' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '792' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '793' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '796' THEN
               'System Error'
           WHEN ISNULL(T1.error_code, '') = '942' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '943' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '944' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '945' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '946' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '947' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') LIKE '9%' THEN
               'Abandoned'
		   ----Requested as a part of OPSBI-220
           --WHEN T1.Event = 'Update Card'
           --     AND ISNULL(T1.transaction_state, '') = 'CREATED'
           --     AND ISNULL(T1.transaction_initiated_by, '') = 'CIT' THEN
           --    'Abandoned'
           --WHEN T1.Event = 'Update Card'
           --     AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
           --     AND ISNULL(T1.transaction_initiated_by, '') = 'CIT' THEN
           --    'Success'
           --WHEN T1.Event = 'Update Card' THEN
           --    'Not Determined'
		   ----Requested as a part of OPSBI-220
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND T1.transaction_initiated_by = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND T1.transaction_initiated_by = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%'
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = '942'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = ''
                AND
                (
                    T1.Event = 'Registration'
                    OR T1.Event = 'Renewal'
                ) THEN
               'Success'
           WHEN ISNULL(T1.transaction_state, '') = 'Captured'
                AND ISNULL(T1.IsDelivery, '') = ''
                AND
                (
                    T1.Event = 'Registration'
                    OR T1.Event = 'Renewal'
                ) THEN
               'Success'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '942' THEN
               'Abandoned'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND T1.Event = 'Visit' THEN
               'Investigate - No Delivery'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Invalid Visit'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND T1.transaction_initiated_by = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND T1.transaction_initiated_by = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '942'
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%' THEN
               'Abandoned'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%' THEN
               'Investigate - No Delivery'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%' THEN
               'Success'
           WHEN ISNULL(T1.transaction_initiated_by, '') = ''
                AND ISNULL(T1.transaction_state, '') = ''
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') = ''
                AND ISNULL(T1.description, '') LIKE '%No Authentication%' THEN
               'Invalid Visit'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '942'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Abandoned'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND T1.Event = 'Visit' THEN
               'Investigate - No Delivery'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') &lt;&gt; ''
                AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Invalid Visit'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND T1.Event = 'Visit' THEN
               'Abandoned'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '942'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success COF used'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND
                (
                    ISNULL(T1.error_code, '') &lt;&gt; ''
                    AND ISNULL(T1.error_code, '') &lt;&gt; '942'
                )
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Abandoned'
           WHEN ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND T1.Event = 'Visit' THEN
               'Investigate - No Delivery'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.transaction_state, '') = 'CREATED' THEN
               'Abandoned'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.transaction_state, '') = 'REFUNDED' THEN
               'Refunded'
           WHEN ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'SENT_FOR_AUTHORISATION'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Abandoned'
           WHEN ISNULL(T1.transaction_state, '') = 'SENT_FOR_VERIFICATION'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y' THEN
               'Abandoned'
           WHEN ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND T1.Event = 'Visit' THEN
               'Abandoned'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Authentication requested'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Authentication Requested'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Authorization System or issuer system inoperative'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Authorization System or issuer system inoperative'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CARD BLOCKED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - CARD BLOCKED'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CONTACT CARD ISSUER'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - CONTACT CARD ISSUER'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CREDITCARD ISSUER TEMPORARILY NOT REACHABLE'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - CREDITCARD ISSUER TEMPORARILY NOT REACHABLE'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Do not honour'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Do not honour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Expired card'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Expired card'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'FRAUD SUSPICION'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - FRAUD SUSPICION'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID ACCOUNT'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID ACCOUNT'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID SECURITY CODE'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID SECURITY CODE'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID TRANSACTION'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID TRANSACTION'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Issuer unavailable or switch inoperative (STIP not applicable or available for this transaction)'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Issuer Unavailable or Inoperative'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'LIMIT EXCEEDED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - LIMIT EXCEEDED'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Refer to card issuer'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Refer to card issuer'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'REFUSED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - REFUSED'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'RESTRICTED CARD'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - RESTRICTED CARD'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'STOLEN CARD, PICK UP'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - STOLEN CARD, PICK UP'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Try another card'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Try another card'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'UNKNOWN CARD'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline  - UNKNOWN CARD'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; '' THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.IsDelivery, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'MIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.IsDelivery, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &gt; 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.IsDelivery, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success'
           WHEN ISNULL(T1.amount, 0) &lt;= 4
                AND ISNULL(T1.transaction_initiated_by, '') = 'CIT'
                AND ISNULL(T1.transaction_state, '') IN ( 'CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED' )
                AND ISNULL(T1.IsDelivery, '') = ''
                AND ISNULL(T1.error_code, '') = ''
                AND ISNULL(T1.[Order Ref], '') &lt;&gt; ''
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Success'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Capture card'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Capture card'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CARD EXPIRED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - CARD EXPIRED'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'DECLINED, EXPIRED CARD'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - DECLINED, EXPIRED CARD'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'ILLEGAL TRANSACTION'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - ILLEGAL TRANSACTION'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID ACCEPTOR'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID ACCEPTOR'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID CARD ISSUER'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - INVALID CARD ISSUER'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Invalid PIN'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - Invalid PIN'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'REJECTED BY CARD ISSUER'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Valid Decline - REJECTED BY CARD ISSUER'
       END AS [Summary Status],
       CASE
           WHEN ISNULL(T1.error_code, '') = '942' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '943' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '944' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '945' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '946' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '947' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') LIKE '9%' THEN
               'Abandoned'
           WHEN ISNULL(T1.error_code, '') = '780' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.error_code, '') = '782' THEN
               'Expected Behaviour'
		   ----Requested as a part of OPSBI-220
           --WHEN T1.Event = 'Update Card'
           --     AND ISNULL(T1.transaction_state, '') = 'CREATED'
           --     AND ISNULL(T1.transaction_initiated_by, '') = 'CIT' THEN
           --    'Abandoned'
           --WHEN T1.Event = 'Update Card'
           --     AND ISNULL(T1.transaction_state, '') = 'VERIFIED'
           --     AND ISNULL(T1.transaction_initiated_by, '') = 'CIT' THEN
           --    'Expected Behaviour'
           --WHEN T1.Event = 'Update Card' THEN
           --    'Not Determined'
		   ----Requested as a part of OPSBI-220
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND
                (
                    T1.Event = 'Registration'
                    OR T1.Event = 'Renewal'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'Captured'
                AND
                (
                    T1.Event = 'Registration'
                    OR T1.Event = 'Renewal'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND T1.Event = 'Visit'
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.[Product Type], '') IN ( 'PP-Retail', 'PP-Affinity' ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = ''
                AND
                (
                    T1.Event = 'Registration'
                    OR T1.Event = 'Renewal'
                ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'Captured'
                AND ISNULL(T1.IsDelivery, '') = ''
                AND
                (
                    T1.Event = 'Registration'
                    OR T1.Event = 'Renewal'
                ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'AUTHORISED'
                AND ISNULL(T1.IsDelivery, '') = 'Y' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND T1.Event = 'Visit' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                ) THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'CANCELLED'
                AND ISNULL(T1.IsDelivery, '') = 'Y' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'CREATED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'PARTIALLY_CAPTURED'
                AND ISNULL(T1.IsDelivery, '') = 'Y' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'REFUNDED'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'SENT_FOR_AUTHORISATION'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'SENT_FOR_VERIFICATION'
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND
                (
                    T1.Event = 'Renewal'
                    OR T1.Event = 'Registration'
                )
                AND ISNULL(T1.IsDelivery, '') = '' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND T1.Event = 'Visit'
                AND
                (
                    ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                    OR ISNULL(T1.IsDelivery, '') = ''
                ) THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'VERIFIED'
                AND ISNULL(T1.IsDelivery, '') = 'Y' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') &lt;&gt; '' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') &lt;&gt; 'Y'
                AND ISNULL(T1.error_code, '') = '' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = ''
                AND ISNULL(T1.IsDelivery, '') = 'Y' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'Authentication requested' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'Authorization System or issuer system inoperative' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'CARD BLOCKED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'CONTACT CARD ISSUER' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'CREDITCARD ISSUER TEMPORARILY NOT REACHABLE' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'Do not honour' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'Expired card' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'FRAUD SUSPICION' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'INVALID ACCOUNT' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'INVALID SECURITY CODE' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'INVALID TRANSACTION' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'Issuer unavailable or switch inoperative (STIP not applicable or available for this transaction)' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'LIMIT EXCEEDED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'Refer to card issuer' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'REFUSED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'RESTRICTED CARD' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'STOLEN CARD, PICK UP' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'Try another card' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.transaction_state, '') = 'DECLINED'
                AND ISNULL(T1.response_payload_error_code_description, '') = 'UNKNOWN CARD' THEN
               'Unexpected Behaviour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Capture card'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'CARD EXPIRED'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'DECLINED, EXPIRED CARD'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'ILLEGAL TRANSACTION'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID ACCEPTOR'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'INVALID CARD ISSUER'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'Invalid PIN'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Expected Behaviour'
           WHEN ISNULL(T1.response_payload_error_code_description, '') = 'REJECTED BY CARD ISSUER'
                AND ISNULL(T1.transaction_state, '') = 'DECLINED' THEN
               'Expected Behaviour'
       END AS Status,
       T1.[User Journey Code],
       T1.[Flag for Source Code],
       T1.source_media,
       T1.owner_product,
       T1.source_desc,
       T1.[Product Type1],
       T1.Event,
       T1.PaymentType,
       ISNULL(T1.[Product Type1], '') + ' - ' + ISNULL(T1.Event, '') + ' - ' + ISNULL(T1.PaymentType, '') AS Category,
       T1.servicecentre,
       T1.row1#
FROM
(
    SELECT DATEDIFF(HOUR, T.CurrentVisitDate, T.NextVisitDate) AS [Diff in Hours],
           T.NextVisitDate AS NextVisitDate1,
           T.NextErrorCode AS NextErrorCode1,
           T.CurrentVisitDate AS CurrentVisitDate1,
           T.NextLoungeCode AS NextLoungeCode1,
           CASE
               WHEN T.[Visit ID] IS NULL THEN
                   1
               ELSE
                   ROW_NUMBER() OVER (PARTITION BY T.[Consumer No],
                                                   b.lounge_code,
                                                   CAST(T.Date AS DATE)
                                      ORDER BY T.Date DESC,
                                               T.Time DESC
                                     )
           END AS row#,
           ROW_NUMBER() OVER (PARTITION BY T.[Consumer No],
                                           CAST(T.Date AS DATE)
                              ORDER BY T.Date DESC,
                                       T.Time DESC
                             ) AS row1#,
           T.*,
           b.lounge_code,
           b.country_code,
           c.PilotWave,
           ptc.user_journey_title AS [User Journey Code],
           CASE
               WHEN
               (
                   ISNULL(T.error_code, '') = 764
                   OR ISNULL(T.error_code, '') = 796
               ) THEN
                   'Error - Do Not Count'
               WHEN UPPER(ISNULL(T.description, '')) = ''
                    AND ISNULL(ptc.user_journey_title, '') = ''
                    AND T.IsDelivery = 'N' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'REGISTER B2B MEMBER'
                    OR UPPER(ISNULL(T.description, '')) = 'REGISTER B2B MEMBER' THEN
                   'Visit'
			   ----CHANGE OPSBI-190----
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT IMPLICIT CIT'
                    OR UPPER(ISNULL(T.description, '')) = 'CONSUMPTION PAYMENT IMPLICIT CIT' THEN
                   'Visit'
               ----CHANGE OPSBI-190----
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'VALIDATE BANKCARD SIGNUP'
                    OR UPPER(ISNULL(T.description, '')) = 'VALIDATE BANKCARD SIGNUP' THEN
                   'Registration'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT EXPLICIT CARD ON FILE'
                    OR UPPER(ISNULL(T.description, '')) = 'CONSUMPTION PAYMENT EXPLICIT CARD ON FILE' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT CARD ON FILE'
                    OR UPPER(ISNULL(T.description, '')) = 'CONSUMPTION PAYMENT CARD ON FILE' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'CONVERT PROSPECT MEMBER'
                    OR UPPER(ISNULL(T.description, '')) = 'CONVERT PROSPECT MEMBER' THEN
                   'Registration'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT EXPLICIT CARD ON FILE'
                    OR UPPER(ISNULL(T.description, '')) = 'CONSUMPTION PAYMENT EXPLICIT CARD ON FILE' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'ADD ACCOUNT LINE FROM PAYMENT HISTORY'
                    OR UPPER(ISNULL(T.description, '')) = 'ADD ACCOUNT LINE FROM PAYMENT HISTORY' THEN
                   'Manually Entered Account Line'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'ADD NEW PAYMENT CARD'
                    OR UPPER(ISNULL(T.description, '')) = 'ADD NEW PAYMENT CARD' THEN
                   'Update Card'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'ADD PURCHASE UI'
                    OR UPPER(ISNULL(T.description, '')) = 'ADD PURCHASE UI' THEN
                   'Registration'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'ADD RETAIL MEMBER'
                    OR UPPER(ISNULL(T.description, '')) = 'ADD RETAIL MEMBER' THEN
                   'Registration'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'CONVERT PROSPECT MEMBER'
                    OR UPPER(ISNULL(T.description, '')) = 'CONVERT PROSPECT MEMBER' THEN
                   'Registration'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'DEVICE SWIPE VALIDATE VISIT'
                    OR UPPER(ISNULL(T.description, '')) = 'DEVICE SWIPE VALIDATE VISIT' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'DMC MANUAL VALIDATE VISIT'
                    OR UPPER(ISNULL(T.description, '')) = 'DMC MANUAL VALIDATE VISIT' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'DMC SCAN VALIDATE VISIT'
                    OR UPPER(ISNULL(T.description, '')) = 'DMC SCAN VALIDATE VISIT' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'LOUNGE VISIT LOAD'
                    OR UPPER(ISNULL(T.description, '')) = 'LOUNGE VISIT LOAD' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'MANUAL RENEWALS COF'
                    OR UPPER(ISNULL(T.description, '')) = 'MANUAL RENEWALS COF' THEN
                   'Renewal'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'MANUAL RENEWALS NEW CARD'
                    OR UPPER(ISNULL(T.description, '')) = 'MANUAL RENEWALS NEW CARD' THEN
                   'Renewal'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'MEMBERSHIP RENEWAL PROCESS'
                    OR UPPER(ISNULL(T.description, '')) = 'MEMBERSHIP RENEWAL PROCESS' THEN
                   'Renewal'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'NON BANKCARD DEVICE PINPAD'
                    OR UPPER(ISNULL(T.description, '')) = 'NON BANKCARD DEVICE PINPAD' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'NON BANKCARD DEVICE SWIPE'
                    OR UPPER(ISNULL(T.description, '')) = 'NON BANKCARD DEVICE SWIPE' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'NON BANKCARD DMC MANUAL'
                    OR UPPER(ISNULL(T.description, '')) = 'NON BANKCARD DMC MANUAL' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'NON BANKCARD DMC SCAN'
                    OR UPPER(ISNULL(T.description, '')) = 'NON BANKCARD DMC SCAN' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'NON BANKCARD PORTAL MANUAL'
                    OR UPPER(ISNULL(T.description, '')) = 'NON BANKCARD PORTAL MANUAL' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'OUTSTANDING PAYMENT COF'
                    OR UPPER(ISNULL(T.description, '')) = 'OUTSTANDING PAYMENT COF' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'OUTSTANDING PAYMENT NEW CARD'
                    OR UPPER(ISNULL(T.description, '')) = 'OUTSTANDING PAYMENT NEW CARD' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'OUTSTANDING PAYMENT NEW CARD STORE'
                    OR UPPER(ISNULL(T.description, '')) = 'OUTSTANDING PAYMENT NEW CARD STORE' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'REAL TIME VISIT'
                    OR UPPER(ISNULL(T.description, '')) = 'REAL TIME VISIT' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'RENEW PURCHASE USING EXISTING CARD ON FILE'
                    OR UPPER(ISNULL(T.description, '')) = 'RENEW PURCHASE USING EXISTING CARD ON FILE' THEN
                   'Renewal'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'UPDATE PAYMENT CARD FOR CONSUMPTION'
                    OR UPPER(ISNULL(T.description, '')) = 'UPDATE PAYMENT CARD FOR CONSUMPTION' THEN
                   'Update Card'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'UPDATE PAYMENT CARD FOR SUBSCRIPTION'
                    OR UPPER(ISNULL(T.description, '')) = 'UPDATE PAYMENT CARD FOR SUBSCRIPTION' THEN
                   'Update Card'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'DEVICE SWIPE VALIDATE VIST'
                    OR UPPER(ISNULL(T.description, '')) = 'DEVICE SWIPE VALIDATE VIST' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT IMPLICIT CARD ON FILE'
                    OR UPPER(ISNULL(T.description, '')) = 'CONSUMPTION PAYMENT IMPLICIT CARD ON FILE' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'RENEW PURCHASE USING NEW CARD'
                    OR UPPER(ISNULL(T.description, '')) = 'RENEW PURCHASE USING NEW CARD' THEN
                   'Renewal'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = 'ONE OFF OVERRIDE'
                    OR UPPER(ISNULL(T.description, '')) = 'ONE OFF OVERRIDE' THEN
                   'Visit'
               WHEN UPPER(ISNULL(T._userJourneyCode, '')) LIKE '%consumption_payment_oneoff_CIT%'
                    OR UPPER(ISNULL(T.description, '')) LIKE '%consumption_payment_oneoff_CIT%' THEN
                   'Visit'
               WHEN UPPER(ISNULL(T._userJourneyCode, '')) LIKE '%UPDATE_PROSPECT_MEMBER%'
                    OR UPPER(ISNULL(T.description, '')) LIKE '%UPDATE_PROSPECT_MEMBER%' THEN
                   'Update Card'
               WHEN UPPER(ISNULL(T._userJourneyCode, '')) LIKE '%UPDATE PROSPECT MEMBER%'
                    OR UPPER(ISNULL(T.description, '')) LIKE '%UPDATE PROSPECT MEMBER%' THEN
                   'Update Card'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = ''
                    AND ISNULL(T.IsDelivery, '') &lt;&gt; ''
                    AND ISNULL(T.[Visit ID], '') &lt;&gt; '' THEN
                   'Visit'
               WHEN UPPER(ISNULL(ptc.user_journey_title, '')) = ''
                    AND ISNULL(T.description, '') LIKE '%Subscription%' THEN
                   'Registration'
               ELSE
                   'Not Determined'
           END AS Event,
           CASE
               WHEN ISNULL(T.transaction_initiated_by, '') = 'CIT' THEN
                   'CIT'
               WHEN ISNULL(T.transaction_initiated_by, '') = 'MIT' THEN
                   'MIT'
               WHEN ISNULL(T.transaction_initiated_by, '') = ''
                    AND ISNULL(T.IsDelivery, '') &lt;&gt; ''
                    AND ISNULL(T.[Visit ID], '') &lt;&gt; ''
                    AND ISNULL(T.id, '') = '' THEN
                   'No Authentication'
           END AS PaymentType,
           CASE
               WHEN ISNULL(T.is_access_on_payment_card, 0) = 1
                    AND T.[Product Type] = 'PP-B2B' THEN
                   'PP-AOPC'
               WHEN ISNULL(T.is_access_on_payment_card, 0) = 0
                    AND T.[Product Type] = 'PP-B2B' THEN
                   'PP-NON-AOPC'
               ELSE
                   T.[Product Type]
           END AS [Product Type1]
    FROM
    (
        SELECT DISTINCT
               LEAD(COALESCE(a.transaction_created_date, a.[denied_delivery/delivery_date_utc])) OVER (PARTITION BY COALESCE(
                                                                                                                                a.consumer_id,
                                                                                                                                a.[Consumer number]
                                                                                                                            ),
                                                                                                                    CAST(COALESCE(
                                                                                                                                     a.transaction_created_date,
                                                                                                                                     a.[denied_delivery/delivery_date_utc]
                                                                                                                                 ) AS DATE)
                                                                                                       ORDER BY CAST(COALESCE(
                                                                                                                                 a.transaction_created_date,
                                                                                                                                 a.[denied_delivery/delivery_date_utc]
                                                                                                                             ) AS DATE),
                                                                                                                CONVERT(
                                                                                                                           VARCHAR,
                                                                                                                           CAST(COALESCE(
                                                                                                                                            a.transaction_created_date,
                                                                                                                                            a.[denied_delivery/delivery_date_utc]
                                                                                                                                        ) AS TIME),
                                                                                                                           108
                                                                                                                       )
                                                                                                      ) AS NextVisitDate,
               LEAD(a.error_code) OVER (PARTITION BY COALESCE(a.consumer_id, a.[Consumer number]),
                                                     CAST(COALESCE(
                                                                      a.transaction_created_date,
                                                                      a.[denied_delivery/delivery_date_utc]
                                                                  ) AS DATE)
                                        ORDER BY CAST(COALESCE(
                                                                  a.transaction_created_date,
                                                                  a.[denied_delivery/delivery_date_utc]
                                                              ) AS DATE),
                                                 CONVERT(
                                                            VARCHAR,
                                                            CAST(COALESCE(
                                                                             a.transaction_created_date,
                                                                             a.[denied_delivery/delivery_date_utc]
                                                                         ) AS TIME),
                                                            108
                                                        )
                                       ) AS NextErrorCode,
               COALESCE(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) AS CurrentVisitDate,
               LEAD(SUBSTRING(
                                 a.[Visit reference],
                                 1,
                                 CAST(REPLACE(
                                                 CHARINDEX(
                                                              SUBSTRING(
                                                                           REPLACE(
                                                                                      CONVERT(
                                                                                                 VARCHAR(10),
                                                                                                 CONVERT(
                                                                                                            DATE,
                                                                                                            COALESCE(
                                                                                                                        a.transaction_created_date,
                                                                                                                        a.[denied_delivery/delivery_date_utc]
                                                                                                                    ),
                                                                                                            111
                                                                                                        )
                                                                                             ),
                                                                                      '-',
                                                                                      ''
                                                                                  ),
                                                                           3,
                                                                           8
                                                                       ),
                                                              a.[Visit reference]
                                                          ) - 1,
                                                 -1,
                                                 3
                                             ) AS INT)
                             )
                   ) OVER (PARTITION BY COALESCE(a.consumer_id, a.[Consumer number]),
                                        CAST(COALESCE(
                                                         a.transaction_created_date,
                                                         a.[denied_delivery/delivery_date_utc]
                                                     ) AS DATE)
                           ORDER BY CAST(COALESCE(
                                                     a.transaction_created_date,
                                                     a.[denied_delivery/delivery_date_utc]
                                                 ) AS DATE),
                                    CONVERT(
                                               VARCHAR,
                                               CAST(COALESCE(
                                                                a.transaction_created_date,
                                                                a.[denied_delivery/delivery_date_utc]
                                                            ) AS TIME),
                                               108
                                           )
                          ) AS NextLoungeCode,
               a.id,
               a.transaction_type,
               a.transaction_initiated_by,
               CASE
                   WHEN ISNULL(s.owner_product, '') = 'LK'
                        AND ISNULL(a.IsDelivery, '') &lt;&gt; ''
                        AND ISNULL(a.description, '') = ''
                        AND ISNULL(a.[Visit reference], '') &lt;&gt; ''
                        AND ISNULL(a.id, '') = '' THEN
                       'LK Visit - No Authentication'
                   WHEN (
                            ISNULL(s.owner_product, '') = 'PP'
                            OR ISNULL(s.owner_product, '') = 'BC'
                        )
                        AND ISNULL(a.IsDelivery, '') &lt;&gt; ''
                        AND ISNULL(a.description, '') = ''
                        AND ISNULL(a.[Visit reference], '') &lt;&gt; ''
                        AND ISNULL(a.id, '') = '' THEN
                       'PP Visit - No Authentication'
                   ELSE
                       a.description
               END AS description,
               a.description AS description1,
               a.currency,
               a.amount,
               a.transaction_state,
               a.transaction_created_date,
               a.transaction_Source_code,
               a.consumer_id,
               a.response_payload_error_code,
               a.response_payload_error_code_description,
               a.Ppass_source_code,
               a.[denied_delivery/delivery_date_utc],
               a.[Consumer Name],
               a.[Consumer number],
               a.[Payments Order number],
               COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code) AS [Source C],
               CASE
                   WHEN a.transaction_Source_code &lt;&gt; a.[Source code] THEN
                       1
                   WHEN a.transaction_Source_code &lt;&gt; a.Ppass_source_code THEN
                       1
                   WHEN a.Ppass_source_code &lt;&gt; a.[Source code] THEN
                       1
                   ELSE
                       0
               END [Flag for Source Code],
               a.error_code,
               a.IsDelivery,
               a.Product,
               a.[payments.scaEnabled] AS scaEnabled,
               a.[Payments.paymentCardVerificationDuringConsumption] AS paymentCardVerificationDuringConsumption,
               CASE
                   WHEN ISNULL(a.[Visit reference], '') LIKE '%-%' THEN
                       LEFT(a.[Visit reference], CHARINDEX('-', a.[Visit reference]) - 1)
                   ELSE
                       ISNULL(a.[Visit reference], '')
               END AS [Visit ID],
               CASE
                   WHEN ISNULL(a.[Visit reference], '') LIKE '%-%' THEN
                       REPLACE(
                                  SUBSTRING(
                                               a.[Visit reference],
                                               CHARINDEX('-', a.[Visit reference]),
                                               LEN(a.[Visit reference])
                                           ),
                                  '-',
                                  ''
                              )
                   ELSE
                       ''
               END AS [Device ID],
               SUBSTRING(
                            a.[Visit reference],
                            0,
                            (CASE
                                 WHEN a.[Visit reference] LIKE '%'
                                                               + SUBSTRING(
                                                                              REPLACE(
                                                                                         CAST(COALESCE(
                                                                                                          a.transaction_created_date,
                                                                                                          a.[denied_delivery/delivery_date_utc]
                                                                                                      ) AS DATE),
                                                                                         '-',
                                                                                         ''
                                                                                     ),
                                                                              3,
                                                                              8
                                                                          ) + '%' THEN
                                     CHARINDEX(
                                                  SUBSTRING(
                                                               REPLACE(
                                                                          CAST(COALESCE(
                                                                                           a.transaction_created_date,
                                                                                           a.[denied_delivery/delivery_date_utc]
                                                                                       ) AS DATE),
                                                                          '-',
                                                                          ''
                                                                      ),
                                                               3,
                                                               8
                                                           ),
                                                  a.[Visit reference]
                                              )
                                 WHEN a.[Visit reference] LIKE '%'
                                                               + SUBSTRING(
                                                                              REPLACE(
                                                                                         DATEADD(
                                                                                                    dd,
                                                                                                    1,
                                                                                                    CAST(COALESCE(
                                                                                                                     a.transaction_created_date,
                                                                                                                     a.[denied_delivery/delivery_date_utc]
                                                                                                                 ) AS DATE)
                                                                                                ),
                                                                                         '-',
                                                                                         ''
                                                                                     ),
                                                                              3,
                                                                              8
                                                                          ) + '%' THEN
                                     CHARINDEX(
                                                  SUBSTRING(
                                                               REPLACE(
                                                                          DATEADD(
                                                                                     dd,
                                                                                     1,
                                                                                     CAST(COALESCE(
                                                                                                      a.transaction_created_date,
                                                                                                      a.[denied_delivery/delivery_date_utc]
                                                                                                  ) AS DATE)
                                                                                 ),
                                                                          '-',
                                                                          ''
                                                                      ),
                                                               3,
                                                               8
                                                           ),
                                                  a.[Visit reference]
                                              )
                                 WHEN a.[Visit reference] LIKE '%'
                                                               + SUBSTRING(
                                                                              REPLACE(
                                                                                         DATEADD(
                                                                                                    dd,
                                                                                                    -1,
                                                                                                    CAST(COALESCE(
                                                                                                                     a.transaction_created_date,
                                                                                                                     a.[denied_delivery/delivery_date_utc]
                                                                                                                 ) AS DATE)
                                                                                                ),
                                                                                         '-',
                                                                                         ''
                                                                                     ),
                                                                              3,
                                                                              8
                                                                          ) + '%' THEN
                                     CHARINDEX(
                                                  SUBSTRING(
                                                               REPLACE(
                                                                          DATEADD(
                                                                                     dd,
                                                                                     -1,
                                                                                     CAST(COALESCE(
                                                                                                      a.transaction_created_date,
                                                                                                      a.[denied_delivery/delivery_date_utc]
                                                                                                  ) AS DATE)
                                                                                 ),
                                                                          '-',
                                                                          ''
                                                                      ),
                                                               3,
                                                               8
                                                           ),
                                                  a.[Visit reference]
                                              )
                             END
                            )
                        ) AS [Lounge Code],
               CAST(COALESCE(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) AS DATE) AS Date,
               CONVERT(
                          VARCHAR,
                          CAST(COALESCE(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) AS TIME),
                          108
                      ) AS Time,
               CASE
                   WHEN a.transaction_initiated_by IN ( 'CIT', 'MIT' )
                        AND ISNULL(a.transaction_state, '') IN ( 'CAPTURED', 'CANCELLED', 'AUTHORISED' )
                        AND a.IsDelivery = 'Y' THEN
                       'Expected Behaviour'
                   WHEN a.transaction_initiated_by IN ( 'CIT', 'MIT' )
                        AND ISNULL(a.transaction_state, '') NOT IN ( 'CAPTURED', 'CANCELLED', 'AUTHORISED', 'DECLINED' ) THEN
                       'Unexpected Behaviour'
                   WHEN a.transaction_initiated_by IN ( 'CIT', 'MIT' )
                        AND ISNULL(a.transaction_state, '') = 'DECLINED'
                        AND a.response_payload_error_code IN ( 34, 91 ) THEN
                       'Unexpected Behaviour'
                   WHEN a.transaction_initiated_by IN ( 'CIT', 'MIT' )
                        AND ISNULL(a.transaction_state, '') = 'DECLINED'
                        AND a.response_payload_error_code IN ( 5, 6, 10, 51, 62, 76 ) THEN
                       'Expected Behaviour'
               END AS Status,
               CASE
                   WHEN ISNULL(a.transaction_state, '') IN ( 'CAPTURED', 'CANCELLED', 'AUTHORISED', 'REFUNDED',
                                                             'PARTIALLY_CAPTURED', 'VERIFIED'
                                                           ) THEN
                       'Approved'
                   WHEN ISNULL(a.transaction_state, '') = 'DECLINED'
                        AND ISNULL(a.response_payload_error_code_description, '') = 'Authentication requested' THEN
                       'Soft Decline'
                   WHEN a.transaction_state = 'DECLINED' THEN
                       'Declined'
                   WHEN a.transaction_state IN ( 'SENT_FOR_AUTHORISATION', 'SENT_FOR_VERIFICATION' ) THEN
                       'Orphan'
                   WHEN ISNULL(a.transaction_state, '') IN ( 'CREATED', '' ) THEN
                       'No payment'
                   WHEN ISNULL(a.response_payload_error_code_description, '') = 'Capture card'
                        AND ISNULL(a.transaction_state, '') = 'DECLINED' THEN
                       'Declined'
                   WHEN ISNULL(a.response_payload_error_code_description, '') = 'CARD EXPIRED'
                        AND ISNULL(a.transaction_state, '') = 'DECLINED' THEN
                       'Declined'
                   WHEN ISNULL(a.response_payload_error_code_description, '') = 'DECLINED, EXPIRED CARD'
                        AND ISNULL(a.transaction_state, '') = 'DECLINED' THEN
                       'Declined'
                   WHEN ISNULL(a.response_payload_error_code_description, '') = 'ILLEGAL TRANSACTION'
                        AND ISNULL(a.transaction_state, '') = 'DECLINED' THEN
                       'Declined'
                   WHEN ISNULL(a.response_payload_error_code_description, '') = 'INVALID ACCEPTOR'
                        AND ISNULL(a.transaction_state, '') = 'DECLINED' THEN
                       'Declined'
                   WHEN ISNULL(a.response_payload_error_code_description, '') = 'INVALID CARD ISSUER'
                        AND ISNULL(a.transaction_state, '') = 'DECLINED' THEN
                       'Declined'
                   WHEN ISNULL(a.response_payload_error_code_description, '') = 'Invalid PIN'
                        AND ISNULL(a.transaction_state, '') = 'DECLINED' THEN
                       'Declined'
                   WHEN ISNULL(a.response_payload_error_code_description, '') = 'REJECTED BY CARD ISSUER'
                        AND ISNULL(a.transaction_state, '') = 'DECLINED' THEN
                       'Declined'
                   ELSE
                       ''
               END AS [Finance status],
               CASE
                   WHEN a.transaction_initiated_by = 'CIT'
                        AND ISNULL(a.transaction_state, '') IN ( 'CAPTURED', 'CANCELLED', 'AUTHORISED' )
                        AND a.IsDelivery = 'Y'
                        AND a.amount &gt; 4 THEN
                       'Success with SCA'
                   WHEN a.transaction_initiated_by = 'CIT'
                        AND ISNULL(a.transaction_state, '') IN ( 'CAPTURED', 'CANCELLED', 'AUTHORISED' )
                        AND a.IsDelivery = 'Y'
                        AND a.amount &lt; 4 THEN
                       'Success with SCA Preauth'
                   WHEN a.transaction_initiated_by = 'MIT'
                        AND ISNULL(a.transaction_state, '') IN ( 'CAPTURED', 'CANCELLED', 'AUTHORISED' )
                        AND a.IsDelivery = 'Y'
                        AND a.amount &gt; 4 THEN
                       'Success COF used'
                   WHEN a.transaction_initiated_by = 'MIT'
                        AND ISNULL(a.transaction_state, '') IN ( 'CAPTURED', 'CANCELLED', 'AUTHORISED' )
                        AND a.IsDelivery = 'Y'
                        AND a.amount &lt; 4 THEN
                       'Success COF used PreAuth'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND
                        (
                            a.transaction_state = 'DECLINED'
                            AND a.response_payload_error_code = 34
                        ) THEN
                       'Valid Decline - FRAUD SUSPICION'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND
                        (
                            a.transaction_state = 'DECLINED'
                            AND a.response_payload_error_code = 5
                        ) THEN
                       'Valid Decline - Do Not Honour'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND
                        (
                            a.transaction_state = 'DECLINED'
                            AND a.response_payload_error_code = 6
                        ) THEN
                       'Valid Decline - TRY ANOTHER CARD'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND
                        (
                            a.transaction_state = 'DECLINED'
                            AND a.response_payload_error_code = 10
                        ) THEN
                       'Valid Decline - UNKNOWN CARD'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND
                        (
                            a.transaction_state = 'DECLINED'
                            AND a.response_payload_error_code = 51
                        ) THEN
                       'Valid Decline - LIMIT EXCEEDED'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND
                        (
                            a.transaction_state = 'DECLINED'
                            AND a.response_payload_error_code = 62
                        ) THEN
                       'Valid Decline - RESTRICTED CARD'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND
                        (
                            a.transaction_state = 'DECLINED'
                            AND a.response_payload_error_code = 76
                        ) THEN
                       'Valid Decline - CARD BLOCKED'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND
                        (
                            a.transaction_state = 'DECLINED'
                            AND a.response_payload_error_code = 91
                        ) THEN
                       'Valid Decline - Issuer Unavailable or Inoperative'
                   WHEN a.transaction_initiated_by = 'CIT'
                        AND ISNULL(a.transaction_state, '') IN ( 'SENT_FOR_AUTHORISATION', 'AUTHORISED' )
                        AND a.IsDelivery = 'N' THEN
                       'Abandoned during payment'
                   WHEN a.transaction_initiated_by IN ( 'MIT', 'CIT' )
                        AND (a.transaction_state = 'REFUNDED') THEN
                       'Refunded'
                   WHEN a.transaction_initiated_by = 'CIT'
                        AND ISNULL(a.transaction_state, '') IN ( 'SENT_FOR_VERIFICATION', 'VERIFIED' )
                        AND a.IsDelivery = 'N' THEN
                       'Abandoned Pre Payment'
                   WHEN a.IsDelivery = 'Y'
                        AND
                        (
                            a.[Payments Order number] IS NULL
                            AND a.id IS NULL
                        ) THEN
                       'Success'
                   ELSE
                       'Investigate'
               END AS Outcome,
               COALESCE(a.id, a.[Payments Order number]) AS [Order Ref],
               CASE
                   WHEN COALESCE(a.consumer_id, a.[Consumer number]) = 0 THEN
                       ''
                   ELSE
                       COALESCE(a.consumer_id, a.[Consumer number])
               END AS [Consumer No],
               a.LoadedDate,
               REPLACE(a.userJourneyCode, '"', '') AS _userJourneyCode,
               s.source_media,
               s.owner_product,
               s.source_desc,
               CASE
				    ----CHANGE OPSBI-189----
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') IN ( 'B', 'G' )
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-B2B'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') IN ( 'B', 'G' ) THEN
                       'PP-AOPC'
                   ----CHANGE OPSBI-189----
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') IN ( 'A', 'C', 'E', 'F', 'K', 'L', 'M', 'N', 'O', 'Q', 'R', 'S',
                                                            'T', 'U', 'V', 'Y'
                                                          ) THEN
                       'PP-Retail'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') IN ( 'Z', 'ZD', 'ZL' ) THEN
                       'LK'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'D'
                        AND ISNULL(s.owner_product, '') = 'BC' THEN
                       'PP-B2B'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'D'
                        AND ISNULL(s.owner_product, '') = 'LK' THEN
                       'LK'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'D'
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-B2B'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'DD'
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-B2B'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'DM'
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-B2B'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'H'
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-Affinity'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'I'
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-Retail'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'J'
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-Retail'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'W'
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-Retail'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'X'
                        AND ISNULL(s.owner_product, '') = 'LK' THEN
                       'LK'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'XA'
                        AND ISNULL(s.owner_product, '') = 'LK' THEN
                       'LK'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'Z'
                        AND ISNULL(s.owner_product, '') = 'LK' THEN
                       'LK'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'ZA'
                        AND ISNULL(s.owner_product, '') = 'LK' THEN
                       'LK'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) = ''
                        AND ISNULL(a.description, '') LIKE '%LK%' THEN
                       'LK'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) = ''
                        AND ISNULL(a.description, '') = '' THEN
                       'Not Available'
                   WHEN ISNULL(s.source_media, '') = ''
                        AND ISNULL(s.owner_product, '') = ''
                        AND ISNULL(a.description, '') LIKE '%LK%' THEN
                       'LK'
                   WHEN (COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; ''
                        AND ISNULL(s.source_media, '') = 'P'
                        AND ISNULL(s.owner_product, '') = 'PP' THEN
                       'PP-Retail'
                   ELSE
                       'Not Determined'
               END AS [Product Type],
               sdc.is_access_on_payment_card,
               s.servicecentre
        FROM PPass.dbo.PTGDB3220_DailyReport_nofilter a
            LEFT JOIN PPass.dbo.source s
                ON COALESCE(a.transaction_Source_code, a.[Source code], a.Ppass_source_code) = s.source_code
            LEFT JOIN PPass.dbo.source_deal_config sdc
                ON s.source_code = sdc.source_code
    ) AS T
        LEFT JOIN PPass.dbo.lounge b
            ON T.[Lounge Code] = b.lounge_code
        LEFT JOIN PPass.dbo.EVOReportingPilotWave c
            ON T.[Source C] = c.SourceCode
        LEFT JOIN PPass.dbo.payment_transaction_config ptc
            ON (
                   T._userJourneyCode = ptc.user_journey_code
                   OR T._userJourneyCode = CAST(ptc.payment_transaction_config_id AS VARCHAR(50))
               )
) AS T1
WHERE T1.[Product Type] &lt;&gt; 'Not Determined'
ORDER BY T1.[Consumer No],
         T1.CurrentVisitDate1,
         T1.Date,
         T1.Time;</File>
              <FormatSpecificOptions>
                <SingleRowFetch>False</SingleRowFetch>
                <ReadCentroids>False</ReadCentroids>
                <TableStyle>Quoted</TableStyle>
                <CacheData>False</CacheData>
                <SessionReadOnly>True</SessionReadOnly>
                <ReadUncommitted>False</ReadUncommitted>
                <NoProgress>True</NoProgress>
                <PostSQL />
                <PreSQLOnConfig>True</PreSQLOnConfig>
                <PreSQL />
              </FormatSpecificOptions>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>aka:CDE OPS (PPASS)
Query=/*
Formatting terminated on ...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
            <Dependencies>
              <Implicit />
            </Dependencies>
            <MetaInfo connection="Output">
              <RecordInfo>
                <Field name="id" size="36" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="transaction_type" size="10" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="transaction_initiated_by" size="5" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="description" size="100" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="currency" size="4" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="amount" scale="10" size="22" source="File: CDE OPS (PPASS)" type="FixedDecimal" />
                <Field name="transaction_state" size="30" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="transaction_created_date" size="30" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="consumer_id" size="50" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="response_payload_error_code" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="response_payload_error_code_description" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Ppass_source_code" size="100" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="transaction_Source_code" size="100" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="denied_delivery/delivery_date_utc" size="30" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Consumer Name" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Consumer number" source="File: CDE OPS (PPASS)" type="Int64" />
                <Field name="Payments Order number" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="error_code" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="IsDelivery" size="1" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Product" size="30" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Visit ID" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Device ID" size="4000" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Date" source="File: CDE OPS (PPASS)" type="Date" />
                <Field name="Time" size="30" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="lounge_code" size="6" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="country_code" size="3" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Source C" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Order Ref" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Consumer No" source="File: CDE OPS (PPASS)" type="Int64" />
                <Field name="scaEnabled" size="10" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="paymentCardVerificationDuringConsumption" size="50" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="PilotWave" size="50" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="LoadedDate" source="File: CDE OPS (PPASS)" type="DateTime" />
                <Field name="Finance status" size="12" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="_userJourneyCode" size="4000" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Last Transaction" size="20" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Outcome" size="65" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Summary Status" size="65" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Status" size="20" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="User Journey Code" size="100" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Flag for Source Code" source="File: CDE OPS (PPASS)" type="Int32" />
                <Field name="source_media" size="10" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="owner_product" size="7" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="source_desc" size="30" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Product Type1" size="14" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Event" size="29" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="PaymentType" size="17" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Category" size="66" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="servicecentre" size="1" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="row1#" source="File: CDE OPS (PPASS)" type="Int64" />
              </RecordInfo>
            </MetaInfo>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileInput" />
        </Node>
        <Node ToolID="41">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Join.Join">
            <Position x="506" y="988" />
          </GuiSettings>
          <Properties>
            <Configuration joinByRecordPos="False">
              <JoinInfo connection="Left">
                <Field field="source_code" />
              </JoinInfo>
              <JoinInfo connection="Right">
                <Field field="Source C" />
              </JoinInfo>
              <SelectConfiguration>
                <Configuration outputConnection="Join">
                  <OrderChanged value="False" />
                  <CommaDecimal value="False" />
                  <SelectFields>
                    <SelectField field="Left_source_code" selected="False" input="Left_" />
                    <SelectField field="Left_prefix" selected="False" input="Left_" />
                    <SelectField field="Left_ica" selected="False" input="Left_" />
                    <SelectField field="Left_reporting_ica" selected="False" input="Left_" />
                    <SelectField field="Left_bin" selected="False" input="Left_" />
                    <SelectField field="Left_group_code" selected="False" input="Left_" />
                    <SelectField field="Left_clean_issuer_name" selected="False" input="Left_" />
                    <SelectField field="Left_country_of_issue_iso" selected="False" input="Left_" />
                    <SelectField field="Left_country_of_issue" selected="True" rename="Issuer Country" input="Left_" />
                    <SelectField field="Left_cg_region_of_issue" selected="False" input="Left_" />
                    <SelectField field="Left_client_region_of_issue" selected="False" input="Left_" />
                    <SelectField field="Left_client_sub_region_of_issue" selected="False" input="Left_" />
                    <SelectField field="Left_model" selected="False" input="Left_" />
                    <SelectField field="Left_deal_status" selected="False" input="Left_" />
                    <SelectField field="Left_deal_start_date" selected="False" input="Left_" />
                    <SelectField field="Left_deal_cancellation_date" selected="False" input="Left_" />
                    <SelectField field="Left_client_service_centre" selected="False" input="Left_" />
                    <SelectField field="Left_contract_type" selected="False" input="Left_" />
                    <SelectField field="Left_card_type" selected="False" input="Left_" />
                    <SelectField field="Left_membership_fee_currency" selected="False" input="Left_" />
                    <SelectField field="Left_membership_fee" selected="False" input="Left_" />
                    <SelectField field="Left_selected_non_selected" selected="False" input="Left_" />
                    <SelectField field="Left_po_charge_type" selected="False" input="Left_" />
                    <SelectField field="Left_billing_inclusion_lounge_visits" selected="False" input="Left_" />
                    <SelectField field="Left_billing_inclusion_memberships" selected="False" input="Left_" />
                    <SelectField field="Left_decline" selected="False" input="Left_" />
                    <SelectField field="Left_bid" selected="False" input="Left_" />
                    <SelectField field="Left_lounge_set_selected" selected="False" input="Left_" />
                    <SelectField field="Left_lv_report_credit_card_type" selected="False" input="Left_" />
                    <SelectField field="Left_consolidated_report" selected="False" input="Left_" />
                    <SelectField field="Left_currency" selected="False" input="Left_" />
                    <SelectField field="Left_created_dt" selected="False" input="Left_" />
                    <SelectField field="Right_currency" selected="True" rename="Right_currency" input="Right_" />
                    <SelectField field="*Unknown" selected="True" />
                  </SelectFields>
                </Configuration>
              </SelectConfiguration>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxJoin" />
        </Node>
        <Node ToolID="42">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="698" y="926" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="True" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="id" selected="True" />
                <SelectField field="transaction_type" selected="True" />
                <SelectField field="transaction_initiated_by" selected="True" />
                <SelectField field="description" selected="True" />
                <SelectField field="Right_currency" selected="True" rename="Currency" />
                <SelectField field="amount" selected="True" type="Float" size="4" />
                <SelectField field="transaction_state" selected="True" />
                <SelectField field="transaction_created_date" selected="True" />
                <SelectField field="consumer_id" selected="True" />
                <SelectField field="response_payload_error_code" selected="True" />
                <SelectField field="response_payload_error_code_description" selected="True" />
                <SelectField field="Ppass_source_code" selected="True" />
                <SelectField field="denied_delivery/delivery_date_utc" selected="True" />
                <SelectField field="Consumer Name" selected="True" />
                <SelectField field="Consumer number" selected="True" />
                <SelectField field="Payments Order number" selected="True" />
                <SelectField field="error_code" selected="True" />
                <SelectField field="IsDelivery" selected="True" />
                <SelectField field="Product" selected="True" />
                <SelectField field="Visit ID" selected="True" />
                <SelectField field="Device ID" selected="True" />
                <SelectField field="Date" selected="True" />
                <SelectField field="Time" selected="True" />
                <SelectField field="Status" selected="True" />
                <SelectField field="Finance status" selected="True" />
                <SelectField field="Outcome" selected="True" />
                <SelectField field="lounge_code" selected="True" />
                <SelectField field="country_code" selected="True" />
                <SelectField field="client_name" selected="True" rename="Network" />
                <SelectField field="issuer_name" selected="True" rename="Issuer" />
                <SelectField field="Last Transaction" selected="True" />
                <SelectField field="currency" selected="False" />
                <SelectField field="Source C" selected="True" />
                <SelectField field="Order Ref" selected="True" />
                <SelectField field="Consumer No" selected="True" />
                <SelectField field="Summary Status" selected="True" />
                <SelectField field="Issuer Country" selected="True" />
                <SelectField field="PilotWave" selected="True" />
                <SelectField field="deal_type" selected="True" />
                <SelectField field="LoadedDate" selected="True" />
                <SelectField field="lounge_programme" selected="True" />
                <SelectField field="scaEnabled" selected="True" />
                <SelectField field="paymentCardVerificationDuringConsumption" selected="True" />
                <SelectField field="User Journey Code" selected="True" />
                <SelectField field="Flag for Source Code" selected="True" />
                <SelectField field="transaction_Source_code" selected="True" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="43">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Unique.Unique">
            <Position x="794" y="928" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <UniqueFields>
                <Field field="id" />
                <Field field="transaction_type" />
                <Field field="transaction_initiated_by" />
                <Field field="description" />
                <Field field="Currency" />
                <Field field="amount" />
                <Field field="transaction_state" />
                <Field field="transaction_created_date" />
                <Field field="consumer_id" />
                <Field field="response_payload_error_code" />
                <Field field="response_payload_error_code_description" />
                <Field field="Ppass_source_code" />
                <Field field="denied_delivery/delivery_date_utc" />
                <Field field="Consumer Name" />
                <Field field="Consumer number" />
                <Field field="Payments Order number" />
                <Field field="error_code" />
                <Field field="IsDelivery" />
                <Field field="Product" />
                <Field field="Visit ID" />
                <Field field="Device ID" />
                <Field field="Date" />
                <Field field="Time" />
                <Field field="Status" />
                <Field field="Finance status" />
                <Field field="Outcome" />
                <Field field="lounge_code" />
                <Field field="country_code" />
                <Field field="Network" />
                <Field field="Last Transaction" />
                <Field field="Source C" />
                <Field field="Order Ref" />
                <Field field="Consumer No" />
                <Field field="Summary Status" />
              </UniqueFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnique" />
        </Node>
        <Node ToolID="44">
          <GuiSettings Plugin="AlteryxSpatialPluginsGui.Summarize.Summarize">
            <Position x="758" y="1108" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <SummarizeFields>
                <SummarizeField field="Source C" action="GroupBy" rename="Source C" />
                <SummarizeField field="issuer_name" action="CountDistinct" rename="CountDistinct_issuer_name" />
                <SummarizeField field="Issuer Country" action="CountDistinct" rename="CountDistinct_Issuer Country" />
                <SummarizeField field="client_name" action="CountDistinct" rename="CountDistinct_client_name" />
                <SummarizeField field="deal_type" action="CountDistinct" rename="CountDistinct_deal_type" />
              </SummarizeFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxSpatialPluginsEngine.dll" EngineDllEntryPoint="AlteryxSummarize" />
        </Node>
        <Node ToolID="45">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Unique.Unique">
            <Position x="662" y="1036" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <UniqueFields>
                <Field field="issuer_name" />
                <Field field="Issuer Country" />
                <Field field="Source C" />
                <Field field="Visit ID" />
              </UniqueFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnique" />
        </Node>
        <Node ToolID="46">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Join.Join">
            <Position x="974" y="1036" />
          </GuiSettings>
          <Properties>
            <Configuration joinByRecordPos="False">
              <JoinInfo connection="Left">
                <Field field="Source C" />
              </JoinInfo>
              <JoinInfo connection="Right">
                <Field field="Source C" />
              </JoinInfo>
              <SelectConfiguration>
                <Configuration outputConnection="Join">
                  <OrderChanged value="False" />
                  <CommaDecimal value="False" />
                  <SelectFields>
                    <SelectField field="Right_Source C" selected="True" rename="Right_Source C" input="Right_" />
                    <SelectField field="Right_Consumer number" selected="False" rename="Right_Consumer number" input="Right_" />
                    <SelectField field="Right_Visit ID" selected="False" rename="Right_Visit ID" input="Right_" />
                    <SelectField field="Right_Consumer No" selected="False" rename="Right_Consumer No" input="Right_" />
                    <SelectField field="*Unknown" selected="True" />
                  </SelectFields>
                </Configuration>
              </SelectConfiguration>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxJoin" />
        </Node>
        <Node ToolID="47">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="1166" y="1084" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="if [CountDistinct_issuer_name]&gt;1 then &quot;Multiple Bank&quot; else [Issuer] endif&#xA;" field="Issuer" size="255" type="V_WString" />
                <FormulaField expression="if [CountDistinct_Issuer Country]&gt;1 then &quot;Multiple Country&quot; else [Issuer Country] endif&#xA;" field="IssuerCountry" size="1073741823" type="V_WString" />
                <FormulaField expression="if [CountDistinct_client_name]&gt;1 then &quot;Multiple Network&quot; else [Network] endif&#xA;" field="Network" size="255" type="V_WString" />
                <FormulaField expression="&quot;&quot;" field="Ppass_source_code" size="100" type="V_WString" />
                <FormulaField expression="&quot;&quot;" field="Product" size="30" type="V_WString" />
                <FormulaField expression="IF [lounge_programme]=&quot;LoungeKey&quot; then &quot;LK&quot; elseif [lounge_programme]=&quot;PriorityPass&quot; then &quot;PP&quot; else [lounge_programme] endif" field="lounge_programme" size="45" type="V_WString" />
                <FormulaField expression="if [Summary Status]=&quot;Abandoned&quot; then &quot;Abandoned&quot; else [Status] endif" field="Status" size="20" type="V_String" />
                <FormulaField expression="if [CountDistinct_deal_type]&gt;1 then &quot;Multiple Deal Type&quot; else [deal_type] endif&#xA;" field="deal_type" size="45" type="V_WString" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>Issuer = if [CountDistinct_issuer_name]&gt;1 then "Multiple Bank" else [Issuer] end...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="48">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="1262" y="1084" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="False" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="Issuer Country" selected="False" />
                <SelectField field="deal_type" selected="True" rename="Source Type" />
                <SelectField field="Right_Source C" selected="False" />
                <SelectField field="CountDistinct_issuer_name" selected="False" />
                <SelectField field="CountDistinct_Issuer Country" selected="False" />
                <SelectField field="Count" selected="False" />
                <SelectField field="Right_Consumer number" selected="False" />
                <SelectField field="Issuer Name" selected="False" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="49">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Unique.Unique">
            <Position x="1358" y="1084" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <UniqueFields>
                <Field field="id" />
                <Field field="transaction_type" />
                <Field field="transaction_initiated_by" />
                <Field field="description" />
                <Field field="Currency" />
                <Field field="amount" />
                <Field field="transaction_state" />
                <Field field="transaction_created_date" />
                <Field field="consumer_id" />
                <Field field="response_payload_error_code" />
                <Field field="response_payload_error_code_description" />
                <Field field="Ppass_source_code" />
                <Field field="denied_delivery/delivery_date_utc" />
                <Field field="Consumer Name" />
                <Field field="Consumer number" />
                <Field field="Payments Order number" />
                <Field field="error_code" />
                <Field field="IsDelivery" />
                <Field field="Product" />
                <Field field="Visit ID" />
                <Field field="Device ID" />
                <Field field="Date" />
                <Field field="Time" />
                <Field field="Status" />
                <Field field="Finance status" />
                <Field field="Outcome" />
                <Field field="lounge_code" />
                <Field field="country_code" />
                <Field field="Network" />
                <Field field="Issuer" />
                <Field field="Last Transaction" />
                <Field field="Source C" />
                <Field field="Order Ref" />
                <Field field="Consumer No" />
                <Field field="Summary Status" />
                <Field field="PilotWave" />
                <Field field="Source Type" />
                <Field field="IssuerCountry" />
              </UniqueFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnique" />
        </Node>
        <Node ToolID="50">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Union.Union">
            <Position x="1070" y="1108" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <ByName_ErrorMode>Warning</ByName_ErrorMode>
              <ByName_OutputMode>All</ByName_OutputMode>
              <Mode>ByName</Mode>
              <SetOutputOrder value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnion" />
        </Node>
        <Node ToolID="51">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Filter.Filter">
            <Position x="878" y="1084" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Expression>[CountDistinct_issuer_name] &gt; 1 OR [CountDistinct_Issuer Country]&gt;1 OR [CountDistinct_client_name]&gt;1 OR [CountDistinct_deal_type]&gt;1</Expression>
              <Mode>Custom</Mode>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>[CountDistinct_issuer_name] &gt; 1 OR [CountDistinct_Issuer Country]&gt;1 OR [CountDis...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFilter" />
        </Node>
        <Node ToolID="52">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="410" y="1010" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="if [Consumer No]=&quot;0&quot; then &quot;&quot; else [Consumer No] endif" field="Consumer No" size="21" type="V_String" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText><![CDATA[Consumer No = if [Consumer No]="0" then "" else [Consumer No] endif
]]></DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="53">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="314" y="1012" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="False" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="Consumer number" selected="True" type="V_String" size="21" />
                <SelectField field="Time" selected="True" type="Time" size="8" />
                <SelectField field="Consumer No" selected="True" type="V_String" size="21" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="54">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Union.Union">
            <Position x="602" y="986" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <ByName_ErrorMode>Warning</ByName_ErrorMode>
              <ByName_OutputMode>All</ByName_OutputMode>
              <Mode>ByName</Mode>
              <SetOutputOrder value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnion" />
        </Node>
        <Node ToolID="55">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="1550" y="1084" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="&quot;\\clbnas01\PriorityPass\Harshad\EVO Reporting\&quot;+DateTimeFormat(DateTimeNow(),&quot;%Y%m%d_EVOReporting_RAW&quot;)+&quot;.xlsx|||Sheet1&quot; " field="FileLocation" size="1073741823" type="V_WString" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>FileLocation = "\\clbnas01\PriorityPass\Harshad\EVO Reporting\"+DateTimeFormat(D...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="56">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="1454" y="1084" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="True" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="id" selected="True" />
                <SelectField field="transaction_type" selected="True" />
                <SelectField field="transaction_initiated_by" selected="True" />
                <SelectField field="description" selected="True" />
                <SelectField field="Currency" selected="True" />
                <SelectField field="amount" selected="True" />
                <SelectField field="transaction_state" selected="True" />
                <SelectField field="transaction_created_date" selected="True" />
                <SelectField field="consumer_id" selected="True" />
                <SelectField field="response_payload_error_code" selected="True" />
                <SelectField field="response_payload_error_code_description" selected="True" />
                <SelectField field="Ppass_source_code" selected="True" />
                <SelectField field="denied_delivery/delivery_date_utc" selected="True" />
                <SelectField field="Consumer Name" selected="True" />
                <SelectField field="Consumer number" selected="True" />
                <SelectField field="Payments Order number" selected="True" />
                <SelectField field="error_code" selected="True" />
                <SelectField field="IsDelivery" selected="True" />
                <SelectField field="Product" selected="True" />
                <SelectField field="Visit ID" selected="True" />
                <SelectField field="Device ID" selected="True" />
                <SelectField field="Date" selected="True" />
                <SelectField field="Time" selected="True" />
                <SelectField field="Status" selected="True" />
                <SelectField field="Finance status" selected="True" />
                <SelectField field="Outcome" selected="True" />
                <SelectField field="lounge_code" selected="True" />
                <SelectField field="country_code" selected="True" />
                <SelectField field="Network" selected="True" />
                <SelectField field="Issuer" selected="True" />
                <SelectField field="Last Transaction" selected="True" />
                <SelectField field="Source C" selected="True" />
                <SelectField field="Order Ref" selected="True" />
                <SelectField field="Consumer No" selected="True" />
                <SelectField field="scaEnabled" selected="True" />
                <SelectField field="paymentCardVerificationDuringConsumption" selected="True" />
                <SelectField field="PilotWave" selected="True" />
                <SelectField field="Source Type" selected="True" />
                <SelectField field="LoadedDate" selected="True" />
                <SelectField field="CountDistinct_client_name" selected="False" />
                <SelectField field="IssuerCountry" selected="True" />
                <SelectField field="User Journey Code" selected="True" />
                <SelectField field="Summary Status" selected="True" />
                <SelectField field="lounge_programme" selected="True" />
                <SelectField field="Flag for Source Code" selected="True" />
                <SelectField field="transaction_Source_code" selected="True" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="30">
          <GuiSettings Plugin="AlteryxGuiToolkit.ToolContainer.ToolContainer">
            <Position x="1679" y="888" width="396" height="269" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Caption>Container 45</Caption>
              <Style TextColor="#314c4a" FillColor="#ecf2f2" BorderColor="#314c4a" Transparency="25" Margin="25" />
              <Disabled value="False" />
              <Folded value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <ChildNodes>
            <Node ToolID="28">
              <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
                <Position x="1704" y="1022" />
              </GuiSettings>
              <Properties>
                <Configuration>
                  <OrderChanged value="False" />
                  <CommaDecimal value="False" />
                  <SelectFields>
                    <SelectField field="User Journey Code" selected="False" />
                    <SelectField field="lounge_programme" selected="False" />
                    <SelectField field="Flag for Source Code" selected="False" />
                    <SelectField field="Transaction_source_code" selected="False" />
                    <SelectField field="FileLocation" selected="False" />
                    <SelectField field="row1#" selected="False" />
                    <SelectField field="*Unknown" selected="True" />
                  </SelectFields>
                </Configuration>
                <Annotation DisplayMode="0">
                  <Name />
                  <DefaultAnnotationText />
                  <Left value="False" />
                </Annotation>
              </Properties>
              <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
            </Node>
            <Node ToolID="29">
              <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
                <Position x="1800" y="974" />
              </GuiSettings>
              <Properties>
                <Configuration>
                  <OrderChanged value="False" />
                  <CommaDecimal value="False" />
                  <SelectFields>
                    <SelectField field="LoadedDate" selected="True" rename="LoadedDateInPPBO" />
                    <SelectField field="_userJourneyCode" selected="False" />
                    <SelectField field="source_media" selected="False" />
                    <SelectField field="owner_product" selected="False" />
                    <SelectField field="source_desc" selected="False" />
                    <SelectField field="Product Type1" selected="True" rename="Product Type" />
                    <SelectField field="CountDistinct_deal_type" selected="False" />
                    <SelectField field="*Unknown" selected="True" />
                  </SelectFields>
                </Configuration>
                <Annotation DisplayMode="0">
                  <Name />
                  <DefaultAnnotationText />
                  <Left value="False" />
                </Annotation>
              </Properties>
              <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
            </Node>
            <Node ToolID="61">
              <GuiSettings Plugin="AlteryxGuiToolkit.ToolContainer.ToolContainer">
                <Position x="1895" y="937" width="155" height="195" />
              </GuiSettings>
              <Properties>
                <Configuration>
                  <Caption>Container 61</Caption>
                  <Style TextColor="#314c4a" FillColor="#ecf2f2" BorderColor="#314c4a" Transparency="25" Margin="25" />
                  <Disabled value="False" />
                  <Folded value="False" />
                </Configuration>
                <Annotation DisplayMode="0">
                  <Name />
                  <DefaultAnnotationText />
                  <Left value="False" />
                </Annotation>
              </Properties>
              <ChildNodes>
                <Node ToolID="27">
                  <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileOutput.DbFileOutput">
                    <Position x="1920" y="986" />
                  </GuiSettings>
                  <Properties>
                    <Configuration>
                      <File MaxRecords="" FileFormat="23">aka:5f15b4860b05360e6c4ed32e|||SCAMonitoring.twb.SCAMonitoring</File>
                      <Passwords />
                      <CachedCosmeticName>DI_Billing</CachedCosmeticName>
                      <FormatSpecificOptions>
                        <TransactionMessages>False</TransactionMessages>
                        <Geometry>True</Geometry>
                        <Projection />
                        <IgnoreDropTableSQLErrors>False</IgnoreDropTableSQLErrors>
                        <SpatialObjSize>8000</SpatialObjSize>
                        <OutputOption>Delete</OutputOption>
                        <AppendMap>
                          <AppendMapping mode="ByName" />
                        </AppendMap>
                        <PostSQL />
                        <TransactionSize>10000</TransactionSize>
                        <TableStyle>Quoted</TableStyle>
                        <PreSQL>TRUNCATE TABLE SCAMonitoring.twb.SCAMonitoring</PreSQL>
                      </FormatSpecificOptions>
                      <MultiFile value="False" />
                    </Configuration>
                    <Annotation DisplayMode="0">
                      <Name />
                      <DefaultAnnotationText>aka:DI_Billing
Query=SCAMonitoring.twb.SCAMonitor...</DefaultAnnotationText>
                      <Left value="False" />
                    </Annotation>
                    <Dependencies>
                      <Implicit />
                    </Dependencies>
                  </Properties>
                  <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileOutput" />
                </Node>
              </ChildNodes>
            </Node>
          </ChildNodes>
        </Node>
        <Node ToolID="59">
          <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileOutput.DbFileOutput">
            <Position x="2046" y="1170" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <File MaxRecords="" FileFormat="25">%temp.xlsx|||Sheet1</File>
              <Passwords />
              <FormatSpecificOptions>
                <PreserveFormat>False</PreserveFormat>
                <SkipFieldNames>False</SkipFieldNames>
                <OutputOption>RemoveFile</OutputOption>
              </FormatSpecificOptions>
              <MultiFile value="True" />
              <MultiFileType>Path</MultiFileType>
              <MultiFileField>FileLocation</MultiFileField>
              <KeepField value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>%temp.xlsx
Query=Sheet1</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
            <Dependencies>
              <Implicit />
            </Dependencies>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileOutput" />
        </Node>
        <Node ToolID="60">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="1854" y="1194" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="&quot;\\clbnas01\PriorityPass\8. OPERATIONS\2. SCA Enabled Payments Reporting\EVO Reporting_RAW.xlsx|||Sheet1&quot; " field="FileLocation" size="1073741823" type="V_WString" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>FileLocation = "\\clbnas01\PriorityPass\8. OPERATIONS\2. SCA Enabled Payments Re...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="69">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="226" y="922" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="True" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="client_name" selected="True" />
                <SelectField field="source_code" selected="True" />
                <SelectField field="prefix" selected="False" />
                <SelectField field="ica" selected="False" />
                <SelectField field="reporting_ica" selected="False" />
                <SelectField field="bin" selected="False" />
                <SelectField field="group_code" selected="False" />
                <SelectField field="issuer_name" selected="True" />
                <SelectField field="clean_issuer_name" selected="False" />
                <SelectField field="country_of_issue_iso" selected="False" />
                <SelectField field="country_of_issue" selected="True" />
                <SelectField field="cg_region_of_issue" selected="False" />
                <SelectField field="client_region_of_issue" selected="False" />
                <SelectField field="client_sub_region_of_issue" selected="False" />
                <SelectField field="lounge_programme" selected="True" />
                <SelectField field="model" selected="False" />
                <SelectField field="deal_type" selected="True" />
                <SelectField field="deal_status" selected="False" />
                <SelectField field="deal_start_date" selected="False" />
                <SelectField field="deal_cancellation_date" selected="False" />
                <SelectField field="client_service_centre" selected="False" />
                <SelectField field="contract_type" selected="False" />
                <SelectField field="card_type" selected="False" />
                <SelectField field="membership_fee_currency" selected="False" />
                <SelectField field="membership_fee" selected="False" />
                <SelectField field="selected_non_selected" selected="False" />
                <SelectField field="po_charge_type" selected="False" />
                <SelectField field="billing_inclusion_lounge_visits" selected="False" />
                <SelectField field="billing_inclusion_memberships" selected="False" />
                <SelectField field="decline" selected="False" />
                <SelectField field="bid" selected="False" />
                <SelectField field="lounge_set_selected" selected="False" />
                <SelectField field="lv_report_credit_card_type" selected="False" />
                <SelectField field="consolidated_report" selected="False" />
                <SelectField field="currency" selected="False" />
                <SelectField field="created_dt" selected="False" />
                <SelectField field="*Unknown" selected="False" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="70">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Unique.Unique">
            <Position x="322" y="921" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <UniqueFields>
                <Field field="client_name" />
                <Field field="source_code" />
                <Field field="issuer_name" />
                <Field field="country_of_issue" />
                <Field field="lounge_programme" />
                <Field field="deal_type" />
              </UniqueFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnique" />
        </Node>
        <Node ToolID="72">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Filter.Filter">
            <Position x="1950" y="1182" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Expression>[LoadedDateInPPBO]&gt;= DateTimeAdd(DateTimeNow(),-30,"days")</Expression>
              <Mode>Custom</Mode>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>[LoadedDateInPPBO]&gt;= DateTimeAdd(DateTimeNow(),-30,"days")</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFilter" />
        </Node>
      </ChildNodes>
    </Node>
    <Node ToolID="58">
      <GuiSettings Plugin="AlteryxGuiToolkit.ToolContainer.ToolContainer">
        <Position x="54" y="54" width="2020" height="754" />
      </GuiSettings>
      <Properties>
        <Configuration>
          <Caption>File Generation</Caption>
          <Style TextColor="#314c4a" FillColor="#ecf2f2" BorderColor="#314c4a" Transparency="25" Margin="25" />
          <Disabled value="False" />
          <Folded value="False" />
        </Configuration>
        <Annotation DisplayMode="0">
          <Name />
          <DefaultAnnotationText />
          <Left value="False" />
        </Annotation>
      </Properties>
      <ChildNodes>
        <Node ToolID="1">
          <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileInput.DbFileInput">
            <Position x="79" y="140" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Passwords />
              <CachedCosmeticName>VisionBI Live</CachedCosmeticName>
              <File FileFormat="23" RecordLimit="">aka:5f15b4b10b05360e6c4ed360|||select * FROM cms.source.tblCmsDeals WHERE deal_status='Active'</File>
              <FormatSpecificOptions>
                <SingleRowFetch>False</SingleRowFetch>
                <ReadCentroids>False</ReadCentroids>
                <TableStyle>Quoted</TableStyle>
                <CacheData>False</CacheData>
                <SessionReadOnly>True</SessionReadOnly>
                <ReadUncommitted>False</ReadUncommitted>
                <NoProgress>True</NoProgress>
                <PostSQL />
                <PreSQLOnConfig>True</PreSQLOnConfig>
                <PreSQL />
              </FormatSpecificOptions>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>aka:VisionBI Live
Query=select * FROM cms.source.tbl...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
            <Dependencies>
              <Implicit />
            </Dependencies>
            <MetaInfo connection="Output">
              <RecordInfo>
                <Field name="client_name" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="source_code" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="prefix" size="25" source="File: VisionBI Live" type="V_WString" />
                <Field name="ica" size="12" source="File: VisionBI Live" type="V_WString" />
                <Field name="reporting_ica" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="bin" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="group_code" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="issuer_name" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="clean_issuer_name" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="country_of_issue_iso" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="country_of_issue" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="cg_region_of_issue" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="client_region_of_issue" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="client_sub_region_of_issue" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="lounge_programme" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="model" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="deal_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="deal_status" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="deal_start_date" source="File: VisionBI Live" type="DateTime" />
                <Field name="deal_cancellation_date" source="File: VisionBI Live" type="DateTime" />
                <Field name="client_service_centre" size="255" source="File: VisionBI Live" type="V_WString" />
                <Field name="contract_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="card_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="membership_fee_currency" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="membership_fee" scale="2" size="13" source="File: VisionBI Live" type="FixedDecimal" />
                <Field name="selected_non_selected" source="File: VisionBI Live" type="Int16" />
                <Field name="po_charge_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="billing_inclusion_lounge_visits" source="File: VisionBI Live" type="Int16" />
                <Field name="billing_inclusion_memberships" source="File: VisionBI Live" type="Int16" />
                <Field name="decline" source="File: VisionBI Live" type="Int16" />
                <Field name="bid" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="lounge_set_selected" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="lv_report_credit_card_type" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="consolidated_report" source="File: VisionBI Live" type="Int16" />
                <Field name="currency" size="45" source="File: VisionBI Live" type="V_WString" />
                <Field name="created_dt" source="File: VisionBI Live" type="DateTime" />
              </RecordInfo>
            </MetaInfo>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileInput" />
        </Node>
        <Node ToolID="2">
          <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileInput.DbFileInput">
            <Position x="79" y="258" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Passwords />
              <CachedCosmeticName>CDE OPS (PPASS)</CachedCosmeticName>
              <File FileFormat="23" RecordLimit="">aka:630f3be88a20878940976291|||select 
T1.id,
	T1.transaction_type,
	T1.transaction_initiated_by,
	case 
			when T1.description = 'LK MIT payment' then 'LK Visit MIT' 
			when T1.description = 'LK Visit' then 'LK Visit CIT' 
			when T1.description = 'LKVisit' then 'LK Visit CIT' 
			else T1.description 
		end as description,
	T1.currency,
	T1.amount,
	T1.transaction_state,
	T1.transaction_created_date,
	T1.consumer_id,
	T1.response_payload_error_code,
	T1.response_payload_error_code_description,
	T1.Ppass_source_code,
	T1.transaction_Source_code,
	T1.[denied_delivery/delivery_date_utc],
	T1.[Consumer Name],
	T1.[Consumer number],
	T1.[Payments Order number],
	T1.error_code,
	T1.IsDelivery,
	T1.Product,
	T1.[Visit ID],
	T1.[Device ID],
	T1.Date,
	T1.Time,
	T1.lounge_code,
	T1.country_code,
	T1.[Source C],
	T1.[Order Ref],
	T1.[Consumer No],
	T1.scaEnabled,
	T1.paymentCardVerificationDuringConsumption,
	T1.PilotWave,
	T1.LoadedDate,
	T1.[Finance status],
	T1._userJourneyCode,
	case 
			when IsNull(T1.description, '') Like '%sub%' and IsNull(T1.[Consumer No], '') = '' 
					THEN '' 
			when T1.Event = 'Visit' --and ((IsNull(T1.[Lounge Code], '') = IsNull(T1.NextLoungeCode, ''))) 
			AND DateDiff(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &lt;= 2 AND ISNULL(T1.NextErrorCode1,'')  NOT IN (796,764) 
					THEN 'Not Last Transaction' 
			when T1.Event = 'Visit' --and ((IsNull(T1.[Lounge Code], '') != IsNull(T1.NextLoungeCode, ''))) 
			AND DateDiff(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &lt;= 2 AND ISNULL(T1.NextErrorCode1,'')  NOT IN (796,764) 
					THEN 'Last Transaction' 
			when T1.Event = 'Visit' and DateDiff(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &lt;= 2 AND ISNULL(T1.NextErrorCode1,'')  NOT IN (796,764) 
					THEN 'Last Transaction' 
			when T1.Event = 'Visit' and DateDiff(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &lt;= 2 AND ISNULL(T1.NextErrorCode1,'')  IN (796,764) AND T1.row1# IN (1,2)
					THEN 'Last Transaction' 
			when T1.Event = 'Visit' and ((IsNull(T1.[Lounge Code], '') ! = IsNull(T1.NextLoungeCode, ''))) and DateDiff(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) is NULL 
					THEN 'Last Transaction' 
			when T1.Event = 'Visit' and ((IsNull(T1.[Lounge Code], '') ! = IsNull(T1.NextLoungeCode, ''))) and DateDiff(HOUR, T1.CurrentVisitDate, T1.NextVisitDate) &gt; 2 
					THEN 'Last Transaction' 
			when IsNull(T1.description, '') Like '%sub%' and IsNull(T1.[Consumer No], '') &lt;&gt; '' and T1.row1# &gt; 1 AND ISNULL(T1.error_code,'') IN (796,764) 
					THEN ''
			when IsNull(T1.description, '') Like '%sub%' and IsNull(T1.[Consumer No], '') &lt;&gt; '' and T1.row1# &gt; 1  AND ISNULL(T1.error_code,'') NOT IN (796,764) 
					THEN 'Not Last Transaction'
			when IsNull(T1.description, '') Like '%sub%' and IsNull(T1.[Consumer No], '') &lt;&gt; '' and T1.row1# = 1  AND ISNULL(T1.error_code,'') IN (796,764) 
					THEN '' 
			when IsNull(T1.description, '') Like '%sub%' and IsNull(T1.[Consumer No], '') &lt;&gt; '' and T1.row1# = 1  AND ISNULL(T1.error_code,'') NOT IN (796,764) 
					THEN 'Last Transaction' 
			when T1.row1# &gt; 1   AND ISNULL(T1.error_code,'') IN (796,764) 
					THEN '' 
			WHEN T1.row1# &gt; 1   AND ISNULL(T1.error_code,'') NOT IN (796,764) 
					THEN 'Not Last Transaction' 
			when T1.row1# = 1     AND ISNULL(T1.error_code,'') IN (796,764) 
					THEN '' 
			when T1.row1# = 1    AND ISNULL(T1.error_code,'') NOT IN (796,764) 
					THEN 'Last Transaction' 
		end as [Last Transaction],
		/* Outcome */
	case 
			when IsNull(T1.error_code, '') = '710' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '711' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '712' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '726' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '727' 
					THEN 'VALID DECLINE - Contact Issuer' 
			when IsNull(T1.error_code, '') = '729' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '731' 
					THEN 'SYSTEM ERROR - Already Voided' 
			when IsNull(T1.error_code, '') = '733' 
					THEN 'SYSTEM ERROR - Please Try Again' 
			when IsNull(T1.error_code, '') = '734' 
					THEN 'SYSTEM ERROR - Please Try Again' 
			when IsNull(T1.error_code, '') = '740' 
					THEN 'VALID DECLINE - Contact Issuer' 
			when IsNull(T1.error_code, '') = '741' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '743' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '744' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '751' 
					THEN 'VALID DECLINE - Contact Issuer' 
			when IsNull(T1.error_code, '') = '753' 
					THEN 'VALID DECLINE - Payment Card Expired' 
			when IsNull(T1.error_code, '') = '757' 
					THEN 'VALID DECLINE - Contact Issuer' 
			when IsNull(T1.error_code, '') = '760' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '761' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '763' 
					THEN 'SYSTEM ERROR - TBC' 
			when IsNull(T1.error_code, '') = '764' 
					THEN 'SYSTEM ERROR - TBC' 
			when IsNull(T1.error_code, '') = '780' 
					THEN 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '782' 
					THEN 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '781' 
					THEN 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '783' 
					THEN 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '784' 
					THEN 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '790' 
					THEN 'SYSTEM ERROR - Please Try Again' 
			when IsNull(T1.error_code, '') = '791' 
					THEN 'SYSTEM ERROR - Please Try Again' 
			when IsNull(T1.error_code, '') = '792' 
					THEN 'SYSTEM ERROR - Please Try Again' 
			when IsNull(T1.error_code, '') = '793' 
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '796'
					THEN 'SYSTEM ERROR - Emergency Manual Process' 
			when IsNull(T1.error_code, '') = '942' 
					THEN 'ABANDONED: Authorise Visit Screen' 
			when IsNull(T1.error_code, '') = '943' 
					THEN 'ABANDONED: 3DS Regulations' 
			when IsNull(T1.error_code, '') = '944' 
					THEN 'ABANDONED: 3DS Member Consent' 
			when IsNull(T1.error_code, '') = '945' 
					THEN 'ABANDONED: 3DS Payment Screen' 
			when IsNull(T1.error_code, '') = '946' 
					THEN 'ABANDONED: 3DS Billing Address' 
			when IsNull(T1.error_code, '') = '947' 
					THEN 'ABANDONED: 3DS Challenge' 
			when IsNull(T1.error_code, '') LIKE '9%' 
					THEN 'ABANDONED: Screen TBC' 
			----Requested as a part of OPSBI-220
			--when T1.Event = 'Update Card' and IsNull(T1.transaction_state, '') = 'CREATED' and IsNull(T1.transaction_initiated_by, '') = 'CIT' 
			--		THEN 'Abandoned' 
			--when T1.Event = 'Update Card' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.transaction_initiated_by, '') = 'CIT' 
			--		THEN 'Success with SCA PreAuth' 
			--when T1.Event = 'Update Card' then 'Not Determined' 
			----Requested as a part of OPSBI-220

			/*PP Retail &amp; PP Affinity*/

			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used' 
			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success No Payment' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '942' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth' 
			WHEN IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used PreAuth'
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used PreAuth' 
			WHEN IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used PreAuth' 
			WHEN IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; ''  AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used PreAuth'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' AND IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth' 
			WHEN IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth'
			WHEN IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' AND IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA'
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED')  and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') 
					THEN 'Success with SCA PreAuth' 

			/*End of PP Retail &amp; PP Affinity*/


			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '942' 
					THEN 'Abandoned Before Transaction' 
			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and T1.Event = 'Visit' 
					THEN 'Investigate - No Delivery' 
			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Invalid Visit' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used' 

			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '942' and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' 
					THEN 'Abandoned Pre Payment' 
			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' 
					THEN 'Investigate - No Delivery' 
			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' 
					THEN 'Success No Payment' 
			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' 
					THEN 'Invalid Visit' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '942' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Abandoned Before Transaction' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and T1.Event = 'Visit' 
					THEN 'Investigate - No Delivery' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Invalid Visit' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and T1.Event = 'Visit' 
					THEN 'Abandoned Before Transaction' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '942' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') 
					THEN 'Success with SCA PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') 
					THEN 'Success with SCA PreAuth'
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used PreAuth'
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA' 

			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used' 
			when IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Abandoned During payment' 
			when IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and T1.Event = 'Visit' 
					THEN 'Investigate - No Delivery' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used' 
			when IsNull(T1.transaction_state, '') = 'CREATED' 
					THEN 'Abandoned' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used' 
			when IsNull(T1.transaction_state, '') = 'REFUNDED' 
					THEN 'Refunded' 
			when IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'SENT_FOR_AUTHORISATION' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.[Order Ref], '') &lt;&gt; ''
					THEN 'Abandoned During Payment' 
			when IsNull(T1.transaction_state, '') = 'SENT_FOR_VERIFICATION' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' 
					THEN 'Abandoned Pre Payment' 
			when IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and T1.Event = 'Visit' 
					THEN 'Abandoned Pre Payment' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA PreAuth'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Authentication requested' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - Authentication Requested' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Authorization System or issuer system inoperative' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - Authorization System or issuer system inoperative' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CARD BLOCKED' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - CARD BLOCKED' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CONTACT CARD ISSUER' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - CONTACT CARD ISSUER' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CREDITCARD ISSUER TEMPORARILY NOT REACHABLE' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - CREDITCARD ISSUER TEMPORARILY NOT REACHABLE' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Do not honour' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - Do not honour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Expired card' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - Expired card' 
			when IsNull(T1.response_payload_error_code_description, '') = 'FRAUD SUSPICION' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - FRAUD SUSPICION' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID ACCOUNT' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - INVALID ACCOUNT' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID SECURITY CODE' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decine - INVALID SECURITY CODE' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID TRANSACTION' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - INVALID TRANSACTION' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Issuer unavailable or switch inoperative (STIP not applicable or available for this transaction)' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Issuer Unavailable or Inoperative' 
			when IsNull(T1.response_payload_error_code_description, '') = 'LIMIT EXCEEDED' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - LIMIT EXCEEDED' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Capture card' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - Capture card' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CARD EXPIRED' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - CARD EXPIRED' 
			when IsNull(T1.response_payload_error_code_description, '') = 'DECLINED, EXPIRED CARD' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - DECLINED, EXPIRED CARD' 
			when IsNull(T1.response_payload_error_code_description, '') = 'ILLEGAL TRANSACTION' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - ILLEGAL TRANSACTION' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID ACCEPTOR' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - INVALID ACCEPTOR' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID CARD ISSUER' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - INVALID CARD ISSUER' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Invalid PIN' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - Invalid PIN' 
			when IsNull(T1.response_payload_error_code_description, '') = 'REJECTED BY CARD ISSUER' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - REJECTED BY CARD ISSUER' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Refer to card issuer' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - Refer to card issuer' 
			when IsNull(T1.response_payload_error_code_description, '') = 'REFUSED' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - REFUSED' 
			when IsNull(T1.response_payload_error_code_description, '') = 'RESTRICTED CARD' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - RESTRICTED CARD' 
			when IsNull(T1.response_payload_error_code_description, '') = 'STOLEN CARD, PICK UP' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - STOLEN CARD, PICK UP' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Try another card' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline - Try another card' 
			when IsNull(T1.response_payload_error_code_description, '') = 'UNKNOWN CARD' and IsNull(T1.transaction_state, '') = 'DECLINED' 
					THEN 'Valid Decline  - UNKNOWN CARD' 

			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success COF used' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA PreAuth' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA PreAuth'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA PreAuth'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA PreAuth'
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.IsDelivery, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') 
					THEN 'Success COF used' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.IsDelivery, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') 
					THEN 'Success COF used PreAuth' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.IsDelivery, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') 
					THEN 'Success with SCA' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.IsDelivery, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') 
					THEN 'Success with SCA PreAuth' 
		end as Outcome,
		/* Summary Status */
	case 
			when IsNull(T1.error_code, '') = '710' 
					THEN 'System Error' 
			when IsNull(T1.error_code, '') = '711' 
					THEN 'System Error' 
			when IsNull(T1.error_code, '') = '712' 
					THEN 'System Error' 
			when IsNull(T1.error_code, '') = '726' then 'System Error' 
			when IsNull(T1.error_code, '') = '727' then 'VALID DECLINE - Contact Issuer' 
			when IsNull(T1.error_code, '') = '729' then 'System Error' 
			when IsNull(T1.error_code, '') = '731' then 'System Error' 
			when IsNull(T1.error_code, '') = '733' then 'System Error' 
			when IsNull(T1.error_code, '') = '734' then 'System Error' 
			when IsNull(T1.error_code, '') = '740' then 'VALID DECLINE - Contact Issuer' 
			when IsNull(T1.error_code, '') = '741' then 'System Error' 
			when IsNull(T1.error_code, '') = '743' then 'System Error' 
			when IsNull(T1.error_code, '') = '744' then 'System Error' 
			when IsNull(T1.error_code, '') = '751' then 'VALID DECLINE - Contact Issuer' 
			when IsNull(T1.error_code, '') = '753' then 'VALID DECLINE - Payment Card Expired' 
			when IsNull(T1.error_code, '') = '757' then 'VALID DECLINE - Contact Issuer' 
			when IsNull(T1.error_code, '') = '760' then 'System Error' 
			when IsNull(T1.error_code, '') = '761' then 'System Error' 
			when IsNull(T1.error_code, '') = '763' then 'System Error' 
			when IsNull(T1.error_code, '') = '764' then 'System Error' 
			when IsNull(T1.error_code, '') = '780' then 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '782' then 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '781' then 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '783' then 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '784' then 'VALID DECLINE - Not eligible for inventory item.' 
			when IsNull(T1.error_code, '') = '790' then 'System Error' 
			when IsNull(T1.error_code, '') = '791' then 'System Error' 
			when IsNull(T1.error_code, '') = '792' then 'System Error' 
			when IsNull(T1.error_code, '') = '793' then 'System Error' 
			when IsNull(T1.error_code, '') = '796' then 'System Error' 
			when IsNull(T1.error_code, '') = '942' then 'Abandoned'
			when IsNull(T1.error_code, '') = '943' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '944' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '945' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '946' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '947' then 'Abandoned' 
			when IsNull(T1.error_code, '') LIKE '9%' then 'Abandoned'
			----Requested as a part of OPSBI-220
			--when T1.Event = 'Update Card' and IsNull(T1.transaction_state, '') = 'CREATED' and IsNull(T1.transaction_initiated_by, '') = 'CIT' then 'Abandoned' 
			--when T1.Event = 'Update Card' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.transaction_initiated_by, '') = 'CIT' then 'Success' 
			--when T1.Event = 'Update Card' then 'Not Determined' 
			----Requested as a part of OPSBI-220

			/* PP Retail &amp; PP Affinity */
			when IsNull(T1.amount, 0) &gt; 4 and T1.transaction_initiated_by = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and T1.transaction_initiated_by = 'MIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '942' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			WHEN IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' AND IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' AND IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') THEN 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' AND IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success'
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED')  and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED')  and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED')  and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 

			/* End of PP Retail &amp; PP Affinity*/

			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '')= '' AND (T1.Event='Registration' OR T1.Event='Renewal') THEN 'Success'
			when IsNull(T1.transaction_state, '') = 'Captured' and IsNull(T1.IsDelivery, '')= '' AND (T1.Event='Registration' OR T1.Event='Renewal') THEN 'Success'
			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '942' then 'Abandoned' 
			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and T1.Event = 'Visit' then 'Investigate - No Delivery' 
			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Invalid Visit' 
			when IsNull(T1.amount, 0) &gt; 4 and T1.transaction_initiated_by = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &gt; 4 and T1.transaction_initiated_by = 'MIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '942' and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' then 'Abandoned' 
			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' then 'Investigate - No Delivery' 
			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' then 'Success' 

			when IsNull(T1.transaction_initiated_by, '') = '' and IsNull(T1.transaction_state, '') = '' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') = '' and IsNull(T1.description, '') Like '%No Authentication%' then 'Invalid Visit' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '942' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Abandoned' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and T1.Event = 'Visit' then 'Investigate - No Delivery' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Invalid Visit' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and T1.Event = 'Visit' then 'Abandoned' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '942' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') then 'Success'


			WHEN IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') then 'Success' 

			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success COF used' 

			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and (IsNull(T1.error_code, '') &lt;&gt; '' and IsNull(T1.error_code, '') &lt;&gt; '942') and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Abandoned' 
			when IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and T1.Event = 'Visit' then 'Investigate - No Delivery' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.transaction_state, '') = 'CREATED' then 'Abandoned' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success'

			when IsNull(T1.transaction_state, '') = 'REFUNDED' then 'Refunded' 
			when IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'SENT_FOR_AUTHORISATION' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Abandoned' 
			when IsNull(T1.transaction_state, '') = 'SENT_FOR_VERIFICATION' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' then 'Abandoned' 
			when IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and T1.Event = 'Visit' then 'Abandoned' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Authentication requested' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Authentication Requested' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Authorization System or issuer system inoperative' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Authorization System or issuer system inoperative' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CARD BLOCKED' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - CARD BLOCKED' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CONTACT CARD ISSUER' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - CONTACT CARD ISSUER' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CREDITCARD ISSUER TEMPORARILY NOT REACHABLE' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - CREDITCARD ISSUER TEMPORARILY NOT REACHABLE' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Do not honour' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Do not honour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Expired card' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Expired card' 
			when IsNull(T1.response_payload_error_code_description, '') = 'FRAUD SUSPICION' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - FRAUD SUSPICION' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID ACCOUNT' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - INVALID ACCOUNT' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID SECURITY CODE' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - INVALID SECURITY CODE' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID TRANSACTION' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - INVALID TRANSACTION' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Issuer unavailable or switch inoperative (STIP not applicable or available for this transaction)' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Issuer Unavailable or Inoperative' 
			when IsNull(T1.response_payload_error_code_description, '') = 'LIMIT EXCEEDED' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - LIMIT EXCEEDED' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Refer to card issuer' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Refer to card issuer' 
			when IsNull(T1.response_payload_error_code_description, '') = 'REFUSED' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - REFUSED' 
			when IsNull(T1.response_payload_error_code_description, '') = 'RESTRICTED CARD' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - RESTRICTED CARD' 
			when IsNull(T1.response_payload_error_code_description, '') = 'STOLEN CARD, PICK UP' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - STOLEN CARD, PICK UP' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Try another card' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Try another card' 
			when IsNull(T1.response_payload_error_code_description, '') = 'UNKNOWN CARD' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline  - UNKNOWN CARD' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 

			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' AND IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.IsDelivery, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'MIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.IsDelivery, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') then 'Success' 
			when IsNull(T1.amount, 0) &gt; 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.IsDelivery, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') then 'Success' 
			when IsNull(T1.amount, 0) &lt;= 4 and IsNull(T1.transaction_initiated_by, '') = 'CIT' and IsNull(T1.transaction_state, '') in ('CANCELLED', 'CAPTURED', 'VERIFIED', 'AUTHORISED') and IsNull(T1.IsDelivery, '') = '' and IsNull(T1.error_code, '') = '' and IsNull(T1.[Order Ref], '') &lt;&gt; '' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') then 'Success' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Capture card' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Capture card' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CARD EXPIRED' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - CARD EXPIRED' 
			when IsNull(T1.response_payload_error_code_description, '') = 'DECLINED, EXPIRED CARD' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - DECLINED, EXPIRED CARD' 
			when IsNull(T1.response_payload_error_code_description, '') = 'ILLEGAL TRANSACTION' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - ILLEGAL TRANSACTION' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID ACCEPTOR' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - INVALID ACCEPTOR' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID CARD ISSUER' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - INVALID CARD ISSUER' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Invalid PIN' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - Invalid PIN' 
			when IsNull(T1.response_payload_error_code_description, '') = 'REJECTED BY CARD ISSUER' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Valid Decline - REJECTED BY CARD ISSUER' 
		end as [Summary Status],
		/* Status */
	case 
			when IsNull(T1.error_code, '') = '942' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '943' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '944' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '945' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '946' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '947' then 'Abandoned' 
			when IsNull(T1.error_code, '') LIKE '9%' then 'Abandoned' 
			when IsNull(T1.error_code, '') = '780' then 'Expected Behaviour' 
			when IsNull(T1.error_code, '') = '782' then 'Expected Behaviour' 
			----Requested as a part of OPSBI-220
			--when T1.Event = 'Update Card' and IsNull(T1.transaction_state, '') = 'CREATED' and IsNull(T1.transaction_initiated_by, '') = 'CIT' then 'Abandoned' 
			--when T1.Event = 'Update Card' and IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.transaction_initiated_by, '') = 'CIT' then 'Expected Behaviour' 
			--when T1.Event = 'Update Card' then 'Not Determined' 
			----Requested as a part of OPSBI-220

			/* PP Retail &amp; PP Affinity */

			when IsNull(T1.transaction_state, '') = 'AUTHORISED' AND (T1.Event='Registration' OR T1.Event='Renewal') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour'
			when IsNull(T1.transaction_state, '') = 'Captured' AND (T1.Event='Registration' OR T1.Event='Renewal') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour'
			when IsNull(T1.transaction_state, '') = 'AUTHORISED' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'CAPTURED' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour'
			when IsNull(T1.transaction_state, '') = 'VERIFIED' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'VERIFIED' and T1.Event = 'Visit' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'VERIFIED' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = '' AND ISNULL(T1.[Product Type],'') IN ('PP-Retail','PP-Affinity')
			THEN 'Expected Behaviour' 

			/* End of PP Retail &amp; PP Affinity */

			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '')= '' AND (T1.Event='Registration' OR T1.Event='Renewal') THEN 'Expected Behaviour'
			when IsNull(T1.transaction_state, '') = 'Captured' and IsNull(T1.IsDelivery, '')= '' AND (T1.Event='Registration' OR T1.Event='Renewal') THEN 'Expected Behaviour'
			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'AUTHORISED' and IsNull(T1.IsDelivery, '') = 'Y' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and T1.Event = 'Visit' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'CANCELLED' and IsNull(T1.IsDelivery, '') = 'Y' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'CREATED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'PARTIALLY_CAPTURED' and IsNull(T1.IsDelivery, '') = 'Y' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'REFUNDED' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'SENT_FOR_AUTHORISATION' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'SENT_FOR_VERIFICATION' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'VERIFIED' and (T1.Event = 'Renewal' or T1.Event = 'Registration' or T1.Event = 'Update Card') and IsNull(T1.IsDelivery, '') = '' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'VERIFIED' and T1.Event = 'Visit' and (IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' or IsNull(T1.IsDelivery, '') = '') then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'VERIFIED' and IsNull(T1.IsDelivery, '') = 'Y' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') &lt;&gt; '' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') &lt;&gt; 'Y' and IsNull(T1.error_code, '') = '' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = '' and IsNull(T1.IsDelivery, '') = 'Y' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'Authentication requested' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'Authorization System or issuer system inoperative' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'CARD BLOCKED' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'CONTACT CARD ISSUER' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'CREDITCARD ISSUER TEMPORARILY NOT REACHABLE' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'Do not honour' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'Expired card' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'FRAUD SUSPICION' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'INVALID ACCOUNT' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'INVALID SECURITY CODE' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'INVALID TRANSACTION' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'Issuer unavailable or switch inoperative (STIP not applicable or available for this transaction)' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'LIMIT EXCEEDED' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'Refer to card issuer' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'REFUSED' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'RESTRICTED CARD' then 'Unexpected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'STOLEN CARD, PICK UP' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'Try another card' then 'Expected Behaviour' 
			when IsNull(T1.transaction_state, '') = 'DECLINED' and IsNull(T1.response_payload_error_code_description, '') = 'UNKNOWN CARD' then 'Unexpected Behaviour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Capture card' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Expected Behaviour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'CARD EXPIRED' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Expected Behaviour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'DECLINED, EXPIRED CARD' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Expected Behaviour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'ILLEGAL TRANSACTION' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Expected Behaviour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID ACCEPTOR' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Expected Behaviour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'INVALID CARD ISSUER' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Expected Behaviour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'Invalid PIN' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Expected Behaviour' 
			when IsNull(T1.response_payload_error_code_description, '') = 'REJECTED BY CARD ISSUER' and IsNull(T1.transaction_state, '') = 'DECLINED' then 'Expected Behaviour' 
		end as Status,
	T1.[User Journey Code],
	T1.[Flag for Source Code],
	T1.source_media,
	T1.owner_product,
	T1.source_desc,
	T1.[Product Type1],
	T1.Event,
	T1.PaymentType,
	ISNULL(T1.[Product Type1],'')+' - '+ISNULL(T1.Event,'')+' - '+ISNULL(PaymentType,'') AS [Category],
	T1.servicecentre,
	row1#,
	T1.pk
from 
	(
	select DateDiff(HOUR, T.CurrentVisitDate, T.NextVisitDate) as [Diff in Hours],
		T.NextVisitDate as NextVisitDate1,
		T.NextErrorCode AS NextErrorCode1,
		T.CurrentVisitDate as CurrentVisitDate1,
		T.NextLoungeCode as NextLoungeCode1,
		case 
				when T.[Visit ID] is NULL then 1 
				else Row_Number() 
		over 
			(
			partition by T.[Consumer No], b.lounge_code, Cast(T.Date as DATE) 
			order by T.Date Desc, T.Time Desc
			) 
			end as row#, 
			ROW_NUMBER() 
			over 
				(
				partition by --T.description, 
				T.[Consumer No], Cast(T.Date as DATE) 
				order by T.Date Desc, T.Time Desc
				) as row1#
		, T.*, b.lounge_code, b.country_code, c.PilotWave, ptc.user_journey_title as [User Journey Code], 
		CASE 
				WHEN (ISNULL(T.error_code,'')=764 OR ISNULL(T.error_code,'')=796) THEN 'Error - Do Not Count'

				----OPSBI-219
				WHEN Upper(IsNull(T.description, '')) = '' AND IsNull(ptc.user_journey_title, '')='' AND IsDelivery = 'N' THEN 'Visit'
				WHEN UPPER(IsNull(ptc.user_journey_title, ''))='REGISTER B2B MEMBER' OR UPPER(IsNull(T.Description, ''))='REGISTER B2B MEMBER' THEN 'Visit'
				----
				----CHANGE OPSBI-190----
				when Upper(IsNull(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT IMPLICIT CIT' OR Upper(IsNull(T.Description, '')) ='CONSUMPTION PAYMENT IMPLICIT CIT'   then 'Visit' 
				----CHANGE OPSBI-190----

				when Upper(IsNull(ptc.user_journey_title, '')) = 'VALIDATE BANKCARD SIGNUP' OR Upper(IsNull(T.Description, '')) = 'VALIDATE BANKCARD SIGNUP'  THEN 'Registration' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT EXPLICIT CARD ON FILE' OR Upper(IsNull(T.Description, '')) = 'CONSUMPTION PAYMENT EXPLICIT CARD ON FILE'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT CARD ON FILE'  OR Upper(IsNull(T.Description, '')) = 'CONSUMPTION PAYMENT CARD ON FILE'  THEN 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'CONVERT PROSPECT MEMBER' OR Upper(IsNull(T.Description, '')) = 'CONVERT PROSPECT MEMBER'  then 'Registration' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT EXPLICIT CARD ON FILE' OR Upper(IsNull(T.Description, '')) = 'CONSUMPTION PAYMENT EXPLICIT CARD ON FILE'  THEN 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'ADD ACCOUNT LINE FROM PAYMENT HISTORY' OR Upper(IsNull(T.Description, '')) = 'ADD ACCOUNT LINE FROM PAYMENT HISTORY' then 'Manually Entered Account Line' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'ADD NEW PAYMENT CARD' OR Upper(IsNull(T.Description, '')) = 'ADD NEW PAYMENT CARD' then 'Update Card' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'ADD PURCHASE UI' OR Upper(IsNull(T.Description, '')) = 'ADD PURCHASE UI' then 'Registration' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'ADD RETAIL MEMBER' OR Upper(IsNull(T.Description, '')) = 'ADD RETAIL MEMBER'  then 'Registration' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'CONVERT PROSPECT MEMBER' OR UPPER(IsNull(T.Description, '')) = 'CONVERT PROSPECT MEMBER'  then 'Registration' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'DEVICE SWIPE VALIDATE VISIT' OR Upper(IsNull(T.Description, '')) = 'DEVICE SWIPE VALIDATE VISIT'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'DMC MANUAL VALIDATE VISIT' OR Upper(IsNull(T.Description, '')) = 'DMC MANUAL VALIDATE VISIT'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'DMC SCAN VALIDATE VISIT' OR Upper(IsNull(T.Description, '')) = 'DMC SCAN VALIDATE VISIT'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'LOUNGE VISIT LOAD' OR Upper(IsNull(T.Description, '')) = 'LOUNGE VISIT LOAD'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'MANUAL RENEWALS COF' OR Upper(IsNull(T.Description, '')) = 'MANUAL RENEWALS COF'  then 'Renewal' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'MANUAL RENEWALS NEW CARD' OR Upper(IsNull(T.Description, '')) = 'MANUAL RENEWALS NEW CARD'  then 'Renewal' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'MEMBERSHIP RENEWAL PROCESS' OR Upper(IsNull(T.Description, '')) = 'MEMBERSHIP RENEWAL PROCESS'  then 'Renewal' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'NON BANKCARD DEVICE PINPAD' OR Upper(IsNull(T.Description, '')) = 'NON BANKCARD DEVICE PINPAD' then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'NON BANKCARD DEVICE SWIPE' OR Upper(IsNull(T.Description, '')) = 'NON BANKCARD DEVICE SWIPE' then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'NON BANKCARD DMC MANUAL' OR Upper(IsNull(T.Description, '')) = 'NON BANKCARD DMC MANUAL'  THEN 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'NON BANKCARD DMC SCAN' OR Upper(IsNull(T.Description, '')) = 'NON BANKCARD DMC SCAN'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'NON BANKCARD PORTAL MANUAL' OR Upper(IsNull(T.Description, '')) = 'NON BANKCARD PORTAL MANUAL'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'OUTSTANDING PAYMENT COF' OR Upper(IsNull(T.Description, '')) = 'OUTSTANDING PAYMENT COF'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'OUTSTANDING PAYMENT NEW CARD' OR Upper(IsNull(T.Description, '')) = 'OUTSTANDING PAYMENT NEW CARD'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'OUTSTANDING PAYMENT NEW CARD STORE' OR Upper(IsNull(T.Description, '')) = 'OUTSTANDING PAYMENT NEW CARD STORE'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'REAL TIME VISIT' OR Upper(IsNull(T.Description, '')) = 'REAL TIME VISIT'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'RENEW PURCHASE USING EXISTING CARD ON FILE' OR Upper(IsNull(T.Description, '')) = 'RENEW PURCHASE USING EXISTING CARD ON FILE' then 'Renewal' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'UPDATE PAYMENT CARD FOR CONSUMPTION' OR Upper(IsNull(T.Description, '')) = 'UPDATE PAYMENT CARD FOR CONSUMPTION' then 'Update Card' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'UPDATE PAYMENT CARD FOR SUBSCRIPTION' OR Upper(IsNull(T.Description, '')) = 'UPDATE PAYMENT CARD FOR SUBSCRIPTION' then 'Update Card' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'DEVICE SWIPE VALIDATE VIST' OR Upper(IsNull(T.Description, '')) = 'DEVICE SWIPE VALIDATE VIST' then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'CONSUMPTION PAYMENT IMPLICIT CARD ON FILE' OR Upper(IsNull(T.Description, '')) = 'CONSUMPTION PAYMENT IMPLICIT CARD ON FILE'  then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'RENEW PURCHASE USING NEW CARD' OR Upper(IsNull(T.Description, '')) = 'RENEW PURCHASE USING NEW CARD' then 'Renewal' 
				when Upper(IsNull(ptc.user_journey_title, '')) = 'ONE OFF OVERRIDE' OR Upper(IsNull(T.Description, '')) = 'ONE OFF OVERRIDE' THEN 'Visit'
				when UPPER(ISNULL(T._userJourneyCode,'')) like '%consumption_payment_oneoff_CIT%' OR UPPER(ISNULL(T.Description,'')) like '%consumption_payment_oneoff_CIT%' then 'Visit'
				when UPPER(ISNULL(T._userJourneyCode,'')) like '%UPDATE_PROSPECT_MEMBER%' OR UPPER(ISNULL(T.Description,'')) like '%UPDATE_PROSPECT_MEMBER%' then 'Update Card'
				when UPPER(ISNULL(T._userJourneyCode,'')) like '%UPDATE PROSPECT MEMBER%' OR UPPER(ISNULL(T.Description,'')) like '%UPDATE PROSPECT MEMBER%' then 'Update Card'
				when Upper(IsNull(ptc.user_journey_title, '')) = '' and IsNull(T.IsDelivery, '') &lt;&gt; '' and IsNull(T.[Visit ID], '') &lt;&gt; '' then 'Visit' 
				when Upper(IsNull(ptc.user_journey_title, '')) = '' and IsNull(T.description, '') Like '%Subscription%' then 'Registration' 
				else 'Not Determined'  
			end as Event, case 
				when IsNull(T.transaction_initiated_by, '') = 'CIT' then 'CIT' 
				when IsNull(T.transaction_initiated_by, '') = 'MIT' then 'MIT' 
				when IsNull(T.transaction_initiated_by, '') = '' and IsNull(T.IsDelivery, '') &lt;&gt; '' and IsNull(T.[Visit ID], '') &lt;&gt; '' and IsNull(T.id, '') = '' then 'No Authentication' 
			end as PaymentType,
			CASE WHEN ISNULL(T.is_access_on_payment_card,0)=1 AND T.[Product Type]='PP-B2B' THEN 'PP-AOPC'
					 WHEN ISNULL(T.is_access_on_payment_card,0)=0 AND T.[Product Type]='PP-B2B' THEN 'PP-NON-AOPC'
					 ELSE T.[Product Type]
			END AS [Product Type1]
	from 
		(
		select distinct 
			LEAD(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc])) 
		over 
			(
			partition by Coalesce(a.consumer_id, a.[Consumer number]), Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE) 
			order by Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE), Convert(varchar, Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as TIME), 108)
			) as NextVisitDate,

			LEAD(a.error_code) 
		over 
			(
			partition by Coalesce(a.consumer_id, a.[Consumer number]), Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE) 
			order by Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE), Convert(varchar, Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as TIME), 108)
			) as NextErrorCode,

			COALESCE(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as CurrentVisitDate, 
			LEAD(Substring(a.[Visit reference], 1, Cast(Replace(CharIndex(Substring(Replace(Convert(VARCHAR(10), Convert(DATE, Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]), 111)), '-', ''), 3, 8), a.[Visit reference]) - 1, -1, 3) as INT))) 
		over 
			(
			partition by Coalesce(a.consumer_id, a.[Consumer number]), Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE) 
			order by Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE), Convert(varchar, Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as TIME), 108)
			) as NextLoungeCode, 
			a.id, a.transaction_type, a.transaction_initiated_by, 
			CASE 
					when IsNull(s.owner_product, '') = 'LK' and IsNull(a.IsDelivery, '') &lt;&gt; '' and IsNull(a.description, '') = '' and 
						--LEFT(IsNull(a.[Visit reference], ''), CharIndex('-', a.[Visit reference]) - 1) &lt;&gt; ''
						IsNull(a.[Visit reference], '') &lt;&gt; ''
						AND IsNull(a.id, '') = '' 
					THEN 'LK Visit - No Authentication' 
					when (IsNull(s.owner_product, '') = 'PP' or IsNull(s.owner_product, '') = 'BC') and IsNull(a.IsDelivery, '') &lt;&gt; '' and IsNull(a.description, '') = '' 
						--AND Left(IsNull(a.[Visit reference], ''), CharIndex('-', a.[Visit reference]) - 1) &lt;&gt; '' 
						AND IsNull(a.[Visit reference], '')&lt;&gt;''
						AND IsNull(a.id, '') = '' 
					THEN 'PP Visit - No Authentication' 
					else a.description 
				end 
			AS description, 
			a.description as description1, a.currency, a.amount, a.transaction_state, a.transaction_created_date, a.transaction_Source_code, a.consumer_id, a.response_payload_error_code, a.response_payload_error_code_description, a.Ppass_source_code, a.[denied_delivery/delivery_date_utc], a.[Consumer Name], a.[Consumer number], a.[Payments Order number], Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code) as [Source C], case 
					when a.transaction_Source_code &lt;&gt; a.[Source code] then 1 
					when a.transaction_Source_code &lt;&gt; a.Ppass_source_code then 1 
					when a.Ppass_source_code &lt;&gt; a.[Source code] then 1 
					else 0 
				end [Flag for Source Code], a.error_code, a.IsDelivery, a.Product, a.[payments.scaEnabled] as scaEnabled, 
				a.[Payments.paymentCardVerificationDuringConsumption] as paymentCardVerificationDuringConsumption, 

				CASE WHEN ISNULL(a.[Visit reference],'') LIKE '%-%' 
						THEN LEFT(a.[Visit reference], CharIndex('-', a.[Visit reference]) - 1)
						ELSE ISNULL(a.[Visit reference],'') END AS [Visit ID], 
				CASE WHEN ISNULL(a.[Visit reference],'') LIKE '%-%' 
						THEN REPLACE(Substring(a.[Visit reference], CharIndex('-', a.[Visit reference]), Len(a.[Visit reference])), '-', '') 
						ELSE '' END AS [Device ID], 


				SUBSTRING(a.[Visit reference],0,(CASE 
				WHEN a.[Visit reference] LIKE '%'+SUBSTRING(REPLACE(CAST(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE),'-',''),3,8)+'%' THEN 
		CHARINDEX(SUBSTRING(REPLACE(CAST(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE),'-',''),3,8),a.[Visit reference])
				WHEN a.[Visit reference] LIKE '%'+SUBSTRING(REPLACE(DATEADD(dd,1, CAST(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE)),'-',''),3,8)+'%' THEN 
		CHARINDEX(SUBSTRING(REPLACE(DATEADD(dd,1, CAST(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE)),'-',''),3,8),a.[Visit reference])
				WHEN a.[Visit reference] LIKE '%'+SUBSTRING(REPLACE(DATEADD(dd,-1, CAST(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE)),'-',''),3,8)+'%' THEN 
		CHARINDEX(SUBSTRING(REPLACE(DATEADD(dd,-1, CAST(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE)),'-',''),3,8),a.[Visit reference])
				END)) AS [Lounge Code],

				--SUBSTRING(a.[Visit reference], 1, Cast(Replace(CharIndex(Substring(Replace(Convert(VARCHAR(10), Convert(DATE, Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]), 111)), '-', ''), 3, 8), a.[Visit reference]) - 1, -1, 3) as INT)) as [Lounge Code], 

				CAST(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as DATE) as Date, Convert(varchar, Cast(Coalesce(a.transaction_created_date, a.[denied_delivery/delivery_date_utc]) as TIME), 108) as Time, case 
					when a.transaction_initiated_by in ('CIT', 'MIT') and IsNull(a.transaction_state, '') in ('CAPTURED', 'CANCELLED', 'AUTHORISED') and a.IsDelivery = 'Y' then 'Expected Behaviour' 
					when a.transaction_initiated_by in ('CIT', 'MIT') and IsNull(a.transaction_state, '') not in ('CAPTURED', 'CANCELLED', 'AUTHORISED', 'DECLINED') then 'Unexpected Behaviour' 
					when a.transaction_initiated_by in ('CIT', 'MIT') and IsNull(a.transaction_state, '') = 'DECLINED' and a.response_payload_error_code in (34, 91) then 'Unexpected Behaviour' 
					when a.transaction_initiated_by in ('CIT', 'MIT') and IsNull(a.transaction_state, '') = 'DECLINED' and a.response_payload_error_code in (5, 6, 10, 51, 62, 76) then 'Expected Behaviour' 
				end as Status, case 
					when IsNull(a.transaction_state, '') in ('CAPTURED', 'CANCELLED', 'AUTHORISED', 'REFUNDED', 'PARTIALLY_CAPTURED', 'VERIFIED') then 'Approved' 
					when IsNull(a.transaction_state, '') = 'DECLINED' and IsNull(a.response_payload_error_code_description, '') = 'Authentication requested' then 'Soft Decline' 
					when a.transaction_state = 'DECLINED' then 'Declined' 
					when a.transaction_state in ('SENT_FOR_AUTHORISATION', 'SENT_FOR_VERIFICATION') then 'Orphan' 
					when IsNull(a.transaction_state, '') in ('CREATED', '') then 'No payment' 
					when IsNull(a.response_payload_error_code_description, '') = 'Capture card' and IsNull(a.transaction_state, '') = 'DECLINED' then 'Declined' 
					when IsNull(a.response_payload_error_code_description, '') = 'CARD EXPIRED' and IsNull(a.transaction_state, '') = 'DECLINED' then 'Declined' 
					when IsNull(a.response_payload_error_code_description, '') = 'DECLINED, EXPIRED CARD' and IsNull(a.transaction_state, '') = 'DECLINED' then 'Declined' 
					when IsNull(a.response_payload_error_code_description, '') = 'ILLEGAL TRANSACTION' and IsNull(a.transaction_state, '') = 'DECLINED' then 'Declined' 
					when IsNull(a.response_payload_error_code_description, '') = 'INVALID ACCEPTOR' and IsNull(a.transaction_state, '') = 'DECLINED' then 'Declined' 
					when IsNull(a.response_payload_error_code_description, '') = 'INVALID CARD ISSUER' and IsNull(a.transaction_state, '') = 'DECLINED' then 'Declined' 
					when IsNull(a.response_payload_error_code_description, '') = 'Invalid PIN' and IsNull(a.transaction_state, '') = 'DECLINED' then 'Declined' 
					when IsNull(a.response_payload_error_code_description, '') = 'REJECTED BY CARD ISSUER' and IsNull(a.transaction_state, '') = 'DECLINED' then 'Declined' 
					else '' 
				end as [Finance status], 
				CASE 
					when a.transaction_initiated_by = 'CIT' and IsNull(a.transaction_state, '') in ('CAPTURED', 'CANCELLED', 'AUTHORISED') and a.IsDelivery = 'Y' and a.amount &gt; 4 then 'Success with SCA' 
					when a.transaction_initiated_by = 'CIT' and IsNull(a.transaction_state, '') in ('CAPTURED', 'CANCELLED', 'AUTHORISED') and a.IsDelivery = 'Y' and a.amount &lt; 4 then 'Success with SCA Preauth' 
					when a.transaction_initiated_by = 'MIT' and IsNull(a.transaction_state, '') in ('CAPTURED', 'CANCELLED', 'AUTHORISED') and a.IsDelivery = 'Y' and a.amount &gt; 4 then 'Success COF used' 
					when a.transaction_initiated_by = 'MIT' and IsNull(a.transaction_state, '') in ('CAPTURED', 'CANCELLED', 'AUTHORISED') and a.IsDelivery = 'Y' and a.amount &lt; 4 then 'Success COF used PreAuth' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'DECLINED' and a.response_payload_error_code = 34) then 'Valid Decline - FRAUD SUSPICION' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'DECLINED' and a.response_payload_error_code = 5) then 'Valid Decline - Do Not Honour' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'DECLINED' and a.response_payload_error_code = 6) then 'Valid Decline - TRY ANOTHER CARD' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'DECLINED' and a.response_payload_error_code = 10) then 'Valid Decline - UNKNOWN CARD' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'DECLINED' and a.response_payload_error_code = 51) then 'Valid Decline - LIMIT EXCEEDED' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'DECLINED' and a.response_payload_error_code = 62) then 'Valid Decline - RESTRICTED CARD' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'DECLINED' and a.response_payload_error_code = 76) then 'Valid Decline - CARD BLOCKED' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'DECLINED' and a.response_payload_error_code = 91) then 'Valid Decline - Issuer Unavailable or Inoperative' 
					when a.transaction_initiated_by = 'CIT' and IsNull(a.transaction_state, '') in ('SENT_FOR_AUTHORISATION', 'AUTHORISED') and a.IsDelivery = 'N' then 'Abandoned during payment' 
					when a.transaction_initiated_by in ('MIT', 'CIT') and (a.transaction_state = 'REFUNDED') then 'Refunded' 
					when a.transaction_initiated_by = 'CIT' and IsNull(a.transaction_state, '') in ('SENT_FOR_VERIFICATION', 'VERIFIED') and a.IsDelivery = 'N' then 'Abandoned Pre Payment' 
					when a.IsDelivery = 'Y' and (a.[Payments Order number] is NULL and a.id is Null) then 'Success' 
					else 'Investigate' 
				end as Outcome, 
				COALESCE(a.id, a.[Payments Order number]) as [Order Ref], 
				CASE 
					when Coalesce(a.consumer_id, a.[Consumer number]) = 0 then '' 
					else Coalesce(a.consumer_id, a.[Consumer number]) 
				end as [Consumer No], a.LoadedDate, Replace(a.userJourneyCode, '"', '') as _userJourneyCode, s.source_media, s.owner_product, s.source_desc, 
				CASE 
					----CHANGE OPSBI-189----
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') in ('B','G')  and IsNull(s.owner_product, '') = 'PP'
					 then 'PP-B2B' 
					WHEN (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') in ('B','G') 
					 then 'PP-AOPC' 
					----CHANGE OPSBI-189----
					WHEN (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') in ('A','C','E','F','K','L','M','N','O','Q','R','S','T','U','V','Y') 
					 then 'PP-Retail' 
					 when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') in ('Z','ZD','ZL') then 'LK' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'D' and IsNull(s.owner_product, '') = 'BC' then 'PP-B2B' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'D' and IsNull(s.owner_product, '') = 'LK' then 'LK' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'D' and IsNull(s.owner_product, '') = 'PP' then 'PP-B2B' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'DD' and IsNull(s.owner_product, '') = 'PP' then 'PP-B2B' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'DM' and IsNull(s.owner_product, '') = 'PP' then 'PP-B2B' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'H' and IsNull(s.owner_product, '') = 'PP' then 'PP-Affinity' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'I' and IsNull(s.owner_product, '') = 'PP' then 'PP-Retail' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'J' and IsNull(s.owner_product, '') = 'PP' then 'PP-Retail' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'W' and IsNull(s.owner_product, '') = 'PP' then 'PP-Retail' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'X' and IsNull(s.owner_product, '') = 'LK' then 'LK' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'XA' and IsNull(s.owner_product, '') = 'LK' then 'LK' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'Z' and IsNull(s.owner_product, '') = 'LK' then 'LK' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'ZA' and IsNull(s.owner_product, '') = 'LK' then 'LK' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) = '' and IsNull(a.description, '') Like '%LK%' then 'LK' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) = '' and IsNull(a.description, '') = '' then 'Not Available' 
					when IsNull(s.source_media, '') = '' and IsNull(s.owner_product, '') = '' and IsNull(a.description, '') Like '%LK%' then 'LK' 
					when (Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code)) &lt;&gt; '' and IsNull(s.source_media, '') = 'P' and IsNull(s.owner_product, '') = 'PP' then 'PP-Retail' 
					else 'Not Determined' 
				end as [Product Type] ,
				sdc.is_access_on_payment_card,
				s.servicecentre,
				a.pk
		from PPass.dbo.PTGDB3220_DailyReport_nofilter a 
			left join PPass.dbo.source s on Coalesce(a.transaction_Source_code, a.[Source code], a.Ppass_source_code) = s.source_code
			LEFT JOIN PPass.dbo.source_deal_config sdc ON s.source_code=sdc.source_code
		) as T 
		left join PPass.dbo.lounge b on T.[Lounge Code] = b.lounge_code 
		left join PPass.dbo.EVOReportingPilotWave c on T.[Source C] = c.SourceCode 
		left join PPass.dbo.payment_transaction_config ptc on (T._userJourneyCode = ptc.user_journey_code or T._userJourneyCode = Cast(ptc.payment_transaction_config_id as VARCHAR(50)))
	) as T1
order by T1.[Consumer No], T1.CurrentVisitDate1, T1.Date, T1.Time</File>
              <FormatSpecificOptions>
                <SingleRowFetch>False</SingleRowFetch>
                <ReadCentroids>False</ReadCentroids>
                <TableStyle>Quoted</TableStyle>
                <CacheData>False</CacheData>
                <SessionReadOnly>True</SessionReadOnly>
                <ReadUncommitted>False</ReadUncommitted>
                <NoProgress>True</NoProgress>
                <PostSQL />
                <PreSQLOnConfig>True</PreSQLOnConfig>
                <PreSQL />
              </FormatSpecificOptions>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>aka:CDE OPS (PPASS)
Query=select 
T1.id,
	T1.transacti...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
            <Dependencies>
              <Implicit />
            </Dependencies>
            <MetaInfo connection="Output">
              <RecordInfo>
                <Field name="id" size="36" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="transaction_type" size="10" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="transaction_initiated_by" size="5" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="description" size="100" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="currency" size="4" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="amount" scale="10" size="22" source="File: CDE OPS (PPASS)" type="FixedDecimal" />
                <Field name="transaction_state" size="30" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="transaction_created_date" size="30" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="consumer_id" size="50" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="response_payload_error_code" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="response_payload_error_code_description" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Ppass_source_code" size="100" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="transaction_Source_code" size="100" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="denied_delivery/delivery_date_utc" size="30" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Consumer Name" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Consumer number" source="File: CDE OPS (PPASS)" type="Int64" />
                <Field name="Payments Order number" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="error_code" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="IsDelivery" size="1" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Product" size="30" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Visit ID" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Device ID" size="4000" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Date" source="File: CDE OPS (PPASS)" type="Date" />
                <Field name="Time" size="30" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="lounge_code" size="6" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="country_code" size="3" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Source C" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Order Ref" size="255" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Consumer No" source="File: CDE OPS (PPASS)" type="Int64" />
                <Field name="scaEnabled" size="10" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="paymentCardVerificationDuringConsumption" size="50" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="PilotWave" size="50" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="LoadedDate" source="File: CDE OPS (PPASS)" type="DateTime" />
                <Field name="Finance status" size="12" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="_userJourneyCode" size="4000" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Last Transaction" size="20" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Outcome" size="65" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Summary Status" size="65" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Status" size="20" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="User Journey Code" size="100" source="File: CDE OPS (PPASS)" type="V_WString" />
                <Field name="Flag for Source Code" source="File: CDE OPS (PPASS)" type="Int32" />
                <Field name="source_media" size="10" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="owner_product" size="7" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="source_desc" size="30" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Product Type1" size="14" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Event" size="29" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="PaymentType" size="17" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="Category" size="66" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="servicecentre" size="1" source="File: CDE OPS (PPASS)" type="V_String" />
                <Field name="row1#" source="File: CDE OPS (PPASS)" type="Int64" />
                <Field name="pk" source="File: CDE OPS (PPASS)" type="Int32" />
              </RecordInfo>
            </MetaInfo>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileInput" />
        </Node>
        <Node ToolID="3">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Join.Join">
            <Position x="482" y="217" />
          </GuiSettings>
          <Properties>
            <Configuration joinByRecordPos="False">
              <JoinInfo connection="Left">
                <Field field="source_code" />
              </JoinInfo>
              <JoinInfo connection="Right">
                <Field field="Source C" />
              </JoinInfo>
              <SelectConfiguration>
                <Configuration outputConnection="Join">
                  <OrderChanged value="False" />
                  <CommaDecimal value="False" />
                  <SelectFields>
                    <SelectField field="Left_source_code" selected="False" input="Left_" />
                    <SelectField field="Left_country_of_issue" selected="True" rename="Issuer Country" input="Left_" />
                    <SelectField field="Right_currency" selected="True" rename="Right_currency" input="Right_" />
                    <SelectField field="Left_prefix" selected="False" input="Left_" />
                    <SelectField field="Left_ica" selected="False" input="Left_" />
                    <SelectField field="Left_reporting_ica" selected="False" input="Left_" />
                    <SelectField field="Left_bin" selected="False" input="Left_" />
                    <SelectField field="Left_group_code" selected="False" input="Left_" />
                    <SelectField field="Left_clean_issuer_name" selected="False" input="Left_" />
                    <SelectField field="Left_country_of_issue_iso" selected="False" input="Left_" />
                    <SelectField field="Left_cg_region_of_issue" selected="False" input="Left_" />
                    <SelectField field="Left_client_region_of_issue" selected="False" input="Left_" />
                    <SelectField field="Left_client_sub_region_of_issue" selected="False" input="Left_" />
                    <SelectField field="Left_model" selected="False" input="Left_" />
                    <SelectField field="Left_deal_status" selected="False" input="Left_" />
                    <SelectField field="Left_deal_start_date" selected="False" input="Left_" />
                    <SelectField field="Left_deal_cancellation_date" selected="False" input="Left_" />
                    <SelectField field="Left_client_service_centre" selected="False" input="Left_" />
                    <SelectField field="Left_contract_type" selected="False" input="Left_" />
                    <SelectField field="Left_card_type" selected="False" input="Left_" />
                    <SelectField field="Left_membership_fee_currency" selected="False" input="Left_" />
                    <SelectField field="Left_membership_fee" selected="False" input="Left_" />
                    <SelectField field="Left_selected_non_selected" selected="False" input="Left_" />
                    <SelectField field="Left_po_charge_type" selected="False" input="Left_" />
                    <SelectField field="Left_billing_inclusion_lounge_visits" selected="False" input="Left_" />
                    <SelectField field="Left_billing_inclusion_memberships" selected="False" input="Left_" />
                    <SelectField field="Left_decline" selected="False" input="Left_" />
                    <SelectField field="Left_bid" selected="False" input="Left_" />
                    <SelectField field="Left_lounge_set_selected" selected="False" input="Left_" />
                    <SelectField field="Left_lv_report_credit_card_type" selected="False" input="Left_" />
                    <SelectField field="Left_consolidated_report" selected="False" input="Left_" />
                    <SelectField field="Left_currency" selected="False" input="Left_" />
                    <SelectField field="Left_created_dt" selected="False" input="Left_" />
                    <SelectField field="*Unknown" selected="True" />
                  </SelectFields>
                </Configuration>
              </SelectConfiguration>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxJoin" />
        </Node>
        <Node ToolID="4">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="674" y="155" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="True" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="id" selected="True" />
                <SelectField field="transaction_type" selected="True" />
                <SelectField field="transaction_initiated_by" selected="True" />
                <SelectField field="description" selected="True" />
                <SelectField field="Right_currency" selected="True" rename="Currency" />
                <SelectField field="amount" selected="True" type="Float" size="4" />
                <SelectField field="transaction_state" selected="True" />
                <SelectField field="transaction_created_date" selected="True" />
                <SelectField field="consumer_id" selected="True" />
                <SelectField field="response_payload_error_code" selected="True" />
                <SelectField field="response_payload_error_code_description" selected="True" />
                <SelectField field="Ppass_source_code" selected="True" />
                <SelectField field="denied_delivery/delivery_date_utc" selected="True" />
                <SelectField field="Consumer Name" selected="True" />
                <SelectField field="Consumer number" selected="True" />
                <SelectField field="Payments Order number" selected="True" />
                <SelectField field="error_code" selected="True" />
                <SelectField field="IsDelivery" selected="True" />
                <SelectField field="Product" selected="True" />
                <SelectField field="Visit ID" selected="True" />
                <SelectField field="Device ID" selected="True" />
                <SelectField field="Date" selected="True" />
                <SelectField field="Time" selected="True" />
                <SelectField field="Status" selected="True" />
                <SelectField field="Finance status" selected="True" />
                <SelectField field="Outcome" selected="True" />
                <SelectField field="lounge_code" selected="True" />
                <SelectField field="country_code" selected="True" />
                <SelectField field="client_name" selected="True" rename="Network" />
                <SelectField field="issuer_name" selected="True" rename="Issuer" />
                <SelectField field="Last Transaction" selected="True" />
                <SelectField field="currency" selected="False" />
                <SelectField field="Source C" selected="True" />
                <SelectField field="Order Ref" selected="True" />
                <SelectField field="Consumer No" selected="True" />
                <SelectField field="Summary Status" selected="True" />
                <SelectField field="Issuer Country" selected="True" />
                <SelectField field="PilotWave" selected="True" />
                <SelectField field="deal_type" selected="True" />
                <SelectField field="LoadedDate" selected="True" />
                <SelectField field="lounge_programme" selected="True" />
                <SelectField field="scaEnabled" selected="True" />
                <SelectField field="paymentCardVerificationDuringConsumption" selected="True" />
                <SelectField field="User Journey Code" selected="True" />
                <SelectField field="Flag for Source Code" selected="True" />
                <SelectField field="transaction_Source_code" selected="True" />
                <SelectField field="_userJourneyCode" selected="True" />
                <SelectField field="source_media" selected="True" />
                <SelectField field="owner_product" selected="True" />
                <SelectField field="source_desc" selected="True" />
                <SelectField field="Product Type1" selected="True" />
                <SelectField field="Event" selected="True" />
                <SelectField field="PaymentType" selected="True" />
                <SelectField field="Category" selected="True" />
                <SelectField field="servicecentre" selected="True" />
                <SelectField field="row1#" selected="True" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="5">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Unique.Unique">
            <Position x="770" y="155" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <UniqueFields>
                <Field field="id" />
                <Field field="transaction_type" />
                <Field field="transaction_initiated_by" />
                <Field field="description" />
                <Field field="Currency" />
                <Field field="amount" />
                <Field field="transaction_state" />
                <Field field="transaction_created_date" />
                <Field field="consumer_id" />
                <Field field="response_payload_error_code" />
                <Field field="response_payload_error_code_description" />
                <Field field="Ppass_source_code" />
                <Field field="denied_delivery/delivery_date_utc" />
                <Field field="Consumer Name" />
                <Field field="Consumer number" />
                <Field field="Payments Order number" />
                <Field field="error_code" />
                <Field field="IsDelivery" />
                <Field field="Product" />
                <Field field="Visit ID" />
                <Field field="Device ID" />
                <Field field="Date" />
                <Field field="Time" />
                <Field field="Status" />
                <Field field="Finance status" />
                <Field field="Outcome" />
                <Field field="lounge_code" />
                <Field field="country_code" />
                <Field field="Network" />
                <Field field="Last Transaction" />
                <Field field="Source C" />
                <Field field="Order Ref" />
                <Field field="Consumer No" />
                <Field field="Summary Status" />
              </UniqueFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnique" />
        </Node>
        <Node ToolID="6">
          <GuiSettings Plugin="AlteryxSpatialPluginsGui.Summarize.Summarize">
            <Position x="734" y="337" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <SummarizeFields>
                <SummarizeField field="Source C" action="GroupBy" rename="Source C" />
                <SummarizeField field="issuer_name" action="CountDistinct" rename="CountDistinct_issuer_name" />
                <SummarizeField field="Issuer Country" action="CountDistinct" rename="CountDistinct_Issuer Country" />
                <SummarizeField field="client_name" action="CountDistinct" rename="CountDistinct_client_name" />
                <SummarizeField field="deal_type" action="CountDistinct" rename="CountDistinct_deal_type" />
              </SummarizeFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxSpatialPluginsEngine.dll" EngineDllEntryPoint="AlteryxSummarize" />
        </Node>
        <Node ToolID="7">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Unique.Unique">
            <Position x="638" y="265" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <UniqueFields>
                <Field field="issuer_name" />
                <Field field="Issuer Country" />
                <Field field="Visit ID" />
                <Field field="Source C" />
              </UniqueFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnique" />
        </Node>
        <Node ToolID="8">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Join.Join">
            <Position x="950" y="268" />
          </GuiSettings>
          <Properties>
            <Configuration joinByRecordPos="False">
              <JoinInfo connection="Left">
                <Field field="Source C" />
              </JoinInfo>
              <JoinInfo connection="Right">
                <Field field="Source C" />
              </JoinInfo>
              <SelectConfiguration>
                <Configuration outputConnection="Join">
                  <OrderChanged value="False" />
                  <CommaDecimal value="False" />
                  <SelectFields>
                    <SelectField field="Right_Source C" selected="True" rename="Right_Source C" input="Right_" />
                    <SelectField field="Right_Consumer number" selected="False" rename="Right_Consumer number" input="Right_" />
                    <SelectField field="Right_Visit ID" selected="False" rename="Right_Visit ID" input="Right_" />
                    <SelectField field="Right_Consumer No" selected="False" rename="Right_Consumer No" input="Right_" />
                    <SelectField field="*Unknown" selected="True" />
                  </SelectFields>
                </Configuration>
              </SelectConfiguration>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxJoin" />
        </Node>
        <Node ToolID="10">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="1142" y="316" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="if [CountDistinct_issuer_name]&gt;1 then &quot;Multiple Bank&quot; else [Issuer] endif&#xA;" field="Issuer" size="255" type="V_WString" />
                <FormulaField expression="if [CountDistinct_Issuer Country]&gt;1 then &quot;Multiple Country&quot; else [Issuer Country] endif&#xA;" field="IssuerCountry" size="1073741823" type="V_WString" />
                <FormulaField expression="if [CountDistinct_client_name]&gt;1 then &quot;Multiple Network&quot; else [Network] endif&#xA;" field="Network" size="255" type="V_WString" />
                <FormulaField expression="&quot;&quot;" field="Ppass_source_code" size="100" type="V_WString" />
                <FormulaField expression="&quot;&quot;" field="Product" size="30" type="V_WString" />
                <FormulaField expression="IF [lounge_programme]=&quot;LoungeKey&quot; then &quot;LK&quot; elseif [lounge_programme]=&quot;PriorityPass&quot; then &quot;PP&quot; else [lounge_programme] endif" field="lounge_programme" size="45" type="V_WString" />
                <FormulaField expression="if [Summary Status]=&quot;Abandoned&quot; then &quot;Abandoned&quot; else [Status] endif" field="Status" size="20" type="V_String" />
                <FormulaField expression="if [CountDistinct_deal_type]&gt;1 then &quot;Multiple Deal Type&quot; else [deal_type] endif" field="deal_type" size="45" type="V_WString" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>Issuer = if [CountDistinct_issuer_name]&gt;1 then "Multiple Bank" else [Issuer] end...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="11">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="1238" y="316" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="False" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="Issuer Country" selected="False" />
                <SelectField field="deal_type" selected="True" rename="Source Type" />
                <SelectField field="Right_Source C" selected="False" />
                <SelectField field="CountDistinct_issuer_name" selected="False" />
                <SelectField field="CountDistinct_Issuer Country" selected="False" />
                <SelectField field="Count" selected="False" />
                <SelectField field="Right_Consumer number" selected="False" />
                <SelectField field="Issuer Name" selected="False" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="12">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Unique.Unique">
            <Position x="1334" y="316" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <UniqueFields>
                <Field field="id" />
                <Field field="transaction_type" />
                <Field field="transaction_initiated_by" />
                <Field field="description" />
                <Field field="Currency" />
                <Field field="amount" />
                <Field field="transaction_state" />
                <Field field="transaction_created_date" />
                <Field field="consumer_id" />
                <Field field="response_payload_error_code" />
                <Field field="response_payload_error_code_description" />
                <Field field="Ppass_source_code" />
                <Field field="denied_delivery/delivery_date_utc" />
                <Field field="Consumer Name" />
                <Field field="Consumer number" />
                <Field field="Payments Order number" />
                <Field field="error_code" />
                <Field field="IsDelivery" />
                <Field field="Product" />
                <Field field="Visit ID" />
                <Field field="Device ID" />
                <Field field="Date" />
                <Field field="Time" />
                <Field field="Status" />
                <Field field="Finance status" />
                <Field field="Outcome" />
                <Field field="lounge_code" />
                <Field field="country_code" />
                <Field field="Network" />
                <Field field="Issuer" />
                <Field field="Last Transaction" />
                <Field field="Source C" />
                <Field field="Order Ref" />
                <Field field="Consumer No" />
                <Field field="Summary Status" />
                <Field field="PilotWave" />
                <Field field="Source Type" />
                <Field field="IssuerCountry" />
              </UniqueFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnique" />
        </Node>
        <Node ToolID="13">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Union.Union">
            <Position x="1046" y="340" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <ByName_ErrorMode>Warning</ByName_ErrorMode>
              <ByName_OutputMode>All</ByName_OutputMode>
              <Mode>ByName</Mode>
              <SetOutputOrder value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnion" />
        </Node>
        <Node ToolID="14">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Filter.Filter">
            <Position x="854" y="315" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Expression>[CountDistinct_issuer_name] &gt; 1 OR [CountDistinct_Issuer Country]&gt;1 OR [CountDistinct_client_name]&gt;1 OR [CountDistinct_deal_type]&gt;1</Expression>
              <Mode>Custom</Mode>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>[CountDistinct_issuer_name] &gt; 1 OR [CountDistinct_Issuer Country]&gt;1 OR [CountDis...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFilter" />
        </Node>
        <Node ToolID="15">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="1530" y="318" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="&quot;\\clbnas01\PriorityPass\Harshad\EVO Reporting\&quot;+DateTimeFormat(DateTimeNow(),&quot;%Y%m%d_EVOReporting_RAW&quot;)+&quot;.xlsx|||Sheet1&quot; " field="FileLocation" size="1073741823" type="V_WString" />
                <FormulaField expression="&quot;\\clbnas01\PriorityPass\Harshad\EVO Reporting\&quot;+DateTimeFormat(DateTimeNow(),&quot;%Y%m%d_EVOReporting_RAW_HSBC&quot;)+&quot;.xlsx|||Sheet1&quot; " field="HSBCTestingFile" size="1073741823" type="V_WString" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>FileLocation = "\\clbnas01\PriorityPass\Harshad\EVO Reporting\"+DateTimeFormat(D...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="16">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="1566" y="438" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="&quot;\\clbnas01\PriorityPass\Harshad\EVO Reporting\&quot;+DateTimeFormat(DateTimeNow(),&quot;%Y%m%d_EVOReporting&quot;)+&quot;.xlsx|||Sheet1&quot; " field="FileLocation" size="1073741823" type="V_WString" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>FileLocation = "\\clbnas01\PriorityPass\Harshad\EVO Reporting\"+DateTimeFormat(D...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="17">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="1758" y="438" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="True" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="id" selected="True" />
                <SelectField field="transaction_type" selected="True" />
                <SelectField field="transaction_initiated_by" selected="True" />
                <SelectField field="description1" selected="True" rename="description" />
                <SelectField field="description" selected="False" />
                <SelectField field="Currency" selected="True" />
                <SelectField field="amount" selected="True" />
                <SelectField field="transaction_state" selected="True" />
                <SelectField field="transaction_created_date" selected="False" />
                <SelectField field="consumer_id" selected="False" />
                <SelectField field="response_payload_error_code" selected="False" />
                <SelectField field="response_payload_error_code_description" selected="False" />
                <SelectField field="Ppass_source_code" selected="True" />
                <SelectField field="denied_delivery/delivery_date_utc" selected="False" />
                <SelectField field="Consumer Name" selected="True" />
                <SelectField field="Consumer number" selected="False" />
                <SelectField field="Payments Order number" selected="False" />
                <SelectField field="error_code" selected="False" />
                <SelectField field="IsDelivery" selected="False" />
                <SelectField field="Product" selected="True" />
                <SelectField field="Visit ID" selected="True" />
                <SelectField field="Device ID" selected="True" />
                <SelectField field="Date" selected="True" />
                <SelectField field="Time" selected="True" />
                <SelectField field="Status" selected="True" />
                <SelectField field="Finance status" selected="True" />
                <SelectField field="Outcome" selected="True" />
                <SelectField field="lounge_code" selected="True" />
                <SelectField field="country_code" selected="True" />
                <SelectField field="Network" selected="True" />
                <SelectField field="Issuer" selected="True" />
                <SelectField field="Last Transaction" selected="True" />
                <SelectField field="Source C" selected="True" />
                <SelectField field="Order Ref" selected="True" />
                <SelectField field="Consumer No" selected="True" />
                <SelectField field="Summary Status" selected="True" />
                <SelectField field="PilotWave" selected="True" />
                <SelectField field="Source Type" selected="False" />
                <SelectField field="CountDistinct_client_name" selected="False" />
                <SelectField field="IssuerCountry" selected="True" />
                <SelectField field="LoadedDate" selected="True" />
                <SelectField field="FileLocation" selected="True" />
                <SelectField field="scaEnabled" selected="False" />
                <SelectField field="paymentCardVerificationDuringConsumption" selected="False" />
                <SelectField field="row1#" selected="False" />
                <SelectField field="lounge_programme" selected="True" />
                <SelectField field="User Journey Code" selected="True" />
                <SelectField field="Flag for Source Code" selected="True" />
                <SelectField field="transaction_Source_code" selected="True" />
                <SelectField field="_userJourneyCode" selected="True" />
                <SelectField field="source_media" selected="True" />
                <SelectField field="owner_product" selected="True" />
                <SelectField field="source_desc" selected="True" />
                <SelectField field="Product Type" selected="True" />
                <SelectField field="Event" selected="True" />
                <SelectField field="PaymentType" selected="True" />
                <SelectField field="Category" selected="True" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="18">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Filter.Filter">
            <Position x="1478" y="604" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Expression>Contains([description],"LK Visit CIT") or Contains([description],"LK Visit MIT") OR
Contains([description],"LK subscription") OR
Contains([description],"LK Visit No Authentication")</Expression>
              <Mode>Custom</Mode>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>Contains([description],"LK Visit CIT") or Contains([description],"LK Visit MIT")...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFilter" />
        </Node>
        <Node ToolID="19">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="1574" y="604" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="&quot;\\clbnas01\PriorityPass\Harshad\EVO Reporting\&quot;+DateTimeFormat(DateTimeNow(),&quot;%Y%m%d_EVOReporting_Filtered&quot;)+&quot;.xlsx|||Sheet1&quot; " field="FileLocation" size="1073741823" type="V_WString" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>FileLocation = "\\clbnas01\PriorityPass\Harshad\EVO Reporting\"+DateTimeFormat(D...</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="20">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="1670" y="604" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="True" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="id" selected="True" />
                <SelectField field="transaction_type" selected="True" />
                <SelectField field="transaction_initiated_by" selected="True" />
                <SelectField field="description1" selected="True" rename="description" />
                <SelectField field="description" selected="False" />
                <SelectField field="Currency" selected="True" />
                <SelectField field="amount" selected="True" />
                <SelectField field="transaction_state" selected="True" />
                <SelectField field="transaction_created_date" selected="False" />
                <SelectField field="consumer_id" selected="False" />
                <SelectField field="response_payload_error_code" selected="False" />
                <SelectField field="response_payload_error_code_description" selected="False" />
                <SelectField field="Ppass_source_code" selected="True" />
                <SelectField field="denied_delivery/delivery_date_utc" selected="False" />
                <SelectField field="Consumer Name" selected="True" />
                <SelectField field="Consumer number" selected="False" />
                <SelectField field="Payments Order number" selected="False" />
                <SelectField field="error_code" selected="False" />
                <SelectField field="IsDelivery" selected="False" />
                <SelectField field="Product" selected="True" />
                <SelectField field="Visit ID" selected="True" />
                <SelectField field="Device ID" selected="True" />
                <SelectField field="Date" selected="True" />
                <SelectField field="Time" selected="True" />
                <SelectField field="Status" selected="True" />
                <SelectField field="Finance status" selected="True" />
                <SelectField field="Outcome" selected="True" />
                <SelectField field="lounge_code" selected="True" />
                <SelectField field="country_code" selected="True" />
                <SelectField field="Network" selected="True" />
                <SelectField field="Issuer" selected="True" />
                <SelectField field="Last Transaction" selected="True" />
                <SelectField field="Source C" selected="True" />
                <SelectField field="Order Ref" selected="True" />
                <SelectField field="Consumer No" selected="True" />
                <SelectField field="Summary Status" selected="True" />
                <SelectField field="PilotWave" selected="True" />
                <SelectField field="Source Type" selected="False" />
                <SelectField field="CountDistinct_client_name" selected="False" />
                <SelectField field="IssuerCountry" selected="True" />
                <SelectField field="LoadedDate" selected="True" />
                <SelectField field="FileLocation" selected="True" />
                <SelectField field="scaEnabled" selected="False" />
                <SelectField field="paymentCardVerificationDuringConsumption" selected="False" />
                <SelectField field="row1#" selected="False" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="23">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Formula.Formula">
            <Position x="385" y="239" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <FormulaFields>
                <FormulaField expression="if [Consumer No]=&quot;0&quot; then &quot;&quot; else [Consumer No] endif" field="Consumer No" size="21" type="V_String" />
              </FormulaFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText><![CDATA[Consumer No = if [Consumer No]="0" then "" else [Consumer No] endif
]]></DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFormula" />
        </Node>
        <Node ToolID="24">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="289" y="239" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="False" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="Consumer number" selected="True" type="V_String" size="21" />
                <SelectField field="Time" selected="True" type="Time" size="8" />
                <SelectField field="Consumer No" selected="True" type="V_String" size="21" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="25">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="1430" y="316" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="True" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="id" selected="True" />
                <SelectField field="transaction_type" selected="True" />
                <SelectField field="transaction_initiated_by" selected="True" />
                <SelectField field="description" selected="True" />
                <SelectField field="Currency" selected="True" />
                <SelectField field="amount" selected="True" />
                <SelectField field="transaction_state" selected="True" />
                <SelectField field="transaction_created_date" selected="True" />
                <SelectField field="consumer_id" selected="True" />
                <SelectField field="response_payload_error_code" selected="True" />
                <SelectField field="response_payload_error_code_description" selected="True" />
                <SelectField field="Ppass_source_code" selected="True" />
                <SelectField field="denied_delivery/delivery_date_utc" selected="True" />
                <SelectField field="Consumer Name" selected="True" />
                <SelectField field="Consumer number" selected="True" />
                <SelectField field="Payments Order number" selected="True" />
                <SelectField field="error_code" selected="True" />
                <SelectField field="IsDelivery" selected="True" />
                <SelectField field="Product" selected="True" />
                <SelectField field="Visit ID" selected="True" />
                <SelectField field="Device ID" selected="True" />
                <SelectField field="Date" selected="True" />
                <SelectField field="Time" selected="True" />
                <SelectField field="Status" selected="True" />
                <SelectField field="Finance status" selected="True" />
                <SelectField field="Outcome" selected="True" />
                <SelectField field="lounge_code" selected="True" />
                <SelectField field="country_code" selected="True" />
                <SelectField field="Network" selected="True" />
                <SelectField field="Issuer" selected="True" />
                <SelectField field="Last Transaction" selected="True" />
                <SelectField field="Source C" selected="True" />
                <SelectField field="Order Ref" selected="True" />
                <SelectField field="Consumer No" selected="True" />
                <SelectField field="scaEnabled" selected="True" />
                <SelectField field="paymentCardVerificationDuringConsumption" selected="True" />
                <SelectField field="PilotWave" selected="True" />
                <SelectField field="Source Type" selected="True" />
                <SelectField field="LoadedDate" selected="True" />
                <SelectField field="CountDistinct_client_name" selected="False" />
                <SelectField field="IssuerCountry" selected="True" />
                <SelectField field="User Journey Code" selected="True" />
                <SelectField field="Summary Status" selected="True" />
                <SelectField field="lounge_programme" selected="True" />
                <SelectField field="Flag for Source Code" selected="True" />
                <SelectField field="transaction_Source_code" selected="True" />
                <SelectField field="source_media" selected="True" />
                <SelectField field="owner_product" selected="True" />
                <SelectField field="source_desc" selected="True" />
                <SelectField field="Product Type" selected="True" />
                <SelectField field="_userJourneyCode" selected="True" />
                <SelectField field="Event" selected="True" />
                <SelectField field="PaymentType" selected="True" />
                <SelectField field="Category" selected="True" />
                <SelectField field="row1#" selected="True" />
                <SelectField field="Product Type1" selected="True" />
                <SelectField field="servicecentre" selected="True" />
                <SelectField field="pk" selected="True" />
                <SelectField field="CountDistinct_deal_type" selected="True" />
                <SelectField field="*Unknown" selected="True" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="37">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Union.Union">
            <Position x="578" y="215" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <ByName_ErrorMode>Warning</ByName_ErrorMode>
              <ByName_OutputMode>All</ByName_OutputMode>
              <Mode>ByName</Mode>
              <SetOutputOrder value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnion" />
        </Node>
        <Node ToolID="38">
          <GuiSettings Plugin="AlteryxGuiToolkit.ToolContainer.ToolContainer">
            <Position x="1897" y="267" width="152" height="180" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Caption>Container 38</Caption>
              <Style TextColor="#314c4a" FillColor="#ecf2f2" BorderColor="#314c4a" Transparency="25" Margin="25" />
              <Disabled value="False" />
              <Folded value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <ChildNodes>
            <Node ToolID="9">
              <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileOutput.DbFileOutput">
                <Position x="1922" y="316" />
              </GuiSettings>
              <Properties>
                <Configuration>
                  <File MaxRecords="" FileFormat="25">%temp%temp.xlsx|||Sheet1</File>
                  <Passwords />
                  <FormatSpecificOptions>
                    <PreserveFormat>False</PreserveFormat>
                    <SkipFieldNames>False</SkipFieldNames>
                    <OutputOption>RemoveFile</OutputOption>
                  </FormatSpecificOptions>
                  <MultiFile value="True" />
                  <MultiFileType>Path</MultiFileType>
                  <MultiFileField>FileLocation</MultiFileField>
                  <KeepField value="False" />
                </Configuration>
                <Annotation DisplayMode="0">
                  <Name />
                  <DefaultAnnotationText>%temp%temp.xlsx
Query=Sheet1</DefaultAnnotationText>
                  <Left value="False" />
                </Annotation>
                <Dependencies>
                  <Implicit>
                    <Dependency Path="%temp%temp.xlsx" Package="False" IsMacro="False" IsOutput="True" IsAlias="False" />
                  </Implicit>
                </Dependencies>
              </Properties>
              <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileOutput" />
            </Node>
          </ChildNodes>
        </Node>
        <Node ToolID="32">
          <GuiSettings Plugin="AlteryxGuiToolkit.ToolContainer.ToolContainer">
            <Position x="1829" y="413" width="152" height="180" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Caption>Container 46</Caption>
              <Style TextColor="#314c4a" FillColor="#ecf2f2" BorderColor="#314c4a" Transparency="25" Margin="25" />
              <Disabled value="False" />
              <Folded value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <ChildNodes>
            <Node ToolID="31">
              <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileOutput.DbFileOutput">
                <Position x="1854" y="462" />
              </GuiSettings>
              <Properties>
                <Configuration>
                  <File MaxRecords="" FileFormat="25">%temp%temp.xlsx|||Sheet1</File>
                  <Passwords />
                  <FormatSpecificOptions>
                    <PreserveFormat>False</PreserveFormat>
                    <SkipFieldNames>False</SkipFieldNames>
                    <OutputOption>RemoveFile</OutputOption>
                  </FormatSpecificOptions>
                  <MultiFile value="True" />
                  <MultiFileType>Path</MultiFileType>
                  <MultiFileField>FileLocation</MultiFileField>
                  <KeepField value="False" />
                </Configuration>
                <Annotation DisplayMode="0">
                  <Name />
                  <DefaultAnnotationText>%temp%temp.xlsx
Query=Sheet1</DefaultAnnotationText>
                  <Left value="False" />
                </Annotation>
                <Dependencies>
                  <Implicit>
                    <Dependency Path="%temp%temp.xlsx" Package="False" IsMacro="False" IsOutput="True" IsAlias="False" />
                  </Implicit>
                </Dependencies>
              </Properties>
              <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileOutput" />
            </Node>
          </ChildNodes>
        </Node>
        <Node ToolID="62">
          <GuiSettings Plugin="AlteryxGuiToolkit.ToolContainer.ToolContainer">
            <Position x="1741" y="603" width="152" height="180" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Caption>Container 62</Caption>
              <Style TextColor="#314c4a" FillColor="#ecf2f2" BorderColor="#314c4a" Transparency="25" Margin="25" />
              <Disabled value="False" />
              <Folded value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <ChildNodes>
            <Node ToolID="35">
              <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileOutput.DbFileOutput">
                <Position x="1766" y="652" />
              </GuiSettings>
              <Properties>
                <Configuration>
                  <File MaxRecords="" FileFormat="25">%temp%temp.xlsx|||Sheet1</File>
                  <Passwords />
                  <FormatSpecificOptions>
                    <PreserveFormat>False</PreserveFormat>
                    <SkipFieldNames>False</SkipFieldNames>
                    <OutputOption>RemoveFile</OutputOption>
                  </FormatSpecificOptions>
                  <MultiFile value="True" />
                  <MultiFileType>Path</MultiFileType>
                  <MultiFileField>FileLocation</MultiFileField>
                  <KeepField value="False" />
                </Configuration>
                <Annotation DisplayMode="0">
                  <Name />
                  <DefaultAnnotationText>%temp%temp.xlsx
Query=Sheet1</DefaultAnnotationText>
                  <Left value="False" />
                </Annotation>
                <Dependencies>
                  <Implicit>
                    <Dependency Path="%temp%temp.xlsx" Package="False" IsMacro="False" IsOutput="True" IsAlias="False" />
                  </Implicit>
                </Dependencies>
              </Properties>
              <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileOutput" />
            </Node>
          </ChildNodes>
        </Node>
        <Node ToolID="63">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Filter.Filter">
            <Position x="1620" y="192" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Expression>[LoadedDate]&gt;= DateTimeAdd(DateTimeNow(),-30,"days")</Expression>
              <Mode>Custom</Mode>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>[LoadedDate]&gt;= DateTimeAdd(DateTimeNow(),-30,"days")</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFilter" />
        </Node>
        <Node ToolID="65">
          <GuiSettings Plugin="AlteryxGuiToolkit.ToolContainer.ToolContainer">
            <Position x="1727" y="103" width="152" height="180" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Caption>Container 65</Caption>
              <Style TextColor="#314c4a" FillColor="#ecf2f2" BorderColor="#314c4a" Transparency="25" Margin="25" />
              <Disabled value="False" />
              <Folded value="False" />
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <ChildNodes>
            <Node ToolID="64">
              <GuiSettings Plugin="AlteryxBasePluginsGui.DbFileOutput.DbFileOutput">
                <Position x="1752" y="152" />
              </GuiSettings>
              <Properties>
                <Configuration>
                  <File MaxRecords="" FileFormat="25">%temp%temp.xlsx|||Sheet1</File>
                  <Passwords />
                  <FormatSpecificOptions>
                    <PreserveFormat>False</PreserveFormat>
                    <SkipFieldNames>False</SkipFieldNames>
                    <OutputOption>RemoveFile</OutputOption>
                  </FormatSpecificOptions>
                  <MultiFile value="True" />
                  <MultiFileType>Path</MultiFileType>
                  <MultiFileField>HSBCTestingFile</MultiFileField>
                  <KeepField value="False" />
                </Configuration>
                <Annotation DisplayMode="0">
                  <Name />
                  <DefaultAnnotationText>%temp%temp.xlsx
Query=Sheet1</DefaultAnnotationText>
                  <Left value="False" />
                </Annotation>
                <Dependencies>
                  <Implicit>
                    <Dependency Path="%temp%temp.xlsx" Package="False" IsMacro="False" IsOutput="True" IsAlias="False" />
                  </Implicit>
                </Dependencies>
              </Properties>
              <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxDbFileOutput" />
            </Node>
          </ChildNodes>
        </Node>
        <Node ToolID="67">
          <GuiSettings Plugin="AlteryxBasePluginsGui.AlteryxSelect.AlteryxSelect">
            <Position x="270" y="164" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <OrderChanged value="True" />
              <CommaDecimal value="False" />
              <SelectFields>
                <SelectField field="client_name" selected="True" />
                <SelectField field="source_code" selected="True" />
                <SelectField field="prefix" selected="False" />
                <SelectField field="ica" selected="False" />
                <SelectField field="reporting_ica" selected="False" />
                <SelectField field="bin" selected="False" />
                <SelectField field="group_code" selected="False" />
                <SelectField field="issuer_name" selected="True" />
                <SelectField field="clean_issuer_name" selected="False" />
                <SelectField field="country_of_issue_iso" selected="False" />
                <SelectField field="country_of_issue" selected="True" />
                <SelectField field="cg_region_of_issue" selected="False" />
                <SelectField field="client_region_of_issue" selected="False" />
                <SelectField field="client_sub_region_of_issue" selected="False" />
                <SelectField field="lounge_programme" selected="True" />
                <SelectField field="model" selected="False" />
                <SelectField field="deal_type" selected="True" />
                <SelectField field="deal_status" selected="False" />
                <SelectField field="deal_start_date" selected="False" />
                <SelectField field="deal_cancellation_date" selected="False" />
                <SelectField field="client_service_centre" selected="False" />
                <SelectField field="contract_type" selected="False" />
                <SelectField field="card_type" selected="False" />
                <SelectField field="membership_fee_currency" selected="False" />
                <SelectField field="membership_fee" selected="False" />
                <SelectField field="selected_non_selected" selected="False" />
                <SelectField field="po_charge_type" selected="False" />
                <SelectField field="billing_inclusion_lounge_visits" selected="False" />
                <SelectField field="billing_inclusion_memberships" selected="False" />
                <SelectField field="decline" selected="False" />
                <SelectField field="bid" selected="False" />
                <SelectField field="lounge_set_selected" selected="False" />
                <SelectField field="lv_report_credit_card_type" selected="False" />
                <SelectField field="consolidated_report" selected="False" />
                <SelectField field="currency" selected="False" />
                <SelectField field="created_dt" selected="False" />
                <SelectField field="*Unknown" selected="False" />
              </SelectFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxSelect" />
        </Node>
        <Node ToolID="68">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Unique.Unique">
            <Position x="346" y="164" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <UniqueFields>
                <Field field="client_name" />
                <Field field="source_code" />
                <Field field="issuer_name" />
                <Field field="country_of_issue" />
                <Field field="lounge_programme" />
                <Field field="deal_type" />
              </UniqueFields>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText />
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxUnique" />
        </Node>
        <Node ToolID="73">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Filter.Filter">
            <Position x="1686" y="318" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Expression>[LoadedDate]&gt;= DateTimeAdd(DateTimeNow(),-30,"days")</Expression>
              <Mode>Custom</Mode>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>[LoadedDate]&gt;= DateTimeAdd(DateTimeNow(),-30,"days")</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFilter" />
        </Node>
        <Node ToolID="74">
          <GuiSettings Plugin="AlteryxBasePluginsGui.Filter.Filter">
            <Position x="1662" y="438" />
          </GuiSettings>
          <Properties>
            <Configuration>
              <Expression>[LoadedDate]&gt;= DateTimeAdd(DateTimeNow(),-30,"days")</Expression>
              <Mode>Custom</Mode>
            </Configuration>
            <Annotation DisplayMode="0">
              <Name />
              <DefaultAnnotationText>[LoadedDate]&gt;= DateTimeAdd(DateTimeNow(),-30,"days")</DefaultAnnotationText>
              <Left value="False" />
            </Annotation>
          </Properties>
          <EngineSettings EngineDll="AlteryxBasePluginsEngine.dll" EngineDllEntryPoint="AlteryxFilter" />
        </Node>
      </ChildNodes>
    </Node>
  </Nodes>
  <Connections>
    <Connection>
      <Origin ToolID="39" Connection="Output" />
      <Destination ToolID="69" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="40" Connection="Output" />
      <Destination ToolID="53" Connection="Input" />
    </Connection>
    <Connection name="#1">
      <Origin ToolID="41" Connection="Join" />
      <Destination ToolID="54" Connection="Input" />
    </Connection>
    <Connection name="#2">
      <Origin ToolID="41" Connection="Right" />
      <Destination ToolID="54" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="42" Connection="Output" />
      <Destination ToolID="43" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="43" Connection="Unique" />
      <Destination ToolID="46" Connection="Left" />
    </Connection>
    <Connection>
      <Origin ToolID="51" Connection="True" />
      <Destination ToolID="46" Connection="Right" />
    </Connection>
    <Connection>
      <Origin ToolID="44" Connection="Output" />
      <Destination ToolID="51" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="45" Connection="Unique" />
      <Destination ToolID="44" Connection="Input" />
    </Connection>
    <Connection name="#1">
      <Origin ToolID="46" Connection="Join" />
      <Destination ToolID="50" Connection="Input" />
    </Connection>
    <Connection name="#2">
      <Origin ToolID="46" Connection="Left" />
      <Destination ToolID="50" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="47" Connection="Output" />
      <Destination ToolID="48" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="48" Connection="Output" />
      <Destination ToolID="49" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="49" Connection="Unique" />
      <Destination ToolID="56" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="50" Connection="Output" />
      <Destination ToolID="47" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="52" Connection="Output" />
      <Destination ToolID="41" Connection="Right" />
    </Connection>
    <Connection>
      <Origin ToolID="70" Connection="Unique" />
      <Destination ToolID="41" Connection="Left" />
    </Connection>
    <Connection>
      <Origin ToolID="53" Connection="Output" />
      <Destination ToolID="52" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="54" Connection="Output" />
      <Destination ToolID="42" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="54" Connection="Output" />
      <Destination ToolID="45" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="55" Connection="Output" />
      <Destination ToolID="28" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="56" Connection="Output" />
      <Destination ToolID="55" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="28" Connection="Output" />
      <Destination ToolID="29" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="29" Connection="Output" />
      <Destination ToolID="27" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="29" Connection="Output" />
      <Destination ToolID="60" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="60" Connection="Output" />
      <Destination ToolID="72" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="69" Connection="Output" />
      <Destination ToolID="70" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="72" Connection="True" />
      <Destination ToolID="59" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="1" Connection="Output" />
      <Destination ToolID="67" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="2" Connection="Output" />
      <Destination ToolID="24" Connection="Input" />
    </Connection>
    <Connection name="#1">
      <Origin ToolID="3" Connection="Join" />
      <Destination ToolID="37" Connection="Input" />
    </Connection>
    <Connection name="#2">
      <Origin ToolID="3" Connection="Right" />
      <Destination ToolID="37" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="4" Connection="Output" />
      <Destination ToolID="5" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="5" Connection="Unique" />
      <Destination ToolID="8" Connection="Left" />
    </Connection>
    <Connection>
      <Origin ToolID="14" Connection="True" />
      <Destination ToolID="8" Connection="Right" />
    </Connection>
    <Connection>
      <Origin ToolID="6" Connection="Output" />
      <Destination ToolID="14" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="7" Connection="Unique" />
      <Destination ToolID="6" Connection="Input" />
    </Connection>
    <Connection name="#1">
      <Origin ToolID="8" Connection="Join" />
      <Destination ToolID="13" Connection="Input" />
    </Connection>
    <Connection name="#2">
      <Origin ToolID="8" Connection="Left" />
      <Destination ToolID="13" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="10" Connection="Output" />
      <Destination ToolID="11" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="11" Connection="Output" />
      <Destination ToolID="12" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="12" Connection="Unique" />
      <Destination ToolID="18" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="12" Connection="Unique" />
      <Destination ToolID="16" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="12" Connection="Unique" />
      <Destination ToolID="25" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="13" Connection="Output" />
      <Destination ToolID="10" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="15" Connection="Output" />
      <Destination ToolID="63" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="15" Connection="Output" />
      <Destination ToolID="73" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="16" Connection="Output" />
      <Destination ToolID="74" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="17" Connection="Output" />
      <Destination ToolID="31" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="18" Connection="True" />
      <Destination ToolID="19" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="19" Connection="Output" />
      <Destination ToolID="20" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="20" Connection="Output" />
      <Destination ToolID="35" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="23" Connection="Output" />
      <Destination ToolID="3" Connection="Right" />
    </Connection>
    <Connection>
      <Origin ToolID="68" Connection="Unique" />
      <Destination ToolID="3" Connection="Left" />
    </Connection>
    <Connection>
      <Origin ToolID="24" Connection="Output" />
      <Destination ToolID="23" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="25" Connection="Output" />
      <Destination ToolID="15" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="37" Connection="Output" />
      <Destination ToolID="4" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="37" Connection="Output" />
      <Destination ToolID="7" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="63" Connection="True" />
      <Destination ToolID="64" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="67" Connection="Output" />
      <Destination ToolID="68" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="73" Connection="True" />
      <Destination ToolID="9" Connection="Input" />
    </Connection>
    <Connection>
      <Origin ToolID="74" Connection="True" />
      <Destination ToolID="17" Connection="Input" />
    </Connection>
  </Connections>
  <Properties>
    <Memory default="True" />
    <GlobalRecordLimit value="0" />
    <TempFiles default="True" />
    <Annotation on="True" includeToolName="False" />
    <ConvErrorLimit value="10" />
    <ConvErrorLimit_Stop value="False" />
    <CancelOnError value="False" />
    <DisableBrowse value="False" />
    <EnablePerformanceProfiling value="False" />
    <RunWithE2 value="True" />
    <PredictiveToolsCodePage value="1252" />
    <DisableAllOutput value="False" />
    <ShowAllMacroMessages value="False" />
    <ShowConnectionStatusIsOn value="True" />
    <ShowConnectionStatusOnlyWhenRunning value="True" />
    <ZoomLevel value="0" />
    <LayoutType>Horizontal</LayoutType>
    <MetaInfo>
      <NameIsFileName value="True" />
      <Name>EVO Reporting (SCA Reporting) v2</Name>
      <Description />
      <RootToolName />
      <ToolVersion />
      <ToolInDb value="False" />
      <CategoryName />
      <SearchTags />
      <Author />
      <Company />
      <Copyright />
      <DescriptionLink actual="" displayed="" />
      <Example>
        <Description />
        <File />
      </Example>
      <WorkflowId value="b58bb9b5-76c5-4112-bf1d-12f9a1fd5309" />
      <Telemetry>
        <PreviousWorkflowId value="65f2878c-38ca-4597-8a51-417c5e10ab81" />
        <OriginWorkflowId value="18ecdd6d-3923-44ac-ae6a-36fc74f06e27" />
      </Telemetry>
    </MetaInfo>
    <Events>
      <Enabled value="True" />
    </Events>
  </Properties>
</AlteryxDocument>